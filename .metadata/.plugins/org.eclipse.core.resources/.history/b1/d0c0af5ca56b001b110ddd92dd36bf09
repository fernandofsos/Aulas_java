package br.org.isgh.paciente.forms;

import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.io.Serializable;
import java.net.MalformedURLException;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;
import java.text.DecimalFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Calendar;
import java.util.Collections;
import java.util.Comparator;
import java.util.Date;
import java.util.HashMap;
import java.util.Iterator;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;
import java.util.Map.Entry;

import javax.faces.application.FacesMessage;
import javax.faces.context.FacesContext;
import javax.faces.event.ActionEvent;
import javax.faces.model.SelectItem;
import javax.servlet.ServletOutputStream;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.hibernate.Criteria;
import org.hibernate.FlushMode;
import org.hibernate.Session;
import org.hibernate.Transaction;

import com.matrixsaude.protocolomatrix.WebServiceMatrix;

import br.com.dicomtix.impl.DicomtixSincronizacao;
import br.com.isgh.almox.ws.PrescricaoJason;
import br.com.statix.dicom.worklist.integrator.dao.WorkListDao;
import br.com.statix.dicom.worklist.integrator.model.WorkListModel;
import br.org.isgh.ambulatorio.beans.InternacaoBean;
import br.org.isgh.ambulatorio.beans.InternacaoLeitoBean;
import br.org.isgh.ambulatorio.beans.InternacaoTransBean;
import br.org.isgh.ambulatorio.impl.InternacaoLeitoImpl;
import br.org.isgh.ambulatorio.impl.InternacaoTransImpl;
import br.org.isgh.paciente.beans.AcidenteRegiaoAfetada;
import br.org.isgh.paciente.beans.AtendimentoChikungunya;
import br.org.isgh.paciente.beans.AtendimentoDengue;
import br.org.isgh.paciente.beans.Cid10;
import br.org.isgh.paciente.beans.ClassificacaoRisco;
import br.org.isgh.paciente.beans.Destino;
import br.org.isgh.paciente.beans.DestinoMedico;
import br.org.isgh.paciente.beans.EmailSepse;
import br.org.isgh.paciente.beans.EspecialidadeEmergencia;
import br.org.isgh.paciente.beans.EvolucaoSepse;
import br.org.isgh.paciente.beans.EvolucaoSepseSinais;
import br.org.isgh.paciente.beans.ExameSolic;
import br.org.isgh.paciente.beans.Fluxograma;
import br.org.isgh.paciente.beans.FocoPrescricaoSepse;
import br.org.isgh.paciente.beans.FocoSepse;
import br.org.isgh.paciente.beans.Internacao;
import br.org.isgh.paciente.beans.InternacaoAtendimento;
import br.org.isgh.paciente.beans.InternacaoAtendimentoAcidente;
import br.org.isgh.paciente.beans.InternacaoAtendimentoCausa;
import br.org.isgh.paciente.beans.InternacaoAtendimentoProcedimento;
import br.org.isgh.paciente.beans.InternacaoLeito;
import br.org.isgh.paciente.beans.ItemDengue;
import br.org.isgh.paciente.beans.JustificativaReposicaoVolemica;
import br.org.isgh.paciente.beans.Leito;
import br.org.isgh.paciente.beans.Paciente;
import br.org.isgh.paciente.beans.Parametro;
import br.org.isgh.paciente.beans.PosicaoAcidente;
import br.org.isgh.paciente.beans.PrescricaoItemSepse;
import br.org.isgh.paciente.beans.PrescricaoPepItemContadorAntib;
import br.org.isgh.paciente.beans.PrescricaoPepItemDietaZero;
import br.org.isgh.paciente.beans.Procedimento;
import br.org.isgh.paciente.beans.ProtocoloSepse;
import br.org.isgh.paciente.beans.ProtocoloSepseSinais;
import br.org.isgh.paciente.beans.ProtocoloSepseSinaisResp;
import br.org.isgh.paciente.beans.RegiaoAfetada;
import br.org.isgh.paciente.beans.Risco;
import br.org.isgh.paciente.beans.SinaisSirs;
import br.org.isgh.paciente.beans.SinaisSirsRisco;
import br.org.isgh.paciente.beans.TipoAcidenteVeiculo;
import br.org.isgh.paciente.beans.TipoFoco;
import br.org.isgh.paciente.beans.VolumePrescricaoSepse;
import br.org.isgh.paciente.enumeracoes.EnumAtendimentoMedico;
import br.org.isgh.paciente.enumeracoes.EnumMotivosAlta;
import br.org.isgh.paciente.facade.AcidenteRegiaoAfetadaFacade;
import br.org.isgh.paciente.facade.AtendimentoChikungunyaFacade;
import br.org.isgh.paciente.facade.AtendimentoDengueFacade;
import br.org.isgh.paciente.facade.Cid10Facade;
import br.org.isgh.paciente.facade.ClassificacaoRiscoFacade;
import br.org.isgh.paciente.facade.DestinoFacade;
import br.org.isgh.paciente.facade.ExameSolicFacade;
import br.org.isgh.paciente.facade.InternacaoAtendimentoAcidenteFacade;
import br.org.isgh.paciente.facade.InternacaoAtendimentoCausaFacade;
import br.org.isgh.paciente.facade.InternacaoAtendimentoFacade;
import br.org.isgh.paciente.facade.InternacaoFacade;
import br.org.isgh.paciente.facade.PacienteFacade;
import br.org.isgh.paciente.facade.PosicaoAcidenteFacade;
import br.org.isgh.paciente.facade.RegiaoAfetadaFacade;
import br.org.isgh.paciente.facade.TipoAcidenteVeiculoFacade;
import br.org.isgh.paciente.facade.impl.AcidenteRegiaoAfetadaFacadeImpl;
import br.org.isgh.paciente.facade.impl.AtendimentoChikungunyaFacadeImpl;
import br.org.isgh.paciente.facade.impl.AtendimentoDengueFacadeImpl;
import br.org.isgh.paciente.facade.impl.Cid10FacadeImpl;
import br.org.isgh.paciente.facade.impl.ClassificacaoRiscoFacadeImpl;
import br.org.isgh.paciente.facade.impl.DestinoFacadeImpl;
import br.org.isgh.paciente.facade.impl.DestinoMedicoFacadeImpl;
import br.org.isgh.paciente.facade.impl.EmailSepseFacadeImpl;
import br.org.isgh.paciente.facade.impl.EspecialidadeEmergenciaFacadeImpl;
import br.org.isgh.paciente.facade.impl.ExameSolicFacadeImpl;
import br.org.isgh.paciente.facade.impl.FluxogramaFacadeImpl;
import br.org.isgh.paciente.facade.impl.InternacaoAtendimentoAcidenteFacadeImpl;
import br.org.isgh.paciente.facade.impl.InternacaoAtendimentoCausaFacadeImpl;
import br.org.isgh.paciente.facade.impl.InternacaoAtendimentoFacadeImpl;
import br.org.isgh.paciente.facade.impl.InternacaoFacadeImpl;
import br.org.isgh.paciente.facade.impl.InternacaoLeitoFacadeImpl;
import br.org.isgh.paciente.facade.impl.PacienteFacadeImpl;
import br.org.isgh.paciente.facade.impl.PosicaoAcidenteFacadeImpl;
import br.org.isgh.paciente.facade.impl.PrescricaoUpaImpl;
import br.org.isgh.paciente.facade.impl.RegiaoAfetadaFacadeImpl;
import br.org.isgh.paciente.facade.impl.TipoAcidenteVeiculoFacadeImpl;
import br.org.isgh.paciente.impl.AtendimentoDengueImpl;
import br.org.isgh.paciente.impl.EvolucaoSepseImpl;
import br.org.isgh.paciente.impl.EvolucaoSepseSinaisImpl;
import br.org.isgh.paciente.impl.FocoPrescricaoSepseImpl;
import br.org.isgh.paciente.impl.FocoSepseImpl;
import br.org.isgh.paciente.impl.InternacaoAtendimentoImpl;
import br.org.isgh.paciente.impl.InternacaoAtendimentoProcedimentoImpl;
import br.org.isgh.paciente.impl.PrescricaoPepItemContadorAntibImpl;
import br.org.isgh.paciente.impl.PrescricaoPepItemDietaZeroImpl;
import br.org.isgh.paciente.impl.ProcedimentoImpl;
import br.org.isgh.paciente.impl.ProtocoloSepseImpl;
import br.org.isgh.paciente.impl.ProtocoloSepseSinaisImpl;
import br.org.isgh.paciente.impl.ProtocoloSepseSinaisRespImpl;
import br.org.isgh.paciente.impl.SinaisSirsImpl;
import br.org.isgh.paciente.impl.SinaisSirsRiscoImpl;
import br.org.isgh.paciente.impl.VolumePrescricaoSepseImpl;
import br.org.isgh.paciente.util.FuncUtil;
import br.org.isgh.paciente.util.ParametroImpl;
import br.org.isgh.paciente.vo.ExameSolicSemBaixaVO;
import br.org.isgh.paciente.vo.ExamesDengueVO;
import br.org.isgh.paciente.vo.PacienteEmergencia;
import br.org.isgh.paciente.vo.PacienteInternado;
import br.org.isgh.pep.beans.AssistenteSocialDeclaracaoBean;
import br.org.isgh.pep.beans.ExamePepBean;
import br.org.isgh.pep.beans.ExameSituacaoPepBean;
import br.org.isgh.pep.beans.ExameSolicDicomTempBean;
import br.org.isgh.pep.beans.ExameSolicTempBean;
import br.org.isgh.pep.beans.ExameSolicitacaoPepBean;
import br.org.isgh.pep.beans.ExameSolicitacaoWsDetalheBean;
import br.org.isgh.pep.beans.InternacaoAtendimentoPepBean;
import br.org.isgh.pep.beans.InternacaoChamadaPepBean;
import br.org.isgh.pep.beans.InternacaoDoc;
import br.org.isgh.pep.beans.InternacaoEvolucao;
import br.org.isgh.pep.beans.InternacaoPepBean;
import br.org.isgh.pep.beans.InternacaoPrescPep;
import br.org.isgh.pep.beans.InternacaoReferenciaBean;
import br.org.isgh.pep.beans.ItemInternacaoPrescPep;
import br.org.isgh.pep.beans.PacEmerOtmTemp;
import br.org.isgh.pep.beans.PacienteAlergia;
import br.org.isgh.pep.beans.PacienteEmergenciaOtimizadoBean;
import br.org.isgh.pep.beans.PacientePepBean;
import br.org.isgh.pep.beans.PrescricaoEnfermagemPep;
import br.org.isgh.pep.beans.PrescricaoPep;
import br.org.isgh.pep.beans.PrescricaoPepIs;
import br.org.isgh.pep.beans.PrescricaoPepItem;
import br.org.isgh.pep.beans.PrescricaoPepTemp;
import br.org.isgh.pep.beans.PrescricaoUpaBean;
import br.org.isgh.pep.beans.TipoPrescricaoPep;
import br.org.isgh.pep.facade.impl.ExameSolicDicomTempImpl;
import br.org.isgh.pep.facade.impl.ExameSolicTempFacadeImpl;
import br.org.isgh.pep.impl.AssistenteSocialDeclaracaoImpl;
import br.org.isgh.pep.impl.AssistenteSocialDeclaracaoTipoImpl;
import br.org.isgh.pep.impl.ExameImpl;
import br.org.isgh.pep.impl.ExameSituacaoImpl;
import br.org.isgh.pep.impl.ExameSolicitacaoImpl;
import br.org.isgh.pep.impl.ExameSolicitacaoWsDetalheImpl;
import br.org.isgh.pep.impl.InternacaoAtendimentoPepImpl;
import br.org.isgh.pep.impl.InternacaoChamadaImpl;
import br.org.isgh.pep.impl.InternacaoDocImpl;
import br.org.isgh.pep.impl.InternacaoDocTipoImpl;
import br.org.isgh.pep.impl.InternacaoEvolucaoImpl;
import br.org.isgh.pep.impl.InternacaoImpl;
import br.org.isgh.pep.impl.InternacaoPrescImpl;
import br.org.isgh.pep.impl.InternacaoReferenciaImpl;
import br.org.isgh.pep.impl.ItemInternacaoPrescImpl;
import br.org.isgh.pep.impl.PacEmerOtmTempImpl;
import br.org.isgh.pep.impl.PacienteAlergiaImpl;
import br.org.isgh.pep.impl.PacienteEmergenciaOtimizadoImpl;
import br.org.isgh.pep.impl.PacienteImpl;
import br.org.isgh.pep.impl.PrescricaoEnfermagemImpl;
import br.org.isgh.pep.impl.PrescricaoPepImpl;
import br.org.isgh.pep.impl.PrescricaoPepIsImpl;
import br.org.isgh.pep.impl.PrescricaoPepItemImpl;
import br.org.isgh.pep.impl.PrescricaoPepTempImpl;
import br.org.isgh.pep.impl.TipoPrescricaoPepImpl;
import br.org.isgh.seguranca.beans.Usuario;
import br.org.isgh.seguranca.beans.UsuarioGrupo;
import br.org.isgh.seguranca.impl.UsuarioImpl;
import br.org.isgh.seguranca.util.HibernateUtil;
import br.org.isgh.seguranca.util.criptografia.IsghEncodeDecode;
import br.org.isgh.seguranca.util.jsf.JSFUtil;
import br.org.isgh.seguranca.util.permissoes.ValidaPermissaoUsuario;
import br.org.isgh.ws.ConsumoToLifeWS;
import net.sf.jasperreports.engine.JRAbstractExporter;
import net.sf.jasperreports.engine.JRException;
import net.sf.jasperreports.engine.JRExporter;
import net.sf.jasperreports.engine.JRExporterParameter;
import net.sf.jasperreports.engine.JasperExportManager;
import net.sf.jasperreports.engine.JasperFillManager;
import net.sf.jasperreports.engine.JasperPrint;
import net.sf.jasperreports.engine.JasperReport;
import net.sf.jasperreports.engine.export.JRRtfExporter;
import net.sf.jasperreports.engine.util.JRLoader;

public class EmergenciaForm implements Serializable {
	/**
	 * avisoValidacao
	 */
	private static final long serialVersionUID = 1L;

	private static final String REPORT_NAME = "RelAtendimento";
	private static final String REPORT_NAME2 = "RelAtendimentoGeral";
	private static final String REPORT_NAME3 = "relatorioMedico";
	private static final String REPORT_NAME4 = "relPrescricaoEmergencia";
	private static final String REPORT_NAME5 = "relEvolucaoPaciente";
	private static final String REPORT_NAME6 = "relEvolucaoPacienteItem";
	private static final String REPORT_NAME7 = "relPrescricaoEnfermagem";
	private static final String REPORT_NAME8 = "relAberturaSepse";

	private static final int EXAME_SOLICITACAO_SITUACAO_CANCELADA = 3;
	private static final String IMG_NAME = new FuncUtil().retornaLogoBrasaoUpa();
	public static final int GRUPO_LABORATORIO = 3;
	private static final int VALIDAR_CAMPOS = 0;
	
	private PacienteEmergencia paciente = new PacienteEmergencia();
	private PacienteEmergenciaOtimizadoBean pacienteOtimizado = new PacienteEmergenciaOtimizadoBean();

	private List<PacienteEmergencia> lstPacientesEmergencia;
	private List<PacienteEmergencia> lstPacientesEmergenciaPendentes;
	private List<SelectItem> lstRiscos;
	private List<SelectItem> lstRiscosDengue;
	private List<SelectItem> lstEspecialidadeEmergencia;

	private ArrayList<SelectItem> sliReferencia = new ArrayList<SelectItem>();
	private ArrayList<SelectItem> sliEixos = new ArrayList<SelectItem>();
	private ArrayList<SelectItem> sliMotivosAlta;
	private ArrayList<SelectItem> sliFluxogramas;
	private ArrayList<SelectItem> sliDestinos;
	private ArrayList<SelectItem> sliAcidente;
	private ArrayList<SelectItem> sliAgressao;

	private List<ExamePepBean> listExameSelecionado;
	private Integer isnExameSolic;
	private Integer totaisRisco[] = new Integer[8];
	private Integer totalEmergencia = 0;
	private Integer avisoValidacao = 0;
	private Integer isnRisco = 0;
	private Integer isnEspecialidadeEmergencia = 0;

	private Integer isnReferencia = 0;
	private Integer isnDestino = 0;
	private Integer isnFluxograma = 0;

	private String usuario;
	private String senha;

	private String textoAtendimento = "";
	private String textoDiscriminador = "";

	private String hipotesesDiagnostico = "";
	private String comorbidade = "";

	private String strPeso = "";
	private String flgEmergencia;

	private String teste;

	private ClassificacaoRisco cr = new ClassificacaoRisco();
	private InternacaoAtendimento objIa = new InternacaoAtendimento();
	private Cid10 objCid10 = new Cid10();
	private InternacaoAtendimentoPepBean objIaPep = new InternacaoAtendimentoPepBean();

	private EnumMotivosAlta isnMotivoAlta = EnumMotivosAlta.SELECIONE;

	private Integer codNTI = Integer.parseInt(FuncUtil.obterCodigoSetorNTI());
	private Integer codNAC = Integer.parseInt(FuncUtil.obterCodigoSetorNAC());

	private boolean mostraPanelAtendimento = true;
	private Integer isnInternacao;

	private List<ExameSolicitacaoPepBean> lstExameSolicEmergencia;
	private List<PrescricaoUpaBean> lstPrescricao;
	private List<PrescricaoPepItem> lstPrescricaoPepItem;
	private List<PrescricaoPep> lstPrescricaoPepAnt;
	private List<PrescricaoPep> lstPrescricaoPepAtual;
	private List<PrescricaoPepItem> lstPrescricaoPepItemAtual;

	private List<PrescricaoPep> lstPrescricaoPep;
	private List<PrescricaoEnfermagemPep> lstPrescricaoEnfermagem = new ArrayList<PrescricaoEnfermagemPep>();
	private List<ItemInternacaoPrescPep> lstPrescricaoEnfermagemItem = new ArrayList<ItemInternacaoPrescPep>();
	private List<ItemInternacaoPrescPep> lstPrescricaoEnfermagemItemTemp = new ArrayList<ItemInternacaoPrescPep>();
	private List<ItemInternacaoPrescPep> lstPrescricaoEnfermagemItemInc = new ArrayList<ItemInternacaoPrescPep>();
	private List<ItemInternacaoPrescPep> lstPrescricaoEnfermagemItemUltima = new ArrayList<ItemInternacaoPrescPep>();
	private List<InternacaoPrescPep> lstPrescricaoEnfermagemPepi;
	private InternacaoPrescPep objInternacaoPrescricao = new InternacaoPrescPep();

	private List<SelectItem> sliPrescricaoPepTipo;
	private Integer isnPrescricaoPepTipo;
	private List<SelectItem> sliTipoPrescricaoPep;
	private Integer isnTipoPrescricaoPep;
	private List<SelectItem> sliTipoPrescricaoEnfermagemPep = new ArrayList<SelectItem>();
	private Integer isnTipoPrescricaoEnfermagemPep;
	private List<SelectItem> sliTipoPrescricaoEnfermagemPadrao = new ArrayList<SelectItem>();;
	private Integer isnTipoPrescricaoEnfermagemPadrao;

	private int codigo = 0;
	private Integer codigoErro;
	private String usuarioCoren = "";
	private String senhaAssinatura = "";

	private List<InternacaoDoc> listaInternacaoDoc;
	private List<InternacaoDoc> listaInternacaoDocAtestado;
	private List<AssistenteSocialDeclaracaoBean> listaDeclaracaoCompareciemtno;

	private Prescricao prescricao = new Prescricao();

	private String permissaoEnf;
	private String permissaoMed;
	private String permissaoOdonto;

	private String msgRelatorio;

	private Integer estadoDivPrescricao;

	FuncUtil funcUtil = new FuncUtil();
	private JSFUtil jsfUtil = new JSFUtil();

	private String url;
	private Boolean imprimirTodos;
	// manuntencao geracao arquivo SIL
	private String isnExameSolicAux;
	private String dscMnemonico;
	private String dscMnemonicoSil;
	
	private ExameSolicSemBaixaVO objExameSolicSemBaixaVO = new ExameSolicSemBaixaVO();
	
	private ExameSolicitacaoPepBean exameSolicLaudo;
	private Parametro codigoMatrixOrigem;
	private Parametro laboratorioInterfaceamento;
	private Parametro dicomInterfaceamento;

	private String[] imagensRiscos = { "risco_cinza.gif", "risco_vermelho.gif",
			"risco_laranja.gif", "risco_amarelo.gif", "risco_verde.gif",
			"risco_azul.gif", "risco_branco.gif", "risco_preto.gif" };

	private String filePath;

	// PrescricaoUpa
	private List<PrescricaoUpaBean> listaPrescricaoUpa = new ArrayList<PrescricaoUpaBean>();

	private boolean alterObjItensPrescritos;
	private String dscPrescricao;
	private String mensagemConfirmacao;
	private String mensagem;
	private String suspender;
	private Integer confInserir;

	private PrescricaoUpaBean prescricaoUpa;
	private PacienteInternado pacienteInternado;
	private Fluxograma objFluxograma = new Fluxograma();

	private String horInicialRisco = "";
	private Date datInicialRisco;

	private String horInicialAtendimento = "";
	private Date datInicialAtendimento;
	private List<InternacaoAtendimentoPepBean> listaInternacaoAtendimento;
	private boolean origemTelaRecpcao = true;
	private List<InternacaoEvolucao> listaEvolucao;
	private String dscEvolucao;
	private Integer isnInternacaoEvolucao;
	private boolean usuarioMedico = false;
	private String nomeProfissionalAtendimento;
	private boolean possuiChamada;
	private Integer isnEixoSelecionado;
	private Integer avisoLiberacaoPaciente;
	private boolean alta = false;
	private List<InternacaoTransBean> listaTransferencia;

	private InternacaoBean internacaoSelecionada;
	private List<InternacaoBean> listaInternacoes = new ArrayList<InternacaoBean>();
	private List<ExameSolicitacaoPepBean> listaExames;
	private List<PrescricaoPep> listaPrescricaoPep;
	private List<InternacaoAtendimento> listaAtendimentos;
	private List<InternacaoDoc> listaDocAtestado;
	private List<InternacaoDoc> listaDocReceituario;

	private Integer origemTelaParaAtendimento; // 1-EIXO; 2-PACIENTES EM
												// ATENDIMENTO;

	private PrescricaoPepItem objPrescricaoPepItem = new PrescricaoPepItem();

	private PrescricaoPepItem objPrescricaoPepItemCopia = new PrescricaoPepItem();

	private PrescricaoPep objPrescricaoPepCopia = new PrescricaoPep();

	private PrescricaoPep objPrescricaoPepRelatorio = new PrescricaoPep();

	private List<PacienteEmergenciaOtimizadoBean> listaPacientesRecepcao;
	private InternacaoReferenciaBean internacaoReferenciaBean;
	private Integer isnExameSolicWsDetalhe;

	private String paginaOrigem = "emergencia";

	private Date dataInicio;

	private boolean isPacienteNaRecepcao;
	private String dscCorGrupoDengue;
	private String cid10Atendimento;

	private Double peso;
	private Double altura;
	private String flgGestante;
	private String dscMedicamentos;
	private ExameSolicitacaoPepBean exameSolicPepBean;
	private Boolean flgDicom = false;

	private Integer pedidoBloqueado;
	private Integer avisoBaixarPaciente;
	private Integer numAtendimentos = 0;
	private InternacaoLeito internacaoLeitoAtual;
	private String flgAltaMedica;
	private Paciente objPaciente;
	
	private List<PacienteAlergia> lstPacienteAlergia;
	public PacienteAlergia pacienteAlergia;
	private boolean alertaAlergia = false;
	private String flgRiscoQueda;
	private Integer isnSepse;
	
	//variaveis para combos de acidente e agressao
	private InternacaoAtendimentoCausa internacaoAtendimentoCausaAcPai = new InternacaoAtendimentoCausa();
	private List<InternacaoAtendimentoCausa> listaInternacaoAtendimentoCausaAcPai;
	private InternacaoAtendimentoCausa internacaoAtendimentoCausaAcFilho = new InternacaoAtendimentoCausa();
	private List<InternacaoAtendimentoCausa> listaInternacaoAtendimentoCausaAcFilho;
	private InternacaoAtendimentoCausa internacaoAtendimentoCausaAg = new InternacaoAtendimentoCausa();
	private List<InternacaoAtendimentoCausa> listaInternacaoAtendimentoCausaAg;
	private List<TipoAcidenteVeiculo> listaTipoAcidenteVeiculo;
	private List<PosicaoAcidente> listaPosicaoAcidente;
	private List<RegiaoAfetada> listaRegiaoAfetada;
	
	private boolean flgDengue = false;
	private boolean flgMenor12 = false;
	private boolean flgChikungunya = false;
	private Date datSintomas=null;
	private AtendimentoDengue atendimentoDengue = new AtendimentoDengue();
	private Map<String,Boolean> checkMapAlerta = new HashMap<String,Boolean>();
	private Map<String,Boolean> checkMapSituacao = new HashMap<String,Boolean>();
	private Map<SinaisSirs,Boolean> checkMapSinaisSirs = new HashMap<SinaisSirs,Boolean>();
	private Map<ProtocoloSepseSinais,Boolean> checkMapProtocoloSepseSinais = new HashMap<ProtocoloSepseSinais,Boolean>();
	
	private List<String> itensDscAlerta;
	private List<String> itensDscSituacao;
	private boolean flgChoque = true;
	private boolean flgAlerta = false;
	private boolean flgSangramento = false;
	private boolean flgSituacaoExtra = false;
	private boolean flgLaco = false;
	private boolean flgPeso = false;
	private boolean flgLiberarConfirmar = false;
	private boolean flgAlertaPositivo = false;
	private boolean flgSituacaoPositivo = false;
	private boolean flgBloqueiaConfirmar;
	private String mensagemAlertaDengue;
	private String mensagemHidratacao;
	private String tipoGrupo;
	private Double pesoDengue;
	private String msgAlerta;
	private String fecharPanelDengue;
	private static final int GRUPO_A = 1;
	private static final int GRUPO_B = 2;
	private static final int GRUPO_C = 3;
	private static final int GRUPO_D = 4;
	private StringBuilder stringExame;
	private List<ItemDengue> itemDengue;
	private List<SinaisSirsRisco> sinaisSirsRisco;

	private Integer isnAtendimentoDengue;
	private InternacaoDoc internacaoDoc  = new InternacaoDoc();
	private boolean flgCid10Dengue= false;
	private Date datSintomaDengue;
	private Date datSintomaChikungunya;
	private ProtocoloSepse protocoloSepse = new ProtocoloSepse();
	private List<ProtocoloSepse> listProtocoloSepse = new ArrayList<ProtocoloSepse>();
	private List<ProtocoloSepse> listProtocoloSepseEnfermagem = new ArrayList<ProtocoloSepse>();
	
	private List<EvolucaoSepse> listEvolucaoSepseAtendimento = new ArrayList<EvolucaoSepse>();
	
	private List<ExameSolicitacaoPepBean> lstExameSolicSepse  = new ArrayList<ExameSolicitacaoPepBean>();
	private ClassificacaoRisco classificacaoRiscoSepse;
	private String strRiscoSepse = "";
	private Boolean mostrarBotaoCancelamentoSepse;
	
	//private List<String> listaCodigosSelecionadosTela1;
	private Integer isnSepsePaciente = 11;
	private List<SelectItem> sliProcedimentos;
	private Integer isnProcedimento;
	private List<InternacaoAtendimentoProcedimento> lstInternacaoAtendimentoProcedimentos = new ArrayList<InternacaoAtendimentoProcedimento>();
	private InternacaoAtendimentoProcedimento internacaoAtendimentoProcedimento = new InternacaoAtendimentoProcedimento();
	private String permitirFechaPanelAlergia;
	private List<SinaisSirs> listSinaisSirs;
	private List<SinaisSirsRisco> lstSinaisSirsRisco;
	private List<ProtocoloSepseSinais> lstProtocoloSepseSinais;
	private ProtocoloSepseSinais sinalClicado;
	private List<FocoPrescricaoSepse> lstFocoPrescricaoSepse;
	private List<FocoPrescricaoSepse> lstSubFocoPrescricaoSepse;
	private List<SelectItem> sliFocoSepse;
	private List<SelectItem> sliFocoPrescricaoSepse;
	private List<SelectItem> sliTipoFoco; 
	private List<SelectItem> sliSubTipoFoco; 
	private List<SelectItem> sliMedicamentosAgrupados; 
	private List<ProtocoloSepseSinaisResp> lstProtocoloSepseSinaisResp;
	private Integer viewPager = 0 ;
	private Boolean statusEtapa;
	private Boolean etapaFinalizada;
	private Integer isnFocoSepse;
	private Integer isnFocoPrescricaoSepse;
	private Integer isnTipoFoco;
	private Integer isnSubTipoFoco;
	private Integer indexList;
	private List<PrescricaoItemSepse> listPrescricoes;
	private String strProtocoloSepseSinaisResp = "";
	private List<SelectItem> sliVolumeSepse;
	
	static {
		try {
			Class.forName("org.hibernate.dialect.PostgreSQLDialect");
		} catch (ClassNotFoundException e) {
			e.printStackTrace();
		}
	}
	
	private InternacaoAtendimentoAcidente objIac;
	private Integer isnTipoAcidenteVeiculo;
	private Integer isnPosicaoAcidente;
	
	private String[] objsRegiaoAfetada;
	
	private Boolean erro = false;
	private String urlReport;
    private Boolean estaNaRecepcaoOuSalaDeEspera = false;
    private JustificativaReposicaoVolemica justificativaRepoVolemica = new JustificativaReposicaoVolemica();
    private ArrayList<SelectItem> slievolucaoSepseSinais;
    private List<EvolucaoSepseSinais> evolucaoSepseSinais;
    private EvolucaoSepse evolucaoSepse = new EvolucaoSepse();
    private String nomePanel;
    private static final int MAIOR_3_MENOR_6 = 0;
    private static final int MAIOR_6_MENOR_12 = 1;
    private static final int MAIOR_12_MENOR_22 = 2;
    private static final int MAIOR_22 = 3;
    private List<List<PrescricaoItemSepse>> lstAgrupamento = new ArrayList<>();
    
	/*
	 * Grava Emergencia no banco de dados.
	 */
	public EmergenciaForm() {
		try {
			JSFUtil util = new JSFUtil();

			this.verificaPermissaoAcao();
			this.setMsgRelatorio("ERRO");

			String parametro = ((HttpServletRequest) util.getFacesContext()
					.getExternalContext().getRequest())
					.getParameter("parametroRelatorio");

			if (parametro != null && !"".equalsIgnoreCase(parametro)
					&& parametro.equals("relISGH")) {
				this.relatorio();
				return;
			}

			if (!"/cs_recepcaoTablet.xhtml".equalsIgnoreCase(FacesContext
					.getCurrentInstance().getViewRoot().getViewId())
					&& !"/eixosEmergencia.xhtml".equalsIgnoreCase(FacesContext
							.getCurrentInstance().getViewRoot().getViewId())) {
				atualizarListaEmergencia();
			}

			codigoMatrixOrigem = (Parametro) util.getSession().getAttribute(
					"codigoMatrixOrigem");
			laboratorioInterfaceamento = (Parametro) util.getSession()
					.getAttribute("laboratorioInterfaceamento");
			dicomInterfaceamento = (Parametro) util.getSession().getAttribute(
					"dicomInterfaceamento");
			if (dicomInterfaceamento.getVlrParametro().equals("S")) {
				this.flgDicom = true;
			}
			// codigoMatrixOrigem = ParametroImpl.getInstancia().getOrInsert(new
			// Parametro(ParametroImpl.CODIGO_MATRIX_ORIGEM, "",""));
			// laboratorioInterfaceamento =
			// ParametroImpl.getInstancia().getOrInsert(new
			// Parametro(ParametroImpl.LABORATORIO_INTERFACEAMENTO, "",""));
			// dicomInterfaceamento = ParametroImpl.getInstancia().get(new
			// Parametro(ParametroImpl.DICOM_INTERFACEAMENTO),0);

			// List<Clinica> lstEixos = new
			// ClinicaFacadeImpl().listarClinicasEmergencia();
			// for (Clinica c : lstEixos) {
			// sliEixos.add(new SelectItem(c.getIsnClinica(),
			// c.getDscClinica()));
			// }
			//
			// // Referencia
			// List<Referencia> lstReferencia = new
			// ReferenciaFacadeImpl().listarReferencia();
			// sliReferencia.add(new SelectItem(0,""));
			// for (Referencia r : lstReferencia) {
			// sliReferencia.add(new SelectItem(r.getIsnReferencia(),
			// r.getDscReferencia()));
			// }
			
			
		} catch (Exception e) {
			e.printStackTrace();
		}
	}

	public void addInternacaoAtendimentoProcedimento() throws Exception{
		this.setMensagemConfirmacao(null);
		validaInternacaoAtendimento();
		if (getMensagemConfirmacao() != null){
			return;
		}
		
		InternacaoAtendimentoProcedimento iaProc = new InternacaoAtendimentoProcedimento();
		iaProc.setFlgAtivo("S");
		iaProc.setIsnInternacao(isnInternacao);
		iaProc.setIsnPc(isnProcedimento);
		iaProc.setIsnUsuarioSolicitacao(jsfUtil.getUsuarioLogado().getIsnUsuario());
		iaProc.setDatSolicitacao(new Date());		
		if (verificarSeExisteProcedimentoPrincipal(iaProc) == false){
			iaProc.setFlgPrincipal("S");
		}else{
			iaProc.setFlgPrincipal("N");
		}
		InternacaoAtendimentoProcedimentoImpl.getInstancia().inserir(iaProc);
		isnProcedimento = 0;
		sliProcedimentos = null;
		getSliProcedimentos();
		carregarInternacaoAtendimentoProcedimento();
	}
	
	public void carregarInternacaoAtendimentoProcedimento() throws Exception{
		InternacaoAtendimentoProcedimento iaProc = new InternacaoAtendimentoProcedimento();
		iaProc.setIsnInternacao(isnInternacao);
		lstInternacaoAtendimentoProcedimentos = InternacaoAtendimentoProcedimentoImpl.getInstancia().pesquisar(iaProc, InternacaoAtendimentoProcedimentoImpl.JOIN_USUARIO_SOLICITACAO | InternacaoAtendimentoProcedimentoImpl.JOIN_USUARIO_SUSPENSAO);
	}
	
	
	public void removerInternacaoAtendimentoProcedimento() throws Exception{
		boolean ehItemPrincipal = internacaoAtendimentoProcedimento.getFlgPrincipal().equals("S");
		if (ehItemPrincipal){
			internacaoAtendimentoProcedimento.setFlgPrincipal("N");
		}
		internacaoAtendimentoProcedimento.setFlgAtivo("N");
		internacaoAtendimentoProcedimento.setIsnUsuarioSuspensao(jsfUtil.getUsuarioLogado().getIsnUsuario());
		internacaoAtendimentoProcedimento.setDatSuspensao(new Date());		
		internacaoAtendimentoProcedimento = InternacaoAtendimentoProcedimentoImpl.getInstancia().alterar(internacaoAtendimentoProcedimento);
		
		if (ehItemPrincipal){
			atualizaItemFlgPrincipal(internacaoAtendimentoProcedimento);
		}
		
		internacaoAtendimentoProcedimento = new InternacaoAtendimentoProcedimento();
		carregarInternacaoAtendimentoProcedimento();
	}
	
	public void atualizaItemFlgPrincipal(InternacaoAtendimentoProcedimento atendimentoProcedimento) throws Exception{
		InternacaoAtendimentoProcedimento iaProc = new InternacaoAtendimentoProcedimento();
		iaProc.setIsnInternacao(atendimentoProcedimento.getIsnInternacao());
		iaProc.setFlgAtivo("S");
		List<InternacaoAtendimentoProcedimento> lstInternacaoAtendimentoProcedimentosTemp = InternacaoAtendimentoProcedimentoImpl.getInstancia().pesquisar(iaProc, InternacaoAtendimentoProcedimentoImpl.JOIN_USUARIO_SOLICITACAO | InternacaoAtendimentoProcedimentoImpl.JOIN_USUARIO_SUSPENSAO);
		if (lstInternacaoAtendimentoProcedimentosTemp.size() > 0){
			iaProc = lstInternacaoAtendimentoProcedimentosTemp.get(0);
			iaProc.setFlgPrincipal("S");
			InternacaoAtendimentoProcedimentoImpl.getInstancia().alterar(iaProc);
		}
	}
	
	public boolean verificarSeExisteProcedimentoPrincipal(InternacaoAtendimentoProcedimento atendimentoProcedimento) throws Exception{
		InternacaoAtendimentoProcedimento iaProc = new InternacaoAtendimentoProcedimento();
		iaProc.setIsnInternacao(atendimentoProcedimento.getIsnInternacao());
		iaProc.setFlgPrincipal("S");
		List<InternacaoAtendimentoProcedimento> lstInternacaoAtendimentoProcedimentosTemp = InternacaoAtendimentoProcedimentoImpl.getInstancia().pesquisar(iaProc, InternacaoAtendimentoProcedimentoImpl.JOIN_USUARIO_SOLICITACAO | InternacaoAtendimentoProcedimentoImpl.JOIN_USUARIO_SUSPENSAO);
		if (lstInternacaoAtendimentoProcedimentosTemp == null || lstInternacaoAtendimentoProcedimentosTemp.size() <= 0){
			return false;
		}else{
			return true;
		}
	
	}
	public void validaInternacaoAtendimento(){
		if (isnProcedimento == null || isnProcedimento.equals(0)){
			this.setMensagemConfirmacao("Selecione um procedimento!");
			return;
		}
		
//		for (InternacaoAtendimentoProcedimento iaProc : lstInternacaoAtendimentoProcedimentos) {
//			if (iaProc.getIsnPc().equals(isnProcedimento) && iaProc.getFlgAtivo().equals("S")){
//				this.setMensagemConfirmacao("Procedimento já foi adicionado, e o mesmo não pode ser adicionado novamente!");
//				return;
//			}
//		}
	}
	
	public boolean desabilitaImprimirExames() {
		/* altAnd */
		if (getLstExameSolicEmergencia() == null
				|| getLstExameSolicEmergencia().size() <= 0)
			return true;

		for (ExameSolicitacaoPepBean e : getLstExameSolicEmergencia()) {
			if (e.getImprimir())
				return false;
		}
		return true;
	}

	public void habilitaTodos() {
		if (imprimirTodos && getLstExameSolicEmergencia() != null
				&& getLstExameSolicEmergencia().size() > 0) {
			for (ExameSolicitacaoPepBean e : getLstExameSolicEmergencia()) {
				e.setImprimir(true);
			}
		} else if (imprimirTodos.equals(false)) {
			for (ExameSolicitacaoPepBean e : getLstExameSolicEmergencia()) {
				e.setImprimir(false);
			}
		}

	}

	private void verificaPermissaoAcao() throws Exception {
		this.setPermissaoEnf("");
		this.setPermissaoMed("");
		this.setPermissaoOdonto("");

		for (UsuarioGrupo ug : jsfUtil.getUsuarioLogado().getUsuarioGrupoBean()) {
			if (ug.getGrupoBean().getDscGrupo().equalsIgnoreCase("MEDICOS")) {
				if (jsfUtil.getUsuarioLogado().getIsnConselho() != null
						&& jsfUtil.getUsuarioLogado().getIsnConselho()
								.intValue() > 0
						&& jsfUtil.getUsuarioLogado().getIsnConselho() == 6) // 6
																				// -
																				// CRM
				{
					this.setPermissaoMed("S");
				}
				if (jsfUtil.getUsuarioLogado().getIsnConselho() != null
						&& jsfUtil.getUsuarioLogado().getIsnConselho()
								.intValue() > 0
						&& jsfUtil.getUsuarioLogado().getIsnConselho() == 9) // 9
																				// -
																				// CRO
				{
					this.setPermissaoOdonto("S");
				}
			}

			if (ug.getGrupoBean().getDscGrupo().equalsIgnoreCase("ENFERMAGEM")) {
				this.setPermissaoEnf("S");
			}
		}
	}


	public void pesoClassificacaoRisco() throws Exception {
		avisoValidacao = 0;
		new InternacaoFacadeImpl().inserirPeso(strPeso,
				cr.getIsnInternacao());
	}

	public String carregarExames() {
		try {
			ExameSolicitacaoPepBean exameSolicitacaoPepBean = new ExameSolicitacaoPepBean();
			exameSolicitacaoPepBean.setIsnInternacao(this.getPaciente()
					.getIsnInternacao());

			// ESSE FILTRO FOI DESATIVADO, PARA QUE SEJA MOSTRADO NA TELA DO
			// MEDICO EXAMES CANCELADOS E NÃO AUTORIZADOS.
			// exameSolicitacaoPepBean.setFiltroMap(new HashMap<String,
			// Object>());
			// exameSolicitacaoPepBean.getFiltroMap().put("isnExameSituacaoNotIn",
			// new Integer[] {
			// ExameSolicitacaoImpl.EXAME_SOLICITACAO_SITUACAO_CANCELADA,
			// ExameSolicitacaoImpl.EXAME_SOLICITACAO_SITUACAO_NAO_AUTORIZADA
			// });

			List<ExameSolicitacaoPepBean> lstExameSolic = ExameSolicitacaoImpl
					.getInstancia()
					.pesquisar(
							exameSolicitacaoPepBean,
							ExameSolicitacaoImpl.JOIN_EXAME
									| ExameSolicitacaoImpl.JOIN_EXAME_SITUACAO
									| ExameSolicitacaoImpl.JOIN_EXAME_SOLIC_WS_DETALHE
									| ExameSolicitacaoImpl.JOIN_PROFISSIONAL
									| ExameSolicitacaoImpl.JOIN_USUARIO_AUTORIZACAO);

			if (lstExameSolic != null && lstExameSolic.size() > 0) {
				Collections.sort(lstExameSolic, new Comparator<Object>() {
					public int compare(Object obj1, Object obj2) {
						ExameSolicitacaoPepBean u1 = (ExameSolicitacaoPepBean) obj1;
						ExameSolicitacaoPepBean u2 = (ExameSolicitacaoPepBean) obj2;
						return u2.getIsnExameSolicAux().compareTo(
								u1.getIsnExameSolicAux());
					}
				});
			}

			/*
			 * if(dicomInterfaceamento.getVlrParametro().equals("S")){
			 * ExameSolicFacadeImpl exImpl = new ExameSolicFacadeImpl();
			 * WorkListModel workListModel = null; for (ExameSolicitacaoPepBean
			 * exame : lstExameSolicEmergencia) {
			 * 
			 * if(exame.getIsnExameGrupo().equals(2)){
			 * 
			 * if(exame.getDatRealizacao() == null){
			 * 
			 * workListModel =
			 * obterWorkList(exame.getIsnExameSolic().toString());
			 * 
			 * if(workListModel.getDataRealizacaoExame() != null){
			 * exame.setDatRealizacao(workListModel.getDataRealizacaoExame());
			 * exame.setIsnExameSituacao(2); exImpl.atualizarExameTipo2(exame);
			 * } } } } }
			 */
			this.setLstExameSolicEmergencia(lstExameSolic);

		} catch (Exception e) {
			e.getMessage();
		}
		return "";
	}

	private WorkListModel obterWorkList(String exameId) throws Exception {

		WorkListModel workListModel = WorkListDao.getInstancia().get(exameId);

		return workListModel;
	}

	public String carregarReceituario() {
		try {
			InternacaoDoc doc = new InternacaoDoc();
			doc.setIsnInternacao(getPaciente().getIsnInternacao());
			Integer[] tipoIn = new Integer[] {
					InternacaoDocTipoImpl.RECEITA_CONTROLADA,
					InternacaoDocTipoImpl.RECEITA_LIVRE,
					InternacaoDocTipoImpl.RECEITA_DENGUE };
			doc.setFiltro(new HashMap<String, Object>());
			doc.getFiltro().put("isnInternacaoDocTipoIN", tipoIn);
			setListaInternacaoDoc(InternacaoDocImpl.getInstancia().pesquisar(
					doc, 0));
		} catch (Exception e) {
			setListaInternacaoDoc(new ArrayList<InternacaoDoc>());
		}

		return "";
	}
	
	public String carregarPacienteAlergia() {
		try {
			PacienteAlergia pacienteAlergia = new PacienteAlergia();
			pacienteAlergia.setIsnPaciente(getPaciente().getIsnPaciente());
			pacienteAlergia.setFlgAtivo("S");
			lstPacienteAlergia = new ArrayList<PacienteAlergia>();
			lstPacienteAlergia = PacienteAlergiaImpl.getInstancia().pesquisar(pacienteAlergia, 0);
		} catch (Exception e) {
			setListaInternacaoDoc(new ArrayList<InternacaoDoc>());
		}

		return "";
	}
	
	public void preparaInserirPacienteAlergia(String valida) {
		pacienteAlergia = new PacienteAlergia();
		pacienteAlergia.setFlgAlergia(null);
			if(getLstPacienteAlergia()!=null && !getLstPacienteAlergia().isEmpty())
			{
				pacienteAlergia = this.getLstPacienteAlergia().get(0);
			}
			
			permitirFechaPanelAlergia= valida;
		
	}
	
	public void preparaAlterarPacienteAlergia() {
		System.out.println("entrou");	
	}
	
	public void inserirPacienteAlergia(ActionEvent event) {
		try {
			
			codigoErro = 1; //Alergia cadastrada com sucesso!
			if(pacienteAlergia.getFlgAlergia()==null || pacienteAlergia.getFlgAlergia().equals(""))
			{
				codigoErro = 5;
				return;
			}
			
			if (pacienteAlergia.getFlgAlergia().equals("S") && (pacienteAlergia.getDscAlergia() == null || pacienteAlergia.getDscAlergia().isEmpty())) {
				codigoErro = 3; //Campo Alergia Obrigatório!
				return;
			}
			
			if (jsfUtil.getUsuarioLogado().getIsnConselho() == null || (jsfUtil.getUsuarioLogado().getIsnConselho() != 6 && jsfUtil.getUsuarioLogado().getIsnConselho() != 9)) {
				codigoErro = 4; //Usuário sem permissão!
				return;
			}
			
					
			if(pacienteAlergia.getFlgAlergia().equals("S"))
	    	{
				pacienteAlergia.setDatCadastro(new Date());
				pacienteAlergia.setIsnUsuarioCadastro(new JSFUtil().getUsuarioLogado().getIsnUsuario());
				pacienteAlergia.setIsnPaciente(paciente.getIsnPaciente());
				pacienteAlergia.setFlgAtivo("S");
				pacienteAlergia.setIsnInternacao(paciente.getIsnInternacao());
				PacienteAlergiaImpl.getInstancia().inserir(pacienteAlergia);
				PacientePepBean p = new PacientePepBean();
				p.setIsnPaciente(pacienteAlergia.getIsnPaciente());
				p = PacienteImpl.getInstancia().get(p, 0);
				
				p.setFlgAlergia("S");
				PacienteImpl.getInstancia().alterar(p);
				paciente.setFlgAlergia("S");
	    	}
	    	else
	    	{
	    		if(pacienteAlergia.getIsnPacienteAlergia()!=null){
		    		PacienteAlergia obj = new  PacienteAlergia(pacienteAlergia.getIsnPacienteAlergia());
		    		PacienteAlergia novoObj = PacienteAlergiaImpl.getInstancia().get(obj, 0);
		    		novoObj.setFlgAtivo("N");
		    		novoObj.setDatAlteracao(new Date());
		    		novoObj.setIsnUsuarioAlteracao(new JSFUtil().getUsuarioLogado().getIsnUsuario());
		    		novoObj.setIsnInternacao(paciente.getIsnInternacao());
		    		novoObj.setFlgAlergia(pacienteAlergia.getFlgAlergia());
		    		PacienteAlergiaImpl.getInstancia().alterar(novoObj);
	    		}
				PacientePepBean p = new PacientePepBean();
				p.setIsnPaciente(paciente.getIsnPaciente());
				p = PacienteImpl.getInstancia().get(p, 0);
				p.setFlgAlergia("N");
				PacienteImpl.getInstancia().alterar(p);
				paciente.setFlgAlergia("N");
	    	}
			
		} catch (Exception e) {
			e.printStackTrace();
		}
		carregarPacienteAlergia();
	}
	
	public void alterarPacienteAlergia(){
		try {
			
			codigoErro = 2; //Alergia alterada com sucesso!
			
			if (pacienteAlergia.getDscAlergia() == null || pacienteAlergia.getDscAlergia().isEmpty()) {
				codigoErro = 1; //Campo Alergia Obrigatório!
				return;
			}
			
			if (jsfUtil.getUsuarioLogado().getIsnConselho() == null || jsfUtil.getUsuarioLogado().getIsnConselho() != 6) {
				codigoErro = 4; //Usuário sem permissão!
				return;
			}
			
			pacienteAlergia.setDatAlteracao(new Date());
			pacienteAlergia.setIsnUsuarioAlteracao(jsfUtil.getUsuarioLogado().getIsnUsuario());
			
			PacienteAlergiaImpl.getInstancia().alterar(pacienteAlergia);
			
		} catch (Exception e) {
			e.printStackTrace();
		}
		carregarPacienteAlergia();
	}

	public void carregaPrescricaoAnt() {
		lstPrescricaoPepAnt = new ArrayList<PrescricaoPep>();
		try {
			PrescricaoPep pep = new PrescricaoPep();
			pep.setIsnInternacao(paciente.getIsnInternacao());

			pep.setFiltro(new HashMap<String, Object>());
			pep.getFiltro().put("isnProfissionalConclNotNull", "NULL");
			pep.getFiltro().put("flgAtivo", "S");

			int join = PrescricaoPepImpl.JOIN_PRESCRICAO_PEP_ITEM
					| PrescricaoPepImpl.JOIN_USUARIO
					| PrescricaoPepImpl.JOIN_USUARIO_CONCLUSAO
					| PrescricaoPepImpl.JOIN_INTERNACAO
					| PrescricaoPepImpl.JOIN_INTERNACAO_LEITO
					| PrescricaoPepImpl.JOIN_PRESCRICAO_TIPO;

			setLstPrescricaoPepAnt(PrescricaoPepImpl.getInstancia().pesquisar(
					pep, join, Criteria.DISTINCT_ROOT_ENTITY));
		} catch (Exception e) {
			e.printStackTrace();
		}

	}
	
	public void pupularPaciente(Integer isnInternacao) throws Exception{
		PacienteFacade facade = new PacienteFacadeImpl();
		paciente = new PacienteEmergencia();
		paciente = facade.getPacienteEmergencia(isnInternacao);
	}
	
	public void pupularPacienteOtimizado(Integer isnInternacao) throws Exception{
		pacienteOtimizado = new PacienteEmergenciaOtimizadoBean();
		pacienteOtimizado = new PacienteEmergenciaOtimizadoImpl().getPacienteEmergenciaOtimizado(isnInternacao);
	}

	public void carregarPaciente() {
		avisoBaixarPaciente = 0;
		try {
			internacaoReferenciaBean = new InternacaoReferenciaBean();

			pupularPaciente(isnInternacao);
			pupularPacienteOtimizado(isnInternacao);
			
			if (validarSeNaoExisteRisco()) {
				setAvisoBaixarPaciente(3);
				return;
			}

			if (validarSeMedicoEstaAtendendo()) {
				setAvisoBaixarPaciente(1);
				return;
			}
			if (validarSeAtendimentoNaofoiCriado()) {
				if (validarSolicitacoesMedicasNoAtendimento()) {
					setAvisoBaixarPaciente(2);
					return;
				}
			}
			setAvisoBaixarPaciente(3);
		} catch (Exception e) {
			e.printStackTrace();
		}
	}

	private boolean validarSeNaoExisteRisco() throws Exception {

		// classificação
		final ClassificacaoRisco classificacaoRisco = new ClassificacaoRisco();
		classificacaoRisco.setIsnInternacao(paciente.getIsnInternacao());
		ClassificacaoRiscoFacadeImpl c = new ClassificacaoRiscoFacadeImpl();
		final List<ClassificacaoRisco> lstClassificacaoRisco = c
				.buscaClassificacaoRisco(paciente.getIsnInternacao());

		if (lstClassificacaoRisco == null) {
			return true;
		}

		return false;
	}

	private boolean validarSeMedicoEstaAtendendo() throws Exception {

		// internação
		InternacaoPepBean internacao = new InternacaoPepBean();
		internacao.setIsnInternacao(paciente.getIsnInternacao());
		internacao = InternacaoImpl.getInstancia().get(internacao, 0);

		if (internacao.getFlgAtendendo() != null && internacao.getFlgAtendendo().equals("S")) {
			return true;
		}

		return false;
	}

	private boolean validarSeAtendimentoNaofoiCriado() throws Exception {
		InternacaoAtendimentoFacade iaF = new InternacaoAtendimentoFacadeImpl();
		InternacaoAtendimento iaBd = new InternacaoAtendimento();
		if (pacienteOtimizado != null && pacienteOtimizado.getIsnInternacao() != null) {
			iaBd = iaF.buscaAtendimentoEmergencia(pacienteOtimizado.getIsnInternacao());
		} else {
			iaBd = iaF.buscaAtendimentoEmergencia(isnInternacao);
		}
		if (iaBd == null) {
			return true;
		}else if (iaBd.getDscDestinoAtendimento() != null && iaBd.getDscDestinoAtendimento().trim().equals("RECEPÇÃO")){
			return true;
		}
		return false;
	}

	private boolean validarSolicitacoesMedicasNoAtendimento() throws Exception {

		// exames
		final ExameSolicitacaoPepBean exame = new ExameSolicitacaoPepBean();
		exame.setIsnInternacao(paciente.getIsnInternacao());
		final List<ExameSolicitacaoPepBean> lstExame = ExameSolicitacaoImpl
				.getInstancia().pesquisar(exame, 0);
		if (lstExame != null && lstExame.size() > 0) {
			return true;
		}
		// prescriçoes
		final PrescricaoPep prescricaoPep = new PrescricaoPep();
		prescricaoPep.setIsnInternacao(paciente.getIsnInternacao());
		final List<PrescricaoPep> lstPrescricao = PrescricaoPepImpl
				.getInstancia().pesquisar(prescricaoPep, 0);
		if (lstPrescricao != null && lstPrescricao.size() > 0) {
			return true;
		}
		// prescricoes de enfermagem
		final InternacaoPrescPep internacaoPrescPep = new InternacaoPrescPep();
		internacaoPrescPep.setIsnInternacao(paciente.getIsnInternacao());
		final List<InternacaoPrescPep> lstInternacaoPrescPep = InternacaoPrescImpl
				.getInstancia().pesquisar(internacaoPrescPep, 0);
		if (lstInternacaoPrescPep != null && lstInternacaoPrescPep.size() > 0) {
			return true;
		}
		// Receituário
		final InternacaoDoc internacaoDoc = new InternacaoDoc();
		internacaoDoc.setIsnInternacao(paciente.getIsnInternacao());
		final List<InternacaoDoc> lstInternacaoDoc = InternacaoDocImpl
				.getInstancia().pesquisar(internacaoDoc, 0);

		if (lstInternacaoDoc != null && lstInternacaoDoc.size() > 0) {
			return true;
		}
		// Atestado/Declaração
		final AssistenteSocialDeclaracaoBean declaracao = new AssistenteSocialDeclaracaoBean();
		declaracao.setIsnInternacao(paciente.getIsnInternacao());
		final List<AssistenteSocialDeclaracaoBean> lstAssistenteSocial = AssistenteSocialDeclaracaoImpl
				.getInstancia().pesquisar(declaracao, 0);
		if (lstAssistenteSocial != null && lstAssistenteSocial.size() > 0) {
			return true;
		}
		// evolução
		final InternacaoEvolucao evolucao = new InternacaoEvolucao();
		evolucao.setIsnInternacao(paciente.getIsnInternacao());
		final List<InternacaoEvolucao> lstEvolucao = InternacaoEvolucaoImpl
				.getInstancia().pesquisar(evolucao, 0);
		if (lstEvolucao != null && lstEvolucao.size() > 0) {
			return true;
		}
		// transferencia
		final InternacaoTransBean transferencia = new InternacaoTransBean();
		transferencia.setIsnInternacao(paciente.getIsnInternacao());
		final List<InternacaoTransBean> lstInternacaoTransBean = InternacaoTransImpl
				.getInstancia().pesquisar(transferencia, 0);
		if (lstInternacaoTransBean != null && lstInternacaoTransBean.size() > 0) {
			return true;
		}
		// sepse
		final ProtocoloSepse sepse = new ProtocoloSepse();
		sepse.setIsnInternacao(paciente.getIsnInternacao());
		final List<ProtocoloSepse> lstProtocoloSepse = ProtocoloSepseImpl
				.getInstancia().pesquisar(sepse, 0);
		if(lstProtocoloSepse != null && lstProtocoloSepse.size() > 0) return true;
		// dengue
		final AtendimentoDengue dengue = new AtendimentoDengue();
		dengue.setIsnInternacao(paciente.getIsnInternacao());
		final List<AtendimentoDengue> lstAtendimentoDengue = AtendimentoDengueImpl
				.getInstancia().pesquisar(dengue, 0);
		if(lstAtendimentoDengue != null && lstAtendimentoDengue.size() > 0) return true;
		return false;
	}

	public String carregaEvolucao() {
		try {
			InternacaoEvolucao evo = new InternacaoEvolucao();
			evo.setIsnInternacao(paciente.getIsnInternacao());
			evo.setFlgAtivo("S");
			setListaEvolucao(InternacaoEvolucaoImpl.getInstancia().pesquisar(
					evo, InternacaoEvolucaoImpl.JOIN_USUARIO));
		} catch (Exception e) {
			e.printStackTrace();
		}
		return "";

	}

	public String carregarAtestado() {
		try {
			InternacaoDoc doc = new InternacaoDoc();
			doc.setIsnInternacao(getPaciente().getIsnInternacao());
			Integer[] tipoIn = new Integer[] { InternacaoDocTipoImpl.ATESTADO,
					InternacaoDocTipoImpl.ATESTADO_LIVRE };

			doc.setFiltro(new HashMap<String, Object>());
			doc.getFiltro().put("isnInternacaoDocTipoIN", tipoIn);

			this.setListaInternacaoDocAtestado(InternacaoDocImpl.getInstancia()
					.pesquisar(doc, 0));

			// declaracao comparecimento
			setListaDeclaracaoCompareciemtno(new ArrayList<AssistenteSocialDeclaracaoBean>());
			AssistenteSocialDeclaracaoBean declaracao = new AssistenteSocialDeclaracaoBean();
			declaracao.setIsnInternacao(getPaciente().getIsnInternacao());
			declaracao
					.setIsnAsDeclaracaoTipo(AssistenteSocialDeclaracaoTipoImpl.TIPO_COMPARECIMENTO);
			List<AssistenteSocialDeclaracaoBean> lista = AssistenteSocialDeclaracaoImpl
					.getInstancia().pesquisar(declaracao,
							AssistenteSocialDeclaracaoImpl.JOIN_USUARIO);
			setListaDeclaracaoCompareciemtno(lista);

		} catch (Exception e) {
			setListaInternacaoDocAtestado(new ArrayList<InternacaoDoc>());
		}
		return "";
	}

	public void carregaCid10() {
		try {
			setCid10Atendimento("");
			if (getObjIa() != null && getObjIa().getIsnCid10() != null
					&& getObjIa().getIsnCid10().intValue() > 0) {
				Cid10Facade cid10Facade = new Cid10FacadeImpl();
				Cid10 c = cid10Facade.buscarCid10(getObjIa().getIsnCid10());
				if (c != null && c.getIsnCid10() != null
						&& c.getIsnCid10().intValue() > 0) {
					setCid10Atendimento(c.getDscCid10());
					objIa.setCid10(c);
					objIa.setIsnCid10(c.getIsnCid10());
					setCid10Atendimento(c.getDscCid10());
				} else {
					objIa.setCid10(new Cid10());
					objIa.setIsnCid10(null);
				}
			}

			this.getObjIaPep().setCid10(null);
			this.getObjIaPep().setIsnCid10(null);
		} catch (Exception e) {
			e.getMessage();
		}
	}

	public void salvaCid10InternacaoAtendimento() {
		try {
			objIaPep.setIsnCid10(objCid10.getIsnCid10());
			objIaPep.setCid10(objCid10);
			// InternacaoAtendimentoPepImpl.getInstancia().alterar(objIaPep);

			objIa.setIsnCid10(objCid10.getIsnCid10());
			objIa.setCid10(objCid10);

		} catch (Exception e) {
			e.getStackTrace();
		}
	}

	public void buscarCid10Onblur(ActionEvent event) {
		if (getObjIa() != null && getObjIa().getCid10() != null
				&& getObjIa().getCid10().getCodCid10() != null
				&& !getObjIa().getCid10().getCodCid10().isEmpty()) {
			setCid10Atendimento("");
			Cid10Facade cid10Facade = new Cid10FacadeImpl();
			Cid10 c = cid10Facade.buscarCid10(getObjIa().getCid10()
					.getCodCid10());
			if (c != null && c.getIsnCid10() != null
					&& c.getIsnCid10().intValue() > 0) {
				setCid10Atendimento(c.getDscCid10());
				objIa.setCid10(c);
				objIa.setIsnCid10(c.getIsnCid10());
				setCid10Atendimento(c.getDscCid10());
			} else {
				objIa.setCid10(new Cid10());
				objIa.setIsnCid10(null);
			}
		} else {
			objIa.setCid10(new Cid10());
			objIa.setIsnCid10(null);
		}
		
	}

	public String pesquisarPrescricoes() throws Exception {
		try {
			carregaPrescricaoAnt();
			carregaPrescricaoPepAtual();
		} catch (Exception e) {
			e.printStackTrace();
		}
		return "";
	}

	public void carregarPrescricaoEnfermagem() {
		setLstPrescricaoEnfermagemPepi(new ArrayList<InternacaoPrescPep>());
		try {
			InternacaoPrescPep internacaoPrescPep = new InternacaoPrescPep();
			internacaoPrescPep.setIsnInternacao(paciente.getIsnInternacao());
			// List<InternacaoPrescPep> listaPrescricaoEnfermagemPepi =
			// InternacaoPrescImpl.getInstancia().pesquisar(internacaoPrescPep,
			// InternacaoPrescImpl.JOIN_TIPO_PRESCRICAO);
			List<InternacaoPrescPep> listaPrescricaoEnfermagemPepi = InternacaoPrescImpl
					.getInstancia().pesquisar(internacaoPrescPep,
							InternacaoPrescImpl.JOIN_USUARIO);
			setLstPrescricaoEnfermagemPepi(listaPrescricaoEnfermagemPepi);
		} catch (Exception e) {
			e.getMessage();
		}
	}

	public void carregaModalPrescricaoEnfermagemItens() {

		try {

			ItemInternacaoPrescPep internacaoPrescPep = new ItemInternacaoPrescPep();
			internacaoPrescPep.setIsnInternacaoPresc(objInternacaoPrescricao
					.getIsnInternacaoPresc());

			List<ItemInternacaoPrescPep> list = ItemInternacaoPrescImpl
					.getInstancia().pesquisar(internacaoPrescPep,
							ItemInternacaoPrescImpl.JOIN_USUARIO);

			setLstPrescricaoEnfermagemItemInc(list);

			carregarSliTipoPrescricaoEnfermagemPadrao();

			carregaUltimaPrescricaoEnfermagem();

		} catch (Exception e) {
			e.getStackTrace();
		}

	}

	public void handleTipoPrescricaoEnfermagemChange() {

		try {

			if (isnTipoPrescricaoEnfermagemPadrao != 0) {

				PrescricaoEnfermagemPep prescricaoEnfermagemPep = new PrescricaoEnfermagemPep();
				prescricaoEnfermagemPep
						.setIsnTipoPrescricao(isnTipoPrescricaoEnfermagemPadrao);

				TipoPrescricaoPep tipoPrescricaoPep = new TipoPrescricaoPep();
				tipoPrescricaoPep
						.setIsnTipoPrescricao(isnTipoPrescricaoEnfermagemPadrao);
				tipoPrescricaoPep = TipoPrescricaoPepImpl.getInstancia().get(
						tipoPrescricaoPep, 0);

				List<PrescricaoEnfermagemPep> list = PrescricaoEnfermagemImpl
						.getInstancia().pesquisar(prescricaoEnfermagemPep,
								PrescricaoEnfermagemImpl.JOIN_TIPO_PRESCRICAO);

				setLstPrescricaoEnfermagem(list);

				setLstPrescricaoEnfermagemItem(new ArrayList<ItemInternacaoPrescPep>());

				for (PrescricaoEnfermagemPep enfermagemPep : lstPrescricaoEnfermagem) {

					ItemInternacaoPrescPep internacaoPrescPep = new ItemInternacaoPrescPep();
					internacaoPrescPep.setDatCadastro(new Date());
					internacaoPrescPep.setDscAprazamento(enfermagemPep
							.getDscAprazamento());
					internacaoPrescPep.setDscObs(enfermagemPep
							.getDscPrescricao()
							+ " ("
							+ enfermagemPep.getDscComplemento() + ")");
					internacaoPrescPep
							.setIsnInternacaoPresc(objInternacaoPrescricao
									.getIsnInternacaoPresc());
					internacaoPrescPep.setIsnPrescricao(enfermagemPep
							.getIsnPrescricao());
					internacaoPrescPep
							.setIsnTipoPrescricao(isnTipoPrescricaoEnfermagemPadrao);
					internacaoPrescPep.setTipoPrescricao(tipoPrescricaoPep);

					internacaoPrescPep.setDscPrescricao(enfermagemPep
							.getDscPrescricao());
					internacaoPrescPep.setDscTipoPrescricao(enfermagemPep
							.getTipoPrescricao().getDscTipoPrescricao());
					// adicionando a lista que sera sugerida
					getLstPrescricaoEnfermagemItem().add(internacaoPrescPep);

				}

				for (ItemInternacaoPrescPep itemInternacaoPrescPepInc : lstPrescricaoEnfermagemItemInc) {
					for (Iterator<ItemInternacaoPrescPep> iterator = lstPrescricaoEnfermagemItem
							.iterator(); iterator.hasNext();) {
						ItemInternacaoPrescPep itemInternacaoPrescPep = (ItemInternacaoPrescPep) iterator
								.next();
						if (itemInternacaoPrescPepInc.getIsnPrescricao()
								.equals(itemInternacaoPrescPep
										.getIsnPrescricao().intValue())) {
							iterator.remove();
						}
					}

				}

				/*
				 * for(ItemInternacaoPrescPep
				 * itemInternacaoPrescPep:lstPrescricaoEnfermagemItem) {
				 * for(ItemInternacaoPrescPep
				 * itemInternacaoPrescPepUltima:lstPrescricaoEnfermagemItemUltima
				 * ) {
				 * if(itemInternacaoPrescPepUltima.getIsnItemPrescricaoPresc()
				 * == itemInternacaoPrescPep.getIsnItemPrescricaoPresc())
				 * getLstPrescricaoEnfermagemItem
				 * ().remove(itemInternacaoPrescPep); } }
				 */
				getLstPrescricaoEnfermagemItem();

			} else {
				setLstPrescricaoEnfermagem(new ArrayList<PrescricaoEnfermagemPep>());
			}

		} catch (Exception e) {
			e.getStackTrace();
		}

	}

	public void carregarSliTipoPrescricaoEnfermagemPadrao() {

		try {

			isnTipoPrescricaoEnfermagemPadrao = 0;
			setLstPrescricaoEnfermagemItem(new ArrayList<ItemInternacaoPrescPep>());
			setLstPrescricaoEnfermagemItemInc(new ArrayList<ItemInternacaoPrescPep>());

			TipoPrescricaoPep tipoPrescricaoPep = new TipoPrescricaoPep();
			// tipoPrescricaoPep.setIsnClinica(objIa.getIsnClinicaDestino());
			tipoPrescricaoPep.setFlgTipo("E");
			tipoPrescricaoPep.setFlgAtivo("S");
			tipoPrescricaoPep.setFlgNovo("A");

			List<TipoPrescricaoPep> peps = new ArrayList<TipoPrescricaoPep>();

			peps = TipoPrescricaoPepImpl.getInstancia().pesquisar(
					tipoPrescricaoPep, 0);

			sliTipoPrescricaoEnfermagemPadrao = new ArrayList<SelectItem>();
			sliTipoPrescricaoEnfermagemPadrao
					.add(new SelectItem(0, "Selecione"));
			for (TipoPrescricaoPep pep : peps) {
				sliTipoPrescricaoEnfermagemPadrao.add(new SelectItem(pep
						.getIsnTipoPrescricao(), pep.getDscTipoPrescricao()));
			}

		} catch (Exception e) {
			e.getStackTrace();
		}

	}

	public void gravarPrescricaoEnfermagemPepi() {
		// setAvisoValidacao(0);
		codigo = 0;
		try {
			// validar o usuario/profissional
			String senha = IsghEncodeDecode.encrypt(senhaAssinatura
					.toUpperCase());
			Usuario usuProf = new Usuario();
			usuProf.setDscLogin(usuarioCoren.toUpperCase());
			usuProf.setDscSenha(senha);
			usuProf = (Usuario) UsuarioImpl.getInstancia().get(
					usuProf,
					UsuarioImpl.JOIN_USUARIO_GRUPO
							| UsuarioImpl.JOIN_USUARIOGRUPO_GRUPO);
			if (usuProf == null) {
				// setAvisoValidacao(1);
				codigo = 1;
				return;
			} else {
				// TODO: ajustar permissao da prescricao de enfermagem
				/*
				 * if(!ValidaPermissaoUsuario.getInstancia().verificaPermissao(
				 * "CD_PRESCRICAO_PEP", funcUtil.getAcaoExcluir())) {
				 * avisoValidacao = 2; return; }
				 */
				
				if(usuProf.getIsnConselho() == null || usuProf.getFlgSituacao().equals("N")){
					codigo = 1;
					return;	
				} else if(usuProf.getIsnConselho() != 2) {
					codigo = 1;
					return;
				} else if (objInternacaoPrescricao.getDscObs() == null
						|| objInternacaoPrescricao.getDscObs().equals("")) {
					codigo = 2;
					return;
				} else {
					objInternacaoPrescricao.setDatCadastro(new Date());
					objInternacaoPrescricao.setIsnInternacaoLeito(paciente
							.getIsnInternacaoLeito());
					objInternacaoPrescricao.setIsnInternacao(paciente
							.getIsnInternacao());
					objInternacaoPrescricao.setFlgTipo("E");
					// objInternacaoPrescricao.setIsnProfissional(usuProf.getIsnUsuario());
					objInternacaoPrescricao.setProfissional(usuProf);
					objInternacaoPrescricao.setIsnUsuario(usuProf
							.getIsnUsuario());
					objInternacaoPrescricao = InternacaoPrescImpl
							.getInstancia().inserir(objInternacaoPrescricao);
					objInternacaoPrescricao.setUsuario(usuProf);

					carregarSliTipoPrescricaoEnfermagemPadrao();

					carregaUltimaPrescricaoEnfermagem();

				}
			}
		} catch (Exception e) {
			e.getStackTrace();
		}
	}

	public void carregaUltimaPrescricaoEnfermagem() {
		try {

			lstPrescricaoEnfermagemItem = new ArrayList<ItemInternacaoPrescPep>();
			lstPrescricaoEnfermagemItemTemp = new ArrayList<ItemInternacaoPrescPep>();
			lstPrescricaoEnfermagemItemInc = new ArrayList<ItemInternacaoPrescPep>();

			InternacaoPrescPep objInternacaoPrescricao = new InternacaoPrescPep();
			objInternacaoPrescricao.setIsnInternacao(paciente
					.getIsnInternacao());
			Integer isnInternacaoPresc = InternacaoPrescImpl.getInstancia()
					.pesquisarUltimaPrescricao(objInternacaoPrescricao);

			if (isnInternacaoPresc != null) {
				ItemInternacaoPrescPep internacaoPrescPep = new ItemInternacaoPrescPep();
				internacaoPrescPep.setIsnInternacaoPresc(isnInternacaoPresc);

				lstPrescricaoEnfermagemItemUltima = ItemInternacaoPrescImpl
						.getInstancia().pesquisar(internacaoPrescPep,
								ItemInternacaoPrescImpl.JOIN_TIPO_PRESCRICAO);

				lstPrescricaoEnfermagemItemInc = new ArrayList<ItemInternacaoPrescPep>();
				setLstPrescricaoEnfermagemItemInc(lstPrescricaoEnfermagemItemUltima);

			}

		} catch (Exception e) {
			e.getStackTrace();
		}
	}

	public void carregaPrescricaoEnfermagem() {
		try {

			lstPrescricaoEnfermagemItem = new ArrayList<ItemInternacaoPrescPep>();
			lstPrescricaoEnfermagemItemTemp = new ArrayList<ItemInternacaoPrescPep>();
			lstPrescricaoEnfermagemItemInc = new ArrayList<ItemInternacaoPrescPep>();

			ItemInternacaoPrescPep internacaoPrescPep = new ItemInternacaoPrescPep();
			internacaoPrescPep.setIsnInternacaoPresc(objInternacaoPrescricao
					.getIsnInternacaoPresc());

			List<ItemInternacaoPrescPep> lstPrescricaoEnfermagemItemAtual = ItemInternacaoPrescImpl
					.getInstancia().pesquisar(internacaoPrescPep,
							ItemInternacaoPrescImpl.JOIN_TIPO_PRESCRICAO);

			lstPrescricaoEnfermagemItemInc = new ArrayList<ItemInternacaoPrescPep>();
			setLstPrescricaoEnfermagemItemInc(lstPrescricaoEnfermagemItemAtual);
		} catch (Exception e) {
			e.getStackTrace();
		}
	}
	
	public void limpaFormUsuario() {
		setUsuarioCoren("");
	}

	public void incluirLstPrescricaoEnfermagemItemInc() {

		List<ItemInternacaoPrescPep> lstTemp = new ArrayList<ItemInternacaoPrescPep>();
		for (ItemInternacaoPrescPep internacaoPrescPep : lstPrescricaoEnfermagemItem) {
			if (internacaoPrescPep.isInsertItem()) {
				internacaoPrescPep.setInsertItem(false);
				internacaoPrescPep.setDeleteItem(false);
				// adicionando a lista que sera incluida nos itens
				getLstPrescricaoEnfermagemItemInc().add(internacaoPrescPep);
				lstTemp.add(internacaoPrescPep);
			}
		}
		for (ItemInternacaoPrescPep internacaoPrescPep : lstTemp) {
			getLstPrescricaoEnfermagemItem().remove(internacaoPrescPep);
			getLstPrescricaoEnfermagemItemTemp().add(internacaoPrescPep);
		}
	}

	public void excluirLstPrescricaoEnfermagemItemInc() {

		List<ItemInternacaoPrescPep> lstTemp = new ArrayList<ItemInternacaoPrescPep>();
		for (ItemInternacaoPrescPep internacaoPrescPep : lstPrescricaoEnfermagemItemInc) {
			if (internacaoPrescPep.isDeleteItem()) {
				lstTemp.add(internacaoPrescPep);
			}
		}
		for (ItemInternacaoPrescPep internacaoPrescPep : lstTemp) {
			getLstPrescricaoEnfermagemItemInc().remove(internacaoPrescPep);
		}
		for (ItemInternacaoPrescPep internacaoPrescPepTemp : lstTemp) {
			if (lstPrescricaoEnfermagemItemTemp
					.contains(internacaoPrescPepTemp)) {
				internacaoPrescPepTemp.setInsertItem(false);
				internacaoPrescPepTemp.setDeleteItem(false);
				getLstPrescricaoEnfermagemItem().add(internacaoPrescPepTemp);
			}
		}

	}

	public void populaSliTipoPrescricaoEnfermagemPep() {
		objInternacaoPrescricao = new InternacaoPrescPep();
		sliTipoPrescricaoEnfermagemPep = new ArrayList<SelectItem>();
		sliTipoPrescricaoEnfermagemPep.add(new SelectItem(1, "Normal"));
		sliTipoPrescricaoEnfermagemPep
				.add(new SelectItem(2, "Alta Hospitalar"));
		sliTipoPrescricaoEnfermagemPep.add(new SelectItem(3,
				"Transferência Intra-Hospitalar"));
		sliTipoPrescricaoEnfermagemPep.add(new SelectItem(4, "Óbito"));
	}

	public void chamaNovaPrescricaoEnfermagem() {
		objInternacaoPrescricao = new InternacaoPrescPep();
		limpaFormUsuario();
	}

	public void verificaSeChikungunya(ActionEvent event){
		flgChikungunya = false;
		datSintomaChikungunya = null;
		AtendimentoChikungunyaFacade atend = new AtendimentoChikungunyaFacadeImpl();
		Integer isnInternacoChi = atend.buscarAtendimentoChikungunya(isnInternacao);
		if(isnInternacoChi != null && isnInternacoChi.intValue() != 0){
			return;
		}
		Integer isnAtendimentoChikungunya =  atend.buscarAtendimentoChikungunya30Dias(isnInternacao);
		if(isnAtendimentoChikungunya != null && isnAtendimentoChikungunya.intValue() != 0){
			return;
		}
		
		if(objIa != null &&  (objIa.getCid10().getCodCid10().equals("A92") || objIa.getCid10().getCodCid10().equals("A920") )){
			
			this.flgChikungunya = true;
		}
	}
	
	public void verificaSeDengue() throws Exception{
		
		resetarParametrosDengue();
		getItemsAlerta();
		getItemsAlgumaSituacao();
		
		int c = buscarIdadeData(paciente.getDatNascimento());
		AtendimentoDengueFacade atendimentoDengueFacade = new AtendimentoDengueFacadeImpl();
		Integer isnIntern =  atendimentoDengueFacade.buscarAtendimentoDengueInternacao(isnInternacao);
		if(isnIntern != null && isnIntern.intValue() != 0){
			return;
		}
		//busca se já existe protocolo dengue para esse paciente até 30 dias atrás
		Integer isnAtendimentoDengue =  atendimentoDengueFacade.buscarAtendimentoDengue30Dias(isnInternacao);
		if(isnAtendimentoDengue != null && isnAtendimentoDengue.intValue() != 0){
			return;
		}
		
		if(c >= 13){
			if(objIa != null &&  (objIa.getCid10().getCodCid10().equals("A90") || objIa.getCid10().getCodCid10().equals("A91") || objIa.getCid10().getCodCid10().equals("A98"))){
				//AtendimentoDengueFacade atendimentoDengueFacade = new AtendimentoDengueFacadeImpl();
				//Integer isnIntern =  atendimentoDengueFacade.buscarAtendimentoDengueInternacao(isnInternacao);
				
				this.flgDengue = true;
/*				if(isnIntern == null){
				}
*/			}
		}else if (objIa != null && objIa.getCid10().getCodCid10().equals("A90")){
			//concluirDengueMenor12();
			this.flgMenor12 = true;
		}
	}
	
	private int buscarIdadeData(Date dt){
		Calendar hoje = Calendar.getInstance();
		Calendar dtnasc = Calendar.getInstance();
		dtnasc.setTime(dt);

		int idade = hoje.get(Calendar.YEAR) - dtnasc.get(Calendar.YEAR);
		//if (dtnasc.get(Calendar.MONTH) > hoje.get(Calendar.MONTH)) {
		if ( (dtnasc.get(Calendar.MONTH) > hoje.get(Calendar.MONTH)) || 
			 (dtnasc.get(Calendar.MONTH) == hoje.get(Calendar.MONTH) && dtnasc.get(Calendar.DAY_OF_MONTH) > hoje.get(Calendar.DAY_OF_MONTH)) ) {
			idade--;
		}
		return idade;
		
	}
	
	public void avancarDengue(){
		this.mensagemAlertaDengue = null;
		flgSituacaoPositivo=false;
		setMsgAlerta(null);
		if(this.flgChoque){
		if(atendimentoDengue.getSinaisChoque() != null){
			if(datSintomas ==null ||datSintomas.toString().equals("")){
				setMsgAlerta("A data dos primeiros sintomas é obrigatória!");
				return;
			}
			 if(datSintomas.after(new Date())){
				  setMsgAlerta("A data dos sintomas não pode ser superior a data atual!");
				  return;
			  }
			if(!atendimentoDengue.getSinaisChoque()){
				liberarAlertaBloquearChoque();
			}else{
				setMensagemAlertaDengue("INTERNAMENTO EM LEITO DE UTI, CUIDADOS INTENSIVOS!");
				this.flgLiberarConfirmar = true;
				this.flgChoque = false;
				setTipoGrupo("Grupo D");
			}
			}
			return;
		}
		
		if(this.flgAlerta){
			boolean validaPergunta = true; 
			  for(Entry<String,Boolean> entry: checkMapAlerta.entrySet()){
					 if (entry.getValue()) {
						 validaPergunta=false;
				      }     
				 }
				  if(validaPergunta){
					  setMsgAlerta("Selecione alguma das opções abaixo!");
					  return;
				  }
			if(verificarItensMarcadosSinaisDeAlerta()){
			atendimentoDengue.setSinaisAlerta(flgAlertaPositivo);
			}else{
				liberarPesoBloquearAlerta();
				this.flgAlertaPositivo = true;
				flgBloqueiaConfirmar = true;
			}
			return;
		}
		
		if(this.flgSangramento){
			if(!atendimentoDengue.getSinaisSangramento()){
				liberarSituacaoBloquearSangramento();
			}else{
				liberarPesoBloquearSangramento();
				this.flgLiberarConfirmar = true;
			}
			return;
		}
		if(this.flgSituacaoExtra){
			
			setMsgAlerta(null);
			if(validarItensMarcadosAlgumaSituacao()){
				setMsgAlerta("Selecione alguma das opções abaixo!");
				return;
			}
			if(verificarItensMarcadosAlgumaSituacao()){
				atendimentoDengue.setSituacaoExtra(flgSituacaoPositivo);
			}else{
			 liberarPesoBloquearSituacao();
			  this.flgLiberarConfirmar = true;
			 this.flgSituacaoPositivo = true;
			 atendimentoDengue.setSituacaoExtra(flgSituacaoPositivo);
			}
			return;
		}
		
		if(this.flgLaco){
			if(!atendimentoDengue.getProvaLaco()){
				liberarPesoBloquearLaco();
				this.flgLiberarConfirmar = true;
				flgBloqueiaConfirmar = true;
			}else{
				liberarPesoBloquearLaco();
				this.flgLiberarConfirmar = true;
				flgBloqueiaConfirmar = true;
			}
		}
	}
	
	public void concluirDengue(){
		setMsgAlerta(null);
		if(pesoDengue == null || pesoDengue.equals(0.0) && validarGrupoDengue() != GRUPO_D){
			setMsgAlerta("Digite o peso!");
			return;
		}
		
		/*AtendimentoDengueFacade atendimentoDengueFacade = new AtendimentoDengueFacadeImpl();
		atendimentoDengue.setDataCadastro(new Date());
		atendimentoDengue.setIsnGrupoDengue(validarGrupoDengue());
		atendimentoDengue.setIsnInternacao(isnInternacao);
		atendimentoDengue.setPeso(String.valueOf(pesoDengue));
		if(atendimentoDengue.getSinaisChoque()){
			atendimentoDengue.setDataPrimeiroSintoma(new InternacaoFacadeImpl().buscarInternacao(isnInternacao).getDatCadastro());
		}else{
			atendimentoDengue.setDataPrimeiroSintoma(datSintomas);
		}
		try {
		atendimentoDengue.setIsnProfissional(jsfUtil.getUsuarioLogado().getIsnUsuario());
		atendimentoDengue.setIsnCid10(objIa.getCid10().getIsnCid10());*/
		//atendimentoDengue.setIsnInternacaoAtendimento(objIa.getIsnInternacaoAtendimento());
		
		//Integer isnAtendimentoDengue = atendimentoDengueFacade.inserir(atendimentoDengue);
		//ItemDengueFacade itemDengueFacade = new ItemDengueFacadeImpl();
		
		/*if(itemDengue != null && itemDengue.size() > 0){
			for (ItemDengue itensDengue : itemDengue) {
				itensDengue.setIsnAtendimentoDengue(isnAtendimentoDengue);
				itemDengueFacade.inserir(itensDengue);
			}
		}*/
		try{
			
			if (validarGrupoDengue() == GRUPO_A) {
				/*
				 * inserirReceituario(isnAtendimentoDengue);
				 * this.isnAtendimentoDengue = isnAtendimentoDengue;
				 */
				concluirDiagnosticoDengueNoGrupoA();
				setFecharPanelDengue("2");
				flgCid10Dengue = true;
				return;
			}
			if (validarGrupoDengue() == GRUPO_B) {
				/*
				 * inserirExame();
				 * inserirPescricaoDengue(this.mensagemHidratacao);
				 */
				concluirDiagnosticoDengueNoGrupoB();
				setFecharPanelDengue("1");
				flgCid10Dengue = true;
				return;
			}
			if (validarGrupoDengue() == GRUPO_C) {
				/*
				 * inserirExame();
				 * inserirPescricaoDengue(this.mensagemHidratacao);
				 */
				concluirDiagnosticoDengueNoGrupoC();
				listarEmergenciaGrupoC();
				isnDestino = 3;
				setFecharPanelDengue("1");
				flgCid10Dengue = true;
				return;
			}
			if (validarGrupoDengue() == GRUPO_D) {
				
				concluirDiagnosticoDengueNoGrupoD();
				setFecharPanelDengue("1");
				flgCid10Dengue = true;
				return;
			}
			//setFecharPanelDengue("1");
		} catch (Exception e) {
			setMsgAlerta("Falha ao registrar, contacte NTI!");
			e.printStackTrace();
		}
	}
	
	private void completarAtendimentoDengue() throws Exception{
		atendimentoDengue.setDataCadastro(new Date());
		atendimentoDengue.setIsnGrupoDengue(validarGrupoDengue());
		atendimentoDengue.setIsnInternacao(this.isnInternacao);
		atendimentoDengue.setPeso(String.valueOf(pesoDengue));
		if(atendimentoDengue.getSinaisChoque()){
			atendimentoDengue.setDataPrimeiroSintoma(datSintomas);
			//atendimentoDengue.setDataPrimeiroSintoma(new InternacaoFacadeImpl().buscarInternacao(isnInternacao).getDatCadastro());
		}else{
			atendimentoDengue.setDataPrimeiroSintoma(datSintomas);
		}
		atendimentoDengue.setIsnProfissional(jsfUtil.getUsuarioLogado().getIsnUsuario());
		atendimentoDengue.setIsnCid10(objIa.getCid10().getIsnCid10());
		atendimentoDengue.setItensDengues(itemDengue);
		
	}
	
	private void completarReceituario() throws Exception {
		internacaoDoc.setDatCadastro(new Date());
		internacaoDoc.setIsnInternacao(this.isnInternacao);
		internacaoDoc.setIsnInternacaoDocTipo(5);
		internacaoDoc.setIsnUsuario(jsfUtil.getUsuarioLogado().getIsnUsuario());
		internacaoDoc.setDscPeso(String.valueOf(this.pesoDengue));
		internacaoDoc.setDscParam3("A");
	}
	
	private ExamesDengueVO completarSolicitacoesExames() throws Exception {
		ExamesDengueVO examesDengue = new ExamesDengueVO();
		examesDengue.setExameSolic(getExameSolic());
		examesDengue.setExamesDengue(listExameSelecionado);
		examesDengue.setPaciente(paciente);
		examesDengue.setDicomInterfaceamento(dicomInterfaceamento);
		return examesDengue;
	}
	
	private ExameSolicitacaoPepBean getExameSolic() throws Exception {
		ExameSolicitacaoPepBean exameSolicitacaoPepBean = new ExameSolicitacaoPepBean();
		exameSolicitacaoPepBean.setIsnExameSituacao(ExameSolicitacaoImpl.EXAME_SOLICITACAO_SITUACAO_PENDENTE);
		exameSolicitacaoPepBean.setDatCadastro(new Date());
		exameSolicitacaoPepBean.setDatSolicitacao(new Date());
		exameSolicitacaoPepBean.setIsnInternacao(paciente.getIsnInternacao());
		exameSolicitacaoPepBean.setNumProntuario(paciente.getNumProntuario());
		exameSolicitacaoPepBean.setIsnProfissional(jsfUtil.getUsuarioLogado().getIsnUsuario());
		exameSolicitacaoPepBean.setIsnUsuario(jsfUtil.getUsuarioLogado().getIsnUsuario());
		exameSolicitacaoPepBean.setFlgLaboratorio(laboratorioInterfaceamento.getVlrParametro());
		exameSolicitacaoPepBean.setPeso(peso);
		exameSolicitacaoPepBean.setAltura(altura);
		exameSolicitacaoPepBean.setFlgGestante(flgGestante);
		exameSolicitacaoPepBean.setDscMedicamentos(dscMedicamentos);
		InternacaoLeito internacaoLeito = new InternacaoLeitoFacadeImpl().buscaMaxInternacaoLeitoOcupado(isnInternacao);
		exameSolicitacaoPepBean.setDscEnfermaria(internacaoLeito.getLeito().getEnfermaria().getDscEnfermaria());
		exameSolicitacaoPepBean.setDscLeito(internacaoLeito.getLeito().getDscLeito());
		exameSolicitacaoPepBean.setDscClinica(internacaoLeito.getLeito().getEnfermaria().getClinica().getDscClinica());
		exameSolicitacaoPepBean.setIsnClinica(internacaoLeito.getLeito().getEnfermaria().getClinica().getIsnClinica());
		return exameSolicitacaoPepBean;
	}
	
	private PrescricaoPep getPescricaoDengue() {
		PrescricaoPep prescricaoPep = new PrescricaoPep();
		prescricaoPep.setIsnInternacao(paciente.getIsnInternacao());
		prescricaoPep.setDscPrescricao(this.mensagemHidratacao);
		prescricaoPep.setPaginaOrigem(this.getPaginaOrigem());
		prescricaoPep.setFlgImp("N");
		prescricaoPep.setIsnInternacaoLeito(paciente.getIsnInternacaoLeito());
		return prescricaoPep;
	}
	
	private void concluirDiagnosticoDengueNoGrupoA() throws Exception {
		completarAtendimentoDengue();
		completarReceituario();
		AtendimentoDengueImpl.getInstancia().concluirAtendimentoDengue(this.atendimentoDengue, internacaoDoc);
	}
	
	public void imprimirRec() {
		imprimirRelatorioDengueTipoA(this.atendimentoDengue.getIsnAtendimentoDengue());
	}
	
	private void concluirDiagnosticoDengueNoGrupoB() throws Exception {
		completarAtendimentoDengue();
		final ExamesDengueVO examesDengueVO = completarSolicitacoesExames();
		final PrescricaoPep prescricaoPep = getPescricaoDengue();
		AtendimentoDengueImpl.getInstancia().concluirAtendimentoDengue(this.atendimentoDengue, examesDengueVO,
				prescricaoPep);
	}
	
	private void concluirDiagnosticoDengueNoGrupoC() throws Exception {
		completarAtendimentoDengue();
		final ExamesDengueVO examesDengueVO = completarSolicitacoesExames();
		final PrescricaoPep prescricaoPep = getPescricaoDengue();
		AtendimentoDengueImpl.getInstancia().concluirAtendimentoDengue(this.atendimentoDengue, examesDengueVO,
				prescricaoPep);
	}
	
	private void concluirDiagnosticoDengueNoGrupoD() throws Exception
	{
		completarAtendimentoDengue();
		AtendimentoDengueImpl.getInstancia().concluirAtendimentoDengue(this.atendimentoDengue);
		//verificarSeAtendimentoDengueFoiConfirmado();
	}
	
	public void concluirDengueMenor12() throws Exception{
		setMsgAlerta(null);
		AtendimentoDengueFacade atendimentoDengueFacade = new AtendimentoDengueFacadeImpl();
		atendimentoDengue.setDataCadastro(new Date());
		atendimentoDengue.setIsnGrupoDengue(null);
		atendimentoDengue.setIsnInternacao(isnInternacao);
		atendimentoDengue.setPeso(null);
		atendimentoDengue.setDataPrimeiroSintoma(null);
		atendimentoDengue.setIsnProfissional(jsfUtil.getUsuarioLogado().getIsnUsuario());
		atendimentoDengue.setIsnCid10(objIa.getCid10().getIsnCid10());
		this.flgCid10Dengue = true;
		atendimentoDengueFacade.inserir(atendimentoDengue);
	}
	
	public void concluirChikungunya() throws Exception{
		setMsgAlerta(null);
		if(datSintomaChikungunya == null){
			setMsgAlerta("Informe a data dos primeiros sintomas da chikungunya.");
			return;
		}
		if(datSintomaChikungunya.after(new Date())){
			  setMsgAlerta("A data dos sintomas não pode ser superior a data atual!");
			  return;
		  }
		AtendimentoChikungunyaFacade atendimentoChikungunyaFacade = new AtendimentoChikungunyaFacadeImpl();
		AtendimentoChikungunya atendimentoChikungunya = new AtendimentoChikungunya();
		atendimentoChikungunya.setDataCadastro(new Date());
		atendimentoChikungunya.setIsnCid10(objIa.getCid10().getIsnCid10());
		atendimentoChikungunya.setIsnInternacao(isnInternacao);
		atendimentoChikungunya.setIsnProfissional(jsfUtil.getUsuarioLogado().getIsnUsuario());
		atendimentoChikungunya.setDataPrimeiroSintoma(getDatSintomaChikungunya());
		this.flgCid10Dengue = true;
		atendimentoChikungunyaFacade.inserir(atendimentoChikungunya);
	}
	
	private void listarEmergenciaGrupoC(){
		Iterator<SelectItem> iterator = getSliDestinos().iterator();
		while(iterator.hasNext())
		{
			SelectItem elemento = iterator.next();
			if(!elemento.getValue().equals(3) && !elemento.getValue().equals(10)){
				iterator.remove();
			}
		}
	}
	
	private InternacaoDoc buscarReceita(InternacaoDoc receita) throws Exception {
		InternacaoDoc internacaoDoc = new InternacaoDoc();
		internacaoDoc.setIsnInternacaoDoc(receita.getIsnInternacaoDoc());
		internacaoDoc.setFiltro(new java.util.HashMap<String, Object>());
		internacaoDoc.getFiltro().put("isnInternacaoDocTipoIN", receita.getIsnInternacaoDocTipo());
		internacaoDoc = InternacaoDocImpl.getInstancia().get(internacaoDoc,
				InternacaoDocImpl.JOIN_INTERNACAO | InternacaoDocImpl.JOIN_USUARIO);
		return internacaoDoc;
	}
	
	private int validarGrupoDengue(){
		
		if(atendimentoDengue.getSinaisChoque()){
			return GRUPO_D;
		}
		if(flgAlertaPositivo){
			return GRUPO_C;
		}
		if(atendimentoDengue.getSinaisSangramento()){
			return GRUPO_B;
		}
		if(flgSituacaoPositivo){
			return GRUPO_B;
		}
		if(atendimentoDengue.getProvaLaco()){
			return GRUPO_B;
		}else{
			return GRUPO_A;
		}
	}
	
	private void liberarAlertaBloquearChoque(){
		this.flgChoque = false;
		this.flgAlerta = true;
	}
	
	private void liberarSituacaoBloquearSangramento(){
		this.flgSangramento = false;
		this.flgSituacaoExtra = true;
	}
	
	private void liberarLacoBloquearSituacao(){
		this.flgSituacaoExtra = false;
		this.flgLaco = true;
	}
	
	private void liberarSangramentoBloquearAlerta(){
		 this.flgAlerta = false;
		 this.flgSangramento = true;
	}
	
	private void liberarPesoBloquearAlerta(){
		 this.flgPeso = true;
		 this.flgAlerta = false;
		 this.flgLiberarConfirmar = true;
		 setMensagemAlertaDengue("INTERNAMENTO NA UNIDADE!");
	}
	
	private void liberarPesoBloquearSituacao(){
		 this.flgPeso = true;
		 this.flgSituacaoExtra = false;
	}
	
	private void liberarPesoBloquearSangramento(){
		this.flgSangramento = false;
		this.flgPeso = true;
	}
	
	private void liberarPesoBloquearLaco(){
		this.flgPeso = true;
		this.flgLaco = false;
	}
	
	private double calcularHidratacaoOral(){
		return 20 * pesoDengue;
	}
	
	private double calcularHidratacaoEv(){
		return 10 * pesoDengue;
	}
	
	public void calcularPesoGeral(){
		String resultadoCalculo = null;
		setMsgAlerta(null);
		
		if(this.pesoDengue == null || this.pesoDengue.equals(0.0)){
			setMsgAlerta("Digite o peso!");
			return;
		}
		
		if(validarGrupoDengue() == GRUPO_B){
			final double oral = calcularHidratacaoOral();
			resultadoCalculo = formatarValor(oral);
			
			final Double partes = oral / 3;
			String soro = formatarValor(partes);
			String msg  = "HIDRATAÇÃO ORAL "+resultadoCalculo+" ML EM 4 HORAS SENDO "+soro+" ML "
					+ "DE SORO ORAL E O RESTANTE DE ÁGUA.";
			setMensagemHidratacao(msg);
			setTipoGrupo("Grupo B");
			atendimentoDengue.setViaMedicacao("ORAL");
			carregarExamesGrupoB();
			buscarItensMarcados();
			flgBloqueiaConfirmar = false;
		}
		
		if(validarGrupoDengue() == GRUPO_C){
			final double evPeso = calcularHidratacaoEv();
			 resultadoCalculo = formatarValor(evPeso);
			 String msg ="HIDRATAÇÃO EV "+resultadoCalculo+" ML NA 1º HORA.";
			 setTipoGrupo("Grupo C");
			 setMensagemHidratacao(msg);
			 atendimentoDengue.setViaMedicacao("EV");
			 atendimentoDengue.setSinaisAlerta(true);
			 carregarExamesGrupoC();
			 buscarItensMarcados();
			 flgBloqueiaConfirmar = false;
		}
		
		if(validarGrupoDengue() == GRUPO_A){
			 setTipoGrupo("Grupo A");
			 calcularPesoDengueTipoA();
			 flgBloqueiaConfirmar = false;
		}
		atendimentoDengue.setTotalLiquido(resultadoCalculo);
	}
	
	private Integer arrendondarValor(final Double valor){
		return  (((int)(valor/10 + 1))*10);
	}
	
	private String formatarValor(final Double valor){
		DecimalFormat df = new DecimalFormat("#,###.00");
		return String.valueOf(df.format(valor)); 
	}
	
	private String formatarValor(final Integer valor){
		DecimalFormat df = new DecimalFormat("#,###");
		return String.valueOf(df.format(valor)); 
	}
	
	private void inserirReceituario(final Integer isnAtendimento){
		try {
		internacaoDoc.setDatCadastro(new Date());
		internacaoDoc.setIsnInternacao(isnInternacao);
		internacaoDoc.setIsnInternacaoDocTipo(5);
		internacaoDoc.setIsnAtendimentoDengue(isnAtendimento);
		internacaoDoc.setIsnUsuario(jsfUtil.getUsuarioLogado().getIsnUsuario());
		internacaoDoc.setDscPeso(String.valueOf(pesoDengue));
		internacaoDoc.setDscParam3("A");
		InternacaoDocImpl.getInstancia().inserir(internacaoDoc);
		} catch (Exception e) {
			e.printStackTrace();
		}
	}
	
	public void calcularPesoDengueTipoA(){
		//CALCULAR PARAMETROS
		Double param1 = (this.pesoDengue * 70)/3;
		Double param2 = ((this.pesoDengue * 70)*2)/3;
		//3 DOSES DIARIAS
		param1 = param1/3;
		param2 = param2/3;
		//ARREDONDAR
		Integer intParam1 = arrendondarValor(param1);
		Integer intParam2 =  arrendondarValor(param2);;
		//FORMATAR
		String dscParam1 = formatarValor(intParam1); 
		String dscParam2 = formatarValor(intParam2);
		String dscPeso = formatarValor(this.pesoDengue);
		
		this.internacaoDoc.setDscParam1(dscParam1);
		this.internacaoDoc.setDscParam2(dscParam2);
		this.internacaoDoc.setDscPeso(dscPeso);
	}
	
	private void inserirPescricaoDengue(final String prescricao){
		PrescricaoPep prescricaoPep = new PrescricaoPep();
		prescricaoPep.setIsnInternacao(paciente.getIsnInternacao());
		prescricaoPep.setDscPrescricao(prescricao);
		prescricaoPep.setPaginaOrigem(this.getPaginaOrigem());
		prescricaoPep.setFlgImp("N");
		prescricaoPep.setIsnInternacaoLeito(paciente.getIsnInternacaoLeito());
		try {
			PrescricaoPepImpl.getInstancia().verificarPrescricao(prescricaoPep);
		} catch (Exception e) {
			e.printStackTrace();
		}
	}
	
	private Boolean verificarItensMarcadosSinaisDeAlerta(){
		 for(Entry<String,Boolean> entry: checkMapAlerta.entrySet()){
			 if (entry.getValue()) {
				 if(entry.getKey().equals(itensDscAlerta.get(8))){//Não há sinais de alerta
					 liberarSangramentoBloquearAlerta();
					 return true;
				 }
		      }     
		 }
		return false;
	}
	
	private boolean verificarItensMarcadosAlgumaSituacao(){
		 for(Entry<String,Boolean> entry: checkMapSituacao.entrySet()){
		 if (entry.getValue()) {
			 if(entry.getKey().equals(itensDscSituacao.get(8))){//Não há sinais de alerta
				 liberarLacoBloquearSituacao();
				 return true;
			 }
	      }     
	 }
		return false;
	}
	
	
	private boolean validarItensMarcadosAlgumaSituacao(){
		for(Entry<String,Boolean> entry: checkMapSituacao.entrySet()){
			if (entry.getValue()) {
				return false;
			}
		}
		
		return true;
	}
	
	private void buscarItensMarcados(){
		itemDengue = new ArrayList<ItemDengue>();
		for(Entry<String,Boolean> entry: checkMapAlerta.entrySet()){
			 if (entry.getValue()) {
				itemDengue.add(new ItemDengue(entry.getKey()));
		      }     
		 }
		
		 for(Entry<String,Boolean> entry: checkMapSituacao.entrySet()){
			 if (entry.getValue()) {
				 itemDengue.add(new ItemDengue(entry.getKey()));
		      }     
		 }
	}
	
	private void getItemsAlgumaSituacao(){
		itensDscSituacao = new ArrayList<String>();
		itensDscSituacao.add("HAS,DM");
		itensDscSituacao.add("Idoso maior que 65 anos.");
		itensDscSituacao.add("Morador de rua.");
		itensDscSituacao.add("Gestante.");
		itensDscSituacao.add("DPOC");
		itensDscSituacao.add("Anemia falciforme.");
		itensDscSituacao.add("Doença renal crônica.");
		itensDscSituacao.add("Doença autoimunes.");
		itensDscSituacao.add("Não apresenta nenhuma das comorbidades/situações citadas acima.");
		setarSituacaoPadrao();
	}
	
	private void getItemsAlerta(){
		itensDscAlerta = new ArrayList<String>();
		itensDscAlerta.add("Dor abdominal intensa (referida ou à palpação) e contínua.");
		itensDscAlerta.add("Vômitos persistentes.");
		itensDscAlerta.add("Acúmulo de líquidos (ascite,derrame pleural,derrame pericárdico).");
		itensDscAlerta.add("Hipotensão postural e/ou lipotimia.");
		itensDscAlerta.add("Hepatomegalia maior do que 2cm abaixo do rebordo costal.");
		itensDscAlerta.add("Sangramento de mucosa.");
		itensDscAlerta.add("Letargia e/ou irritabilidade.");
		itensDscAlerta.add("Aumento progressivo do hematócrito.");
		itensDscAlerta.add("Não apresenta nenhum dos sinais de alerta.");
		setarAlertaPadrao();
	}
	
	private void setarAlertaPadrao(){
		for (String item : this.itensDscAlerta) {
            this.checkMapAlerta.put(item,Boolean.FALSE);
        }
	}
	
	private void setarSituacaoPadrao(){
		for (String item : this.itensDscSituacao) {
            this.checkMapSituacao.put(item,Boolean.FALSE);
        }
	}
	
	private void carregarExamesGrupoC() {
		listExameSelecionado = new ArrayList<ExamePepBean>();
		ExamePepBean exame = new ExamePepBean();
		exame.setFiltroMap(new HashMap<String, Object>());
		Integer[] isnExame = { 19, 22, 34, 62, 72 };
		exame.getFiltroMap().put("vetorExameIN", isnExame);
		try {
			List<ExamePepBean> lstexame = ExameImpl.getInstancia().pesquisar(exame, 0);
			for (ExamePepBean examePep : lstexame) {
				listExameSelecionado.add(examePep);
			}

			montarTxtExames();
			peso = pesoDengue;
			flgGestante = "N";
		} catch (Exception e) {
			e.printStackTrace();
		}
	}
	
	private void montarTxtExames(){
		stringExame = new StringBuilder();
		
		for (ExamePepBean exame : this.listExameSelecionado) {
			stringExame.append(exame.getDscExame());
			stringExame.append(" / ");
		}
	}
	
	private void carregarExamesGrupoB() {
		listExameSelecionado = new ArrayList<ExamePepBean>();
		ExamePepBean exame = new ExamePepBean();
		exame.setFiltroMap(new HashMap<String, Object>());
		Integer[] isnExame = { 72 };
		exame.getFiltroMap().put("vetorExameIN", isnExame);
		try {
			List<ExamePepBean> lstexame = ExameImpl.getInstancia().pesquisar(exame, 0);
			for (ExamePepBean examePep : lstexame) {
				listExameSelecionado.add(examePep);
			}
			montarTxtExames();
			peso = pesoDengue;
			flgGestante = "N";

		} catch (Exception e) {
			e.printStackTrace();
		}
	}
	
	private String imprimirRelatorioDengueTipoA(final Integer isnAtendimentoDengue){
	
			Connection con = null;
			try
			{
				HttpServletRequest request = (HttpServletRequest) FacesContext.getCurrentInstance().getExternalContext().getRequest();
				FuncUtil.apagarArquivos(request);
				Map parameters = new HashMap();
				
				String nomeRelatorio = "relReceitaDengue";
				String nomeImagem = IMG_NAME;
				String nomeImagem2 = "upa.gif";
				
				InternacaoDoc doc = new InternacaoDoc();
				doc.setIsnAtendimentoDengue(isnAtendimentoDengue);
				doc = InternacaoDocImpl.getInstancia().get(doc, 0);
				
				String pathJasper = request.getRealPath("WEB-INF/classes/relatorio");
				String pathJasperImg = request.getRealPath("IMG/" + nomeImagem);
				String pathJasperImg2 = request.getRealPath("IMG/" + nomeImagem2);
				
				parameters.put("CAMINHO_IMG2", pathJasperImg2);
				
		        String os = System.getProperty("os.name");	
		        File pasta = new File((os.toLowerCase().indexOf("linux") > -1 ? "/" : "\\"));
		        pathJasper += pasta; 
		        JasperReport jasperReport = (JasperReport) JRLoader.loadObject(pathJasper + "/" + nomeRelatorio + ".jasper");
		
		        if (jasperReport == null){
		           FacesContext.getCurrentInstance().addMessage(null, new FacesMessage(FacesMessage.SEVERITY_WARN, "Nenhum relatório selecionado.", null));
		        }
		        
		        parameters.put("CAMINHO_IMG_UPA", pathJasperImg);
		        parameters.put("CAMINHO_IMG_BRASAO", pathJasperImg2);
		        parameters.put("P1", getIsnInternacao());
		        parameters.put("P2", doc.getIsnInternacaoDoc());
		        
		        //PARAMETROS CONEXAO BANCO DE DADOS - INICIO
		        String urlBd ="", userBd = "", senhaBd = "";
		        //usuario
		        Parametro parametro = new Parametro();
		        parametro.setIsnParametro(ParametroImpl.USUARIO_BANCO_DADOS);
		        parametro = ParametroImpl.getInstancia().get(parametro, 0);
		        userBd = parametro.getVlrParametro();
		        //senha
		        parametro = new Parametro();
		        parametro.setIsnParametro(ParametroImpl.SENHA_CRIPTOGRAFADA_BANCO_DADOS);
		        parametro = ParametroImpl.getInstancia().get(parametro, 0);
		        senhaBd = IsghEncodeDecode.decrypt(parametro.getVlrParametro());
		        //url
		        parametro = new Parametro();
		        parametro.setIsnParametro(ParametroImpl.URL_CONEXAO_BANCO_DADOS);
		        parametro = ParametroImpl.getInstancia().get(parametro, 0);
		        urlBd = parametro.getVlrParametro();
		        //PARAMETROS CONEXAO BANCO DE DADOS - FIM	        
		        
		    	con = (Connection) DriverManager.getConnection(urlBd, userBd, senhaBd);
		    	
		    	JasperPrint impressao = JasperFillManager.fillReport(jasperReport, parameters, con);
		        
		        String pathPdf =  "/temp/"
		        				  + request.getRequestedSessionId()
		                          + String.valueOf(Math.random() * 10000)
		                          + nomeRelatorio
		                          + ".pdf";
		        
		         JasperExportManager.exportReportToPdfFile(impressao, request.getRealPath("") + pathPdf);
		       
		         HttpServletResponse response = (HttpServletResponse) FacesContext.getCurrentInstance().getExternalContext().getResponse();
		         response.sendRedirect(request.getContextPath() + pathPdf);
		         con.close();
		         
			}
			catch (Exception e) 
			{
				e.printStackTrace();
				if(con != null)
				{
					try 
					{
						con.close();
					} 
					catch (SQLException e1) 
					{
						e1.printStackTrace();
					}
				}
			}
		         
	         return null;
	}
	
	public void resetarParametrosDengue(){
		 atendimentoDengue = new AtendimentoDengue();
		 stringExame = null;
		 flgChoque = true;
		 flgAlerta = false;
		 flgSangramento = false;
		 flgSituacaoExtra = false;
		 flgLaco = false;
		 flgPeso = false;
		 flgLiberarConfirmar = false;
		 flgAlertaPositivo = false;
		 flgSituacaoPositivo = false;
		 mensagemAlertaDengue=null;
		 mensagemHidratacao = null;
		 msgAlerta = null;
		 tipoGrupo = null;
		 pesoDengue = 0.0;
		 flgDengue = false;
		 datSintomas=null;
		 flgMenor12 = false;
				
		
	}
	
	public String resetarCid10(){
		objIaPep.setIsnCid10(0);
		objIaPep.setCid10(new Cid10());
		objIa.setIsnCid10(0);
		objIa.setCid10(new Cid10());
		objCid10 = new Cid10();
		
		return "";
	}
	
	public void concluirPrescricaoEnfermagemPepi() {

		setAvisoValidacao(0);
		try {
			// validar o usuario/profissional
			String senha = IsghEncodeDecode.encrypt(senhaAssinatura
					.toUpperCase());
			Usuario usuProf = new Usuario();
			usuProf.setDscLogin(usuarioCoren.toUpperCase());
			usuProf.setDscSenha(senha);
			usuProf = (Usuario) UsuarioImpl.getInstancia().get(
					usuProf,
					UsuarioImpl.JOIN_USUARIO_GRUPO
							| UsuarioImpl.JOIN_USUARIOGRUPO_GRUPO);
			if (usuProf == null) {
				setAvisoValidacao(5);
				return;
			} else if(usuProf.getIsnConselho() == null || usuProf.getFlgSituacao().equals("N")){
				setAvisoValidacao(5);
				return;	
			} else if(usuProf.getIsnConselho() != 2) {
				setAvisoValidacao(5);
				return;
			}

			// if(!ValidaPermissaoUsuario.getInstancia().verificaPermissao("CD_ATENDIMENTOMEDICO",
			// funcUtil.getAcaoGravar())) {
			// avisoValidacao = 2;
			// return;
			// }

			if (lstPrescricaoEnfermagemItemInc.size() < 1) {
				setAvisoValidacao(33);
				return;
			} else {
				// insere itens
				for (ItemInternacaoPrescPep internacaoPrescPep : lstPrescricaoEnfermagemItemInc) {
					internacaoPrescPep
							.setIsnInternacaoPresc(objInternacaoPrescricao
									.getIsnInternacaoPresc());
					ItemInternacaoPrescImpl.getInstancia().inserir(
							internacaoPrescPep);
				}

				// finaliza prescricao enfermagem
				InternacaoPrescPep internacaoPrescPep = objInternacaoPrescricao;
				internacaoPrescPep.setDatConclusao(new Date());
				internacaoPrescPep.setIsnUsuario(usuProf.getIsnUsuario());
				InternacaoPrescImpl.getInstancia().alterar(internacaoPrescPep);

			}

			carregarPrescricaoEnfermagem();

		} catch (Exception e) {
			e.getStackTrace();
			setAvisoValidacao(3);
		}

	}

	public String atendimentoEixo() throws MalformedURLException {

		Usuario usuarioDg = new Usuario();
		String retornoVazio = "";
		avisoValidacao = 0;
		try {
			if (usuario == null || usuario.trim().equalsIgnoreCase("")
					|| senha == null || senha.trim().equalsIgnoreCase("")) {
				avisoValidacao = 3;
				return retornoVazio;
			}
			String senhaEnpritpt = IsghEncodeDecode
					.encrypt(senha.toUpperCase());
			usuarioDg.setDscLogin(usuario.toUpperCase());
			usuarioDg.setDscSenha(senhaEnpritpt);
			usuarioDg = (Usuario) UsuarioImpl.getInstancia().get(
					usuarioDg,
					UsuarioImpl.JOIN_USUARIO_GRUPO
							| UsuarioImpl.JOIN_USUARIOGRUPO_GRUPO,
					Criteria.DISTINCT_ROOT_ENTITY);

			if (usuarioDg == null) {
				avisoValidacao = 3;
				return retornoVazio;
			}
			if (!ValidaPermissaoUsuario.getInstancia().verificaPermissao(
					usuarioDg, funcUtil.getAcaoAtender())) {
				avisoValidacao = 5;
				return retornoVazio;
			}

			if (alta) {
				if (isnMotivoAlta == EnumMotivosAlta.SELECIONE) {
					avisoValidacao = 8;
					return retornoVazio;
				}
				if (listaEvolucao == null || listaEvolucao != null
						&& listaEvolucao.size() <= 0) {
					avisoValidacao = 31;
					return retornoVazio;
				}
			}

			// if(objIa.getCid10() == null || objIa.getIsnCid10() == null){
			// avisoValidacao = 32;
			// return retornoVazio;
			// }

			if (usuarioDg.getIsnConselho() != null
					&& usuarioDg.getIsnConselho().intValue() == 6) // CONSELHO
																	// CRM
			{
				objIa.setDatInicioMed(getDataInicio());
			} else if (usuarioDg.getIsnConselho() != null
					&& usuarioDg.getIsnConselho().intValue() == 9) // CONSELHO
																	// CRO
			{
				objIa.setDatInicioOdonto(getDataInicio());
			}

			if (paciente.getIsnInternacao() != null){
				PrescricaoPep prescricaoPep = new PrescricaoPep();
				prescricaoPep.setIsnInternacao(paciente.getIsnInternacao());
				HashMap<String, Object> filtro = new HashMap<String, Object>();
				filtro.put("isnProfissionalConcl", "NULL");
				filtro.put("datPrescricaoLE", new Date());
				filtro.put("datCancelamentoNull", "null");
				
				prescricaoPep.setFiltro(filtro);
	
				List<PrescricaoPep> lstObjPrescricaoPep = PrescricaoPepImpl.getInstancia().pesquisar(prescricaoPep, 0);
	
				if (lstObjPrescricaoPep != null && lstObjPrescricaoPep.size() > 0) 
				{
					avisoValidacao = 41;
					return retornoVazio;
				}
			}
			PrescricaoPepImpl.getInstancia().concluirAtendimento(usuarioDg, paciente.getIsnInternacao(),isnMotivoAlta.ordinal(), alta, objIa);

			if (internacaoLeitoAtual != null) {
				
				/*InternacaoLeitoFacade ilFacade = new InternacaoLeitoFacadeImpl();
				internacaoLeitoAtual = ilFacade.buscaInternacaoLeitoAnterior(internacaoLeitoAtual.getIsnInternacaoLeito());*/
				
				if (internacaoLeitoAtual.getFlgAltaMedica() != null && internacaoLeitoAtual.getFlgAltaMedica().equals("S")) {
					internacaoLeitoAtual.setIsnUsuarioAltaMedica(usuarioDg.getIsnUsuario());
					internacaoLeitoAtual.setDatAltaMedica(new Date());
				} else {
					internacaoLeitoAtual.setIsnUsuarioAltaMedica(null);
				}
				new InternacaoLeitoFacadeImpl().alterarObjeto(internacaoLeitoAtual);
			}

		} catch (Exception e) {
			e.printStackTrace();
		}
		return "cd_atendimentoMedico_eixosEmergencia";
	}

	public void copiaPrescricao() {

		try {
			if (!ValidaPermissaoUsuario.getInstancia().verificaPermissao(
					"CD_ATENDIMENTOMEDICO", funcUtil.getAcaoGravar())) {
				this.setMensagemConfirmacao("Usuário sem permissão!");
				return;
			}

			this.setMensagemConfirmacao(null);

			PrescricaoPep prescricaoPep = new PrescricaoPep();
			prescricaoPep.setIsnInternacao(paciente.getIsnInternacao());
			prescricaoPep.setDscPrescricao(this.objPrescricaoPepItemCopia
					.getDscPrescricao());
			prescricaoPep.setPaginaOrigem(this.getPaginaOrigem());
			PrescricaoPepImpl.getInstancia().verificarPrescricao(prescricaoPep);

			// PrescricaoPepItem prescricaoPepItem = new PrescricaoPepItem();
			// prescricaoPepItem.setIsnPrescricaoPep(this.objPrescricaoPepItemCopia.getIsnPrescricaoPep());
			// prescricaoPepItem.setDscPrescricao(this.objPrescricaoPepItemCopia.getDscPrescricao());
			//
			// PrescricaoPepItemImpl.getInstancia().inserir(prescricaoPepItem);

			this.limparCampos();

			this.carregaPrescricaoPepAtual();
			this.carregarPrescricao();

		} catch (Exception e) {
			this.setMensagemConfirmacao(e.getMessage());
		}

	}

	public void copiaPrescricaoGrupo() {

		try {
			if (!ValidaPermissaoUsuario.getInstancia().verificaPermissao(
					"CD_ATENDIMENTOMEDICO", funcUtil.getAcaoGravar())) {
				this.setMensagemConfirmacao("Usuário sem permissão!");
				return;
			}

			this.setMensagemConfirmacao(null);

			// PrescricaoPepImpl.getInstancia().verificarPrescricaoGrupo(objPrescricaoPepCopia);
			objPrescricaoPepCopia.setPaginaOrigem(this.getPaginaOrigem());
			PrescricaoPepImpl.getInstancia().verificarPrescricaoGrupo(
					objPrescricaoPepCopia);

			this.limparCampos();

			this.carregaPrescricaoPepAtual();
			this.carregarPrescricao();

		} catch (Exception e) {
			this.setMensagemConfirmacao("Ocorreu um erro inesperado, por favor entre em contarto com NTI."
					+ e.getMessage() != null ? e.getMessage() : "");
		}

	}

	public void teste() {

	}

	public String voltarAtendimento() throws MalformedURLException {
		// Avisa para o ws toLife que o paciente foi liberado/realocado
		if (this.getUsarClassificacaoToLife()) { // se tolife estiver habilitado
			if (!new ConsumoToLifeWS().registrarRealocacaoPaciente(paciente
					.getIsnInternacao())) {
				avisoValidacao = 1;
				return "";
			}
		}

		ClassificacaoRiscoFacade crf = new ClassificacaoRiscoFacadeImpl();
		cr = crf.maximoClassificacaoRisco(paciente.getIsnInternacao());

		// Início - Atualizar Flg_Risco para alterar a cor do Risco para preto
		InternacaoFacade i = new InternacaoFacadeImpl();
		i.atendimentoLivre(paciente.getIsnInternacao(), true);
		
		
		// Fim - Atualizar Flg_Risco para alterar a cor do Risco para preto

		this.atualizarListaEmergencia();

		return "cd_atendimentoMedicoTocs_emergencia";
	}

	public String voltarParaTelaOrigem() throws MalformedURLException {

		// Avisa para o ws toLife que o paciente foi liberado/realocado
		if (this.getUsarClassificacaoToLife()) { // se tolife estiver habilitado
			if (!new ConsumoToLifeWS().registrarRealocacaoPaciente(paciente
					.getIsnInternacao())) {
				avisoValidacao = 1;
				return "";
			}
		}

		try {

			List<ExameSolicitacaoPepBean> listaExameSolic = getLstExameSolicEmergencia();
			List<PrescricaoUpaBean> listaPrescricao = getLstPrescricao();

			PrescricaoUpaImpl.getInstancia().atualizarOrdem(listaPrescricao,
					isnInternacao);

			ExameSolicFacade facade = new ExameSolicFacadeImpl();
			facade.atualizarOrgem(listaExameSolic, isnInternacao);
		} catch (Exception e) {
			e.printStackTrace();
		}

		switch (origemTelaParaAtendimento) {
		case 1:
			return "cd_atendimentoMedico_eixosEmergencia";
		case 2:
			return "cd_atendimentoMedico_cs_pacienteAtendimento";
		default:
			return "";
		}

	}

	public void ImpressaoAtendimento() throws JRException, SQLException,
			IOException, Exception {

		HttpServletRequest request = (HttpServletRequest) FacesContext
				.getCurrentInstance().getExternalContext().getRequest();

		FuncUtil.apagarArquivos(request);

		String pathJasper = request.getRealPath("WEB-INF/classes/relatorio");

		String os = System.getProperty("os.name");
		File pasta = new File((os.toLowerCase().indexOf("linux") > -1 ? "/"
				: "\\"));

		pathJasper += pasta;

		JasperReport jasperReport = (JasperReport) JRLoader
				.loadObject(pathJasper + "/" + this.REPORT_NAME + ".jasper");

		if (jasperReport == null) {
			FacesContext.getCurrentInstance().addMessage(
					null,
					new FacesMessage(FacesMessage.SEVERITY_WARN,
							"Nenhum relatório selecionado.", null));
		}

		Map parameters = new HashMap();

		parameters.put("CAMINHO_SUB_REPORT", pathJasper);
		parameters.put("p1", 14); // internacao

		List<ExameSolic> listaAux = new ArrayList<ExameSolic>();

		ExameSolic exameSolic = new ExameSolic();
		exameSolic.setDatCadastro(new Date());

		listaAux.add(exameSolic);

		// JRBeanCollectionDataSource ds = new
		// JRBeanCollectionDataSource(listaAux);

		// JasperPrint impressao = JasperFillManager.fillReport(jasperReport,
		// parameters, ds);

		// PARAMETROS CONEXAO BANCO DE DADOS - INICIO
		String urlBd = "", userBd = "", senhaBd = "";

		// usuario
		Parametro parametro = new Parametro();
		parametro.setIsnParametro(ParametroImpl.USUARIO_BANCO_DADOS);
		parametro = ParametroImpl.getInstancia().get(parametro, 0);
		userBd = parametro.getVlrParametro();
		// senha
		parametro = new Parametro();
		parametro
				.setIsnParametro(ParametroImpl.SENHA_CRIPTOGRAFADA_BANCO_DADOS);
		parametro = ParametroImpl.getInstancia().get(parametro, 0);
		senhaBd = IsghEncodeDecode.decrypt(parametro.getVlrParametro());
		// url
		parametro = new Parametro();
		parametro.setIsnParametro(ParametroImpl.URL_CONEXAO_BANCO_DADOS);
		parametro = ParametroImpl.getInstancia().get(parametro, 0);
		urlBd = parametro.getVlrParametro();
		// PARAMETROS CONEXAO BANCO DE DADOS - FIM

		Connection con = (Connection) DriverManager.getConnection(urlBd,
				userBd, senhaBd);

		JasperPrint impressao = JasperFillManager.fillReport(jasperReport,
				parameters, con);

		String pathPdf = "/temp/" + request.getRequestedSessionId()
				+ String.valueOf(Math.random() * 10000) + this.REPORT_NAME
				+ ".pdf";

		JasperExportManager.exportReportToPdfFile(impressao,
				request.getRealPath("") + pathPdf);

		HttpServletResponse response = (HttpServletResponse) FacesContext
				.getCurrentInstance().getExternalContext().getResponse();
		response.sendRedirect(request.getContextPath() + pathPdf);

		// //////////////////////////// RELATORIO ATENDIMENTO
		// //////////////////////////////
		//
		// HttpServletResponse response = (HttpServletResponse)
		// FacesContext.getCurrentInstance().getExternalContext().getResponse();
		//
		// Connection con = null;
		// boolean ok = true;
		//
		// try {
		// con = (Connection) DriverManager.getConnection(urlBd, userBd,
		// senhaBd);
		//
		// HashMap<String, Integer> parametros = new HashMap<String,Integer>();
		// parametros.put("p1",paciente.getIsnInternacao()); // ISN CLINICA
		// //parametros.put("p2", p2); // DATA .
		//
		// //RelatorioUtil ru = new RelatorioUtil();
		// //RelatorioUtil.exibirRelatorio("subRelExames.jasper", con,
		// parametros, request);
		//
		// RelatorioUtil.getInstance().exibirRelatorio("subRelExames.jasper",
		// con, parametros);
		//
		// } catch (SQLException e) {
		// e.printStackTrace();
		// ok = false;
		// } catch (JRException e) {
		// e.printStackTrace();
		// ok = false;
		// } finally {
		// try {
		// if (con != null)
		// con.close();
		// } catch (SQLException e) {
		// e.printStackTrace();
		// }
		// }
		//
		//
		// try {
		// PrintWriter out = response.getWriter();
		//
		// if (ok) {
		// out.println("<html><head>");
		// out.println("<script type=\"text/javascript\" src=\"SCRIPTS/relatorio.js\"></script>");
		// out.println("</head><body onload=\"openReport()\"></body></html>");
		// } else {
		// out.println("<html><body>");
		// out.println("<h3>Erro na geração do Relatório</h3>");
		// out.println("</body></html>");
		// }
		//
		// out.close();
		//
		//
		// } catch (IOException e) {
		// e.printStackTrace();
		// }
		//
		//
		//
		// //////////////////////////

	}

	@SuppressWarnings({ "deprecation", "static-access", "rawtypes", "unchecked" })
	public String relatorioPrescricaoEnfermagem() {
		Connection con = null;
		try {
			HttpServletRequest request = (HttpServletRequest) FacesContext
					.getCurrentInstance().getExternalContext().getRequest();

			FuncUtil.apagarArquivos(request);

			String pathJasper = request
					.getRealPath("WEB-INF/classes/relatorio");
			String pathJasperImg = request.getRealPath("IMG/" + new FuncUtil().retornaLogoBrasaoUpa());
			String pathJasperImg2 = request.getRealPath("IMG/" + "upa.gif");

			String os = System.getProperty("os.name");
			File pasta = new File((os.toLowerCase().indexOf("linux") > -1 ? "/"
					: "\\"));

			pathJasper += pasta;

			JasperReport jasperReport = null;

			jasperReport = (JasperReport) JRLoader.loadObject(pathJasper + "/"
					+ this.REPORT_NAME7 + ".jasper");

			if (jasperReport == null) {
				FacesContext.getCurrentInstance().addMessage(
						null,
						new FacesMessage(FacesMessage.SEVERITY_WARN,
								"Nenhum relatório selecionado.", null));
			}

			Map parameters = new HashMap();

			parameters.put("CAMINHO_IMG", pathJasperImg);
			parameters.put("CAMINHO_IMG2", pathJasperImg2);
			parameters.put("p1", this.getObjInternacaoPrescricao()
					.getIsnInternacaoPresc());

			// PARAMETROS CONEXAO BANCO DE DADOS - INICIO
			String urlBd = "", userBd = "", senhaBd = "";

			// usuario
			Parametro parametro = new Parametro();
			parametro.setIsnParametro(ParametroImpl.USUARIO_BANCO_DADOS);
			parametro = ParametroImpl.getInstancia().get(parametro, 0);
			userBd = parametro.getVlrParametro();
			// senha
			parametro = new Parametro();
			parametro
					.setIsnParametro(ParametroImpl.SENHA_CRIPTOGRAFADA_BANCO_DADOS);
			parametro = ParametroImpl.getInstancia().get(parametro, 0);
			senhaBd = IsghEncodeDecode.decrypt(parametro.getVlrParametro());
			// url
			parametro = new Parametro();
			parametro.setIsnParametro(ParametroImpl.URL_CONEXAO_BANCO_DADOS);
			parametro = ParametroImpl.getInstancia().get(parametro, 0);
			urlBd = parametro.getVlrParametro();
			// PARAMETROS CONEXAO BANCO DE DADOS - FIM

			con = (Connection) DriverManager.getConnection(urlBd, userBd,
					senhaBd);

			JasperPrint impressao = JasperFillManager.fillReport(jasperReport,
					parameters, con);

			String pathPdf = "/temp/" + request.getRequestedSessionId()
					+ String.valueOf(Math.random() * 10000) + this.REPORT_NAME7
					+ ".pdf";

			JasperExportManager.exportReportToPdfFile(impressao,
					request.getRealPath("") + pathPdf);

			HttpServletResponse response = (HttpServletResponse) FacesContext
					.getCurrentInstance().getExternalContext().getResponse();
			response.sendRedirect(request.getContextPath() + pathPdf);
			con.close();
		} catch (Exception e) {
			if (con != null) {
				try {
					con.close();
				} catch (SQLException e1) {
					e1.printStackTrace();
				}
			}
			e.printStackTrace();
		}
		return null;
	}

	@SuppressWarnings({ "deprecation", "static-access", "rawtypes", "unchecked" })
	public String relatorioEvolucaoPaciente() {
		Connection con = null;
		try {
			HttpServletRequest request = (HttpServletRequest) FacesContext
					.getCurrentInstance().getExternalContext().getRequest();

			FuncUtil.apagarArquivos(request);

			String pathJasper = request
					.getRealPath("WEB-INF/classes/relatorio");
			String pathJasperImg = request.getRealPath("IMG/" + this.IMG_NAME);
			String pathJasperImg2 = request.getRealPath("IMG/" + "upa.gif");

			String os = System.getProperty("os.name");
			File pasta = new File((os.toLowerCase().indexOf("linux") > -1 ? "/"
					: "\\"));

			pathJasper += pasta;

			JasperReport jasperReport = null;

			if (this.getIsnInternacaoEvolucao() == 0) {
				jasperReport = (JasperReport) JRLoader.loadObject(pathJasper
						+ "/" + this.REPORT_NAME5 + ".jasper"); // todas
																// evoluções
			} else {
				jasperReport = (JasperReport) JRLoader.loadObject(pathJasper
						+ "/" + this.REPORT_NAME6 + ".jasper"); // somente uma
																// evolução
			}

			if (jasperReport == null) {
				FacesContext.getCurrentInstance().addMessage(
						null,
						new FacesMessage(FacesMessage.SEVERITY_WARN,
								"Nenhum relatório selecionado.", null));
			}

			Map parameters = new HashMap();

			parameters.put("CAMINHO_SUB_REPORT", pathJasper);
			parameters.put("CAMINHO_IMG", pathJasperImg);
			parameters.put("CAMINHO_IMG2", pathJasperImg2);
			parameters.put("p1", this.getIsnInternacao());
			parameters.put("p2", this.getIsnInternacaoEvolucao()); // Imprime
																	// uma
																	// evolução
																	// especifica

			// PARAMETROS CONEXAO BANCO DE DADOS - INICIO
			String urlBd = "", userBd = "", senhaBd = "";

			// usuario
			Parametro parametro = new Parametro();
			parametro.setIsnParametro(ParametroImpl.USUARIO_BANCO_DADOS);
			parametro = ParametroImpl.getInstancia().get(parametro, 0);
			userBd = parametro.getVlrParametro();
			// senha
			parametro = new Parametro();
			parametro
					.setIsnParametro(ParametroImpl.SENHA_CRIPTOGRAFADA_BANCO_DADOS);
			parametro = ParametroImpl.getInstancia().get(parametro, 0);
			senhaBd = IsghEncodeDecode.decrypt(parametro.getVlrParametro());
			// url
			parametro = new Parametro();
			parametro.setIsnParametro(ParametroImpl.URL_CONEXAO_BANCO_DADOS);
			parametro = ParametroImpl.getInstancia().get(parametro, 0);
			urlBd = parametro.getVlrParametro();
			// PARAMETROS CONEXAO BANCO DE DADOS - FIM

			con = (Connection) DriverManager.getConnection(urlBd, userBd,
					senhaBd);

			// error here
			JasperPrint impressao = JasperFillManager.fillReport(jasperReport,
					parameters, con);

			String pathPdf = "/temp/" + request.getRequestedSessionId()
					+ String.valueOf(Math.random() * 10000) + this.REPORT_NAME
					+ ".pdf";

			JasperExportManager.exportReportToPdfFile(impressao,
					request.getRealPath("") + pathPdf);

			HttpServletResponse response = (HttpServletResponse) FacesContext
					.getCurrentInstance().getExternalContext().getResponse();
			response.sendRedirect(request.getContextPath() + pathPdf);
			con.close();
		} catch (Exception e) {
			if (con != null) {
				try {
					con.close();
				} catch (SQLException e1) {
					e1.printStackTrace();
				}
			}
			e.printStackTrace();
		}
		return null;
	}
	
	public void validaChikungunya(ActionEvent event) {
		if (this.cr.getFlgDengue() != null && this.cr.getFlgDengue().equals("S")) {
			this.cr.setFlgChikungunya("N");
			resetarData();
		}
	}
	
	public void validaDengue(ActionEvent event) {
		if (this.cr.getFlgChikungunya() != null && this.cr.getFlgChikungunya().equals("S")) {
			this.cr.setFlgDengue("N");
			resetarData();
		}
	}
	
	private void resetarData(){
		this.setDatSintomaDengue(null);
		this.setDatSintomaChikungunya(null);
	}

	public void classificarRisco() {

		/*
		 * if(!validaCr()){ avisoValidacao = 22; return; }
		 */

		avisoValidacao = 0;

		if ((objFluxograma.getIsnFluxograma() == 0)) { // fluxograma
			avisoValidacao = 12;
			return;
		} else if (cr.getDscDiscriminador().isEmpty()) { // discriminador
			avisoValidacao = 13;
			return;
		} else if (isnRisco == 0) { // classificacao
			avisoValidacao = 1;
			return;
		} else if (isnEspecialidadeEmergencia == 0) { // Destino
			avisoValidacao = 6;
			return;
			// } else if (isnRisco.equals(paciente.getIsnRisco())) { // Validar
			// se Ã© a mesma que a atual
			// avisoValidacao = 2;
			// return;
		} else if (pacienteOtimizado.getHorRegistro() != null
				&& pacienteOtimizado.getHorRegistro().equals(FuncUtil.obterHoraAtual())) {
			// Validar se a classificacao foi atualizada no mesmo minuto
			avisoValidacao = 4;
			return;
		} else if (cr.getFlgRiscoQueda() == null || cr.getFlgRiscoQueda().isEmpty()) {
			avisoValidacao = 23;
			return;
		} else if (objPaciente.getFlgAlergia() == null || objPaciente.getFlgAlergia().isEmpty()){
			avisoValidacao = 24;
			return;
		}else if(cr.getFlgDengue().isEmpty()){
			avisoValidacao = 26;
			return;
			
		}else if (cr.getFlgDengue().equals("S")  && getDatSintomaDengue() == null){
			avisoValidacao = 25;
			return;
		}else if (cr.getFlgChikungunya().isEmpty()){
			avisoValidacao = 28;
			return;
		}else if (cr.getFlgChikungunya().equals("S")  && getDatSintomaChikungunya() == null){
			avisoValidacao = 29;
			return;
		}else if (cr.getFlgSuspeitaInfeccao().isEmpty()){
			avisoValidacao = 27;
			return;
		}

		Usuario usuarioDg = new Usuario();
		try {

			if (usuario == null || usuario.trim().equalsIgnoreCase("")) {
				avisoValidacao = 3;
				return;
			}
			if (senha == null || senha.trim().equalsIgnoreCase("")) {
				avisoValidacao = 3;
				return;
			}

			String senhaEnpritpt = IsghEncodeDecode
					.encrypt(senha.toUpperCase());

			usuarioDg.setDscLogin(usuario.toUpperCase());
			usuarioDg.setDscSenha(senhaEnpritpt);
			usuarioDg = (Usuario) UsuarioImpl.getInstancia().get(
					usuarioDg,
					UsuarioImpl.JOIN_USUARIO_GRUPO
							| UsuarioImpl.JOIN_USUARIOGRUPO_GRUPO);

			if (usuarioDg == null) {
				avisoValidacao = 3;
				return;
			}

			if (!ValidaPermissaoUsuario.getInstancia().verificaPermissao(
					usuarioDg, funcUtil.getAcaoCalssificar())) {
				avisoValidacao = 5;
				return;
			}

		} catch (Exception e1) {
			e1.printStackTrace();
		}

		// Registrar o risco
		try {
			Fluxograma fluxo = new FluxogramaFacadeImpl()
					.obterFluxograma(objFluxograma.getIsnFluxograma());

			cr.setDateIni(getDatInicialRisco());
			cr.setDscHorIni(getHorInicialRisco());
			cr.setDatSintomaDengue(getDatSintomaDengue());
			if(cr.getFlgDengue().equals("N")){
				cr.setDatSintomaDengue(null);
			}
			cr.setDatSintomaChikungunya(getDatSintomaChikungunya());
			if(cr.getFlgChikungunya().equals("N")){
				cr.setDatSintomaChikungunya(null);
			}
			//cr.setFlgDengue("N"); // so para mandar pra producao,
									// desconsiderando o fluxo da dengue.
									// renderder="false" na cs_emergencia.xhtml
			if(cr.getFlgSuspeitaInfeccao().equals("N")){
				adicionarApenasNaoApresentaSirs();
			}
			cr.setSinaisSirsRiscos(this.sinaisSirsRisco);
			
			cr.setFlgAlergia(objPaciente.getFlgAlergia());
			
			cr = new InternacaoFacadeImpl().classificarRisco(
					pacienteOtimizado.getIsnInternacao(), isnRisco, fluxo, cr,
					isnEspecialidadeEmergencia, usuarioDg);

			new PacienteFacadeImpl().alterarObjeto(objPaciente);

			// Início - Atualizar Flg_Risco para alterar a cor do Risco para
			// preto
			InternacaoFacade i = new InternacaoFacadeImpl();
			i.riscoLivre(pacienteOtimizado.getIsnInternacao());
			// Fim - Atualizar Flg_Risco para alterar a cor do Risco para preto

			atualizarListaEmergencia();
			// limpar as variaveis;
			isnRisco = 0;
			isnEspecialidadeEmergencia = 0;
			textoDiscriminador = "";
			setIsnFluxograma(0);
			usuario = "";
			senha = "";

			if (cr.getIsnInternacaoRisco() != null) {
				Integer idade = funcUtil.calcularIdade(pacienteOtimizado
						.getDatNascimento());

				if (idade <= 14) {
					avisoValidacao = 16;// CHAMA PANEL PESO
					return;
				}
			}

		} catch (Exception e) {
			avisoValidacao = 11;
		}
	}
	
	public void iniciarMapSinaisSirs() {
		this.checkMapSinaisSirs = new HashMap<SinaisSirs,Boolean>();
		if (this.listSinaisSirs != null && !this.listSinaisSirs.isEmpty()) {
			for (SinaisSirs sinais : this.listSinaisSirs) {
				this.checkMapSinaisSirs.put(sinais, Boolean.FALSE);
			}
		}
	}
	
	public String gravarSinaisSirs() {
		this.setMensagem("");

		adicionarSinaisSirs();
		
		if(isSelecionadasSinaisSirsRiscoVazias()){
			this.setMensagem("Selecione uma opção!");
		}
		if(verificaSeTemAlgumaOpcaoMarcadaComNaoApresentaSirs()){
			adicionarApenasNaoApresentaSirs();
			inseriNaoTemSepseQuandoMarcadaNaoApresentaSirs();
		}
		return "";
	}
	
	private void inseriNaoTemSepseQuandoMarcadaNaoApresentaSirs(){
		this.cr.setFlgSuspeitaInfeccao("N");
	}
	
	private void adicionarSinaisSirs(){
		final List<SinaisSirsRisco> sinais = new ArrayList<>();

		for (Entry<SinaisSirs, Boolean> entry : checkMapSinaisSirs.entrySet()) {
			if (entry.getValue()) {
				final SinaisSirsRisco sinaisSirsRisco = getNovoSinalSirsRisco(entry.getKey());
				sinais.add(sinaisSirsRisco);
			}
		}
		this.sinaisSirsRisco = new ArrayList<>(sinais);
	}
	
	private boolean verificaSeTemAlgumaOpcaoMarcadaComNaoApresentaSirs() {
		final Integer REBAIXAMENTO_NIVEL_CONSCIENCIA = 1;
		final Integer DESSATURACAO = 5;
		final Integer NAO_APRESENTA_SIRS = 7;
		
		for (SinaisSirsRisco sinaisSirsRisco : this.sinaisSirsRisco) {
			if (sinaisSirsRisco.getIsnSinaisSirs().equals(NAO_APRESENTA_SIRS)) {
				return true;
			}
		}
		
		Integer qtdSinais = 0;
		for (SinaisSirsRisco sinaisSirsRisco : this.sinaisSirsRisco) {
			qtdSinais++;
			if(sinaisSirsRisco.getIsnSinaisSirs().equals(REBAIXAMENTO_NIVEL_CONSCIENCIA)) {
				return false;
			}
			if(sinaisSirsRisco.getIsnSinaisSirs().equals(DESSATURACAO)) {
				return false;
			}
		}
		if(qtdSinais < 2) return true;
		
		return false;
	}
	
	private void adicionarApenasNaoApresentaSirs() {
		final Integer NAO_APRESENTA_SIRS = 7;
		final List<SinaisSirsRisco> sinais = new ArrayList<>();

		for (SinaisSirs sinaisSirs : this.listSinaisSirs) {
			if (sinaisSirs.getIsnSinaisSirs().equals(NAO_APRESENTA_SIRS)) {
				final SinaisSirsRisco sinaisSirsRisco = getNovoSinalSirsRisco(sinaisSirs);
				sinais.add(sinaisSirsRisco);
			}
		}
		this.sinaisSirsRisco = new ArrayList<>(sinais);
	}
	
	private SinaisSirsRisco getNovoSinalSirsRisco(SinaisSirs sinaisSirs) {
		final SinaisSirsRisco sinaisSirsRisco = new SinaisSirsRisco();
		sinaisSirsRisco.setIsnSinaisSirs(sinaisSirs.getIsnSinaisSirs());
		sinaisSirsRisco.setDscSinaisSirs(sinaisSirs.getDscSinaisSirs());
		return sinaisSirsRisco;
	}
	
	private boolean isSelecionadasSinaisSirsRiscoVazias(){
		return this.sinaisSirsRisco.isEmpty();
	}
	
	public void classificarEBaixarPaciente() {
		try {
			avisoValidacao = 0;

			// Validar se selecionou o risco
			if (isnRisco == 0) {
				avisoValidacao = 1;
				return;
			} else if (objFluxograma.getIsnFluxograma() == 0) {
				avisoValidacao = 12;
				return;
			} else if (cr.getDscDiscriminador().isEmpty()) {
				avisoValidacao = 13;
				return;
			} else if (isnEspecialidadeEmergencia == 0) {
				avisoValidacao = 6;
				return;
			} else if (paciente.getHorRegistro() != null
					&& paciente.getHorRegistro().equals(
							FuncUtil.obterHoraAtual())) {
				// Validar se a classificacao foi atualizada no mesmo minuto
				avisoValidacao = 4;
				return;
			}

			if (usuario == null || "".equalsIgnoreCase(usuario.trim())) {
				avisoValidacao = 3;
				return;
			}
			if (senha == null || "".equalsIgnoreCase(senha.trim())) {
				avisoValidacao = 3;
				return;
			}
			// validacao - fim

			Usuario usuarioDg = new Usuario();
			String senhaEnpritpt = IsghEncodeDecode
					.encrypt(senha.toUpperCase());

			usuarioDg.setDscLogin(usuario.toUpperCase());
			usuarioDg.setDscSenha(senhaEnpritpt);
			usuarioDg = (Usuario) UsuarioImpl.getInstancia().get(
					usuarioDg,
					UsuarioImpl.JOIN_USUARIO_GRUPO
							| UsuarioImpl.JOIN_USUARIOGRUPO_GRUPO);

			if (usuarioDg == null) {
				avisoValidacao = 3;
				return;
			}

			if (!ValidaPermissaoUsuario.getInstancia().verificaPermissao(
					usuarioDg, funcUtil.getAcaoCalssificar())) {
				avisoValidacao = 5;
				return;
			}

			Fluxograma fluxo = new Fluxograma();
			fluxo.setIsnFluxograma(objFluxograma.getIsnFluxograma());

			cr.setDateIni(getDatInicialRisco());
			cr.setDscHorIni(getHorInicialRisco());

			cr = new InternacaoFacadeImpl().classificarRisco(
					paciente.getIsnInternacao(), isnRisco, fluxo, cr,
					isnEspecialidadeEmergencia, usuarioDg);

			// Início - Atualizar Flg_Risco para alterar a cor do Risco para
			// preto
			InternacaoFacade i = new InternacaoFacadeImpl();
			i.riscoLivre(paciente.getIsnInternacao());
			// Fim - Atualizar Flg_Risco para alterar a cor do Risco para preto

			InternacaoLeitoFacadeImpl ilf = new InternacaoLeitoFacadeImpl();

			InternacaoLeito il = new InternacaoLeito();
			il.setMotivoAlta("");
			il.setLeito(new Leito());
			il.getLeito().setIsnInternacao(paciente.getIsnInternacao());
			il.getLeito().setIsnLeito(paciente.getIsnLeito());
			il.setIsnMotivoAlta(EnumMotivosAlta.UNIDADE_BASICA_SAUDE.ordinal());

			il.setDscObsAlta("ALTA DE DENTRO DA SALA CLASSIFICAÇÃO DE RISCO");

			ilf.altaLeito(il, 1, usuarioDg);

			atualizarListaEmergencia();
			// limpar as variaveis;
			isnRisco = 0;
			isnEspecialidadeEmergencia = 0;
			textoDiscriminador = "";
			setIsnFluxograma(0);
			usuario = "";
			senha = "";

		} catch (Exception e1) {
			avisoValidacao = 11;
			e1.printStackTrace();
		}

	}

	public void referenciarPaciente(ActionEvent event) {
		try {
			// INICIO VALIDACOES
			avisoValidacao = 0;
			if (internacaoReferenciaBean == null || paciente == null
					|| paciente.getIsnInternacao() == null
					|| paciente.getIsnInternacao().intValue() <= 0) {
				avisoValidacao = 11; // Aconteceu um erro inesperado. contate o
										// NTI.
				return;
			}
			if (internacaoReferenciaBean.getFlgReferencia() == null
					|| "".equalsIgnoreCase(internacaoReferenciaBean
							.getFlgReferencia().trim())) {
				avisoValidacao = 23; // O Campo 'Paciente acatou referência?' é
										// obrigatório.
				return;
			}
			if (internacaoReferenciaBean.getDscReferencia() == null
					|| "".equalsIgnoreCase(internacaoReferenciaBean
							.getDscReferencia().trim())) {
				avisoValidacao = 24; // O Campo Referência é obrigatório.
				return;
			}
			if (usuario == null || "".equalsIgnoreCase(usuario.trim())
					|| senha == null || "".equalsIgnoreCase(senha.trim())) {
				avisoValidacao = 3; // Usuário/Conselho e/ou Senha/Assinatura
									// inválidos.
				return;
			}

			Usuario usuarioDg = new Usuario();
			String senhaEnpritpt = IsghEncodeDecode
					.encrypt(senha.toUpperCase());
			usuarioDg.setDscLogin(usuario.toUpperCase());
			usuarioDg.setDscSenha(senhaEnpritpt);
			usuarioDg = (Usuario) UsuarioImpl.getInstancia().get(
					usuarioDg,
					UsuarioImpl.JOIN_USUARIO_GRUPO
							| UsuarioImpl.JOIN_USUARIOGRUPO_GRUPO,
					Criteria.DISTINCT_ROOT_ENTITY);

			if (usuarioDg == null) {
				avisoValidacao = 3;
				return;
			}

			if (!ValidaPermissaoUsuario.getInstancia().verificaPermissao(
					usuarioDg, funcUtil.getAcaoAlta())) {
				avisoValidacao = 5;
				return;
			}
			// FIM VALIDACOES

			internacaoReferenciaBean.setIsnInternacao(paciente
					.getIsnInternacao());
			internacaoReferenciaBean.setIsnUsuario(usuarioDg.getIsnUsuario());

			InternacaoReferenciaImpl.getInstancia().inserir(
					internacaoReferenciaBean);

			atualizarListaEmergencia();

		} catch (Exception e) {
			avisoValidacao = 11; // Aconteceu um erro inesperado. contate o NTI.
			e.printStackTrace();
		}
	}

	public String relatorioTranf() {
		Connection con = null;
		try {
			// this.setIsnInternacao(internacao);

			HttpServletRequest request = (HttpServletRequest) FacesContext
					.getCurrentInstance().getExternalContext().getRequest();

			FuncUtil.apagarArquivos(request);

			String pathJasper = request
					.getRealPath("WEB-INF/classes/relatorio");
			String pathJasperImgBrasao = request.getRealPath("IMG/" + IMG_NAME);
			String pathJasperImgUpa = request.getRealPath("IMG/upa.gif");

			String os = System.getProperty("os.name");
			File pasta = new File((os.toLowerCase().indexOf("linux") > -1 ? "/"
					: "\\"));

			pathJasper += pasta;

			JasperReport jasperReport = (JasperReport) JRLoader
					.loadObject(pathJasper + "/" + this.REPORT_NAME3
							+ ".jasper");

			if (jasperReport == null) {
				FacesContext.getCurrentInstance().addMessage(
						null,
						new FacesMessage(FacesMessage.SEVERITY_WARN,
								"Nenhum relatório selecionado.", null));
			}
			Map parameters = new HashMap();
			parameters.put("p1", this.getIsnInternacao());
			parameters.put("CAMINHO_IMG_BRASAO", pathJasperImgBrasao);
			parameters.put("CAMINHO_IMG_UPA", pathJasperImgUpa);

			// PARAMETROS CONEXAO BANCO DE DADOS - INICIO
			String urlBd = "", userBd = "", senhaBd = "";

			// usuario
			Parametro parametro = new Parametro();
			parametro.setIsnParametro(ParametroImpl.USUARIO_BANCO_DADOS);
			parametro = ParametroImpl.getInstancia().get(parametro, 0);
			userBd = parametro.getVlrParametro();
			// senha
			parametro = new Parametro();
			parametro
					.setIsnParametro(ParametroImpl.SENHA_CRIPTOGRAFADA_BANCO_DADOS);
			parametro = ParametroImpl.getInstancia().get(parametro, 0);
			senhaBd = IsghEncodeDecode.decrypt(parametro.getVlrParametro());
			// url
			parametro = new Parametro();
			parametro.setIsnParametro(ParametroImpl.URL_CONEXAO_BANCO_DADOS);
			parametro = ParametroImpl.getInstancia().get(parametro, 0);
			urlBd = parametro.getVlrParametro();
			// PARAMETROS CONEXAO BANCO DE DADOS - FIM

			con = (Connection) DriverManager.getConnection(urlBd, userBd,
					senhaBd);

			JasperPrint impressao = JasperFillManager.fillReport(jasperReport,
					parameters, con);

			String pathPdf = "/temp/" + request.getRequestedSessionId()
					+ String.valueOf(Math.random() * 10000) + this.REPORT_NAME
					+ ".pdf";

			JasperExportManager.exportReportToPdfFile(impressao,
					request.getRealPath("") + pathPdf);

			HttpServletResponse response = (HttpServletResponse) FacesContext
					.getCurrentInstance().getExternalContext().getResponse();
			response.sendRedirect(request.getContextPath() + pathPdf);
			con.close();
		} catch (Exception e) {
			if (con != null) {
				try {
					con.close();
				} catch (SQLException e1) {
					e1.printStackTrace();
				}
			}
		}
		return null;
	}
	
	public List<PrescricaoPep> retornaListaPrescricoesEmAberto(Integer isnInternacao){
		List<PrescricaoPep> listPrescricaoPep = new ArrayList<PrescricaoPep>();
		try {
			PrescricaoPep prescricaoVo = new PrescricaoPep();
			prescricaoVo.setIsnInternacao(isnInternacao);
			HashMap<String, Object> filtro = new HashMap<String, Object>();
			filtro.put("datConclusaoNull", "NULL");
			filtro.put("datCancelamentoNull", "null");
			prescricaoVo.setFiltro(filtro);
	
			listPrescricaoPep = PrescricaoPepImpl.getInstancia().pesquisar(prescricaoVo, PrescricaoPepImpl.JOIN_PRESCRICAO_TIPO);
		}catch(Exception e){
			new ArrayList<PrescricaoPep>();
		}
		return listPrescricaoPep;
	}

	public void validarRelatorioGeral(){
		this.setMensagem("");
		if (this.getIsnInternacao() != null && !this.getIsnInternacao().equals(0)){
			InternacaoLeito internacaoLeito = new InternacaoLeito();
			internacaoLeito = new InternacaoLeitoFacadeImpl().buscaMaxInternacaoLeitoOcupado(this.getIsnInternacao());
			if (isPacienteNaRecepcao == false && internacaoLeito != null && internacaoLeito.getIsnInternacaoLeito() != null){
				if (retornaListaPrescricoesEmAberto(this.getIsnInternacao()).size() > 0){
					this.setMensagem("Não é permitido imprimir este relatório. Por favor conclua as prescrições pendentes.");
					return;
				}
			}
		}		
	}
	
	public String irHistorioMovPaciente() {
		codigoErro = 0;
		if (ValidaPermissaoUsuario.getInstancia().verificaPermissao("CS_GERAL", funcUtil.getAcaoPreparaPesquisar())) {
			return "csGeral_CsHistoricoMovPaciente";

		}
		codigoErro = 2;
		return null;
	}
	
	public void validaImpressao(){
		codigoErro = 0;
		if (!ValidaPermissaoUsuario.getInstancia().verificaPermissao("CS_GERAL", funcUtil.getAcaoImprimir()))
		{
			codigoErro = 2; 
		}
	}
	
	public String relatorioGeral() {
		
		Connection con = null;
		try {			
			HttpServletRequest request = (HttpServletRequest) FacesContext
					.getCurrentInstance().getExternalContext().getRequest();

			FuncUtil.apagarArquivos(request);

			String pathJasper = request
					.getRealPath("WEB-INF/classes/relatorio");
			String pathJasperImg = request.getRealPath("IMG/" + this.IMG_NAME);
			String pathJasperImg2 = request.getRealPath("IMG/" + "upa.gif");

			String os = System.getProperty("os.name");
			File pasta = new File((os.toLowerCase().indexOf("linux") > -1 ? "/"
					: "\\"));

			pathJasper += pasta;

			JasperReport jasperReport = (JasperReport) JRLoader
					.loadObject(pathJasper + "/" + this.REPORT_NAME2
							+ ".jasper");

			if (jasperReport == null) {
				FacesContext.getCurrentInstance().addMessage(
						null,
						new FacesMessage(FacesMessage.SEVERITY_WARN,
								"Nenhum relatório selecionado.", null));
			}

			Map parameters = new HashMap();

			parameters.put("CAMINHO_SUB_REPORT", pathJasper);
			parameters.put("CAMINHO_IMG", pathJasperImg);
			parameters.put("CAMINHO_IMG2", pathJasperImg2);
			parameters.put("p1", this.getIsnInternacao());

			List<ExameSolic> listaAux = new ArrayList<ExameSolic>();

			ExameSolic exameSolic = new ExameSolic();
			exameSolic.setDatCadastro(new Date());

			listaAux.add(exameSolic);

			// PARAMETROS CONEXAO BANCO DE DADOS - INICIO
			String urlBd = "", userBd = "", senhaBd = "";

			// usuário
			Parametro parametro = new Parametro();
			parametro.setIsnParametro(ParametroImpl.USUARIO_BANCO_DADOS);
			parametro = ParametroImpl.getInstancia().get(parametro, 0);
			userBd = parametro.getVlrParametro();
			// senha
			parametro = new Parametro();
			parametro
					.setIsnParametro(ParametroImpl.SENHA_CRIPTOGRAFADA_BANCO_DADOS);
			parametro = ParametroImpl.getInstancia().get(parametro, 0);
			senhaBd = IsghEncodeDecode.decrypt(parametro.getVlrParametro());
			// url
			parametro = new Parametro();
			parametro.setIsnParametro(ParametroImpl.URL_CONEXAO_BANCO_DADOS);
			parametro = ParametroImpl.getInstancia().get(parametro, 0);
			urlBd = parametro.getVlrParametro();
			// PARAMETROS CONEXAO BANCO DE DADOS - FIM

			con = (Connection) DriverManager.getConnection(urlBd, userBd,
					senhaBd);

			JasperPrint impressao = JasperFillManager.fillReport(jasperReport,
					parameters, con);

			String pathPdf = "/temp/" + request.getRequestedSessionId()
					+ String.valueOf(Math.random() * 10000) + this.REPORT_NAME2
					+ ".pdf";

			JasperExportManager.exportReportToPdfFile(impressao,
					request.getRealPath("") + pathPdf);

			HttpServletResponse response = (HttpServletResponse) FacesContext
					.getCurrentInstance().getExternalContext().getResponse();
			response.sendRedirect(request.getContextPath() + pathPdf);
			con.close();
		} catch (Exception e) {
			if (con != null) {
				try {
					con.close();
				} catch (SQLException e1) {
					e1.printStackTrace();
				}
			}
		}
		return null;
	}

	public String relatorio() {
		Connection con = null;
		try {
			HttpServletRequest request = (HttpServletRequest) FacesContext
					.getCurrentInstance().getExternalContext().getRequest();

			FuncUtil.apagarArquivos(request);

			String pathJasper = request
					.getRealPath("WEB-INF/classes/relatorio");
			String pathJasperImg = request.getRealPath("IMG/" + this.IMG_NAME);
			String pathJasperImg2 = request.getRealPath("IMG/" + "upa.gif");

			String os = System.getProperty("os.name");
			File pasta = new File((os.toLowerCase().indexOf("linux") > -1 ? "/"
					: "\\"));

			pathJasper += pasta;

			JasperReport jasperReport = (JasperReport) JRLoader
					.loadObject(pathJasper + "/" + this.REPORT_NAME + ".jasper");

			if (jasperReport == null) {
				FacesContext.getCurrentInstance().addMessage(
						null,
						new FacesMessage(FacesMessage.SEVERITY_WARN,
								"Nenhum relatório selecionado.", null));
			}

			Map parameters = new HashMap();

			parameters.put("CAMINHO_SUB_REPORT", pathJasper);
			parameters.put("CAMINHO_IMG", pathJasperImg);
			parameters.put("CAMINHO_IMG2", pathJasperImg2);
			parameters.put("p1", this.getIsnInternacao());

			List<ExameSolic> listaAux = new ArrayList<ExameSolic>();

			ExameSolic exameSolic = new ExameSolic();
			exameSolic.setDatCadastro(new Date());

			listaAux.add(exameSolic);

			// JRBeanCollectionDataSource ds = new
			// JRBeanCollectionDataSource(listaAux);

			// JasperPrint impressao =
			// JasperFillManager.fillReport(jasperReport, parameters, ds);

			// PARAMETROS CONEXAO BANCO DE DADOS - INICIO
			String urlBd = "", userBd = "", senhaBd = "";

			// usuario
			Parametro parametro = new Parametro();
			parametro.setIsnParametro(ParametroImpl.USUARIO_BANCO_DADOS);
			parametro = ParametroImpl.getInstancia().get(parametro, 0);
			userBd = parametro.getVlrParametro();
			// senha
			parametro = new Parametro();
			parametro
					.setIsnParametro(ParametroImpl.SENHA_CRIPTOGRAFADA_BANCO_DADOS);
			parametro = ParametroImpl.getInstancia().get(parametro, 0);
			senhaBd = IsghEncodeDecode.decrypt(parametro.getVlrParametro());
			// url
			parametro = new Parametro();
			parametro.setIsnParametro(ParametroImpl.URL_CONEXAO_BANCO_DADOS);
			parametro = ParametroImpl.getInstancia().get(parametro, 0);
			urlBd = parametro.getVlrParametro();
			// PARAMETROS CONEXAO BANCO DE DADOS - FIM

			con = (Connection) DriverManager.getConnection(urlBd, userBd,
					senhaBd);

			JasperPrint impressao = JasperFillManager.fillReport(jasperReport,
					parameters, con);

			String pathPdf = "/temp/" + request.getRequestedSessionId()
					+ String.valueOf(Math.random() * 10000) + this.REPORT_NAME
					+ ".pdf";

			JasperExportManager.exportReportToPdfFile(impressao,
					request.getRealPath("") + pathPdf);

			HttpServletResponse response = (HttpServletResponse) FacesContext
					.getCurrentInstance().getExternalContext().getResponse();
			response.sendRedirect(request.getContextPath() + pathPdf);
			con.close();
		} catch (Exception e) {
			if (con != null) {
				try {
					con.close();
				} catch (SQLException e1) {
					e1.printStackTrace();
				}
			}
			e.printStackTrace();
		}

		return null;
	}

	public String relatorioPrescricao() {
		Connection con = null;
		try {
			HttpServletRequest request = (HttpServletRequest) FacesContext
					.getCurrentInstance().getExternalContext().getRequest();

			String imagemRelatorio = retornaStrParametro(ParametroImpl.LOGO_UPA, false);
			String pathJasper = request
					.getRealPath("WEB-INF/classes/relatorio");
			String pathJasperImg = request.getRealPath("IMG/" + this.IMG_NAME);
			String pathJasperImg2 = request.getRealPath("images/paciente/"
					+ imagemRelatorio);

			String os = System.getProperty("os.name");
			File pasta = new File((os.toLowerCase().indexOf("linux") > -1 ? "/"
					: "\\"));

			pathJasper += pasta;

			JasperReport jasperReport = (JasperReport) JRLoader
					.loadObject(pathJasper + "/" + this.REPORT_NAME4
							+ ".jasper");

			if (jasperReport == null) {
				FacesContext.getCurrentInstance().addMessage(
						null,
						new FacesMessage(FacesMessage.SEVERITY_WARN,
								"Nenhum relatório selecionado.", null));
			}

			Map parameters = new HashMap();

			parameters.put("CAMINHO_IMG_BRASAO", pathJasperImg);
			parameters.put("CAMINHO_IMG_UPA", pathJasperImg2);
			parameters.put("p1", this.getObjPrescricaoPepRelatorio()
					.getIsnPrescricaoPep());

			List<ExameSolic> listaAux = new ArrayList<ExameSolic>();

			ExameSolic exameSolic = new ExameSolic();
			exameSolic.setDatCadastro(new Date());

			listaAux.add(exameSolic);

			// PARAMETROS CONEXAO BANCO DE DADOS - INICIO
			String urlBd = "", userBd = "", senhaBd = "";
			userBd = retornaStrParametro(ParametroImpl.USUARIO_BANCO_DADOS, false);		
			senhaBd = retornaStrParametro(ParametroImpl.SENHA_CRIPTOGRAFADA_BANCO_DADOS, true);
			urlBd = retornaStrParametro(ParametroImpl.URL_CONEXAO_BANCO_DADOS, false);
			// PARAMETROS CONEXAO BANCO DE DADOS - FIM

			con = (Connection) DriverManager.getConnection(urlBd, userBd,
					senhaBd);

			JasperPrint impressao = JasperFillManager.fillReport(jasperReport,
					parameters, con);

			String pathPdf = "/temp/" + request.getRequestedSessionId()
					+ String.valueOf(Math.random() * 10000) + this.REPORT_NAME4
					+ ".pdf";

			JasperExportManager.exportReportToPdfFile(impressao,
					request.getRealPath("") + pathPdf);

			HttpServletResponse response = (HttpServletResponse) FacesContext
					.getCurrentInstance().getExternalContext().getResponse();
			response.sendRedirect(request.getContextPath() + pathPdf);
			con.close();

		} catch (Exception e) {
			if (con != null) {
				try {
					con.close();
				} catch (SQLException e1) {
					e1.printStackTrace();
				}
			}
			e.printStackTrace();
		}

		return null;
	}

	public void laudoExame3() throws IOException {
		Connection con = null;
		try {
			// recuperar path jasper - inicio
			HttpServletRequest request = (HttpServletRequest) FacesContext
					.getCurrentInstance().getExternalContext().getRequest();
			HttpServletResponse response = (HttpServletResponse) FacesContext
					.getCurrentInstance().getExternalContext().getResponse();
			String pathJasper = request
					.getRealPath("WEB-INF/classes/relatorio");
			String os = System.getProperty("os.name");
			File pasta = new File((os.toLowerCase().indexOf("linux") > -1 ? "/"
					: "\\"));
			pathJasper += pasta;
			// recuperar path jasper - fim

			ExameSolicitacaoWsDetalheBean laudo = new ExameSolicitacaoWsDetalheBean();
			laudo.setIsnExameSolicWsDetalhe(isnExameSolicWsDetalhe);
			laudo = ExameSolicitacaoWsDetalheImpl.getInstancia().get(laudo, 0);

			Map parameters = new HashMap();
			String newString = new String(
					laudo.getDscLaudo().getBytes("UTF-8"), "UTF-8");
			newString = newString.replaceAll("\tab", "\t");
			parameters.put("p1", newString);

			// tentativa 1
			ByteArrayOutputStream baos = new ByteArrayOutputStream();
			JasperReport relatorio = (JasperReport) JRLoader
					.loadObject(pathJasper + "/" + "laudoExame.jasper");
			JRAbstractExporter saida = new JRRtfExporter();
			JasperPrint impressao = JasperFillManager.fillReport(relatorio,
					parameters, con);

			saida.setParameter(JRExporterParameter.CHARACTER_ENCODING, "UTF-8");
			saida.setParameter(JRExporterParameter.JASPER_PRINT, impressao);
			saida.setParameter(JRExporterParameter.OUTPUT_STREAM, baos);
			saida.setParameter(JRExporterParameter.OUTPUT_FILE_NAME, pathJasper
					+ "relatorio.rtf");
			saida.exportReport();

			byte[] bytes = baos.toByteArray();
			String fileName = "relatorio.rtf";
			response.setHeader("Content-Disposition", "attachment; filename=\""
					+ fileName + "\";");
			response.setContentLength(bytes.length);
			ServletOutputStream ouputStream = response.getOutputStream();
			ouputStream.write(bytes, 0, bytes.length);
			ouputStream.flush();
			ouputStream.close();
			FacesContext.getCurrentInstance().responseComplete();

		} catch (Exception e) {
			if (con != null) {
				try {
					con.close();
				} catch (SQLException e1) {
					e1.printStackTrace();
				}
			}
			e.printStackTrace();
		}
		// return "";
	}

	public String laudoListaExames() {
		Connection con = null;
		try {
			// recuperar path jasper - inicio
			HttpServletRequest request = (HttpServletRequest) FacesContext
					.getCurrentInstance().getExternalContext().getRequest();
			String pathJasper = request
					.getRealPath("WEB-INF/classes/relatorio");
			String os = System.getProperty("os.name");
			File pasta = new File((os.toLowerCase().indexOf("linux") > -1 ? "/"
					: "\\"));
			pathJasper += pasta;
			// recuperar path jasper - fim

			ExameSolicitacaoWsDetalheBean laudo = new ExameSolicitacaoWsDetalheBean();
			laudo.setIsnExameSolicWsDetalhe(isnExameSolicWsDetalhe);
			laudo = ExameSolicitacaoWsDetalheImpl.getInstancia().get(laudo, 0);

			Map parameters = new HashMap();

			parameters.put("CAMINHO_IMG",
					request.getRealPath("IMG/" + this.IMG_NAME));
			parameters.put("CAMINHO_IMG2", request.getRealPath("IMG/"
					+ "upa.gif"));

			/**
			 * No ireport o maximo de parametros esta 30, caso um dia alguem
			 * deseje selecionar mais que 30 exames para impressao basta ir no
			 * iReport e adicionar mais parametros ao relatorio, sem alterar
			 * este codigo.
			 */
			Integer qntdParametros = 0;

			for (ExameSolicitacaoPepBean exameSolicitacaoPepBean : lstExameSolicEmergencia) {
				if (exameSolicitacaoPepBean.getImprimir()) {
					qntdParametros++;
					parameters.put("parameter" + qntdParametros,
							exameSolicitacaoPepBean.getIsnExameSolic());
				}
			}

			// usuario
			Parametro parametro = new Parametro();
			parametro.setIsnParametro(ParametroImpl.USUARIO_BANCO_DADOS);
			parametro = ParametroImpl.getInstancia().get(parametro, 0);
			String userBd = parametro.getVlrParametro();
			// senha
			parametro = new Parametro();
			parametro
					.setIsnParametro(ParametroImpl.SENHA_CRIPTOGRAFADA_BANCO_DADOS);
			parametro = ParametroImpl.getInstancia().get(parametro, 0);
			String senhaBd = IsghEncodeDecode.decrypt(parametro
					.getVlrParametro());
			// url
			parametro = new Parametro();
			parametro.setIsnParametro(ParametroImpl.URL_CONEXAO_BANCO_DADOS);
			parametro = ParametroImpl.getInstancia().get(parametro, 0);
			String urlBd = parametro.getVlrParametro();
			// PARAMETROS CONEXAO BANCO DE DADOS - FIM

			con = (Connection) DriverManager.getConnection(urlBd, userBd,
					senhaBd);

			JRExporter exporter = new JRRtfExporter();
			exporter.setParameter(JRExporterParameter.CHARACTER_ENCODING,
					"UTF-8");

			JasperReport jasperReport = (JasperReport) JRLoader
					.loadObject(pathJasper + "/" + "laudoExame.jasper");

			JasperPrint impressao = JasperFillManager.fillReport(jasperReport,
					parameters, con);

			String pathPdf = "/temp/" + request.getRequestedSessionId()
					+ String.valueOf(Math.random() * 10000) + "laudoExame"
					+ ".pdf";

			JasperExportManager.exportReportToPdfFile(impressao,
					request.getRealPath("") + pathPdf);

			HttpServletResponse response = (HttpServletResponse) FacesContext
					.getCurrentInstance().getExternalContext().getResponse();
			response.sendRedirect(request.getContextPath() + pathPdf);
			con.close();

		} catch (Exception e) {
			if (con != null) {
				try {
					con.close();
				} catch (SQLException e1) {
					e1.printStackTrace();
				}
			}
			e.printStackTrace();
		}
		return "";
	}

	public String laudoExame() {
		Connection con = null;
		try {
			// recuperar path jasper - inicio
			HttpServletRequest request = (HttpServletRequest) FacesContext
					.getCurrentInstance().getExternalContext().getRequest();
			String pathJasper = request
					.getRealPath("WEB-INF/classes/relatorio");
			String os = System.getProperty("os.name");
			File pasta = new File((os.toLowerCase().indexOf("linux") > -1 ? "/"
					: "\\"));
			pathJasper += pasta;
			// recuperar path jasper - fim

			ExameSolicitacaoWsDetalheBean laudo = new ExameSolicitacaoWsDetalheBean();
			laudo.setIsnExameSolicWsDetalhe(isnExameSolicWsDetalhe);
			laudo = ExameSolicitacaoWsDetalheImpl.getInstancia().get(laudo, 0);

			Map parameters = new HashMap();
			// String newString = new
			// String(laudo.getDscLaudo().getBytes("UTF-8"), "UTF-8");
			String newString = new String(
					laudo.getDscLaudo().getBytes("UTF-8"), "UTF-8");
			// newString =
			// ComunicacaoWsEm.getInstance().replaceAcentuacao(newString);
			// newString = newString.replaceAll("\tab", "\t");
			parameters.put("p1", newString);

			// usuario
			Parametro parametro = new Parametro();
			parametro.setIsnParametro(ParametroImpl.USUARIO_BANCO_DADOS);
			parametro = ParametroImpl.getInstancia().get(parametro, 0);
			String userBd = parametro.getVlrParametro();
			// senha
			parametro = new Parametro();
			parametro
					.setIsnParametro(ParametroImpl.SENHA_CRIPTOGRAFADA_BANCO_DADOS);
			parametro = ParametroImpl.getInstancia().get(parametro, 0);
			String senhaBd = IsghEncodeDecode.decrypt(parametro
					.getVlrParametro());
			// url
			parametro = new Parametro();
			parametro.setIsnParametro(ParametroImpl.URL_CONEXAO_BANCO_DADOS);
			parametro = ParametroImpl.getInstancia().get(parametro, 0);
			String urlBd = parametro.getVlrParametro();
			// PARAMETROS CONEXAO BANCO DE DADOS - FIM

			con = (Connection) DriverManager.getConnection(urlBd, userBd,
					senhaBd);

			JRExporter exporter = new JRRtfExporter();
			exporter.setParameter(JRExporterParameter.CHARACTER_ENCODING,
					"UTF-8");

			JasperReport jasperReport = (JasperReport) JRLoader
					.loadObject(pathJasper + "/" + "laudoExame.jasper");

			JasperPrint impressao = JasperFillManager.fillReport(jasperReport,
					parameters, con);

			String pathPdf = "/temp/" + request.getRequestedSessionId()
					+ String.valueOf(Math.random() * 10000) + "laudoExame"
					+ ".pdf";

			JasperExportManager.exportReportToPdfFile(impressao,
					request.getRealPath("") + pathPdf);

			HttpServletResponse response = (HttpServletResponse) FacesContext
					.getCurrentInstance().getExternalContext().getResponse();
			response.sendRedirect(request.getContextPath() + pathPdf);
			con.close();

		} catch (Exception e) {
			if (con != null) {
				try {
					con.close();
				} catch (SQLException e1) {
					e1.printStackTrace();
				}
			}
			e.printStackTrace();
		}
		return "";
	}

	public String atendimentoPaciente() throws Exception {
		Usuario usuarioDg = new Usuario();
		String retornoVazio = "";
		try {

			if (usuario == null || "".equalsIgnoreCase(usuario.trim())) {
				avisoValidacao = 26; // O Campo Usuário/Consenho é obrigatório.
				return retornoVazio;
			}
			if (senha == null || "".equalsIgnoreCase(senha.trim())) {
				avisoValidacao = 27; // O Campo Senha/Assinatura é obrigatório.
				return retornoVazio;
			}

			String senhaEnpritpt = IsghEncodeDecode
					.encrypt(senha.toUpperCase());
			usuarioDg.setDscLogin(usuario.toUpperCase());
			usuarioDg.setDscSenha(senhaEnpritpt);
			usuarioDg = (Usuario) UsuarioImpl.getInstancia().get(
					usuarioDg,
					UsuarioImpl.JOIN_USUARIO_GRUPO
							| UsuarioImpl.JOIN_USUARIOGRUPO_GRUPO,
					Criteria.DISTINCT_ROOT_ENTITY);

			if (usuarioDg == null) {
				avisoValidacao = 3;
				return retornoVazio;
			}
			if (!ValidaPermissaoUsuario.getInstancia().verificaPermissao(
					usuarioDg, funcUtil.getAcaoAtender())) {
				avisoValidacao = 5;
				return retornoVazio;
			}

		} catch (Exception e1) {
			this.setMsgRelatorio("ERRO");
			e1.printStackTrace();
		}

		// Registrar o risco
		try {
			String strDestino = "";

			for (SelectItem item : sliDestinos) {
				if (item.getValue().equals(isnDestino)) {
					strDestino = item.getLabel();
					break;
				}
			}

			// transferencia para outro hospital - inicio

			// alta para o paciente quando alta é true e isnDestino igual a 0
			// (zero).
			if (isnDestino != null && isnDestino.intValue() > 0) {
				isnMotivoAlta = EnumMotivosAlta.SELECIONE;
				isnReferencia = 0;
			}

			if (alta && isnDestino == 0
					&& isnMotivoAlta == EnumMotivosAlta.OUTRO_HOSPITAL
					&& isnDestino.intValue() == 0) {
				isnDestino = 1;
				DestinoFacade destFacade = new DestinoFacadeImpl();
				Destino destino = destFacade.buscarDestino(3);
				if (destino != null) {
					strDestino = destino.getDscDestino();
				}
			} else if (alta && isnDestino == 0) {
				isnDestino = 1;
				for (SelectItem item : sliMotivosAlta) {
					if (item.getValue().equals(isnMotivoAlta)) {
						strDestino = item.getLabel();
						break;
					}
				}
			}
			// transferencia para outro hospital - fim

			// Avisa para o ws toLife que terminou o atendimento medico
			if (this.getUsarClassificacaoToLife()) { // se tolife estiver
														// habilitado
				if (!new ConsumoToLifeWS().finalAtendimento(paciente
						.getIsnInternacao())) {
					avisoValidacao = 34;
					return "";
				}
			}

			List<ExameSolicitacaoPepBean> listaExameSolic = getLstExameSolicEmergencia();
			List<PrescricaoUpaBean> listaPrescricao = getLstPrescricao();

			if (objIa.getCid10() == null || objIa.getIsnCid10() == null) {
				avisoValidacao = 32;
				return retornoVazio;
			}

			objIa.setHipotesesDiagnostico(objIa.getCid10().getCodCid10());
			objIa.setDscHipDiagOdonto(objIa.getCid10().getCodCid10());

			objIa.setDscHoraIni(horInicialAtendimento);
			objIa.setDatIni(datInicialAtendimento);

			if (cr == null || cr.getIsnInternacaoRisco() == null
					|| cr.getIsnInternacaoRisco().intValue() <= 0) {
				ClassificacaoRiscoFacade crf = new ClassificacaoRiscoFacadeImpl();
				cr = crf.maximoClassificacaoRisco(paciente.getIsnInternacao());
			}
			
			//Acidente
			if (objIa.getIsnInternacaoAtendimento() == null && objIa.getFlgAcidente().equals("S")) {
				InternacaoAtendimentoCausaFacade causaFacade = new InternacaoAtendimentoCausaFacadeImpl();
				InternacaoAtendimentoCausa atendimentoCausaSelecionado = causaFacade.buscaInternacaoAtendimentoCausaPorId(internacaoAtendimentoCausaAcPai.getIsnInternacaoAtendimentoCausa());
				
				if (atendimentoCausaSelecionado.getIsnPai() != null && atendimentoCausaSelecionado.getIsnPai() == 0
						&& atendimentoCausaSelecionado.getIsnInternacaoAtendimentoCausa() != 2) {
					objIa.setIsnInternacaoAtendimentoCausaAcidente(internacaoAtendimentoCausaAcFilho.getIsnInternacaoAtendimentoCausa());
				} else if (atendimentoCausaSelecionado.getIsnPai() == null || atendimentoCausaSelecionado.getIsnInternacaoAtendimentoCausa() == 2) {
					objIa.setIsnInternacaoAtendimentoCausaAcidente(internacaoAtendimentoCausaAcPai.getIsnInternacaoAtendimentoCausa());
				}
				
				if (isnTipoAcidenteVeiculo != null && isnTipoAcidenteVeiculo > 0) {
					objIac.setIsnTipoVeiculo(isnTipoAcidenteVeiculo);
				} else {
					objIac.setIsnTipoVeiculo(null);
				}
				
				if (isnPosicaoAcidente != null && isnPosicaoAcidente > 0) {
					objIac.setIsnPosicao(isnPosicaoAcidente);
				} else {
					objIac.setIsnPosicao(null);
				}
				
				objIac.setIsnInternacao(paciente.getIsnInternacao());
				objIac.setIsnUsuario(usuarioDg.getIsnUsuario());
				objIac.setDatCadastro(new Date());
				
				if(objsRegiaoAfetada != null && objsRegiaoAfetada.length > 0) {
					List<RegiaoAfetada> regioesSelecionadas = new ArrayList<RegiaoAfetada>();
					for(RegiaoAfetada ra : listaRegiaoAfetada) {
						for(int i=0; i<objsRegiaoAfetada.length; i++) {
							if(ra.getIsnRegiaoAfetada().equals(new Integer(objsRegiaoAfetada[i]))) {
								regioesSelecionadas.add(ra);
							}
						}
					}
					objIac.setListaRegiaoAfetada(regioesSelecionadas);
				}
			}
			
			//Agressao
			if (objIa.getFlgAgressao().equals("S")) {
				objIa.setIsnInternacaoAtendimentoCausaAgressao(internacaoAtendimentoCausaAg.getIsnInternacaoAtendimentoCausa());
			}

			EnumAtendimentoMedico retorno = new InternacaoFacadeImpl()
					.atendimentoEmergencia(paciente.getIsnInternacao(),
							isnMotivoAlta.ordinal(), isnReferencia, isnDestino,
							strDestino, usuarioDg, objIa, paciente, cr, objIac,
							listaExameSolic, listaPrescricao);

			if (retorno == EnumAtendimentoMedico.JA_ATENDIDO) {
				avisoValidacao = 29;
				return retornoVazio;
			} else if (retorno == EnumAtendimentoMedico.ERRO_INESPERADO) {
				avisoValidacao = 11;
				return retornoVazio;
			}

			atualizarListaEmergencia();

			// Início - Atualizar Flg_Risco para alterar a cor do Risco para
			// preto
			InternacaoFacade i = new InternacaoFacadeImpl();
			i.atendimentoLivre(paciente.getIsnInternacao());
			// Fim - Atualizar Flg_Risco para alterar a cor do Risco para preto

			// limpar as variaveis;
			isnReferencia = 0;
			textoAtendimento = "";
			usuario = "";
			senha = "";
			avisoValidacao = 18;

			if (alta && isnDestino.intValue() > 0
					&& isnMotivoAlta == EnumMotivosAlta.OUTRO_HOSPITAL) {
				isnMotivoAlta = EnumMotivosAlta.SELECIONE;
				InternacaoTransForm transForm = new InternacaoTransForm();
				return transForm.atentidmentoToTransferencia(paciente
						.getIsnInternacao());
			}

			if (!isnDestino.equals(1)){
				List<PrescricaoPep> listPrescricaoPep = retornaListaPrescricoesEmAberto(pacienteOtimizado.getIsnInternacao());

				for (PrescricaoPep prescricaoPep : listPrescricaoPep) {
					List<PrescricaoPepItem> lstPrescricaoPepiItem = new ArrayList<PrescricaoPepItem>();
					lstPrescricaoPepiItem = retornaListaPrescricaoPepItem(prescricaoPep.getIsnPrescricaoPep());
					
					Integer isnItemPossuiDietaZero = null;
					//boolean possuiOutraDieta = false;
					for (PrescricaoPepItem ppi : lstPrescricaoPepiItem) {
						addTabelaContadorAntibiotico(prescricaoPep.getIsnPrescricaoTipo(), ppi, pacienteOtimizado.getIsnInternacaoLeito(), 
								pacienteOtimizado.getIsnInternacao(), lstPrescricaoPepiItem);

						if (ppi.getIsnDieta() != null && ppi.getIsnDieta() == 4 && ppi.getIsnPrescricaoPepIs() == null &&
								ppi.getIsnPrescricaoPepItemDietaZero() == null) {
							isnItemPossuiDietaZero = ppi.getIsnPrescricaoPepItem();
							PrescricaoPepItemDietaZero dietaZero = new PrescricaoPepItemDietaZero();
							dietaZero.setDatInicial(new Date());
							dietaZero.setDatFinal(null);
							dietaZero = PrescricaoPepItemDietaZeroImpl.getInstancia().inserir(dietaZero);
							ppi.setIsnPrescricaoPepItemDietaZero(dietaZero.getIsnPrescricaoPepItemDietaZero());
							break;
						}
					}
	
					Session sessao = HibernateUtil.getSession();
					sessao.setFlushMode(FlushMode.COMMIT);
					Transaction tx = sessao.beginTransaction();
					try
					{	
						
						if (isnItemPossuiDietaZero != null) {
							for (PrescricaoPepItem ppi : lstPrescricaoPepiItem) {
								if (ppi.getIsnPrescricaoPepItem().equals(isnItemPossuiDietaZero)){
									PrescricaoPepItemImpl.getInstancia().alterar(sessao, ppi);
								}
							}
						}
						
						//CONCLUIR PRESCRICAO
						prescricaoPep.setDatConclusao(new Date());
						if (usuarioDg.getIsnConselho() == null || usuarioDg.getIsnConselho().equals(9)){
							prescricaoPep.setIsnProfissionalConcl(prescricaoPep.getIsnProfissional());
							prescricaoPep.setNumConselho("6");
						}
						else{
							prescricaoPep.setIsnProfissionalConcl(usuarioDg.getIsnUsuario());
							prescricaoPep.setNumConselho(usuarioDg.getNumConselho());
						}
						PrescricaoPepImpl.getInstancia().alterar(sessao, prescricaoPep);
						
						PrescricaoJason prescricaoJason = new PrescricaoJason();
						prescricaoPep.setListPrescricaoPepItem(lstPrescricaoPepiItem);
						String json = prescricaoJason.popularVOsQueSeraoUtilizadasNoWebServiceJson(prescricaoPep, pacienteOtimizado, "",permissaoOdonto);
						
						//INSERIR PRESCRICAO TEMP
						prescricaoPep.setListPrescricaoPepItem(lstPrescricaoPepiItem);
						PrescricaoPepTemp prescricaoPepTemp = new PrescricaoPepTemp();
						prescricaoPepTemp.setIsn_prescricao_pep(prescricaoPep.getIsnPrescricaoPep());
						prescricaoPepTemp.setDatCadastro(new Date());
						prescricaoPepTemp.setFlgTipoTransacao("I");
						prescricaoPepTemp.setJson(json);
						prescricaoPepTemp.setTentativas(0);
						prescricaoPepTemp.setIsnPaciente(pacienteOtimizado.getIsnPaciente());
						PrescricaoPepTempImpl.getInstancia().inserir(sessao, prescricaoPepTemp);
							
						tx.commit();
					}
					catch (Exception e)
					{
						e.printStackTrace();
						tx.rollback();
						throw e;
					}
					finally
					{
						sessao.close();
					}				
				}
			}
			
			isnDestino = 0;
			isnMotivoAlta = EnumMotivosAlta.SELECIONE;
			this.setMsgRelatorio("OK");
			return retornoVazio;
			// return "cd_atendimentoMedicoTocs_emergencia";
		} catch (RuntimeException e) {
			avisoValidacao = 11;
			this.setMsgRelatorio("ERRO");
			return retornoVazio;
		}
	}
	
	public void addTabelaContadorAntibiotico(Integer isnPrescricaoTipo, PrescricaoPepItem ppi, Integer isnInternacaoLeito, Integer isnInternacao, List<PrescricaoPepItem> lstPrescricaoPepiItem) throws Exception{
		if (ppi.getIsnTipoPrescricao().equals(20)){
			if (ppi.getIsnPrescricaoPepIs() != null){
				if (isnPrescricaoTipo.equals(8)){
					if (!existeItemAntibioticoNaPrescricaoAtual(ppi.getIsnPrescricaoPepItem(), ppi.getIsnProdutoAlmox(), lstPrescricaoPepiItem)){
						inativarItemContadorAntibiotico(ppi.getIsnProdutoAlmox(), isnInternacao);
					}					
				}else{
					if (!existeItemAntibioticoNasPrescricoes(ppi.getIsnPrescricaoPepItem(), ppi.getIsnProdutoAlmox())){
						inativarItemContadorAntibiotico(ppi.getIsnProdutoAlmox(), isnInternacao);
					}	
				}
			}else if (!verificarSeExisteAntibioticoValidoNaTabela(ppi.getIsnProdutoAlmox(), isnInternacao)){
				cadastrarItemContadorAntibiotico(ppi.getIsnProdutoAlmox(), isnInternacao, isnInternacaoLeito);
			}
		}
	}
	
	public void cadastrarItemContadorAntibiotico(Integer isnProduto, Integer isnInternacao, Integer isnInternacaoLeito) throws Exception{
		PrescricaoPepItemContadorAntib antibVenc = new PrescricaoPepItemContadorAntib();
		antibVenc.setDatInicial(new Date());
		antibVenc.setDatFinal(null);
		antibVenc.setFlgAlta(null);
		antibVenc.setIsnProduto(isnProduto);
		antibVenc.setIsnInternacaoLeito(isnInternacaoLeito);
		antibVenc.setIsnInternacao(isnInternacao);
		antibVenc = PrescricaoPepItemContadorAntibImpl.getInstancia().inserir(antibVenc);	
	}
	
	public boolean verificarSeExisteAntibioticoValidoNaTabela(Integer isnProduto, Integer isnInternacao) throws Exception{
		PrescricaoPepItemContadorAntib antibVenc = new PrescricaoPepItemContadorAntib();
		antibVenc.setIsnProduto(isnProduto);
		antibVenc.setIsnInternacao(isnInternacao);
		List<PrescricaoPepItemContadorAntib> listTemp = PrescricaoPepItemContadorAntibImpl.getInstancia().pesquisar(antibVenc, 0);
		if (listTemp == null || listTemp.size() <= 0){
			return false;
		}
		
		for (PrescricaoPepItemContadorAntib item : listTemp) {
			if (item.getDatFinal() == null){
				return true;
			}
			if ((item.getFlgAlta() != null && item.getFlgAlta().equals("S")) || (FuncUtil.diferencaDeDatasEmDias(item.getDatFinal(), new Date()) > 0)){
				continue;
			}else{
				return true;
			}
		}
		
		return false;
	}
	
	public boolean existeItemAntibioticoNasPrescricoes(Integer isnPrescricaoPepItem, Integer isnProduto) throws Exception{

    	Integer UltimaPrescricaoCompletaOuAdmissao = PrescricaoPepImpl.getInstancia().isnUltimaPrescricaoCompletaComAdmissao(pacienteOtimizado.getIsnInternacao());
		PrescricaoPepItem pepItem = new PrescricaoPepItem();
		pepItem.setFlgAtivo("S");
		HashMap<String, Object> filtro = new HashMap<String, Object>();
		filtro.put("isnInternacaoAux", pacienteOtimizado.getIsnInternacao());
		filtro.put("isnPrescricaoPepIs", "isnPrescricaoPepIs");
		filtro.put("isnPrescricaoPepInicial", UltimaPrescricaoCompletaOuAdmissao);
		filtro.put("datConclusaoNotNull", "null");
		pepItem.setFiltro(filtro);
		
		List<PrescricaoPepItem> lstPrescricaoPepiItemTemp = PrescricaoPepItemImpl.getInstancia().pesquisar(pepItem, 
																							PrescricaoPepItemImpl.JOIN_PRESCRICAO_PEP
																							| PrescricaoPepItemImpl.JOIN_INTERNACAO
																							| PrescricaoPepItemImpl.JOIN_TIPO_PRESCRICAO
																							| PrescricaoPepItemImpl.JOIN_PRESCRICAO_PEP_IS
																							| PrescricaoPepItemImpl.JOIN_PRODUTO
																							| PrescricaoPepItemImpl.JOIN_DIETA_ZERO
																							, Criteria.DISTINCT_ROOT_ENTITY);
		
		for (PrescricaoPepItem prescricaoPepItem : lstPrescricaoPepiItemTemp) {
			if (!prescricaoPepItem.getIsnPrescricaoPepItem().equals(isnPrescricaoPepItem) && prescricaoPepItem.getIsnProdutoAlmox().equals(isnProduto)){
				return true;
			}
		}
		
		return false;
	}
	
	public void inativarItemContadorAntibiotico(Integer isnProduto, Integer isnInternacao) throws Exception{
		PrescricaoPepItemContadorAntib antibVenc = new PrescricaoPepItemContadorAntib();
		antibVenc.setIsnProduto(isnProduto);
		antibVenc.setIsnInternacao(isnInternacao);						
		antibVenc.setFiltro(new HashMap<String, Object>());
		antibVenc.getFiltro().put("datFinalIsNull", "datFinalIsNull");
		List<PrescricaoPepItemContadorAntib> listTemp = PrescricaoPepItemContadorAntibImpl.getInstancia().pesquisar(antibVenc, 0);
		for (PrescricaoPepItemContadorAntib prescricaoPepItemAntibVenc : listTemp) {
			prescricaoPepItemAntibVenc.setDatFinal(new Date());
			PrescricaoPepItemContadorAntibImpl.getInstancia().alterar(prescricaoPepItemAntibVenc);
		}		
	}
	
	public boolean existeItemAntibioticoNaPrescricaoAtual(Integer isnPrescricaoPepItem, Integer isnProduto, List<PrescricaoPepItem> lstPrescricaoPepiItem){
		List<PrescricaoPepItem> lstPrescricaoPepiItemTemp = new ArrayList<PrescricaoPepItem>();
		lstPrescricaoPepiItemTemp.addAll(lstPrescricaoPepiItem);
		for (PrescricaoPepItem prescricaoPepItem : lstPrescricaoPepiItemTemp) {
			if (!prescricaoPepItem.getIsnPrescricaoPepItem().equals(isnPrescricaoPepItem) && prescricaoPepItem.getIsnProdutoAlmox().equals(isnProduto) &&
					prescricaoPepItem.getIsnPrescricaoPepIs() == null){
				return true;
			}
		}
		
		return false;
	}
	
	public List<PrescricaoPepItem> retornaListaPrescricaoPepItem(Integer isnPrescricaoPep){
		PrescricaoPepItem pepItem = new PrescricaoPepItem();
		pepItem.setIsnPrescricaoPep(isnPrescricaoPep);
		pepItem.setFlgAtivo("S");
		List<PrescricaoPepItem> list = new ArrayList<PrescricaoPepItem>();
		try {
			list = PrescricaoPepItemImpl.getInstancia().pesquisar(pepItem, PrescricaoPepItemImpl.JOIN_PRESCRICAO_PEP
																								| PrescricaoPepItemImpl.JOIN_INTERNACAO
																								| PrescricaoPepItemImpl.JOIN_PRESCRICAO_PEP_IS
																								| PrescricaoPepItemImpl.JOIN_PRODUTO
																								| PrescricaoPepItemImpl.JOIN_TIPO_PRESCRICAO
																								| PrescricaoPepItemImpl.JOIN_PROCEDIMENTO
																								,Criteria.DISTINCT_ROOT_ENTITY);
		} catch (Exception e) {
			return new ArrayList<PrescricaoPepItem>();
		}
		return list;
	}
	
	public void atendimentoPacienteCama() throws Exception {
		Usuario usuarioDg = new Usuario();

		try {
			String senhaEnpritpt = IsghEncodeDecode
					.encrypt(senha.toUpperCase());
			usuarioDg.setDscLogin(usuario.toUpperCase());
			usuarioDg.setDscSenha(senhaEnpritpt);
			usuarioDg = (Usuario) UsuarioImpl.getInstancia().get(
					usuarioDg,
					UsuarioImpl.JOIN_USUARIO_GRUPO
							| UsuarioImpl.JOIN_USUARIOGRUPO_GRUPO,
					Criteria.DISTINCT_ROOT_ENTITY);

			if (usuarioDg == null) {
				avisoValidacao = 3;
				return;
			} else {
				if ((usuarioDg.getIsnConselho() == null || usuarioDg
						.getIsnConselho().intValue() <= 0)
						|| usuarioDg.getIsnConselho().intValue() != 6) {
					avisoValidacao = 3;
					return;
				}
			}
			if (!ValidaPermissaoUsuario.getInstancia().verificaPermissao(
					usuarioDg, funcUtil.getAcaoAtender())) {
				avisoValidacao = 5;
				return;
			}

		} catch (Exception e1) {
			this.setMsgRelatorio("ERRO");
			e1.printStackTrace();
		}

		// Registrar o risco
		try {

			List<ExameSolicitacaoPepBean> listaExameSolic = getLstExameSolicEmergencia();
			List<PrescricaoUpaBean> listaPrescricao = getLstPrescricao();

			PrescricaoUpaImpl.getInstancia().atualizarOrdem(listaPrescricao,
					isnInternacao);

			ExameSolicFacade facade = new ExameSolicFacadeImpl();
			facade.atualizarOrgem(listaExameSolic, isnInternacao);

			// Início - Atualizar Flg_Risco para alterar a cor do Risco para
			// preto
			// InternacaoFacade i = new InternacaoFacadeImpl();
			// i.atendimentoLivre(paciente.getIsnInternacao());
			// Fim - Atualizar Flg_Risco para alterar a cor do Risco para preto

			// limpar as variaveis;
			isnReferencia = 0;
			isnDestino = 0;
			isnMotivoAlta = EnumMotivosAlta.SELECIONE;
			textoAtendimento = "";
			usuario = "";
			senha = "";
			avisoValidacao = 18;

			this.setMsgRelatorio("CAMA");

			// return "cd_atendimentoMedicoTocs_emergencia";
		} catch (RuntimeException e) {
			avisoValidacao = 11;
			this.setMsgRelatorio("ERRO");
			return;
		}
	}

	public void baixarPaciente() {
		avisoValidacao = 0;

		if (textoAtendimento == "") {
			avisoValidacao = 7;
			return;
		}

		Usuario usuarioDgt = new Usuario();
		try {

			if (usuario == null || usuario.trim().equalsIgnoreCase("")) {
				avisoValidacao = 3;
				return;
			}

			if (senha == null || senha.trim().equalsIgnoreCase("")) {
				avisoValidacao = 3;
				return;
			}

			String senhaCript = IsghEncodeDecode.encrypt(senha.toUpperCase());
			usuarioDgt.setDscLogin(usuario.toUpperCase());
			usuarioDgt.setDscSenha(senhaCript);
			// usuProf = UsuarioImpl.getInstancia().get(usuarioDgt, 0);
			usuarioDgt = (Usuario) UsuarioImpl.getInstancia().get(usuarioDgt, UsuarioImpl.JOIN_USUARIO_GRUPO | UsuarioImpl.JOIN_USUARIOGRUPO_GRUPO);

			if (usuarioDgt == null) {
				avisoValidacao = 3;
				return;
			}

			if (!ValidaPermissaoUsuario.getInstancia().verificaPermissao(usuarioDgt, funcUtil.getAcaoBaixar())) {
				avisoValidacao = 5;
				return;
			}

			// Avisa para o ws toLife que a baixa/evassao foi realizada
			if (this.getUsarClassificacaoToLife()) { // se tolife estiver
														// habilitado
				if (!new ConsumoToLifeWS().registrarEvasaoPaciente(paciente.getIsnInternacao())) {
					avisoValidacao = 25; // erro no emerges
					return;
				}
			}

			InternacaoLeitoFacadeImpl ilf = new InternacaoLeitoFacadeImpl();

			InternacaoLeito il = new InternacaoLeito();
			il.setIsnMotivoAlta(6);
			il.setLeito(new Leito());
			il.getLeito().setIsnInternacao(paciente.getIsnInternacao());
			il.getLeito().setIsnLeito(paciente.getIsnLeito());

			il.setDscObsAlta(textoAtendimento);

			ilf.altaLeito(il, 1, usuarioDgt);

			InternacaoChamadaPepBean chamada = new InternacaoChamadaPepBean();
			chamada.setIsnInternacao(paciente.getIsnInternacao());
			InternacaoChamadaImpl.getInstancia().atualizarInternacoesAberta(chamada);

			atualizarListaEmergencia();

		} catch (Exception e) {
			e.printStackTrace();
		}

	}

	public void fechaPanel() {
		try {
			ClassificacaoRiscoFacade crf = new ClassificacaoRiscoFacadeImpl();
			cr = crf.maximoClassificacaoRisco(paciente.getIsnInternacao());

			// if(cr != null){
			// Início - Atualizar Flg_Risco para alterar a cor do Risco para
			// preto
			InternacaoFacade i = new InternacaoFacadeImpl();
			i.riscoLivre(paciente.getIsnInternacao());
			// Fim - Atualizar Flg_Risco para alterar a cor do Risco para preto
			// }
			this.atualizarListaEmergencia();
		} catch (Exception e) {
			e.printStackTrace();
		}
	}

	public void exame() throws Exception {
		Parametro parametro = new Parametro();
		parametro.setIsnParametro(ParametroImpl.CODIGO_ENDERECO_URL_MODAL);

		parametro = ParametroImpl.getInstancia().get(parametro, 0);

		if (parametro != null) {
			InternacaoFacade objPFacade = new InternacaoFacadeImpl();
			Internacao obji = new Internacao();
			obji = objPFacade.buscarInternacao(paciente.getIsnInternacao());
			this.setUrl("http://"
					+ parametro.getVlrParametro()
					+ "/pep/exameSolicitacoesForm.jsf?codigoAcesso=1&isnClinica="
					+ paciente.getIsnClinica() + "&isnPaciente="
					+ obji.getPaciente().getIsnPaciente() + "");
		}

		/*
		 * PacienteFacade ibjPacienteFacade = new PacienteFacadeImpl(); Paciente
		 * objPacinete = new Paciente(); objPacinete =
		 * ibjPacienteFacade.buscaPaciente(obji.getPaciente().getIsnPaciente());
		 */

		// FacesContext.getCurrentInstance().getExternalContext().redirect("http://192.168.253.29:8080/pep/exameSolicitacoesForm.jsf?codigoAcesso=1&isnClinica="+
		// paciente.getIsnClinica()+"&isnPaciente=" +
		// obji.getPaciente().getIsnPaciente());
	}

	public void prescricao() {
		try {
			Parametro parametro = new Parametro();
			parametro.setIsnParametro(ParametroImpl.CODIGO_ENDERECO_URL_MODAL);

			parametro = ParametroImpl.getInstancia().get(parametro, 0);

			if (parametro != null) {
				InternacaoFacade objPFacade = new InternacaoFacadeImpl();
				Internacao obji = new Internacao();
				obji = objPFacade.buscarInternacao(paciente.getIsnInternacao());
				this.setUrl("http://"
						+ parametro.getVlrParametro()
						+ "/pep/prescricaoForm.jsf?codigoAcesso=1&isnInternacao="
						+ obji.getIsnInternacao());
			}

			/*
			 * PacienteFacade ibjPacienteFacade = new PacienteFacadeImpl();
			 * Paciente objPacinete = new Paciente(); objPacinete =
			 * ibjPacienteFacade
			 * .buscaPaciente(obji.getPaciente().getIsnPaciente());
			 */

			// FacesContext.getCurrentInstance().getExternalContext().redirect("http://192.168.253.29:8080/pep/exameSolicitacoesForm.jsf?codigoAcesso=1&isnClinica="+
			// paciente.getIsnClinica()+"&isnPaciente=" +
			// obji.getPaciente().getIsnPaciente());
			// FacesContext.getCurrentInstance().getExternalContext().redirect("http://localhost:8080/pep/prescricaoForm.jsf?codigoAcesso=1&isnInternacao="
			// + obji.getIsnInternacao());
		} catch (Exception e) {
			e.printStackTrace();
		}

	}

	public void panelAutenticaPrescricao() {
		avisoValidacao = 30;
	}

	public void panelAutentica() {

		try {
			avisoValidacao = 0;
			if (origemTelaRecpcao) {
				if(validaSeInternacaoLeitoEstaAtiva()){
					avisoValidacao = 35;
					return;
				}
				if (objIa.getDscAtendimento() != null
						&& objIa.getDscAtendimento().equals("")
						&& jsfUtil.getUsuarioLogado().getIsnConselho()
								.intValue() != 9) {
					avisoValidacao = 31;
					return;
				} else if (objIa.getDscHdaOdonto() != null
						&& objIa.getDscHdaOdonto().trim().equals("")
						&& jsfUtil.getUsuarioLogado().getIsnConselho()
								.intValue() == 9) {
					avisoValidacao = 31;
					return;
				} else if (!alta && isnDestino == 0) {
					avisoValidacao = 10;
					return;
				} else if (alta && isnMotivoAlta == EnumMotivosAlta.SELECIONE) {
					avisoValidacao = 8;
					return;
				} else if (isnDestino == 0
						&& isnMotivoAlta == EnumMotivosAlta.OUTRO_HOSPITAL
						&& isnReferencia == 0) {
					avisoValidacao = 9;
					return;
				} else if (objIa.getIsnInternacaoAtendimento() != null && objIa.getIsnInternacaoAtendimento().intValue() > 0 && isnDestino == 13) {
					avisoValidacao = 39; //Paciente ja atendido, portanto o mesmo nao pode voltar para a recepcao
					return;
				} else if (objIa.getFlgAcidente().equals("")) {
					avisoValidacao = 14;
					return;
				} else if (objIa.getFlgAcidente().equals("S") && (internacaoAtendimentoCausaAcPai == null || internacaoAtendimentoCausaAcPai.getIsnInternacaoAtendimentoCausa() == null || internacaoAtendimentoCausaAcPai.getIsnInternacaoAtendimentoCausa() == 0)) {
					avisoValidacao = 36; //atendimento causa acidente pai obrigatorio
					return;
				} else if (objIa.getFlgAcidente().equals("S") && internacaoAtendimentoCausaAcPai != null && internacaoAtendimentoCausaAcPai.getIsnInternacaoAtendimentoCausa() != null && internacaoAtendimentoCausaAcPai.getIsnInternacaoAtendimentoCausa() != 0 && internacaoAtendimentoCausaAcPai.getIsnInternacaoAtendimentoCausa() != 2 && internacaoAtendimentoCausaAcPai.getIsnPai() != null && (internacaoAtendimentoCausaAcFilho == null || internacaoAtendimentoCausaAcFilho.getIsnInternacaoAtendimentoCausa() == null || internacaoAtendimentoCausaAcFilho.getIsnInternacaoAtendimentoCausa() == 0)) {
					avisoValidacao = 37; //atendimento causa acidente filho obrigatorio
					return;
				} else if (objIa.getFlgAgressao().equals("")) {
					avisoValidacao = 15;
					return;
				} else if (objIa.getFlgAgressao().equals("S") && (internacaoAtendimentoCausaAg == null || internacaoAtendimentoCausaAg.getIsnInternacaoAtendimentoCausa() == null || internacaoAtendimentoCausaAg.getIsnInternacaoAtendimentoCausa() == 0)) {
					avisoValidacao = 38; //atendimento causa agressao obrigatorio
					return;
				} else if (objIa.getIsnCid10() == null
						|| objIa.getIsnCid10().intValue() <= 0) {
					avisoValidacao = 32; // campo hipotese diagnostico (cid10) É
											// obrigatório
					return;
				} else if (isnDestino == 0 && alta) {
					avisoValidacao = 28; // perguntar se realmente quer dar alta
											// para o paciente
					return;
				} else if (objIac != null && objIac.getDatAcidente() != null && objIac.getDatAcidente().after(new Date())) {
					avisoValidacao = 40;
					return;
				} else {
					avisoValidacao = 21;
					return;
				}
			} else {
				avisoValidacao = 21;
				return;
			}
		} catch (Exception e) {
			e.printStackTrace();
			avisoValidacao = 23;
		}

	}

	private boolean validaSeInternacaoLeitoEstaAtiva() {
		InternacaoLeitoFacadeImpl l = new InternacaoLeitoFacadeImpl();
		InternacaoLeito internacaoLeito = l.buscarInternacaoLeito(pacienteOtimizado.getIsnInternacao());
		if(internacaoLeito.getDatAlta() != null){
			return true;
		}
		return false;
	}

	public boolean validaCr() {
		boolean retorno = false;
		ClassificacaoRiscoFacade crF = new ClassificacaoRiscoFacadeImpl();
		List<ClassificacaoRisco> clRiscoBD = crF.buscaClassificacaoRisco(cr
				.getIsnInternacao());

		if (clRiscoBD.get(0).getIsnInternacaoRisco().intValue() == cr
				.getIsnInternacaoRisco().intValue()) {
			retorno = true;
		}

		return retorno;
	}

	public boolean validaIa() {
		boolean retorno = false;
		InternacaoAtendimentoFacade iaF = new InternacaoAtendimentoFacadeImpl();
		InternacaoAtendimento iaBd = new InternacaoAtendimento();
		iaBd = iaF.buscaInternacaoAtendimento(objIa
				.getIsnInternacaoAtendimento());

		if (iaBd.getIsnInternacaoAtendimento().intValue() == objIa
				.getIsnInternacaoAtendimento().intValue()) {
			retorno = true;
		}

		return retorno;

	}

	public void limparCampoModal() throws Exception {
		// Início - Verificando se o paciente está em atendimento ou se está
		// sendo clssificado por outro profissional
		int join = InternacaoImpl.JOIN_PROFISSIONAL_ATENDIMENTO;
		
		if(!validarSeAtendimentoNaofoiCriado()){
			avisoValidacao = 31;
			return;
		}

		//MNT-7546 
		PacienteFacade facade = new PacienteFacadeImpl();
		paciente = new PacienteEmergencia();
		try {
			paciente = facade.getPacienteEmergencia(pacienteOtimizado
					.getIsnInternacao());
		} catch (Exception e) {
			e.printStackTrace();
			avisoValidacao = 32;
			return;
		}
		
		if (pacienteOtimizado != null
				&& (pacienteOtimizado.getIsnRisco() == null || pacienteOtimizado.getIsnRisco()
						.intValue() < 1)) {
			pacienteOtimizado.setIsnRisco(0);
		}
		

		InternacaoPepBean internacao = new InternacaoPepBean();
		internacao.setIsnInternacao(pacienteOtimizado.getIsnInternacao());

		internacao = InternacaoImpl.getInstancia().get(internacao, join);

		if (internacao != null) {
			if ((internacao.getFlgAtendendo() != null 
					&& !"".equalsIgnoreCase(internacao.getFlgAtendendo()) && "S"
						.equalsIgnoreCase(internacao.getFlgAtendendo()))
					|| (internacao.getFlgRisco() != null
							&& !"".equalsIgnoreCase(internacao.getFlgRisco()) && "S"
								.equalsIgnoreCase(internacao.getFlgRisco()))) {

				if (internacao.getProfissionalAtendimento() != null) {
					nomeProfissionalAtendimento = internacao
							.getProfissionalAtendimento().getDscUsuario();
				}
				
			}

			if (internacao.getFlgAtendendo() != null
					&& !"".equalsIgnoreCase(internacao.getFlgAtendendo())
					&& "S".equalsIgnoreCase(internacao.getFlgAtendendo())) {
				avisoValidacao = 24; // Não pode classificar, pois o paciente
										// está em atendimento
				return;
			} else if (internacao.getFlgRisco() != null
					&& !"".equalsIgnoreCase(internacao.getFlgRisco())
					&& "S".equalsIgnoreCase(internacao.getFlgRisco())
					&& internacao.getProfissionalAtendimento() != null
					&& internacao.getProfissionalAtendimento().getIsnUsuario() != null
					&& internacao.getProfissionalAtendimento().getIsnUsuario()
							.intValue() > 0
					&& jsfUtil.getUsuarioLogado() != null
					&& jsfUtil.getUsuarioLogado().getIsnUsuario() != null
					&& jsfUtil.getUsuarioLogado().getIsnUsuario().intValue() > 0
					&& jsfUtil.getUsuarioLogado().getIsnUsuario().intValue() != internacao
							.getProfissionalAtendimento().getIsnUsuario()
							.intValue()) {
				avisoValidacao = 26; // Não pode classificar, pois o paciente
										// está sendo classificado por outro
										// profissional
				return;
			}
		}
		// Fim - Verificando se o paciente está em atendimento ou se está sendo
		// clssificado por outro profissional
		usuario = "";
		senha = "";
		cr = new ClassificacaoRisco();
		objCid10 = new Cid10();
		isnEspecialidadeEmergencia = 0;
		isnRisco = 0;
		isnFluxograma = 0;
		hipotesesDiagnostico = "";
		comorbidade = "";
		
		

		setHorInicialRisco(FuncUtil.obterHoraAtual());
		setDatInicialRisco(new Date());

		ClassificacaoRiscoFacade crf = new ClassificacaoRiscoFacadeImpl();
		cr = crf.maximoClassificacaoRisco(pacienteOtimizado.getIsnInternacao());

		objPaciente = new PacienteFacadeImpl().buscaPaciente(pacienteOtimizado
				.getIsnPaciente());

		mostraPanelAtendimento = true;

		// INÍCIO - BAIXA NA CHAMADA
		InternacaoChamadaPepBean internacaoChamada = new InternacaoChamadaPepBean();
		internacaoChamada
				.setIsnInternacao(pacienteOtimizado.getIsnInternacao());

		InternacaoChamadaImpl.getInstancia().atualizarInternacoesAberta(
				internacaoChamada);
		// FIM - BAIXA NA CHAMADA

		// Início - Atualizar Flg_Risco para alterar a cor do Risco para
		// vermelho
		InternacaoFacade i = new InternacaoFacadeImpl();
		i.emRisco(pacienteOtimizado.getIsnInternacao(), jsfUtil
				.getUsuarioLogado().getIsnUsuario());
		
		// MNT-7546 
		List<PacEmerOtmTemp> listTemp = PacEmerOtmTempImpl.getInstancia()
				.pesquisar(new PacEmerOtmTemp(pacienteOtimizado.getIsnInternacao()), 0);
		
		PacEmerOtmTemp pacEmerOtmTemp = new PacEmerOtmTemp();
		if (listTemp != null && !listTemp.isEmpty()) {
			pacEmerOtmTemp = listTemp.get(0);
			pacEmerOtmTemp.setFlgRisco("S");
			pacEmerOtmTemp.setEmAtendimentoOuRisco("B");
			pacEmerOtmTemp.setIsnProfissionalAtendimento(jsfUtil.getUsuarioLogado().getIsnUsuario());
			pacEmerOtmTemp.setNomProfAtend(jsfUtil.getUsuarioLogado().getDscUsuario());
			PacEmerOtmTempImpl.getInstancia().alterar(pacEmerOtmTemp);
		}
		// Fim - Atualizar Flg_Risco para alterar a cor do Risco para vermelho

		//pupularPaciente(pacienteOtimizado.getIsnInternacao());
		//pupularPacienteOtimizado(pacienteOtimizado.getIsnInternacao());
		
		// MNT-7546 - ATUALIZANDO PACIENTE OTIMIZADO SEM PRECISAR CONSULTAR A VIEW
		pacienteOtimizado = new PacienteEmergenciaOtimizadoBean(pacEmerOtmTemp.getIsnInternacao(), pacEmerOtmTemp.getFlgRecepcao(), pacEmerOtmTemp.getIsnPaciente(),
				pacEmerOtmTemp.getDscNome(), pacEmerOtmTemp.getDatCadastro(), pacEmerOtmTemp.getHorChegada(), pacEmerOtmTemp.getDatRegistro(), pacEmerOtmTemp.getHorRegistro(),
				pacEmerOtmTemp.getDatNascimento(), pacEmerOtmTemp.getIsnRisco(), pacEmerOtmTemp.getDatInicioClassificacao(), pacEmerOtmTemp.getHorInicioClassificacao(),
				pacEmerOtmTemp.getDscFluxograma(), pacEmerOtmTemp.getDscQueixa(), pacEmerOtmTemp.getDscEspecialidadeEmergencia(), pacEmerOtmTemp.getFlgAtendendo(),
				pacEmerOtmTemp.getFlgRisco(), pacEmerOtmTemp.getNomProfAtend(), pacEmerOtmTemp.getQtdChamada(), pacEmerOtmTemp.getIsnProfissionalAtendimento(),
				pacEmerOtmTemp.getIsnInternacaoAtendimento(), pacEmerOtmTemp.getIsnEspecialidadeEmergencia(), pacEmerOtmTemp.getFlgRiscoQueda(),
				pacEmerOtmTemp.getFlgAlergia(), pacEmerOtmTemp.getFlgDocFoto(), pacEmerOtmTemp.getIsnInternacaoLeito(), pacEmerOtmTemp.getIsnLeito(), pacEmerOtmTemp.getNumProntuario(),
				pacEmerOtmTemp.getIsnClinica(), pacEmerOtmTemp.getSglSexo(), pacEmerOtmTemp.getDscLeito(), pacEmerOtmTemp.getDscMae(), pacEmerOtmTemp.getDscDiscriminador(),
				pacEmerOtmTemp.getDscSato2(), pacEmerOtmTemp.getDscGlassgow(), pacEmerOtmTemp.getDscTemperatura(), pacEmerOtmTemp.getDscGlicemia(), pacEmerOtmTemp.getDscReguaDor(),
				pacEmerOtmTemp.getDscFc(), pacEmerOtmTemp.getFlgDengue(), pacEmerOtmTemp.getDatSintomaDengue(), pacEmerOtmTemp.getFlgSuspeitaInfeccao(), pacEmerOtmTemp.getCodTela1(),
				exibeIconeSepse(pacEmerOtmTemp.getIsnInternacao(), pacEmerOtmTemp.getFlgSuspeitaInfeccao(), pacEmerOtmTemp.getDatInicioClassificacao(), pacEmerOtmTemp.getHorInicioClassificacao()));
		
		if (pacienteOtimizado != null
				&& (pacienteOtimizado.getIsnRisco() == null || pacienteOtimizado.getIsnRisco()
						.intValue() < 1)) {
			pacienteOtimizado.setIsnRisco(0);
		}
		this.listSinaisSirs = SinaisSirsImpl.getInstancia().pesquisar(new SinaisSirs(), 0);

		if (cr == null) {
			popularListasPanelRisco();
			cr = new ClassificacaoRisco();
			avisoValidacao = 20;
			return;
		}

		/*
		 * if(cr.getFlgAtendendo() == null){ cr.setFlgAtendendo("N"); }
		 */

		if (cr == null) {
			avisoValidacao = 17; // Enfermeira precisa avaliar risco
			mostraPanelAtendimento = false;
			return;
			/*
			 * }else if(cr.getFlgAtendendo().equals("S") ){ avisoValidacao = 19;
			 * // Paciente em atendimento por outro profissional de saude
			 * mostraPanelAtendimento = false; return;
			 */
		} else {
			popularListasPanelRisco();
			cr.setDscDiscriminador("");
			cr.setDscFc("");
			cr.setDscGlassgow("");
			cr.setDscGlicemia("");
			cr.setDscQueixa("");
			cr.setDscReguaDor("");
			cr.setDscSato2("");
			cr.setDscTemperatura("");
			setDatSintomaDengue(null);
			cr.setFlgDengue("");
			cr.setFlgRiscoQueda("");
			cr.setFlgSuspeitaInfeccao("");
			cr.setCodTela1(null);
			if(objPaciente.getFlgAlergia() ==  null){
				objPaciente.setFlgAlergia("");
			}
			if (objFluxograma == null)
				objFluxograma = new Fluxograma();
			objFluxograma.setIsnFluxograma(FluxogramaFacadeImpl.NAO_INFORMADO);
			avisoValidacao = 20; // chama o panel
			return;
		}

	}

	private void popularListasPanelRisco() {
		// popular lista fluxogramas - INICIO
		if (sliFluxogramas == null || sliFluxogramas.isEmpty()) {
			List<Fluxograma> lista = new FluxogramaFacadeImpl()
					.listarFluxogramas();
			sliFluxogramas = new ArrayList<SelectItem>();
			sliFluxogramas.add(new SelectItem(0, "SELECIONE"));
			for (Fluxograma f : lista) {
				sliFluxogramas.add(new SelectItem(f.getIsnFluxograma(), f
						.getDscFluxograma()));
			}
			objFluxograma.setIsnFluxograma(FluxogramaFacadeImpl.NAO_INFORMADO);
		}
		// popular lista fluxogramas - FIM

		// popular lista especialidade emergencia - INICIO
		if (lstEspecialidadeEmergencia == null
				|| lstEspecialidadeEmergencia.isEmpty()) {
			List<EspecialidadeEmergencia> lista = new EspecialidadeEmergenciaFacadeImpl()
					.listarEspecialidadeEmergencia();
			lstEspecialidadeEmergencia = new ArrayList<SelectItem>();
			lstEspecialidadeEmergencia.add(new SelectItem(0, "SELECIONE"));
			for (EspecialidadeEmergencia ee : lista) {
				lstEspecialidadeEmergencia.add(new SelectItem(ee
						.getIsnEspecialidadeEmergencia(), ee
						.getDscEspecialidadeEmergencia()));
			}
		}
		// popular lista especialidade emergencia - FIM

		// popular lista cor risco - INICIO
		if (lstRiscos == null || lstRiscos.isEmpty()) {
			List<Risco> lista = new InternacaoFacadeImpl().listarRiscos();
			lstRiscos = new ArrayList<SelectItem>();
			lstRiscos.add(new SelectItem(0, "SELECIONE"));
			for (Risco r : lista) {
				lstRiscos.add(new SelectItem(r.getIsnRisco(), r.getDscRisco()));
			}
		}
		// popular lista cor risco - FIM

		// popular lista cor risco DENGUE - INICIO
		if (lstRiscosDengue == null || lstRiscosDengue.isEmpty()) {
			List<Risco> lista = new InternacaoFacadeImpl().listarRiscosDengue();
			lstRiscosDengue = new ArrayList<SelectItem>();
			lstRiscos

			
			.add(new SelectItem(0, "SELECIONE"));
			for (Risco r : lista) {
				lstRiscosDengue.add(new SelectItem(r.getIsnRisco(), r
						.getDscRisco()));
			}
		}
		// popular lista cor risco DENGUE - FIM
	}

	public String modalAtendimentoMedico() throws Exception {

		popularEstaNaRecepcaoOuSalaDeEspera();
		
		// Início - Verificando se o paciente está sendo classificado ou se ele
		// está sendo atendido por outro profissional
		int joinInternacao = InternacaoImpl.JOIN_PROFISSIONAL_ATENDIMENTO
				| InternacaoImpl.JOIN_INTERNACAO_LEITO;


		InternacaoPepBean internacao = new InternacaoPepBean();
		internacao.setIsnInternacao(pacienteOtimizado.getIsnInternacao());
		internacao.setFiltroMap(new HashMap<String, Object>());
		internacao.getFiltroMap().put("datAltaNull", "datAltaNull");
		internacao = InternacaoImpl.getInstancia().get(internacao,
				joinInternacao);
		sliDestinos=null;
		if (internacao != null) {
			if ((internacao.getFlgRisco() != null
					&& !"".equalsIgnoreCase(internacao.getFlgRisco()) && "S"
						.equalsIgnoreCase(internacao.getFlgRisco()))
					|| (internacao.getFlgAtendendo() != null
							&& !"".equalsIgnoreCase(internacao
									.getFlgAtendendo()) && "S"
								.equalsIgnoreCase(internacao.getFlgAtendendo()))) {
				mostraPanelAtendimento = false;

				if (internacao.getProfissionalAtendimento() != null) {
					nomeProfissionalAtendimento = internacao
							.getProfissionalAtendimento().getDscUsuario();
				}
			}

			if (internacao.getFlgRisco() != null
					&& !"".equalsIgnoreCase(internacao.getFlgRisco())
					&& "S".equalsIgnoreCase(internacao.getFlgRisco())) {
				avisoValidacao = 23; // Não pode atender, pois o paciente está
										// sendo classificado
				return "";
			} else if (internacao.getFlgAtendendo() != null
					&& !"".equalsIgnoreCase(internacao.getFlgAtendendo())
					&& "S".equalsIgnoreCase(internacao.getFlgAtendendo())
					&& internacao.getProfissionalAtendimento() != null
					&& internacao.getProfissionalAtendimento().getIsnUsuario() != null
					&& internacao.getProfissionalAtendimento().getIsnUsuario()
							.intValue() > 0
					&& jsfUtil.getUsuarioLogado() != null
					&& jsfUtil.getUsuarioLogado().getIsnUsuario() != null
					&& jsfUtil.getUsuarioLogado().getIsnUsuario().intValue() > 0
					&& jsfUtil.getUsuarioLogado().getIsnUsuario().intValue() != internacao
							.getProfissionalAtendimento().getIsnUsuario()
							.intValue()) {
				avisoValidacao = 25; // Não pode atender, pois o paciente está
										// sendo atendido por outro profissional
				return "";
			}
		}
		// Fim - Verificando se o paciente está sendo classificado ou se ele
		// está sendo atendido por outro profissional

		setInternacaoAtendimentoCausaAcPai(new InternacaoAtendimentoCausa());
		setInternacaoAtendimentoCausaAcFilho(new InternacaoAtendimentoCausa());
		
		//carrega combo acidentes pais
		listaInternacaoAtendimentoCausaAcPai = carregaListaInternacaoAtendimentoCausaAcPai();
		
		//carrega combo agressoes pais
		listaInternacaoAtendimentoCausaAg = carregaListaInternacaoAtendimentoCausaAg();
		
		listaTipoAcidenteVeiculo = carregaListaTipoAcidenteVeiculo();
		
		listaPosicaoAcidente = carregaListaPosicaoAcidente();
		
		setListaRegiaoAfetada(carregaListaRegiaoAfetada());
		
		// verificar se paciente ja foi atendido - INICIO
		/**
		 * Antes era assim, com o atendimento odontologico tive que comentar
		 * pois o paciente pode ser atendido . EM: 05/12/2012
		 * 
		 * InternacaoAtendimentoPepBean atend = new
		 * InternacaoAtendimentoPepBean();
		 * atend.setIsnInternacao(pacienteOtimizado.getIsnInternacao());
		 * List<InternacaoAtendimentoPepBean> listaAtend =
		 * InternacaoAtendimentoPepImpl.getInstancia().pesquisar(atend,
		 * InternacaoAtendimentoPepImpl.JOIN_PROFISSIONAL); if(listaAtend !=
		 * null && listaAtend.size() > 0) { avisoValidacao = 29; // PACIENTE JA
		 * FOI ATENDIDO.
		 * 
		 * nomeProfissionalAtendimento =
		 * listaAtend.get(0).getProfissional().getDscUsuario();
		 * 
		 * return ""; }
		 */
		objIa = new InternacaoAtendimentoFacadeImpl()
				.buscaAtendimentoEmergencia(pacienteOtimizado
						.getIsnInternacao());
		
		if (objIa == null) {
			objIa = new InternacaoAtendimento();
			objIa.setCid10(new Cid10());
			isnDestino = 0;
		} else {
			isnDestino = objIa.getIsnClinicaDestino();
			//ACIDENTE
			InternacaoAtendimentoCausaFacade causaFacade = new InternacaoAtendimentoCausaFacadeImpl();
			InternacaoAtendimentoCausa atendimentoCausaSalvo = causaFacade.buscaInternacaoAtendimentoCausaPorId(objIa.getIsnInternacaoAtendimentoCausaAcidente());
			if (atendimentoCausaSalvo != null) {
				if (atendimentoCausaSalvo.getIsnPai() != null && atendimentoCausaSalvo.getIsnPai() != 0) {
					InternacaoAtendimentoCausa atendimentoCausaPai = causaFacade.buscaInternacaoAtendimentoCausaPorId(atendimentoCausaSalvo.getIsnPai());
					carregaListaInternacaoAtendimentoCausaAcFilhoPorPai(atendimentoCausaPai.getIsnInternacaoAtendimentoCausa());
					setInternacaoAtendimentoCausaAcPai(atendimentoCausaPai);
					setInternacaoAtendimentoCausaAcFilho(atendimentoCausaSalvo);
				} else if (atendimentoCausaSalvo.getIsnPai() == null || atendimentoCausaSalvo.getIsnInternacaoAtendimentoCausa() == 2) {
					setInternacaoAtendimentoCausaAcPai(atendimentoCausaSalvo);
					setInternacaoAtendimentoCausaAcFilho(new InternacaoAtendimentoCausa());
				}				
			} else {
				setInternacaoAtendimentoCausaAcPai(new InternacaoAtendimentoCausa());
				setInternacaoAtendimentoCausaAcFilho(new InternacaoAtendimentoCausa());
			}
			
			InternacaoAtendimentoAcidenteFacade internacaoAtendimentoFacade = new InternacaoAtendimentoAcidenteFacadeImpl();
			objIac = internacaoAtendimentoFacade.buscaInternacaoAtendimentoAcidente(this.isnInternacao);
			if(objIac == null) {
				objIac = new InternacaoAtendimentoAcidente();
				if(objIa.getFlgAcidente().equals("S")) {
					objIac.setIsnInternacao(paciente.getIsnInternacao());
					objIac.setIsnUsuario(objIa.getIsnUsuario());
					objIac.setDatCadastro(new Date());
				}
			} else {
				this.isnTipoAcidenteVeiculo = objIac.getIsnTipoVeiculo();
				this.isnPosicaoAcidente = objIac.getIsnPosicao();
				AcidenteRegiaoAfetadaFacade acidenteRegiaoAfetadaFacade = new AcidenteRegiaoAfetadaFacadeImpl();
				List<AcidenteRegiaoAfetada> lstAcidenteRegiaoAfetada = acidenteRegiaoAfetadaFacade.buscaAcidenteRegiaoAfetada(objIac.getIsnInternacaoAtendimentoAcidente());
				if(lstAcidenteRegiaoAfetada != null && lstAcidenteRegiaoAfetada.size() > 0) {
					this.objsRegiaoAfetada = new String[lstAcidenteRegiaoAfetada.size()];
					for(int i=0; i < lstAcidenteRegiaoAfetada.size(); i++) {
						this.objsRegiaoAfetada[i] = lstAcidenteRegiaoAfetada.get(i).getIsnRegiaoAfetada().toString();
					}
				}
			}
			//AGRESSAO
			InternacaoAtendimentoCausa atendimentoCausaAgressao = causaFacade.buscaInternacaoAtendimentoCausaPorId(objIa.getIsnInternacaoAtendimentoCausaAgressao());
			setInternacaoAtendimentoCausaAg(atendimentoCausaAgressao);
		}
		// verificar se paciente ja foi atendido - FIM

		usuario = "";
		senha = "";
		cr = new ClassificacaoRisco();
		objCid10 = new Cid10();
		carregarInternacaoAtendimentoProcedimento();
		isnEspecialidadeEmergencia = 0;
		isnRisco = 0;
		isnFluxograma = 0;
		viewPager = 0;
		evolucaoSepse = new EvolucaoSepse();
		
		setHorInicialAtendimento(FuncUtil.obterHoraAtual());
		setDatInicialAtendimento(new Date());

		ClassificacaoRiscoFacade crf = new ClassificacaoRiscoFacadeImpl();
		cr = crf.maximoClassificacaoRisco(pacienteOtimizado.getIsnInternacao());

		// INÍCIO - BAIXA NA CHAMADA
		InternacaoChamadaPepBean internacaoChamada = new InternacaoChamadaPepBean();
		internacaoChamada
				.setIsnInternacao(pacienteOtimizado.getIsnInternacao());

		InternacaoChamadaImpl.getInstancia().atualizarInternacoesAberta(
				internacaoChamada);
		// FIM - BAIXA NA CHAMADA

		// this.preencherListaHistorico();

		mostraPanelAtendimento = true;

		if (cr == null) {
			avisoValidacao = 17; // Enfermeira precisa avaliar risco
			mostraPanelAtendimento = false;
			return "";
		} else {
			/*
			 * if(cr.getFlgAtendendo() == null){ cr.setFlgAtendendo("N"); }
			 */
		}

		// Avisa para o ws toLife que comecou o atendimento medico
		if (this.getUsarClassificacaoToLife()) { // se tolife estiver habilitado
			if (!new ConsumoToLifeWS().inicioAtendimento(pacienteOtimizado
					.getIsnInternacao())) {
				avisoValidacao = 30;
				return "";
			}
		}

		/*
		 * if(cr.getFlgAtendendo().equals("S") ){ avisoValidacao = 19; //
		 * Paciente em atendimento por outro profissional de saude
		 * mostraPanelAtendimento = false; return ""; }else{
		 */
		// Início - Atualizar Flg_Risco para alterar a cor do Risco para
		// vermelho
		InternacaoFacade i = new InternacaoFacadeImpl();
		i.emAtendimento(pacienteOtimizado.getIsnInternacao(), jsfUtil
				.getUsuarioLogado().getIsnUsuario());
		// Fim - Atualizar Flg_Risco para alterar a cor do Risco para vermelho
		// avisoValidacao = 18; //chama o panel
		
		
		pupularPaciente(pacienteOtimizado.getIsnInternacao());
		pupularPacienteOtimizado(pacienteOtimizado.getIsnInternacao());
		
		if(!validarSeAtendimentoNaofoiCriado()){
			avisoValidacao = 32;
			return "";
		}
		
		getPacienteOtimizado().setFlgRiscoQueda(pacienteOtimizado.getFlgRiscoQueda());
		verificarPacienteRecepcao(pacienteOtimizado.getIsnInternacao());

		populaSliTipoPrescricaoEnfermagemPep();
		carregarSliTipoPrescricaoEnfermagemPadrao();

		// RETORNA NUMERO ATENDIMENTO
		InternacaoPepBean filter = new InternacaoPepBean();
		filter.setIsnPaciente(pacienteOtimizado.getIsnPaciente());
		List<InternacaoPepBean> lstInternacao = new ArrayList<InternacaoPepBean>();
		lstInternacao = InternacaoImpl.getInstancia().pesquisar(filter,0);
		if (lstInternacao != null && lstInternacao.size() > 0) {
			numAtendimentos = lstInternacao.size();
		}
		verificaSeAtendimentoDengueCriado();
		verificaSeAtendimentoChikungunyaCriado();
		carregarPacienteAlergia();
		alertaAlergia = false;
		pacienteAlergia = new PacienteAlergia();
		if (paciente.getFlgAlergia() != null && paciente.getFlgAlergia().equals("S")) {
			if(getLstPacienteAlergia()!=null && !getLstPacienteAlergia().isEmpty())
			{
				pacienteAlergia = this.getLstPacienteAlergia().get(0);
				pacienteAlergia.setFlgAlergia(null);
				permitirFechaPanelAlergia="N";
			}
			alertaAlergia = true;

		}
		
		return "cs_emergenciaTocd_atendimentoMedico";
		// }
	}
	
	private List<InternacaoAtendimentoCausa> carregaListaInternacaoAtendimentoCausaAcPai() {
		List<InternacaoAtendimentoCausa> lista = null;
		try {
			InternacaoAtendimentoCausaFacade causaFacade = new InternacaoAtendimentoCausaFacadeImpl();
			lista = causaFacade.buscaInternacaoAtendimentoCausas("AC", true);
		} catch (Exception e) {
			e.printStackTrace();
		}
		return lista;
	}
	
	public void carregaListaInternacaoAtendimentoCausaAcFilho(ActionEvent ev) {
		List<InternacaoAtendimentoCausa> lista = null;
		try {
			InternacaoAtendimentoCausaFacade causaFacade = new InternacaoAtendimentoCausaFacadeImpl();
			if (getInternacaoAtendimentoCausaAcPai() != null && getInternacaoAtendimentoCausaAcPai().getIsnInternacaoAtendimentoCausa() != null && getInternacaoAtendimentoCausaAcPai().getIsnInternacaoAtendimentoCausa() != 0 && getInternacaoAtendimentoCausaAcPai().getIsnInternacaoAtendimentoCausa() != 2) lista = causaFacade.buscaInternacaoAtendimentoCausaPorIdPai(getInternacaoAtendimentoCausaAcPai().getIsnInternacaoAtendimentoCausa());
		} catch (Exception e) {
			e.printStackTrace();
		}
		listaInternacaoAtendimentoCausaAcFilho = lista;
	}
	
	public void carregaListaInternacaoAtendimentoCausaAcFilhoPorPai(Integer isnPai) {
		List<InternacaoAtendimentoCausa> lista = null;
		try {
			InternacaoAtendimentoCausaFacade causaFacade = new InternacaoAtendimentoCausaFacadeImpl();
			if (isnPai != null && isnPai != 0) lista = causaFacade.buscaInternacaoAtendimentoCausaPorIdPai(isnPai);
		} catch (Exception e) {
			e.printStackTrace();
		}
		listaInternacaoAtendimentoCausaAcFilho = lista;
	}
	
	public void limpaCombosAcidente(ActionEvent ev) {
		setInternacaoAtendimentoCausaAcPai(new InternacaoAtendimentoCausa());
		setInternacaoAtendimentoCausaAcFilho(new InternacaoAtendimentoCausa());
		setListaInternacaoAtendimentoCausaAcFilho(new ArrayList<InternacaoAtendimentoCausa>());
		setIsnTipoAcidenteVeiculo(new Integer(0));
		setIsnPosicaoAcidente(new Integer(0));
		setObjIac(new InternacaoAtendimentoAcidente());
		setObjsRegiaoAfetada(new String[]{});
	}
	
	public void limpaComboAgressao(ActionEvent ev) {
		setInternacaoAtendimentoCausaAg(new InternacaoAtendimentoCausa());
	}
	
	private List<InternacaoAtendimentoCausa> carregaListaInternacaoAtendimentoCausaAg() {
		List<InternacaoAtendimentoCausa> lista = null;
		try {
			InternacaoAtendimentoCausaFacade causaFacade = new InternacaoAtendimentoCausaFacadeImpl();
			lista = causaFacade.buscaInternacaoAtendimentoCausas("AG", true);
		} catch (Exception e) {
			e.printStackTrace();
		}
		return lista;
	}

	
	private void verificaSeAtendimentoDengueCriado(){
		flgCid10Dengue = false;
		AtendimentoDengueFacade atendimentoDengueFacade = new AtendimentoDengueFacadeImpl();
		AtendimentoDengue dengue = atendimentoDengueFacade.getAtendimentoDengueInternacao(this.isnInternacao);
		if(dengue != null ){
			Cid10Facade cid10Facade = new Cid10FacadeImpl();
			this.objCid10 = cid10Facade.buscarCid10(dengue.getIsnCid10());
			salvaCid10InternacaoAtendimento();
			flgCid10Dengue = true;
			if(dengue.getIsnGrupoDengue() != null && dengue.getIsnGrupoDengue().intValue() == 3){
				listarEmergenciaGrupoC();
				isnDestino=3;
			}
		}
		
	}
	
	private void verificaSeAtendimentoChikungunyaCriado(){
		flgCid10Dengue = false;
		AtendimentoChikungunyaFacade atendimentoChikungunyaFacade = new AtendimentoChikungunyaFacadeImpl();
		AtendimentoChikungunya chikungunya = atendimentoChikungunyaFacade.buscarAtendimentoChikungunyaInternacao(this.isnInternacao);
		if(chikungunya != null ){
			Cid10Facade cid10Facade = new Cid10FacadeImpl();
			this.objCid10 = cid10Facade.buscarCid10(chikungunya.getIsnCid10());
			salvaCid10InternacaoAtendimento();
			flgCid10Dengue = true;
		}
		
	}
	
	public void preencherListaHistorico() throws Exception {
		int join = InternacaoAtendimentoPepImpl.JOIN_INTERNACAO
				| InternacaoAtendimentoPepImpl.JOIN_PACIENTE
				| InternacaoAtendimentoPepImpl.JOIN_PROFISSIONAL;

		InternacaoAtendimentoPepBean internacaoAtendimentoPepBean = new InternacaoAtendimentoPepBean();
		HashMap<String, Object> filtro = new HashMap<String, Object>();
		filtro.put("isnPaciente", paciente.getIsnPaciente());
		internacaoAtendimentoPepBean.setFiltro(filtro);

		List<InternacaoAtendimentoPepBean> listaInternacaoAtendimentoPepBean = InternacaoAtendimentoPepImpl
				.getInstancia().pesquisar(internacaoAtendimentoPepBean, join);

		if (listaInternacaoAtendimentoPepBean != null
				&& listaInternacaoAtendimentoPepBean.size() > 0) {
			this.setListaInternacaoAtendimento(listaInternacaoAtendimentoPepBean);
		}
	}

	public void preencherListaTransferencia() throws Exception {
		int join = InternacaoTransImpl.JOIN_USUARIO;

		InternacaoTransBean internacaoTransBean = new InternacaoTransBean();
		internacaoTransBean.setIsnInternacao(paciente.getIsnInternacao());

		List<InternacaoTransBean> listaInternacaoTransferencias = InternacaoTransImpl
				.getInstancia().pesquisar(internacaoTransBean, join);

		if (listaInternacaoTransferencias != null
				&& listaInternacaoTransferencias.size() > 0) {
			this.setListaTransferencia(listaInternacaoTransferencias);
		} else {
			this.setListaTransferencia(new ArrayList<InternacaoTransBean>());
		}
	}

	public boolean getIsUsuarioNac() {
		try {
			boolean bolPermissao = false;

			Usuario usr = new Usuario();
			usr.setIsnUsuario(jsfUtil.getUsuarioLogado().getIsnUsuario());

			usr = UsuarioImpl.getInstancia().get(
					usr,
					UsuarioImpl.JOIN_USUARIO_GRUPO
							| UsuarioImpl.JOIN_USUARIOGRUPO_GRUPO);

			for (UsuarioGrupo ug : usr.getUsuarioGrupoBean()) {
				if (ug.getGrupoBean().getDscGrupo().equals("NAC")) {
					bolPermissao = true;
				}
			}

			return bolPermissao;
		} catch (Exception e) {
			return false;
		}

	}

	public void excluirItem() {

		if (!ValidaPermissaoUsuario.getInstancia().verificaPermissao(
				"CD_ATENDIMENTOMEDICO", funcUtil.getAcaoExcluir())) {
			this.setMensagemConfirmacao("Usuário sem permissão!");
			return;
		}

		try {
			PrescricaoPep objPrescricaoPep = new PrescricaoPep();
			// objPrescricaoPep.setIsnPrescricaoPep(this.getObjPrescricaoPepItem().getIsnPrescricaoPep());
			HashMap<String, Object> filtroPep = new HashMap<String, Object>();
			filtroPep.put("isnPrescricaoPep", this.getObjPrescricaoPepItem()
					.getIsnPrescricaoPep());
			filtroPep.put("isnProfissionalConclNotNull", "NULL");
			objPrescricaoPep.setFiltro(filtroPep);

			objPrescricaoPep.setIsnProfissional(jsfUtil.getUsuarioLogado()
					.getIsnUsuario());

			objPrescricaoPep = PrescricaoPepImpl.getInstancia().get(
					objPrescricaoPep, 0);

			if (objPrescricaoPep == null) {
				this.objPrescricaoPepItem.setFlgAtivo("N");
				PrescricaoPepItemImpl.getInstancia().alterar(
						this.objPrescricaoPepItem);

				if (objPrescricaoPepItem != null
						&& objPrescricaoPepItem.getIsnPrescricaoUpa() != null
						&& objPrescricaoPepItem.getIsnPrescricaoUpa()
								.intValue() > 0) {
					PrescricaoUpaBean pUpa = new PrescricaoUpaBean();
					pUpa.setIsnPrescricaoUpa(objPrescricaoPepItem
							.getIsnPrescricaoUpa());
					pUpa = PrescricaoUpaImpl.getInstancia().get(pUpa, 0);
					pUpa.setFlgAtivo("N");
					PrescricaoUpaImpl.getInstancia().alterar(pUpa);
				}
			} else {
				this.setMensagemConfirmacao("Esse item de prescrição não pode ser removido, pois essa prescrição já foi concluída!");
				return;
			}

			carregaPrescricaoPepAtual();
			carregarPrescricao();

		} catch (Exception e) {
			e.printStackTrace();
		}

	}

	public void suspender() {
		try {
			if (!ValidaPermissaoUsuario.getInstancia().verificaPermissao(
					"CD_ATENDIMENTOMEDICO", funcUtil.getAcaoExcluir())) {
				this.setMensagemConfirmacao("Usuário sem permissão!");
				return;
			}

			PrescricaoPepIs objPrescricaoPepIs = new PrescricaoPepIs();

			objPrescricaoPepIs.setDatCadastro(new Date());
			objPrescricaoPepIs
					.setIsnPrescricaoPepItem(this.objPrescricaoPepItem
							.getIsnPrescricaoPepItem());
			objPrescricaoPepIs.setIsnPrescricaoPep(this.objPrescricaoPepItem
					.getIsnPrescricaoPep());

			objPrescricaoPepIs.setIsnProfissional(jsfUtil.getUsuarioLogado()
					.getIsnUsuario());

			PrescricaoPepIsImpl.getInstancia().suspender(objPrescricaoPepIs,
					this.objPrescricaoPepItem);

			this.limparCampos();

			this.carregarPrescricao();

		} catch (Exception e) {
			this.setMensagemConfirmacao(e.getMessage());
		}
	}

	public void incluirItem() throws Exception {
		try {
			if (!ValidaPermissaoUsuario.getInstancia().verificaPermissao(
					"CD_ATENDIMENTOMEDICO", funcUtil.getAcaoGravar())) {
				this.setMensagemConfirmacao("Usuário sem permissão!");
				return;
			}

			// Início - Validar Campos Obrigatório
			if (this.getDscPrescricao() == null
					|| "".equalsIgnoreCase(this.getDscPrescricao())) {
				this.setMensagemConfirmacao("O campo Prescrição é obrigatório!");
				return;
			}
			// Fim - Validar Campos Obrigatório

			this.setMensagemConfirmacao(null);

			PrescricaoPep prescricaoPep = new PrescricaoPep();
			prescricaoPep.setIsnInternacao(paciente.getIsnInternacao());
			prescricaoPep.setDscPrescricao(this.getDscPrescricao());
			// prescricaoPep.setPaginaOrigem(this.getPaginaOrigem());
			prescricaoPep.setFlgImp("N");
			prescricaoPep.setIsnInternacaoLeito(paciente
					.getIsnInternacaoLeito());
			PrescricaoPepImpl.getInstancia().verificarPrescricao(prescricaoPep);

			this.limparCampos();

			this.carregaPrescricaoPepAtual();
			this.carregarPrescricao();
		} catch (Exception e) {
			this.setMensagemConfirmacao(e.getMessage());
			e.printStackTrace();
		}
	}

	public String carregaPrescricaoPepAtual() {
		lstPrescricaoPepAtual = new ArrayList<PrescricaoPep>();
		try {

			PrescricaoPep prescricaoPep = new PrescricaoPep();
			prescricaoPep.setIsnInternacao(this.getPaciente()
					.getIsnInternacao());

			HashMap<String, Object> filtro = new HashMap<String, Object>();
			filtro.put("isnProfissionalConcl", "NULL");
			filtro.put("flgAtivo", "S");
			filtro.put("datCancelamentoNull", "null");
			prescricaoPep.setFiltro(filtro);

			lstPrescricaoPepAtual = PrescricaoPepImpl.getInstancia().pesquisar(
					prescricaoPep,
					PrescricaoPepImpl.JOIN_PRESCRICAO_PEP_ITEM
							| PrescricaoPepImpl.JOIN_USUARIO
							| PrescricaoPepImpl.JOIN_USUARIO_CONCLUSAO,
					Criteria.DISTINCT_ROOT_ENTITY);

		} catch (Exception e) {
			e.getMessage();
		}
		return "";

	}

	public String carregarPrescricao() {
		this.setLstPrescricaoPep(new ArrayList<PrescricaoPep>());
		try {
			PrescricaoPep pep = new PrescricaoPep();
			if (paciente != null && paciente.getIsnInternacao() != null) {
				pep.setIsnInternacao(paciente.getIsnInternacao());
				HashMap<String, Object> filtroPep = new HashMap<String, Object>();
				filtroPep.put("flgAtivo", "S");
				pep.setFiltro(filtroPep);
				List<PrescricaoPep> listaPrescricaoPep = PrescricaoPepImpl.getInstancia().pesquisar(pep, PrescricaoPepImpl.JOIN_USUARIO
																										| PrescricaoPepImpl.JOIN_USUARIO_CONCLUSAO
																										| PrescricaoPepImpl.JOIN_PRESCRICAO_PEP_ITEM,
																										Criteria.DISTINCT_ROOT_ENTITY);
				if (listaPrescricaoPep != null && listaPrescricaoPep.size() > 0) {
					this.setLstPrescricaoPep(listaPrescricaoPep);
				}
			}
		} catch (Exception e) {
			e.printStackTrace();
		}
		return "";
	}

	public void preparaAlterarPrescricao() {
		this.setDscPrescricao(this.getPrescricaoUpa().getDscPrescricao());
	}

	public void cancelarItem(ActionEvent event) {
		this.setPrescricaoUpa(null);
		this.setDscPrescricao(null);
	}

	public String alterarItem() {
		try {
			if (!ValidaPermissaoUsuario.getInstancia().verificaPermissao(
					"CD_ATENDIMENTOMEDICO", funcUtil.getAcaoAlterar())) {
				this.setMensagemConfirmacao("Usuário sem permissão!");
				return "";
			}
			// Início - Validar Campos Obrigatório
			if (this.getObjPrescricaoPepItem().getDscPrescricao() == null
					|| "".equalsIgnoreCase(this.getObjPrescricaoPepItem()
							.getDscPrescricao())) {
				this.setMensagemConfirmacao("O campo Prescrição é obrigatório!");
				return "";
			}

			PrescricaoPepItemImpl.getInstancia().alterar(
					this.objPrescricaoPepItem);
			
			if (objPrescricaoPepItem != null
					&& objPrescricaoPepItem.getIsnPrescricaoUpa() != null
					&& objPrescricaoPepItem.getIsnPrescricaoUpa()
							.intValue() > 0) {
				PrescricaoUpaBean pUpa = new PrescricaoUpaBean();
				pUpa.setIsnPrescricaoUpa(objPrescricaoPepItem.getIsnPrescricaoUpa());
				pUpa = PrescricaoUpaImpl.getInstancia().get(pUpa, 0);
				pUpa.setDscPrescricao(objPrescricaoPepItem.getDscPrescricao());
				PrescricaoUpaImpl.getInstancia().alterar(pUpa);
			}

			this.limparCampos();
		} catch (Exception e) {
			this.setMensagemConfirmacao(e.getMessage());
		}
		return "";
	}

	public void verificarChamada() throws Exception {
		InternacaoChamadaPepBean internacaoChamada = new InternacaoChamadaPepBean();
		internacaoChamada.setIsnInternacao(paciente.getIsnInternacao());
		internacaoChamada.setFiltroMap(new HashMap<String, Object>());
		internacaoChamada.getFiltroMap().put("datEncerramentoNull", "NULL");

		List<InternacaoChamadaPepBean> lista = InternacaoChamadaImpl
				.getInstancia().pesquisar(internacaoChamada, 0);

		if (lista != null && lista.size() > 0) {
			possuiChamada = true;
		} else {
			possuiChamada = false;
			this.limparCampoModal();
		}
	}

	public String irParaAtendimento() {
		viewPager = 0;
		evolucaoSepse = new EvolucaoSepse();
		
		try {
			if (!ValidaPermissaoUsuario.getInstancia().verificaPermissao(
					"CD_ATENDIMENTOMEDICO", funcUtil.getAcaoAlterar())) {
				
				mensagem = "Usuário sem permissão para esta ação.";
				
				/*
				switch (origemTelaParaAtendimento) {
				 
				case 1:
					return "eixosEmergencia";
				case 2:
					return "cs_pacienteAtendimento";
				default:
					return "";
				}
				*/
				return "";
			}

			origemTelaRecpcao = false;
			
			pupularPaciente(isnInternacao);
			pupularPacienteOtimizado(isnInternacao);
			
			pacienteOtimizado.setFlgRiscoQueda(flgRiscoQueda);			

			popularEstaNaRecepcaoOuSalaDeEspera();
			
			InternacaoAtendimentoFacade facadeAtend = new InternacaoAtendimentoFacadeImpl();
			objIa = facadeAtend.buscaAtendimentoEmergencia(isnInternacao);
			if (objIa != null && objIa.getCid10() == null) {
				objIa.setCid10(new Cid10());
			}
			setIsnDestino(objIa.getIsnClinicaDestino());
			
			//carrega combo acidentes pais
			listaInternacaoAtendimentoCausaAcPai = carregaListaInternacaoAtendimentoCausaAcPai();
			
			//carrega combo agressoes pais
			listaInternacaoAtendimentoCausaAg = carregaListaInternacaoAtendimentoCausaAg();
			
			setListaTipoAcidenteVeiculo(carregaListaTipoAcidenteVeiculo());
			
			setListaPosicaoAcidente(carregaListaPosicaoAcidente());
			
			setListaRegiaoAfetada(carregaListaRegiaoAfetada());
			
			InternacaoAtendimentoAcidenteFacade internacaoAtendimentoFacade = new InternacaoAtendimentoAcidenteFacadeImpl();
			setObjIac(internacaoAtendimentoFacade.buscaInternacaoAtendimentoAcidente(this.isnInternacao));
			if(getObjIac() == null) {
				setObjIac(new InternacaoAtendimentoAcidente());
				if(objIa.getFlgAcidente().equals("S")) {
					getObjIac().setIsnInternacao(paciente.getIsnInternacao());
					getObjIac().setIsnUsuario(objIa.getIsnUsuario());
					getObjIac().setDatCadastro(new Date());
				}
			} else {
				this.setIsnTipoAcidenteVeiculo(getObjIac().getIsnTipoVeiculo());
				this.setIsnPosicaoAcidente(getObjIac().getIsnPosicao());
				AcidenteRegiaoAfetadaFacade acidenteRegiaoAfetadaFacade = new AcidenteRegiaoAfetadaFacadeImpl();
				List<AcidenteRegiaoAfetada> lstAcidenteRegiaoAfetada = acidenteRegiaoAfetadaFacade.buscaAcidenteRegiaoAfetada(getObjIac().getIsnInternacaoAtendimentoAcidente());
				if(lstAcidenteRegiaoAfetada != null && lstAcidenteRegiaoAfetada.size() > 0) {
					this.setObjsRegiaoAfetada(new String[lstAcidenteRegiaoAfetada.size()]);
					for(int i=0; i < lstAcidenteRegiaoAfetada.size(); i++) {
						this.getObjsRegiaoAfetada()[i] = lstAcidenteRegiaoAfetada.get(i).getIsnRegiaoAfetada().toString();
					}
				}
			}
			
			//ACIDENTE
			InternacaoAtendimentoCausaFacade causaFacade = new InternacaoAtendimentoCausaFacadeImpl();
			InternacaoAtendimentoCausa atendimentoCausaSalvo = causaFacade.buscaInternacaoAtendimentoCausaPorId(objIa.getIsnInternacaoAtendimentoCausaAcidente());
			if (atendimentoCausaSalvo != null) {
				if (atendimentoCausaSalvo.getIsnPai() != null && atendimentoCausaSalvo.getIsnPai() != 0) {
					InternacaoAtendimentoCausa atendimentoCausaPai = causaFacade.buscaInternacaoAtendimentoCausaPorId(atendimentoCausaSalvo.getIsnPai());
					carregaListaInternacaoAtendimentoCausaAcFilhoPorPai(atendimentoCausaPai.getIsnInternacaoAtendimentoCausa());
					setInternacaoAtendimentoCausaAcPai(atendimentoCausaPai);
					setInternacaoAtendimentoCausaAcFilho(atendimentoCausaSalvo);
				} else if (atendimentoCausaSalvo.getIsnPai() == null || atendimentoCausaSalvo.getIsnInternacaoAtendimentoCausa() == 2) {
					setInternacaoAtendimentoCausaAcPai(atendimentoCausaSalvo);
					setInternacaoAtendimentoCausaAcFilho(new InternacaoAtendimentoCausa());
				}				
			} else {
				setInternacaoAtendimentoCausaAcPai(new InternacaoAtendimentoCausa());
				setInternacaoAtendimentoCausaAcFilho(new InternacaoAtendimentoCausa());
			}
			//AGRESSAO
			InternacaoAtendimentoCausa atendimentoCausaAgressao = causaFacade.buscaInternacaoAtendimentoCausaPorId(objIa.getIsnInternacaoAtendimentoCausaAgressao());
			setInternacaoAtendimentoCausaAg(atendimentoCausaAgressao);

			this.carregarExames();
			this.verificaPermissaoAcao();
			setDataInicio(new Date());
			// this.preencherListaHistorico();
			verificarPacienteRecepcao(isnInternacao);

			// InternacaoAtendimentoFacade iaF = new
			// InternacaoAtendimentoFacadeImpl();
			// InternacaoAtendimento iaBd = new InternacaoAtendimento();
			// iaBd = iaF.buscaAtendimentoEmergencia(isnInternacao);
			// setObjIa(iaBd);

			internacaoLeitoAtual = new InternacaoLeitoFacadeImpl()
					.buscaMaxInternacaoLeitoOcupado(isnInternacao);

			if (internacaoLeitoAtual != null && internacaoLeitoAtual.getIsnUsuarioAltaMedica() != null) {
				Usuario vo = new Usuario();
				vo.setIsnUsuario(internacaoLeitoAtual.getIsnUsuarioAltaMedica());

				try {
					vo = new UsuarioImpl().getInstancia().get(vo, 0);
				} catch (Exception e) {
					e.printStackTrace();
				}
				internacaoLeitoAtual
						.setDscUsuarioAltaMedica(vo.getDscUsuario());
			}

			// RETORNA NUMERO ATENDIMENTO
			InternacaoPepBean filter = new InternacaoPepBean();
			filter.setIsnPaciente(paciente.getIsnPaciente());
			List<InternacaoPepBean> lstInternacao = new ArrayList<InternacaoPepBean>();
			lstInternacao = InternacaoImpl.getInstancia().pesquisar(filter,0);
			if (lstInternacao != null && lstInternacao.size() > 0) {
				numAtendimentos = lstInternacao.size();
			}

			populaSliTipoPrescricaoEnfermagemPep();
			carregarSliTipoPrescricaoEnfermagemPadrao();
			carregarInternacaoAtendimentoProcedimento();
			carregarPacienteAlergia();
			
			alertaAlergia = false;
			pacienteAlergia = new PacienteAlergia();
			if (paciente.getFlgAlergia() != null && paciente.getFlgAlergia().equals("S")) {
				if(getLstPacienteAlergia()!=null && !getLstPacienteAlergia().isEmpty())
				{
					pacienteAlergia = this.getLstPacienteAlergia().get(0);
				}
				alertaAlergia = true;

			}

			if (isnInternacao != null){
				cr = new ClassificacaoRisco();
				ClassificacaoRiscoFacade crf = new ClassificacaoRiscoFacadeImpl();
				cr = crf.maximoClassificacaoRisco(isnInternacao);
			}

		} catch (Exception e) {
			e.printStackTrace();
		}

		switch (origemTelaParaAtendimento) {
		case 1:
			return "eixosEmergencia_cd_atendimentoMedico";
		case 2:
			return "cs_pacienteAtendimentoToAtendimento";
		default:
			return "";
		}
	}

	private void verificarPacienteRecepcao(Integer isnInternacao) {
		setPacienteNaRecepcao(false);
		if (isnInternacao != null && isnInternacao.intValue() > 0) {
			InternacaoLeito il = new InternacaoLeitoFacadeImpl()
					.maximoInternacaoLeito(isnInternacao);
			if (il != null && il.getFlgRecepcao() != null
					&& il.getFlgRecepcao().trim().equalsIgnoreCase("S")) {
				setPacienteNaRecepcao(true);
			}
		}
	}

	public String irParaAtendimentoDaTelaTransferencia() {
		try {
			origemTelaRecpcao = false;
			viewPager = 0;
			evolucaoSepse = new EvolucaoSepse();

			pupularPaciente(isnInternacao);
			pupularPacienteOtimizado(isnInternacao);
			carregarInternacaoAtendimentoProcedimento();
			popularEstaNaRecepcaoOuSalaDeEspera();
			
			this.carregarExames();
			verificarPacienteRecepcao(isnInternacao);
			preencherListaTransferencia();
			
			if (isnInternacao != null){
				cr = new ClassificacaoRisco();
				ClassificacaoRiscoFacade crf = new ClassificacaoRiscoFacadeImpl();
				cr = crf.maximoClassificacaoRisco(isnInternacao);
			}
		} catch (Exception e) {
			e.printStackTrace();
		}

		return "internacaoTransToatendimentoMedico";
	}

	public void abrirPanelNovaEvolucao() {
		try {
			setIsnInternacaoEvolucao(null);
			setAvisoValidacao(null);
			if (!ValidaPermissaoUsuario.getInstancia().verificaPermissao(
					"CD_ATENDIMENTOMEDICO_EVOLUCAO", funcUtil.getAcaoGravar())
					|| (jsfUtil.getUsuarioLogado().getIsnVinculoTipo() != null
						&& (jsfUtil.getUsuarioLogado().getIsnVinculoTipo() == 1
							|| jsfUtil.getUsuarioLogado().getIsnVinculoTipo() == 3))) { // BLOQUEIO INTERNOS E ESTAGIARIOS
				setAvisoValidacao(22); // Usuário sem permissão.
				return;
			}
			setDscEvolucao("");
			setAvisoValidacao(9999);
		} catch (Exception e) {
			setAvisoValidacao(23); // Aconteceu um erro inesperado. Entre em
									// contato com o administrador do sistema.
		}
	}

	public void preparaAlterarEvolucao() {
		try {
			setAvisoValidacao(null);
			if (!ValidaPermissaoUsuario.getInstancia().verificaPermissao(
					"CD_ATENDIMENTOMEDICO_EVOLUCAO", funcUtil.getAcaoGravar())) {
				setAvisoValidacao(22); // Usuário sem permissão.
				return;
			}

			InternacaoEvolucao evolucao = new InternacaoEvolucao();
			evolucao.setIsnInternacaoEvolucao(isnInternacaoEvolucao);
			evolucao = InternacaoEvolucaoImpl.getInstancia().get(evolucao, 0);

			setDscEvolucao(evolucao.getDscEvolucao());
			setAvisoValidacao(9999);
		} catch (Exception e) {
			setAvisoValidacao(23); // Aconteceu um erro inesperado. Entre em
									// contato com o administrador do sistema.
		}
	}

	public void inserirEvolucao() {
		try {
			setAvisoValidacao(9999);
			// GRAVANDO EVOLUCAO
			if (getDscEvolucao() == null
					|| "".equalsIgnoreCase(getDscEvolucao().trim())) {
				setAvisoValidacao(24); // CAMPO EVOLUCAO OBRIGATORIO
				return;
			} else if (getDscEvolucao().length() > 3001) {
				setAvisoValidacao(25); // CAMPO EVOLUCAO MAIOR QUE O TAMANHO DO
										// CAMPO NO BANCO DE DADOS
				return;
			}

			InternacaoEvolucao evolucao = new InternacaoEvolucao();

			if (isnInternacaoEvolucao == null
					|| isnInternacaoEvolucao.intValue() <= 0) {
				evolucao.setIsnInternacao(paciente.getIsnInternacao());
				evolucao.setDatCadastro(new Date());
				evolucao.setIsnUsuario(jsfUtil.getUsuarioLogado()
						.getIsnUsuario());
				evolucao.setFlgAtivo("S");
				evolucao.setDscEvolucao(getDscEvolucao());
				InternacaoEvolucaoImpl.getInstancia().inserir(evolucao);
			} else {
				evolucao.setIsnInternacaoEvolucao(isnInternacaoEvolucao);
				evolucao = InternacaoEvolucaoImpl.getInstancia().get(evolucao,
						0);
				evolucao.setDscEvolucao(getDscEvolucao());
				InternacaoEvolucaoImpl.getInstancia().alterar(evolucao);
			}

			setAvisoValidacao(9999); // Sucesso
			carregaEvolucao();
		} catch (Exception e) {
			setAvisoValidacao(23); // Aconteceu um erro inesperado. Entre em
									// contato com o administrador do sistema.
		}
	}

	public void verificarPedidoBloqueado() {
		pedidoBloqueado = 0;
		for (ExamePepBean exame : listExameSelecionado) {
			if (exame.getIsnDisponibilidade() != 1 && (!isnSepse.equals(9) && !isnSepse.equals(10))) {
				pedidoBloqueado = 1;
				break;
			}
		}
	}
	
	public void inserirExameSepse() {
		try {
			if (!ValidaPermissaoUsuario.getInstancia().verificaPermissao(
					"CD_ATENDIMENTOMEDICO", funcUtil.getAcaoGravar())) {
				this.setMensagemConfirmacao("Usuário sem permissão!");
				return;
			}

			if (laboratorioInterfaceamento.getVlrParametro().equals("M")) {
				for (ExamePepBean exame : listExameSelecionado) {
					if (exame.getFlgParametroMatrix() != null && exame.getFlgParametroMatrix().equals("S")) {
						if (peso.toString().isEmpty()|| peso.toString().equals("0.0")|| altura.toString().isEmpty()| altura.toString().equals("0.0")) {
							this.setMensagemConfirmacao("2"); // Os campos Peso
																// e Altura são
																// obrigatórios!
							return;
						}
						if ((paciente.getSglSexo().equals("F") && flgGestante
								.isEmpty())) {
							this.setMensagemConfirmacao("3"); // O campo
																// Gestante é
																// obrigatório!
							return;
						}
					}
				}
			}

			// GRAVANDO SOLICITAÇÃO DE EXAMES
			ExameSolicitacaoPepBean exameSolicitacaoPepBean = new ExameSolicitacaoPepBean();

			exameSolicitacaoPepBean.setIsnExameSituacao(ExameSolicitacaoImpl.EXAME_SOLICITACAO_SITUACAO_PENDENTE);
			exameSolicitacaoPepBean.setDatCadastro(new Date());
			exameSolicitacaoPepBean.setDatSolicitacao(new Date());
			exameSolicitacaoPepBean.setIsnInternacao(paciente.getIsnInternacao());
			exameSolicitacaoPepBean.setNumProntuario(paciente.getNumProntuario());
			exameSolicitacaoPepBean.setIsnProfissional(jsfUtil.getUsuarioLogado().getIsnUsuario());
			exameSolicitacaoPepBean.setIsnUsuario(jsfUtil.getUsuarioLogado().getIsnUsuario());
			exameSolicitacaoPepBean.setFlgLaboratorio(laboratorioInterfaceamento.getVlrParametro());
			exameSolicitacaoPepBean.setPeso(peso);
			exameSolicitacaoPepBean.setAltura(altura);
			exameSolicitacaoPepBean.setFlgGestante(flgGestante);
			exameSolicitacaoPepBean.setDscMedicamentos(dscMedicamentos);

			InternacaoLeito internacaoLeito = new InternacaoLeitoFacadeImpl().buscaMaxInternacaoLeitoOcupado(isnInternacao);
			exameSolicitacaoPepBean.setDscEnfermaria(internacaoLeito.getLeito().getEnfermaria().getDscEnfermaria());
			exameSolicitacaoPepBean.setDscLeito(internacaoLeito.getLeito().getDscLeito());
			exameSolicitacaoPepBean.setDscClinica(internacaoLeito.getLeito().getEnfermaria().getClinica().getDscClinica());
			exameSolicitacaoPepBean.setIsnClinica(internacaoLeito.getLeito().getEnfermaria().getClinica().getIsnClinica());

			for (ExamePepBean examePepBean : getListExameSelecionado()) {
				examePepBean.setVemDaSepse(true);
			}
			
			if (laboratorioInterfaceamento.getVlrParametro().equals("S")) { // SIL
				ExameSolicitacaoImpl.getInstancia().inserirExameSolicitacao(exameSolicitacaoPepBean,this.getListExameSelecionado(), paciente,dicomInterfaceamento,true);
			}

			if (laboratorioInterfaceamento.getVlrParametro().equals("M")) { // MATRIX

				List<ExameSolicitacaoPepBean> lstExameSolicitacaoPepBeanTemp = ExameSolicitacaoImpl.getInstancia().inserirExameSolicitacaoMatrix(
													exameSolicitacaoPepBean,
													this.getListExameSelecionado(), paciente,
													dicomInterfaceamento, true);
				
				for (ExameSolicitacaoPepBean exameSolicitacaoInserir : lstExameSolicitacaoPepBeanTemp) {
					ExameSituacaoPepBean exameSituacaoPepBean = new ExameSituacaoPepBean();
					exameSituacaoPepBean.setIsnExameSituacao(exameSolicitacaoInserir.getIsnExameSituacao());
					exameSituacaoPepBean = ExameSituacaoImpl.getInstancia().get(exameSituacaoPepBean, 0);
					exameSolicitacaoInserir.setExameSituacaoPepBean(exameSituacaoPepBean);
					getLstExameSolicSepse().add(exameSolicitacaoInserir);
				}
				
			}

			this.setMensagemConfirmacao("A solicitação foi concluída com sucesso!");
		} catch (Exception e) {
			this.setMensagemConfirmacao(e.getMessage());
		}
	}
	
	public void prepararInserirExame(){
		protocoloSepse = new ProtocoloSepse();
		inserirExame();
	}
	
	public void inserirExame() {
		try {
			if (!ValidaPermissaoUsuario.getInstancia().verificaPermissao(
					"CD_ATENDIMENTOMEDICO", funcUtil.getAcaoGravar())) {
				this.setMensagemConfirmacao("Usuário sem permissão!");
				return;
			}

			if (laboratorioInterfaceamento.getVlrParametro().equals("M")) {
				for (ExamePepBean exame : listExameSelecionado) {
					if (exame.getFlgParametroMatrix() != null && exame.getFlgParametroMatrix().equals("S")) {
						if (peso.toString().isEmpty()|| peso.toString().equals("0.0")|| altura.toString().isEmpty()| altura.toString().equals("0.0")) {
							this.setMensagemConfirmacao("2"); // Os campos Peso
																// e Altura são
																// obrigatórios!
							return;
						}
						if ((paciente.getSglSexo().equals("F") && flgGestante
								.isEmpty())) {
							this.setMensagemConfirmacao("3"); // O campo
																// Gestante é
																// obrigatório!
							return;
						}
					}
				}
			}

			// GRAVANDO SOLICITAÇÃO DE EXAMES
			ExameSolicitacaoPepBean exameSolicitacaoPepBean = new ExameSolicitacaoPepBean();

			exameSolicitacaoPepBean.setIsnExameSituacao(ExameSolicitacaoImpl.EXAME_SOLICITACAO_SITUACAO_PENDENTE);
			exameSolicitacaoPepBean.setDatCadastro(new Date());
			exameSolicitacaoPepBean.setDatSolicitacao(new Date());
			exameSolicitacaoPepBean.setIsnInternacao(paciente.getIsnInternacao());
			exameSolicitacaoPepBean.setNumProntuario(paciente.getNumProntuario());
			exameSolicitacaoPepBean.setIsnProfissional(jsfUtil.getUsuarioLogado().getIsnUsuario());
			exameSolicitacaoPepBean.setIsnUsuario(jsfUtil.getUsuarioLogado().getIsnUsuario());
			exameSolicitacaoPepBean.setFlgLaboratorio(laboratorioInterfaceamento.getVlrParametro());
			exameSolicitacaoPepBean.setPeso(peso);
			exameSolicitacaoPepBean.setAltura(altura);
			exameSolicitacaoPepBean.setFlgGestante(flgGestante);
			exameSolicitacaoPepBean.setDscMedicamentos(dscMedicamentos);
			if (protocoloSepse != null && protocoloSepse.getIsnProtocoloSepse() != null && !protocoloSepse.getIsnProtocoloSepse().equals(0)){
				exameSolicitacaoPepBean.setIsnProtocoloSepse(protocoloSepse.getIsnProtocoloSepse());
			}

			InternacaoLeito internacaoLeito = new InternacaoLeitoFacadeImpl().buscaMaxInternacaoLeitoOcupado(isnInternacao);
			exameSolicitacaoPepBean.setDscEnfermaria(internacaoLeito.getLeito().getEnfermaria().getDscEnfermaria());
			exameSolicitacaoPepBean.setDscLeito(internacaoLeito.getLeito().getDscLeito());
			exameSolicitacaoPepBean.setDscClinica(internacaoLeito.getLeito().getEnfermaria().getClinica().getDscClinica());
			exameSolicitacaoPepBean.setIsnClinica(internacaoLeito.getLeito().getEnfermaria().getClinica().getIsnClinica());

			if (laboratorioInterfaceamento.getVlrParametro().equals("S")) { // SIL
				ExameSolicitacaoImpl.getInstancia().inserirExameSolicitacao(exameSolicitacaoPepBean,this.getListExameSelecionado(), paciente,dicomInterfaceamento,false);
			}

			if (laboratorioInterfaceamento.getVlrParametro().equals("M")) { // MATRIX

			List<ExameSolicitacaoPepBean> lstExameSolicitacaoPepBeanTemp = ExameSolicitacaoImpl.getInstancia().inserirExameSolicitacaoMatrix(
												exameSolicitacaoPepBean,
												this.getListExameSelecionado(), paciente,
												dicomInterfaceamento, false);
			
				// APENAS EXAMES DE LABORATORIO
				List<ExameSolicitacaoPepBean> lstExameSolicitacaoPepBean = new ArrayList<ExameSolicitacaoPepBean>();
				for (ExameSolicitacaoPepBean e : lstExameSolicitacaoPepBeanTemp) {
					if (e.getIsnExameGrupo() == GRUPO_LABORATORIO) {

						// P - PENDENTE | A - AUTORIZADO | N - NAO AUTORIZADO |
						// E - EXAME LIVRE PENDENTE ESPERA
						// ADICIONA NA LISTA, APENAS EXAMES NAO BLOQUEADOS E NAO
						// PENDENTES DE ESPERA
						if (e.getFlgAutorizacao().equals("") || e.getFlgAutorizacao().equals("A")) {
							lstExameSolicitacaoPepBean.add(e);
						}
						if (e.getFlgAutorizacao().equals("P") || e.getFlgAutorizacao().equals("E")) {
							lstExameSolicitacaoPepBean = new ArrayList<ExameSolicitacaoPepBean>();
							break;
						}

					}
				}

				if (lstExameSolicitacaoPepBean.size() > 0) {
					List<ExameSolicitacaoPepBean> lstExameSolicitacaoPepBeanWS = lstExameSolicitacaoPepBean;
					PacienteEmergencia pacienteWS = paciente;

					// GERAR XML
					WebServiceMatrix ws = new WebServiceMatrix();
					final String xml = ws.GerarXml(
							lstExameSolicitacaoPepBeanWS, pacienteWS, 1);

					// INCLUIR NA TEMP
					ExameSolicTempBean exameSolicTempBean = new ExameSolicTempBean();
					exameSolicTempBean
							.setIsnExameSolicAux(lstExameSolicitacaoPepBeanWS
									.get(0).getIsnExameSolicAux());
					exameSolicTempBean.setDatCadastro(new Date());
					exameSolicTempBean.setFlgTipoTransacao("I");
					exameSolicTempBean.setXml(xml);
					exameSolicTempBean.setTentativas(0);
					new ExameSolicTempFacadeImpl().inserir(exameSolicTempBean);

				}

			}

			this.setMensagemConfirmacao("A solicitação foi concluída com sucesso!");

			this.carregarExames();

		} catch (Exception e) {
			this.setMensagemConfirmacao(e.getMessage());
		}
	}

	
	public String visualizarExameRealizado() throws IOException{
			
		try {
			ExameSolicitacaoPepBean objexameSolicLaudo = new ExameSolicitacaoPepBean();
			objexameSolicLaudo.setIsnExameSolic(objExameSolicSemBaixaVO.getIsn_exame_solic());
			exameSolicLaudo = ExameSolicitacaoImpl.getInstancia().get(objexameSolicLaudo, 0);
			
		} catch (Exception e) {
			e.printStackTrace();
		}
		
		visualizarExame();
		
		HttpServletResponse response = (HttpServletResponse) FacesContext
				.getCurrentInstance().getExternalContext().getResponse();
		response.sendRedirect(urlReport);
		
		return null;
		
		
		
	}

	
	public String visualizarExame() {
		String retorno = "";
		if (exameSolicLaudo != null) {
			if (exameSolicLaudo.getFlgLaboratorio().equals("S")) { // SIL
				retorno = visualizarExameSIL();
			} else if (exameSolicLaudo.getFlgLaboratorio().equals("M")) { // MATRIX
				retorno = visualizarExameMATRIX();
			} else if (exameSolicLaudo.getFlgLaboratorio().equals("N")) { // ND
				retorno = visualizarExameND();
			}
		}
		return retorno;
	}

	/**
	 * Manutencao geracao arquivo MATRIX
	 * 
	 * @return
	 */
	@SuppressWarnings({ "deprecation" })
	public String visualizarExameMATRIX() {
		try {
			
			erro = false;
			
			String strDirUpa = codigoMatrixOrigem.getVlrParametro();
			WebServiceMatrix ws = new WebServiceMatrix();
			List<Integer> listInteger = new ArrayList<Integer>();
			listInteger.add(exameSolicLaudo.getIsnExameSolic());
			urlReport = ws.enviaLaudoUrl(strDirUpa, exameSolicLaudo.getIsnExameSolicAux(), listInteger);
			
			if (urlReport == null) {
				erro = true;
			}
			
		} catch (Exception e) {
			e.printStackTrace();
		}
		return null;
	}

	/**
	 * Manutencao geracao arquivo ND
	 * 
	 * @return
	 */
	public String visualizarExameND() {
		return "";
	}

	// manuntencao geracao arquivo SIL
	public String visualizarExameSIL() {

		try {
			String retorno = "";

			java.io.File diretorio = new java.io.File("/mnt/sil/"); // mapeamento
																	// criado
																	// pelo Alan
																	// para
																	// \\10.1.1.35\laudo_htm\
			// Alterar a linha abaixo pela linha acima para producao

			// 000949
			String exameSolic = getIsnExameSolicAux();
			for (int i = exameSolic.length(); i < 6; i++) {
				exameSolic = "0" + exameSolic;
			}

			java.io.File arquivo = new java.io.File(diretorio, exameSolic + "_"
					+ getDscMnemonicoSil().trim() + ".htm");
			System.out.println(arquivo.getName());
			if (arquivo.exists()) {
				setFilePath(arquivo.getPath());
			} else {
				arquivo = new java.io.File("/mnt/sil/teste/",
						"NAO_ENCONTRADO.htm");
				setFilePath("/mnt/sil/teste/NAO_ENCONTRADO.htm");
			}

			BufferedReader br = new BufferedReader(new FileReader(
					arquivo.getPath()));

			HttpServletRequest request = (HttpServletRequest) FacesContext
					.getCurrentInstance().getExternalContext().getRequest();
			@SuppressWarnings("deprecation")
			File caminhoTemp = new File(request.getRealPath("") + "/temp");
			@SuppressWarnings("static-access")
			File copia = arquivo.createTempFile("arquivoSIL", ".htm",
					caminhoTemp);

			FileWriter fw1 = new FileWriter(copia, true);
			BufferedWriter bw2 = new BufferedWriter(fw1);

			while (br.ready()) {
				bw2.write(br.readLine());
				bw2.newLine();
			}

			bw2.close();
			fw1.close();
			br.close();

			HttpServletResponse response = (HttpServletResponse) FacesContext
					.getCurrentInstance().getExternalContext().getResponse();
			response.sendRedirect(request.getContextPath() + File.separator
					+ "temp" + File.separator + copia.getName());
		} catch (Exception e) {
			e.printStackTrace();
		}
		return null;
	}

	public void enviarPedido(Integer isnExameSolicAux) {
		try {

			List<ExameSolicitacaoPepBean> listExameSolicitacaoPepBeanMatrix = new ArrayList<ExameSolicitacaoPepBean>();
			List<ExameSolicitacaoPepBean> listExameSolicitacaoPepBeanSil = new ArrayList<ExameSolicitacaoPepBean>();
			List<ExameSolicitacaoPepBean> listExameSolicitacaoPepBeanDicom = new ArrayList<ExameSolicitacaoPepBean>();

			ExameSolicitacaoPepBean ex = new ExameSolicitacaoPepBean();
			ex.setIsnExameSolicAux(isnExameSolicAux);
			ex.setIsnExameSituacao(1);

			List<ExameSolicitacaoPepBean> lstExameSolic = ExameSolicitacaoImpl
					.getInstancia().pesquisar(
							ex,
							ExameSolicitacaoImpl.JOIN_EXAME
									| ExameSolicitacaoImpl.JOIN_PACIENTE
									| ExameSolicitacaoImpl.JOIN_INTERNACAO
									| ExameSolicitacaoImpl.JOIN_PROFISSIONAL);

			// VERIFICAR SE O PEDIDO ESTÁ LIBERADO PARA ENVIO - MATRIX
			for (ExameSolicitacaoPepBean exame : lstExameSolic) {
				if (exame.getIsnExameGrupo().equals(3)
						&& exame.getFlgLaboratorio().equals("M")) {
					if (exame.getFlgAutorizacao().equals("P")) {
						listExameSolicitacaoPepBeanMatrix = new ArrayList<ExameSolicitacaoPepBean>();
						break;
					}
					if ((exame.getFlgAutorizacao().equals("E") || exame
							.getFlgAutorizacao().equals("A"))
							&& (exame.getCodPedidoMatrix() == null)) {
						listExameSolicitacaoPepBeanMatrix.add(exame);
					}

				}

			}

			// VERIFICAR SE O PEDIDO ESTÁ LIBERADO PARA ENVIO - DICOM
			for (ExameSolicitacaoPepBean exame : lstExameSolic) {
				if (exame.getIsnExameGrupo().equals(2)
						&& dicomInterfaceamento.equals("S")) {
					if (exame.getFlgAutorizacao().equals("P")) {
						listExameSolicitacaoPepBeanDicom = new ArrayList<ExameSolicitacaoPepBean>();
						break;
					}
					if (exame.getFlgAutorizacao().equals("E")
							|| exame.getFlgAutorizacao().equals("A")) {
						listExameSolicitacaoPepBeanDicom.add(exame);
					}

				}
			}

			// VERIFICAR SE O PEDIDO ESTÁ LIBERADO PARA ENVIO - SIL
			for (ExameSolicitacaoPepBean exame : lstExameSolic) {
				if (exame.getIsnExameGrupo().equals(3)
						&& exame.getFlgLaboratorio().equals("S")) {
					if (exame.getFlgAutorizacao().equals("P")) {
						listExameSolicitacaoPepBeanSil = new ArrayList<ExameSolicitacaoPepBean>();
						break;
					}
					if (exame.getFlgAutorizacao().equals("E")
							|| exame.getFlgAutorizacao().equals("A")) {
						listExameSolicitacaoPepBeanSil.add(exame);
					}

				}
			}

			// INTEGRAÇÃO MATRIX
			if (listExameSolicitacaoPepBeanMatrix.size() > 0) {

				// SETAR EXAMES COM FLG_AUTORIZACAO = E (EXAMES LIVRES PENDENTES
				// DE ENVIO) PARA VAZIO
				for (ExameSolicitacaoPepBean exame : listExameSolicitacaoPepBeanMatrix) {
					if (exame.getFlgAutorizacao().equals("E")) {
						exame.setFlgAutorizacao("");
						ExameSolicitacaoImpl.getInstancia().alterar(exame);
					}
				}

				Paciente pacienteWS = new Paciente();
				pacienteWS = new PacienteFacadeImpl()
						.buscaPaciente(listExameSolicitacaoPepBeanMatrix.get(0)
								.getInternacaoPepBean().getPacientePepBean()
								.getIsnPaciente());

				PacienteEmergencia pacienteEmergencia = new PacienteEmergencia();
				pacienteEmergencia.setNumProntuario(pacienteWS
						.getNumProntuario());
				pacienteEmergencia.setDscNome(pacienteWS.getDscNome());
				pacienteEmergencia
						.setSglSexo(pacienteWS.getSexo().getSglSexo());
				pacienteEmergencia.setDscMae(pacienteWS.getDscMae());
				pacienteEmergencia.setIsnPaciente(pacienteWS.getIsnPaciente());
				pacienteEmergencia.setDatNascimento(pacienteWS
						.getDatNascimento());

				// GERAR XML
				WebServiceMatrix ws = new WebServiceMatrix();
				final String xml = ws.GerarXml(
						listExameSolicitacaoPepBeanMatrix, pacienteEmergencia,
						1);

				// INCLUIR NA TEMP
				ExameSolicTempBean exameSolicTempBean = new ExameSolicTempBean();
				exameSolicTempBean
						.setIsnExameSolicAux(listExameSolicitacaoPepBeanMatrix
								.get(0).getIsnExameSolicAux());
				exameSolicTempBean.setDatCadastro(new Date());
				exameSolicTempBean.setFlgTipoTransacao("I");
				exameSolicTempBean.setXml(xml);
				exameSolicTempBean.setTentativas(0);
				new ExameSolicTempFacadeImpl().inserir(exameSolicTempBean);

			}

			// INTEGRAÇÃO DICOM
			if (listExameSolicitacaoPepBeanDicom.size() > 0) {

				// SETAR EXAMES COM FLG_AUTORIZACAO = E (EXAMES LIVRES PENDENTES
				// DE ENVIO) PARA VAZIO
				for (ExameSolicitacaoPepBean exame : listExameSolicitacaoPepBeanDicom) {
					if (exame.getFlgAutorizacao().equals("E")) {
						exame.setFlgAutorizacao("");
						ExameSolicitacaoImpl.getInstancia().alterar(exame);
					}
				}

				Paciente pacienteWS = new Paciente();
				pacienteWS = new PacienteFacadeImpl()
						.buscaPaciente(listExameSolicitacaoPepBeanDicom.get(0)
								.getInternacaoPepBean().getPacientePepBean()
								.getIsnPaciente());

				PacienteEmergencia pacienteEmergencia = new PacienteEmergencia();
				pacienteEmergencia.setNumProntuario(pacienteWS
						.getNumProntuario());
				pacienteEmergencia.setDscNome(pacienteWS.getDscNome());
				pacienteEmergencia
						.setSglSexo(pacienteWS.getSexo().getSglSexo());
				pacienteEmergencia.setDatNascimento(pacienteWS
						.getDatNascimento());

				for (ExameSolicitacaoPepBean exameS : listExameSolicitacaoPepBeanDicom) {
					DicomtixSincronizacao ds = new DicomtixSincronizacao();
					final String xml = ds.GerarXml(exameS, pacienteEmergencia);

					ExameSolicDicomTempBean exame = new ExameSolicDicomTempBean();
					exame.setDatCadastro(new Date());
					exame.setFlgTipoTransacao("I");
					exame.setIsnExameSolic(Integer.valueOf(exameS
							.getIsnExameSolic()));
					exame.setTentativas(0);
					exame.setXml(xml);
					new ExameSolicDicomTempImpl().inserir(exame);

					final ExameSolicDicomTempBean exameSolicDicomTempBeanWS = exame;

					new Thread() {
						@Override
						public void run() {
							DicomtixSincronizacao ds = new DicomtixSincronizacao();
							ds.enviarSolicitacao(exameSolicDicomTempBeanWS);

						}
					}.start();
				}

			}

			// INTEGRAÇÃO SIL
			if (listExameSolicitacaoPepBeanSil.size() > 0) {

				// SETAR EXAMES COM FLG_AUTORIZACAO = E (EXAMES LIVRES PENDENTES
				// DE ENVIO) PARA VAZIO
				for (ExameSolicitacaoPepBean exame : listExameSolicitacaoPepBeanSil) {
					if (exame.getFlgAutorizacao().equals("E")) {
						exame.setFlgAutorizacao("");
						ExameSolicitacaoImpl.getInstancia().alterar(exame);
					}
				}

				// SETAR TRANSIENT
				for (ExameSolicitacaoPepBean e : listExameSolicitacaoPepBeanSil) {
					InternacaoLeito internacaoLeito = new InternacaoLeitoFacadeImpl()
							.buscaMaxInternacaoLeitoOcupado(listExameSolicitacaoPepBeanSil
									.get(0).getIsnInternacao());
					if (internacaoLeito != null) {
						e.setDscEnfermaria(internacaoLeito.getLeito()
								.getEnfermaria().getDscEnfermaria());
						e.setDscLeito(internacaoLeito.getLeito().getDscLeito());
					} else {
						e.setDscEnfermaria("P.A.");
						e.setDscLeito("P.A.");
						e.setDscClinica("P.A.");
					}

				}

				Paciente pacienteWS = new Paciente();
				pacienteWS = new PacienteFacadeImpl()
						.buscaPaciente(listExameSolicitacaoPepBeanSil.get(0)
								.getInternacaoPepBean().getPacientePepBean()
								.getIsnPaciente());

				List<ExamePepBean> list = new ArrayList<ExamePepBean>();
				for (ExameSolicitacaoPepBean e : listExameSolicitacaoPepBeanSil) {
					if (e.getFlgUrgente().equals("S")) {
						e.getExamePepBean().setFlagUrgente(true);
					}
					list.add(e.getExamePepBean());
				}
				PacienteEmergencia pacienteEmergencia = new PacienteEmergencia();
				pacienteEmergencia.setNumProntuario(pacienteWS
						.getNumProntuario());
				pacienteEmergencia.setDscNome(pacienteWS.getDscNome());
				pacienteEmergencia.setDatNascimento(pacienteWS
						.getDatNascimento());
				pacienteEmergencia
						.setSglSexo(pacienteWS.getSexo().getSglSexo());
				pacienteEmergencia.setDscLeito(listExameSolicitacaoPepBeanSil
						.get(0).getDscLeito());

				ExameSolicitacaoImpl.getInstancia().gerarArquivoSIL(
						listExameSolicitacaoPepBeanSil.get(0), list,
						pacienteEmergencia, isnExameSolicAux);
			}

		} catch (Exception e) {
			e.printStackTrace();
		}
	}

	public void excluirExame() {
		try {
			if (this.getIsnExameSolic() != null
					&& !"".equals(this.getIsnExameSolic())) {
				if (!ValidaPermissaoUsuario.getInstancia().verificaPermissao(
						"CD_ATENDIMENTOMEDICO", funcUtil.getAcaoExcluir())) {
					this.setMensagem("Usuário sem permissão!");
					return;
				}

				ExameSolicitacaoPepBean exameSolicitacaoPepBean = new ExameSolicitacaoPepBean();
				exameSolicitacaoPepBean.setIsnExameSolic(this
						.getIsnExameSolic());

				ExameSolicitacaoImpl.getInstancia().excluirExame(
						exameSolicitacaoPepBean);
				
				if (!exameSolicPepBean.getFlgAutorizacao().equals("P")
						&& !exameSolicPepBean.getFlgAutorizacao().equals("N")
						&& !exameSolicPepBean.getFlgAutorizacao().equals("E")) {

					if (exameSolicPepBean.getExamePepBean().getIsnExameGrupo()
							.equals(2)) {
						try {
							if (dicomInterfaceamento.getVlrParametro().equals(
									"S")) {

								ExameSolicDicomTempBean exame = new ExameSolicDicomTempBean();
								exame.setDatCadastro(new Date());
								exame.setFlgTipoTransacao("E");
								exame.setIsnExameSolic(Integer
										.valueOf(exameSolicPepBean
												.getIsnExameSolic()));
								exame.setTentativas(0);
								new ExameSolicDicomTempImpl().inserir(exame);
								final ExameSolicDicomTempBean exameSolicDicomTempBeanWS = exame;

								new Thread() {
									@Override
									public void run() {

										DicomtixSincronizacao ds = new DicomtixSincronizacao();
										ds.excluirExame(exameSolicDicomTempBeanWS);
									}
								}.start();

							}
						} catch (Exception e) {
							e.printStackTrace();
						}
					}

					if (laboratorioInterfaceamento.getVlrParametro()
							.equals("M")) {
						if (exameSolicPepBean.getExamePepBean()
								.getIsnExameGrupo().equals(GRUPO_LABORATORIO)) {
							PacienteEmergencia pacienteWS = paciente;
							List<ExameSolicitacaoPepBean> lstExameSolicitacaoPepBeanWS = new ArrayList<ExameSolicitacaoPepBean>();
							lstExameSolicitacaoPepBeanWS.add(exameSolicPepBean);

							// GERAR XML
							WebServiceMatrix ws = new WebServiceMatrix();
							final String xml = ws
									.GerarXml(lstExameSolicitacaoPepBeanWS,
											pacienteWS, 2);

							// INCLUIR NA TEMP
							ExameSolicTempBean exameSolicTempBean = new ExameSolicTempBean();
							exameSolicTempBean
									.setIsnExameSolicAux(lstExameSolicitacaoPepBeanWS
											.get(0).getIsnExameSolicAux());
							exameSolicTempBean.setDatCadastro(new Date());
							exameSolicTempBean.setFlgTipoTransacao("E");
							exameSolicTempBean.setXml(xml);
							exameSolicTempBean.setTentativas(0);
							new ExameSolicTempFacadeImpl()
									.inserir(exameSolicTempBean);

						}

					}

				}

				this.setMensagemConfirmacao("O Exame foi cancelado com sucesso!");

				enviarPedido(exameSolicPepBean.getIsnExameSolicAux());

				this.carregarExames();

			} else {
				this.setMensagemConfirmacao("Erro ao excluir o exame!");
			}
		} catch (Exception e) {
			this.setMensagem(e.getMessage());
		}
	}

	private void excluirWorklist(String exameId) throws Exception {
		WorkListDao.getInstancia().excluir(exameId);
	}

	/**
	 * Metodo utilizado para "chamar" pacientes. Enfermeiros e médicos podem
	 * chamar pacientes (classificacao de risco ou atendimento). Se o usuário
	 * tiver nos 2 grupos (MEDICOS e ENFERMEIROS), o grupo de médicos tem
	 * prioridade em relação ao de enfermeiros
	 */
	public void chamar() {
		try {
			this.setMensagem(null);

			if (this.getPermissaoEnf().equals("S")
					|| this.getPermissaoMed().equals("S")) {
				if (this.getPermissaoMed().equals("S")) {
					ClassificacaoRiscoFacade crf = new ClassificacaoRiscoFacadeImpl();
					cr = crf.maximoClassificacaoRisco(getIsnInternacao());

					if (cr == null) {
						this.setMensagem("Enfermeira precisa avaliar o risco do paciente.");
						return;
					}
				}
				InternacaoChamadaPepBean internacaoChamada = new InternacaoChamadaPepBean();
				internacaoChamada.setDatChamada(new Date());
				internacaoChamada.setIsnProfissional(jsfUtil.getUsuarioLogado()
						.getIsnUsuario());
				internacaoChamada.setIsnInternacao(this.isnInternacao);
				internacaoChamada.setTpInternacaoChamada(this
						.getTipoInternacaoChamada());

				InternacaoChamadaImpl.getInstancia().inserir(internacaoChamada);

				this.atualizarListaEmergencia();
			}
		} catch (Exception e) {
			this.setMensagem(e.getMessage());
		}
	}

	public void liberarPaciente() throws Exception {
		if (!ValidaPermissaoUsuario.getInstancia().verificaPermissao(
				funcUtil.getAcaolLiberar())) {
			avisoLiberacaoPaciente = 2; // usuario sem permissao
			return;
		}

		// Avisa para o ws toLife que o paciente foi liberado/ realocado
		if (this.getUsarClassificacaoToLife()) { // se tolife estiver habilitado
			if (!new ConsumoToLifeWS()
					.registrarRealocacaoPaciente(pacienteOtimizado
							.getIsnInternacao())) {
				avisoLiberacaoPaciente = 3; // erro no emerges
				return;
			}
		}

		// Início - Atualizar Flg_Risco / Flg_Atendendo para alterar a cor para
		// preto
		InternacaoPepBean internacao = new InternacaoPepBean();
		internacao.setIsnPaciente(this.getPacienteOtimizado().getIsnPaciente());
		internacao.setIsnInternacao(this.getPacienteOtimizado().getIsnInternacao());
		InternacaoImpl.getInstancia().liberarPaciente(internacao);

		avisoLiberacaoPaciente = 1;
		// Fim - Atualizar Flg_Risco / Flg_Atendendo para alterar a cor para
		// preto
		return;
	}

	private Integer getTipoInternacaoChamada() {
		if (this.getPermissaoMed().equals("S")) {
			return 1;
		} else {
			if (this.getPermissaoEnf().equals("S")) {
				return 2;
			}
		}

		return null;
	}

	private void limparCampos() {
		this.setPrescricaoUpa(null);
		this.setDscPrescricao(null);
	}

	public void carregaGrupoCor(ActionEvent event) {
		dscCorGrupoDengue = "";
		if (cr.getIsnRiscoDengue() != null
				&& cr.getIsnRiscoDengue().intValue() > 0) {
			Risco r = new InternacaoFacadeImpl().getRisco(cr
					.getIsnRiscoDengue());
			if (r != null) {
				setDscCorGrupoDengue("Grupo: " + r.getDscGrupoDengue());
			}
		}
	}

	public void limparCorDengue(ActionEvent event) {
		// if(cr.getFlgDengue() != null
		// && cr.getFlgDengue().equalsIgnoreCase("N"))
		// {
		dscCorGrupoDengue = "";
		cr.setIsnRiscoDengue(0);
		// }
	}

	public String limparCampoAlta()
	{
		alta = false;
		isnMotivoAlta = EnumMotivosAlta.SELECIONE;
		return null;
	}
	public String getDscPrescricao() {
		return dscPrescricao;
	}

	public void setDscPrescricao(String dscPrescricao) {
		this.dscPrescricao = dscPrescricao;
	}

	public boolean isAlterObjItensPrescritos() {
		return alterObjItensPrescritos;
	}

	public void setAlterObjItensPrescritos(boolean alterObjItensPrescritos) {
		this.alterObjItensPrescritos = alterObjItensPrescritos;
	}

	public String getMensagemConfirmacao() {
		return mensagemConfirmacao;
	}

	public void setMensagemConfirmacao(String mensagemConfirmacao) {
		this.mensagemConfirmacao = mensagemConfirmacao;
	}

	public String getSuspender() {
		return suspender;
	}

	public void setSuspender(String suspender) {
		this.suspender = suspender;
	}

	public Integer getConfInserir() {
		return confInserir;
	}

	public void setConfInserir(Integer confInserir) {
		this.confInserir = confInserir;
	}

	public PacienteInternado getPacienteInternado() {
		return pacienteInternado;
	}

	public void setPacienteInternado(PacienteInternado pacienteInternado) {
		this.pacienteInternado = pacienteInternado;
	}

	public PrescricaoUpaBean getPrescricaoUpa() {
		return prescricaoUpa;
	}

	public void setPrescricaoUpa(PrescricaoUpaBean prescricaoUpa) {
		this.prescricaoUpa = prescricaoUpa;
	}

	public List<PrescricaoUpaBean> getListaPrescricaoUpa() {
		return listaPrescricaoUpa;
	}

	public void setListaPrescricaoUpa(List<PrescricaoUpaBean> listaPrescricaoUpa) {
		this.listaPrescricaoUpa = listaPrescricaoUpa;
	}

	public EnumMotivosAlta getIsnMotivoAlta() {
		return isnMotivoAlta;
	}

	public void setIsnMotivoAlta(EnumMotivosAlta isnMotivoAlta) {
		this.isnMotivoAlta = isnMotivoAlta;
	}

	public boolean getAltaOutroHospital() {
		return this.isnMotivoAlta == EnumMotivosAlta.OUTRO_HOSPITAL;
	}

	public void atualizarListaEmergencia() {
		// lstPacientesEmergencia = null;
		// atualizarListaPacientesEmergencia();
		atualizarListaPacientesRecepacao();
	}
	
	private EvolucaoSepse getUltimaEvolucaoSepse(Integer isnProtocoloSepse) throws Exception{
		EvolucaoSepse evolucaoSepse = new EvolucaoSepse();
		evolucaoSepse.setIsnProtocoloSepse(isnProtocoloSepse);
		final List<EvolucaoSepse> lst =  EvolucaoSepseImpl.getInstancia().pesquisar(evolucaoSepse, 0);
		return !lst.isEmpty() ? lst.get(0) : evolucaoSepse;
	}
	
	private Boolean verificarClassificacaoAtivo24h(Date datInicio, String horInicio) {
		if(datInicio == null || horInicio == null || horInicio.isEmpty())
			return false;
		Date dataInicioClassificacao = FuncUtil.adicionarHoraMinutoSegundoData(datInicio, horInicio + ":00");
		return (dataInicioClassificacao.getTime() + 86_400_000) >= new Date().getTime();
	}
	
	public Boolean exibeIconeSepse(Integer isnInternacao, String suspeitaInfeccaoClassificacao, Date datInicio, String horInicio) {
		ProtocoloSepse ultimoProtocoloSepse = ProtocoloSepseImpl.getInstancia().getUltimoProtocoloSepse(isnInternacao);
		if(ultimoProtocoloSepse == null) {
			return (suspeitaInfeccaoClassificacao == null || suspeitaInfeccaoClassificacao.equals("N") ? false : true) && verificarClassificacaoAtivo24h(datInicio, horInicio);
		} else {
			try {
				if( !ultimoProtocoloSepse.getSuspeitaInfeccao() ) {
					return false;
				} else {
					EvolucaoSepse ultimaEvolucaoSepse = getUltimaEvolucaoSepse(ultimoProtocoloSepse.getIsnProtocoloSepse());
					if ( ultimoProtocoloSepse.getAtivo24h() &&
					ultimaEvolucaoSepse != null &&
					(ultimaEvolucaoSepse.getFlgRetiraSepse() == null || !ultimaEvolucaoSepse.getFlgRetiraSepse()) ) {
						return true;
					}
				}
			} catch(Exception e) {
				e.printStackTrace();
				return false;
			}
			return false;
		}
	}

	public void atualizarListaPacientesRecepacao() {
		try {
			listaPacientesRecepcao = null;
			totaisRisco[0] = 0;
			totaisRisco[1] = 0;
			totaisRisco[2] = 0;
			totaisRisco[3] = 0;
			totaisRisco[4] = 0;
			totaisRisco[5] = 0;
			totaisRisco[6] = 0;
			totaisRisco[7] = 0;
			
			PacEmerOtmTemp pacEmerOtmTemp = new PacEmerOtmTemp();
			pacEmerOtmTemp.setFlgRecepcao("S");
			pacEmerOtmTemp.setIsnLeito(56);
			List<PacEmerOtmTemp> listaTemp = PacEmerOtmTempImpl.getInstancia().pesquisar(pacEmerOtmTemp, 0);
			listaPacientesRecepcao = new ArrayList<PacienteEmergenciaOtimizadoBean>();
			for (PacEmerOtmTemp pacEmerOtmTemp2 : listaTemp) {
				listaPacientesRecepcao.add(new PacienteEmergenciaOtimizadoBean(pacEmerOtmTemp2.getIsnInternacao(), pacEmerOtmTemp2.getFlgRecepcao(), pacEmerOtmTemp2.getIsnPaciente(),
						pacEmerOtmTemp2.getDscNome(), pacEmerOtmTemp2.getDatCadastro(), pacEmerOtmTemp2.getHorChegada(), pacEmerOtmTemp2.getDatRegistro(), pacEmerOtmTemp2.getHorRegistro(),
						pacEmerOtmTemp2.getDatNascimento(), pacEmerOtmTemp2.getIsnRisco(), pacEmerOtmTemp2.getDatInicioClassificacao(), pacEmerOtmTemp2.getHorInicioClassificacao(),
						pacEmerOtmTemp2.getDscFluxograma(), pacEmerOtmTemp2.getDscQueixa(), pacEmerOtmTemp2.getDscEspecialidadeEmergencia(), pacEmerOtmTemp2.getFlgAtendendo(),
						pacEmerOtmTemp2.getFlgRisco(), pacEmerOtmTemp2.getNomProfAtend(), pacEmerOtmTemp2.getQtdChamada(), pacEmerOtmTemp2.getIsnProfissionalAtendimento(),
						pacEmerOtmTemp2.getIsnInternacaoAtendimento(), pacEmerOtmTemp2.getIsnEspecialidadeEmergencia(), pacEmerOtmTemp2.getFlgRiscoQueda(),
						pacEmerOtmTemp2.getFlgAlergia(), pacEmerOtmTemp2.getFlgDocFoto(), pacEmerOtmTemp2.getIsnInternacaoLeito(), pacEmerOtmTemp2.getIsnLeito(), pacEmerOtmTemp2.getNumProntuario(),
						pacEmerOtmTemp2.getIsnClinica(), pacEmerOtmTemp2.getSglSexo(), pacEmerOtmTemp2.getDscLeito(), pacEmerOtmTemp2.getDscMae(), pacEmerOtmTemp2.getDscDiscriminador(),
						pacEmerOtmTemp2.getDscSato2(), pacEmerOtmTemp2.getDscGlassgow(), pacEmerOtmTemp2.getDscTemperatura(), pacEmerOtmTemp2.getDscGlicemia(), pacEmerOtmTemp2.getDscReguaDor(),
						pacEmerOtmTemp2.getDscFc(), pacEmerOtmTemp2.getFlgDengue(), pacEmerOtmTemp2.getDatSintomaDengue(), pacEmerOtmTemp2.getFlgSuspeitaInfeccao(), pacEmerOtmTemp2.getCodTela1(),
						exibeIconeSepse(pacEmerOtmTemp2.getIsnInternacao(), pacEmerOtmTemp2.getFlgSuspeitaInfeccao(), pacEmerOtmTemp2.getDatInicioClassificacao(), pacEmerOtmTemp2.getHorInicioClassificacao())));
			}
			
			/*PacienteEmergenciaOtimizadoBean vo = new PacienteEmergenciaOtimizadoBean();
			vo.setFlgRecepcao("S");
			vo.setIsnLeito(56);
			listaPacientesRecepcao = PacienteEmergenciaOtimizadoImpl.getInstancia().pesquisar(vo, 0);
			*/

			if (listaPacientesRecepcao != null) {
				for (PacienteEmergenciaOtimizadoBean pe : listaPacientesRecepcao) {

					if (pe.getIsnRisco() != null) {
						switch (pe.getIsnRisco()) {
						case 1:
							totaisRisco[0]++;
							break;
						case 2:
							totaisRisco[1]++;
							break;
						case 3:
							totaisRisco[2]++;
							break;
						case 4:
							totaisRisco[3]++;
							break;
						case 5:
							totaisRisco[4]++;
							break;
						case 6:
							totaisRisco[5]++;
							break;
						case 7:
							totaisRisco[7]++;
							break;
						default:
							totaisRisco[6]++;
						}

					} else {
						pe.setIsnRisco(0);
						totaisRisco[6]++;
					}
				}
			}
			else {
				listaPacientesRecepcao = new ArrayList<PacienteEmergenciaOtimizadoBean>();
			}
			
			Collections.sort(listaPacientesRecepcao, new Comparator<Object>() {
				
	    		public int compare(Object obj1, Object obj2) {
	    			PacienteEmergenciaOtimizadoBean pe1 = (PacienteEmergenciaOtimizadoBean) obj1;
	    			PacienteEmergenciaOtimizadoBean pe2 = (PacienteEmergenciaOtimizadoBean) obj2;
	    			
	    			// COMPARAR
	    			int comparacaoRisco = compararRisco(pe1.getIsnRisco(), pe2.getIsnRisco());
	    			int comparacaoIdade = compararIdade(pe1.getDatNascimento(), pe2.getDatNascimento());
	    			int comparacaoChegada = compararChegada(pe1.getDatCadastro(), pe1.getHorChegada(), pe2.getDatCadastro(), pe2.getHorChegada());
	    			
	    			if (comparacaoRisco == 0)
	    				if (comparacaoIdade == 0)
	    					return comparacaoChegada;
	    				else
	    					return comparacaoIdade;
	    			else
	    				return comparacaoRisco;
	    		}
	    		
	    		public boolean compararObjetosNulos(Object o1, Object o2) {
	    			return (o1 == null && o2 == null);
	    		}
	    		
	    		public int compararRisco(Integer r1, Integer r2) 
	    		{
	    			if (compararObjetosNulos(r1, r2) == true)
	    				return 0;
	    			else
	    				if (r1 != null && r2 != null)
	    					if (r1 > 0 && r2 > 0)
	    						return r1.compareTo(r2);
	    					else if (r1 == 0 && r2 == 0)
	    						return 0;
    						else
	    						return (r1 == 0) ? 1 : -1;
	    				else
	    					return (r1 == null) ? 1 : -1;
	    		}
	    		
	    		public int compararIdade(Date dn1, Date dn2)
	    		{
	    			if (compararObjetosNulos(dn1, dn2))
	    				return 0;
	    			else
	    			{
	    				if (dn1 != null && dn2 != null)
	    				{
	    					// >= 60 ANOS
	    					FuncUtil funcUtil = new FuncUtil();
	    					Integer idade01 = funcUtil.calcularIdade(dn1);
	    					Integer idade02 = funcUtil.calcularIdade(dn2);
	    					
	    					if (idade01.intValue() >= 60 && idade02.intValue() >= 60)
	    						return 0;
	    					else if (idade01.intValue() >= 60)
	    						return -1;
	    					else if (idade02.intValue() >= 60)
	    						return 1;
	    					else
	    						return 0;	    						
	    				}
	    				else 
	    					return (dn1 == null) ? 1 : -1;
	    			}
	    		}
	    		
	    		public int compararChegada(Date d01, String h01, Date d02, String h02) {
	    			
	    			if (compararObjetosNulos(d01, d02))
	    				return 0;
	    			else
	    				if (d01 != null && d02 != null)
	    				{
	    					if (compararObjetosNulos(h01, h02))
	    						return 0;
	    					else 
	    						if (h01 != null && h02 != null)
	    						{
	    							SimpleDateFormat sdfData = new SimpleDateFormat("dd/MM/yyyy");
	    							SimpleDateFormat sdfDataHora = new SimpleDateFormat("dd/MM/yyyy HH:mm");
	    							
	    							try 
	    							{
										Date dh01 = sdfDataHora.parse(sdfData.format(d01).concat(" ").concat(h01));
										Date dh02 = sdfDataHora.parse(sdfData.format(d02).concat(" ").concat(h02));
										
										return dh01.compareTo(dh02);
									} 
	    							catch (ParseException e) 
	    							{
	    								return -1;
									}
	    						}
	    						else
	    							return h01 == null ? 1 : -1;
	    				}
	    				else
	    					return (d01 == null)  ? 1 : -1;
	    		}
	    	});
			
			
			totalEmergencia = totaisRisco[0] + totaisRisco[1] + totaisRisco[2]
					+ totaisRisco[3] + totaisRisco[4] + totaisRisco[5]
					+ totaisRisco[6] + totaisRisco[7];
			
			

		} catch (Exception e) {
			e.printStackTrace();
			if (listaPacientesRecepcao == null)
				listaPacientesRecepcao = new ArrayList<PacienteEmergenciaOtimizadoBean>();
		}
	}
	
	public void atualizarListaPacientesEmergencia() {
		totaisRisco[0] = 0;
		totaisRisco[1] = 0;
		totaisRisco[2] = 0;
		totaisRisco[3] = 0;
		totaisRisco[4] = 0;
		totaisRisco[5] = 0;
		totaisRisco[6] = 0;
		totaisRisco[7] = 0;

		lstPacientesEmergencia = new PacienteFacadeImpl().listarEmergencia("",
				0);
		for (PacienteEmergencia pe : lstPacientesEmergencia) {
			if (pe.getIsnRisco() != null) {
				switch (pe.getIsnRisco()) {
				case 1:
					totaisRisco[0]++;
					break;
				case 2:
					totaisRisco[1]++;
					break;
				case 3:
					totaisRisco[2]++;
					break;
				case 4:
					totaisRisco[3]++;
					break;
				case 5:
					totaisRisco[4]++;
					break;
				case 6:
					totaisRisco[5]++;
					break;
				case 7:
					totaisRisco[7]++;
					break;
				default:
					totaisRisco[6]++;
				}
			} else {
				pe.setIsnRisco(0);
				totaisRisco[6]++;
			}

		}
		totalEmergencia = totaisRisco[0] + totaisRisco[1] + totaisRisco[2]
				+ totaisRisco[3] + totaisRisco[4] + totaisRisco[5]
				+ totaisRisco[6] + totaisRisco[7];
	}

	public boolean retornaSeContemIndiceInformadoNaLista(List<String> listInt, String indice){
		for (String indiceAdd : listInt) {
			if (indiceAdd.equals(indice))
				return true;
		}
		return false;
	}
	
	public boolean abrePopupSepse() throws Exception {
		this.protocoloSepse = new ProtocoloSepse();
		this.lstExameSolicSepse = new ArrayList<ExameSolicitacaoPepBean>();
		boolean permisaoPanel = false;
		this.nomePanel = "";

		this.protocoloSepse = getUltimoProtocolo();
		final boolean protocoloNaoCriadoEsepseSinalizada = isProtocoloNaoCriadoSepseSinalizadaNaClassificacao(protocoloSepse);

		if (protocoloNaoCriadoEsepseSinalizada)
		{
			buscarSinaisSirsAdicionadosNaClassificacaoDeRisco();
			carregarEtapasDoPanelProtocoloSepse();
			this.nomePanel = "panelInfeccao";
			permisaoPanel = true;
			return permisaoPanel;
		}
		
		final boolean protocoloCriadoSepseConfirmadoPorMedico = isProtocoloCriadoSepseSinalizada(protocoloSepse);
		
		if (protocoloCriadoSepseConfirmadoPorMedico) {
			if (isUsuarioLogadoMedico() && !isEvolucaoFinalizada() && isAcessoEvolucaoNoTempoAbaixoDe24Horas()) {
				this.nomePanel = "panelAcompSepse";
				permisaoPanel = true;
			}
		}

		return permisaoPanel;
		/*if(lista != null){
			protocoloSepse = lista.get(0);
			if(protocoloSepse == null){
				if(cr.getFlgSuspeitaInfeccao().equals("S")){
					buscarSinaisSirsAdicionadosNaClassificacaoDeRisco();
					carregarEtapasDoPanelProtocoloSepse();
					return true;
				}
			}
		}*/
		//p = ((lista == null || lista.size() <= 0)?null:lista.get(0));
		
		
		
		/*if (p != null && p.getIsnProtocoloSepse() != null && !p.getIsnProtocoloSepse().equals(0)){
			return false;
		}
		
		if (cr.getFlgSuspeitaInfeccao() == null || cr.getFlgSuspeitaInfeccao().trim().equals("") || cr.getFlgSuspeitaInfeccao().equals("N")){
			return false;
		}*/
		
		
		//List<String> list = converterStringParaListString(cr.getCodTela1());
		
		/*if (list.size() <= 0){
			return false;
		}else if (retornaSeContemIndiceInformadoNaLista(list, "7")){
			return false;
		}else if (list.size() > 1){
			return true;
		}*/
		
	}
	
	
	private boolean isProtocoloCriadoSepseSinalizada(final ProtocoloSepse prot) throws Exception {
		return (prot != null && prot.getSuspeitaInfeccao() != null && prot.getSuspeitaInfeccao());
	}
	
	private boolean isEvolucaoFinalizada() throws Exception{
		final EvolucaoSepse evolucaoSepse = getUltimaEvolucaoSepse();
		return evolucaoSepse.getFlgFinalizado() != null && evolucaoSepse.getFlgFinalizado();
	}
	
	private boolean isAcessoEvolucaoNoTempoAbaixoDe24Horas() throws Exception
	{
		final int tempoSepseEntreDataAtual = getTempoSepseEntreDataAtual();
		if ((tempoSepseEntreDataAtual > 10800 && tempoSepseEntreDataAtual < 21600))
		{
			if (retornarSeTemEvolucaoDeAcordoComOTempo(MAIOR_3_MENOR_6) == false)
				return true;
		}
		if (tempoSepseEntreDataAtual >= 21600 && tempoSepseEntreDataAtual < 43200) 
		{
			if (retornarSeTemEvolucaoDeAcordoComOTempo(MAIOR_6_MENOR_12) == false)
				return true;
		}
		if (tempoSepseEntreDataAtual >= 43200 && tempoSepseEntreDataAtual < 79200)
		{
			if (retornarSeTemEvolucaoDeAcordoComOTempo(MAIOR_12_MENOR_22) == false)
				return true;
		}
		if (tempoSepseEntreDataAtual >= 79200 && tempoSepseEntreDataAtual < 86400)
		{
			if (retornarSeTemEvolucaoDeAcordoComOTempo(MAIOR_22) == false)
				return true;
		}
		if (tempoSepseEntreDataAtual >= 86400){
			if (retornarSeTemEvolucaoDeAcordoComOTempo(null) == false)
				return true;
			else
				return false;
		}
		return false;
	}
	
	private boolean retornarSeTemEvolucaoDeAcordoComOTempo(Integer codTempo) throws Exception{
		if (protocoloSepse.getIsnProtocoloSepse() == null || protocoloSepse.getIsnProtocoloSepse().equals(0)){
			return false;
		}
		EvolucaoSepse evolucaoSepse = new EvolucaoSepse();
		evolucaoSepse.setIsnProtocoloSepse(protocoloSepse.getIsnProtocoloSepse());
		evolucaoSepse.setCodTempoSepse(codTempo);
		List<EvolucaoSepse> list = EvolucaoSepseImpl.getInstancia().pesquisar(evolucaoSepse, 0);
		return (list != null && list.size() > 0);
	}
	
	private int getTempoSepseEntreDataAtual() 
	{
		if (protocoloSepse != null && protocoloSepse.getDatCadastro() != null)
		{
			return getSegundosEntreDataAtual(protocoloSepse.getDatCadastro());
		}
		return 0;
	}
	
	private int getTempoSepseEntreDataEvoluvao() throws Exception 
	{
		final EvolucaoSepse evolucaoSepse = getUltimaEvolucaoSepse();
		if (evolucaoSepse != null && evolucaoSepse.getDatCadastro() != null)
		{
			return getSegundosEntreDatas(evolucaoSepse.getDatCadastro(), protocoloSepse.getDatCadastro());
		}
		return 0;
	}

	private EvolucaoSepse getUltimaEvolucaoSepse() throws Exception{
		EvolucaoSepse evolucaoSepse = new EvolucaoSepse();
		evolucaoSepse.setIsnProtocoloSepse(protocoloSepse.getIsnProtocoloSepse());
		final List<EvolucaoSepse> lst =  EvolucaoSepseImpl.getInstancia().pesquisar(evolucaoSepse, 0);
		return !lst.isEmpty() ? lst.get(0) : evolucaoSepse;
	}
	
	private int getSegundosEntreDataAtual(Date date) {
		long diferenca = (new Date().getTime() - date.getTime());
		int segundos = (int) (diferenca / (1000));
		return segundos;
	}
	
	private int getSegundosEntreDatas(Date dat1 , Date dat2) {
		long diferenca = (dat1.getTime() - dat2.getTime());
		int segundos = (int) (diferenca / (1000));
		return segundos;
	}
	
	private boolean isProtocoloNaoCriadoSepseSinalizadaNaClassificacao(final ProtocoloSepse protocoloSepse) throws Exception {
		return (protocoloSepse.getIsnProtocoloSepse() == null && cr.getFlgSuspeitaInfeccao().equals("S")) ? true : false;
	}
	
	private ProtocoloSepse getUltimoProtocolo() throws Exception {
		ProtocoloSepse protocolo = new ProtocoloSepse();
		protocolo.setIsnInternacao(pacienteOtimizado.getIsnInternacao());
		final List<ProtocoloSepse> lista = ProtocoloSepseImpl.getInstancia().pesquisar(protocolo, 0);
		return !lista.isEmpty() ? lista.get(0) :  new ProtocoloSepse();
	}
	
	public void salvarEvolucaoSepse() throws Exception
	{
		this.mensagem = "";

		if (usuario == null || "".equalsIgnoreCase(usuario.trim())) {
			this.setMensagem("Conselho é obrigatório!");
			return;
		}
		if (senha == null || "".equalsIgnoreCase(senha.trim())) {
			this.setMensagem("Senha é obrigatório!");
			return;			
		}
		
		Usuario usuarioDg = new Usuario();
		String senhaEnpritpt = IsghEncodeDecode.encrypt(senha.toUpperCase());
		usuarioDg.setDscLogin(usuario.toUpperCase());
		usuarioDg.setDscSenha(senhaEnpritpt);
		usuarioDg = (Usuario) UsuarioImpl.getInstancia().get(usuarioDg,
				UsuarioImpl.JOIN_USUARIO_GRUPO | UsuarioImpl.JOIN_USUARIOGRUPO_GRUPO, Criteria.DISTINCT_ROOT_ENTITY);

		if (usuarioDg == null) {
			this.setMensagem("Usuário/senha inválidos!");
			return;	
		}
		
		if (!ValidaPermissaoUsuario.getInstancia().verificaPermissao(usuarioDg, funcUtil.getAcaoAtender())) {
			this.setMensagem("Usuário sem permissão para essa ação!");
			return;	
		}

		try {
			if (retornaCountEvolucao()) {
				this.setMensagem("ATUALIZE");
				return;
			}
			
			if (isCamposVazios())
			{
				this.mensagem = "Campos obrigatórios precisam ser informados!";
				return;
			}
			boolean retira = verificarSeRetiraSepse();
			boolean finalizado = verificarSeAlgumSinalFinalizouEvolucao();
			evolucaoSepse.setFlgFinalizado(finalizado);
			evolucaoSepse.setFlgRetiraSepse(retira);
			evolucaoSepse.setDatCadastro(new Date());
			evolucaoSepse.setIsnProtocoloSepse(protocoloSepse.getIsnProtocoloSepse());
			evolucaoSepse.setIsnUsuario(usuarioDg.getIsnUsuario());
			int tempo = getSegundosEntreDataAtual(protocoloSepse.getDatCadastro());
			
			if ((tempo > 10800 && tempo < 21600))
			{
				evolucaoSepse.setCodTempoSepse(MAIOR_3_MENOR_6);
			}
			if (tempo >= 21600 && tempo < 43200) 
			{
				evolucaoSepse.setCodTempoSepse(MAIOR_6_MENOR_12);
			}
			if (tempo >= 43200  && tempo < 79200)
			{
				evolucaoSepse.setCodTempoSepse(MAIOR_12_MENOR_22);
			}
			if (tempo >= 79200)
			{
				evolucaoSepse.setCodTempoSepse(MAIOR_22);
			}

			/*if(evolucaoSepse.getFlgRetiraSepse()){
				atualizarSinalInfeccaoRecepcao(protocoloSepse.getIsnInternacao(), "N");
			}*/
			EvolucaoSepseImpl.getInstancia().salvarEvolucao(evolucaoSepse,protocoloSepse);

		} catch (Exception e) {
			e.printStackTrace();
		}
	}
	
	private boolean verificarSeAlgumSinalFinalizouEvolucao() {

		for (EvolucaoSepseSinais ev : this.evolucaoSepseSinais) {
			if (this.evolucaoSepse.getIsnEvolucaoSepseSinais().equals(ev.getIsnEvolucaoSepseSinais())) {
				if (ev.getFlgConclusao()) {
					return true;
				}
			}
		}
		return false;
	}
	
	private boolean verificarSeRetiraSepse() {

		for (EvolucaoSepseSinais ev : this.evolucaoSepseSinais) {
			if (this.evolucaoSepse.getIsnEvolucaoSepseSinais().equals(ev.getIsnEvolucaoSepseSinais())) {
				if (ev.getFlgRetirarSepse()) {
					return true;
				}
			}
		}
		return false;
	}

	private boolean isCamposVazios() {
		final List<Object> lst = getCampos();

		for (Object object : lst)
		{
			if (object.equals("") || object.equals(0)) {
				return true;
			}
		}
		return false;
	}
	
	private List<Object> getCampos()
	{
		final List<Object> lst = new ArrayList<>();
		lst.add(evolucaoSepse.getDscEvolucaoSepse());
		lst.add(evolucaoSepse.getDscFc());
		lst.add(evolucaoSepse.getDscFr());
		lst.add(evolucaoSepse.getDscPa());
		lst.add(evolucaoSepse.getDscPaFinal());
		lst.add(evolucaoSepse.getDscSpo2());
		lst.add(evolucaoSepse.getDscTemp());
		lst.add(evolucaoSepse.getIsnEvolucaoSepseSinais());
		return lst;
	}
	
	private void buscarSinaisSirsAdicionadosNaClassificacaoDeRisco() throws Exception {
		if (this.cr != null) {
			final SinaisSirsRisco sinaisSirsRisco = new SinaisSirsRisco();
			sinaisSirsRisco.setIsnInternacaoRisco(cr.getIsnInternacaoRisco());
			this.lstSinaisSirsRisco = SinaisSirsRiscoImpl.getInstancia().pesquisar(sinaisSirsRisco, 0);
		}
	}
	
	private void carregarEtapasDoPanelProtocoloSepse() throws Exception {
		this.lstProtocoloSepseSinais = ProtocoloSepseSinaisImpl.getInstancia().pesquisar(new ProtocoloSepseSinais(), 0);
		iniciarMapProtocoloSepseSinais();
		adicionarProtocoloSepseSinaisResp();
		verificarStatusEtapa(null);
		buscarFocoSepse();
		isnFocoSepse = 1;
		buscarMedicacoesPorFoco();
		buscarVolumesDaSepse();
		setIsnFocoPrescricaoSepse(0);
		this.sliTipoFoco = new ArrayList<>();
		resetTipoFoco();
	}
	
	private void buscarFocoSepse() throws Exception{
		final List<FocoSepse> lstFocoSepse = FocoSepseImpl.getInstancia().pesquisar(new FocoSepse(), 0);
		sliFocoSepse = new ArrayList<SelectItem>();
		for (FocoSepse p : lstFocoSepse) {
			sliFocoSepse.add(new SelectItem(p.getIsnFocoSepse(), p.getDscFocoSepse()));
		}
	}
	
	public void buscarMedicacoesPorFoco() throws Exception{
		setIsnFocoPrescricaoSepse(0);
		this.sliTipoFoco = new ArrayList<>();
		resetTipoFoco();
		
		final List<FocoPrescricaoSepse> lstFocoPrescricao = FocoPrescricaoSepseImpl.getInstancia().pesquisar(new FocoPrescricaoSepse(true, isnFocoSepse), 0);
		sliFocoPrescricaoSepse = new ArrayList<SelectItem>();
		sliFocoPrescricaoSepse.add(new SelectItem(null,"-- Selecione Foco --"));
		for (FocoPrescricaoSepse p : lstFocoPrescricao) {
			sliFocoPrescricaoSepse.add(new SelectItem(p.getIsnFocoPrescricaoSepse(), p.getDscFocoPrescricaoSepse()));
		}
	}
	
	private void buscarVolumesDaSepse() throws Exception{
		final List<VolumePrescricaoSepse> lstVolumeSepse = VolumePrescricaoSepseImpl.getInstancia().pesquisar(new VolumePrescricaoSepse(true), 0);
		sliVolumeSepse = new ArrayList<SelectItem>();
		sliVolumeSepse.add(new SelectItem(null,"-- Selecione Opção --"));
		for (VolumePrescricaoSepse v : lstVolumeSepse) {
			sliVolumeSepse.add(new SelectItem(v.getIsnVolumePrescricaoSepse(), v.getDscVolumePrescricaoSepse()));
		}
		
		
	}
	
	public void selectFoco(ActionEvent event) {
		try {
			final FocoPrescricaoSepse foSepse = new FocoPrescricaoSepse();
			foSepse.setIsnFocoPrescricaoSepse(isnFocoPrescricaoSepse);
			foSepse.setFlgAtivo(true);
			lstFocoPrescricaoSepse = FocoPrescricaoSepseImpl.getInstancia().pesquisar(foSepse,
					FocoPrescricaoSepseImpl.JOIN_TIPO_FOCO | FocoPrescricaoSepseImpl.JOIN_ITEM_PRESRICAO);
			
			this.sliTipoFoco = new ArrayList<>();
			resetTipoFoco();
			
			sliTipoFoco.add(new SelectItem(null, "--Selecione--"));
			for (FocoPrescricaoSepse focoPrescricaoSepse : lstFocoPrescricaoSepse) {
				for (TipoFoco foco : focoPrescricaoSepse.getLstTipoFoco()) {
					if(foco.getDscTipoFoco().isEmpty()){
						isnTipoFoco = foco.getIsnTipoFoco();
						selectTipoFoco(null);
						break;
					}
					sliTipoFoco.add(new SelectItem(foco.getIsnTipoFoco(), foco.getDscTipoFoco()));
				}
			}
		} catch (Exception e) {
			e.printStackTrace();
		}
	}
	
	public void selectSubFoco(ActionEvent event) {
		try {
			final FocoPrescricaoSepse foSepse = new FocoPrescricaoSepse();
			foSepse.setIsnFocoPrescricaoSepse(6);
			lstSubFocoPrescricaoSepse = FocoPrescricaoSepseImpl.getInstancia().pesquisar(foSepse,
					FocoPrescricaoSepseImpl.JOIN_TIPO_FOCO | FocoPrescricaoSepseImpl.JOIN_ITEM_PRESRICAO);
			
			this.sliSubTipoFoco = new ArrayList<>();
			resetTipoFoco();
			
			sliSubTipoFoco.add(new SelectItem(null, "--Selecione--"));
			for (FocoPrescricaoSepse focoPrescricaoSepse : lstSubFocoPrescricaoSepse) {
				List<TipoFoco> listFoco = new ArrayList<TipoFoco>();
				listFoco.addAll(focoPrescricaoSepse.getLstTipoFoco());
				ordenarListaFoco(listFoco);
				
				for (TipoFoco foco : listFoco) {
					if(foco.getDscTipoFoco().isEmpty()){
						isnSubTipoFoco = foco.getIsnTipoFoco();
						selectSubTipoFoco(null);
						break;
					}
					sliSubTipoFoco.add(new SelectItem(foco.getIsnTipoFoco(), foco.getDscTipoFoco()));
				}
			}
		} catch (Exception e) {
			e.printStackTrace();
		}
	}
	
	public void ordenarListaFoco(List<TipoFoco> lstTipoFoco){
		Collections.sort(lstTipoFoco, new Comparator<Object>() {
			public int compare(Object obj1, Object obj2) {
				TipoFoco u1 = (TipoFoco) obj1;
				TipoFoco u2 = (TipoFoco) obj2;
				return u1.getIsnTipoFoco().compareTo(
						u2.getIsnTipoFoco());
			}
		});
	}
	
	public void selectTipoFoco(ActionEvent event) {
		resetTipoFoco();
		try {
			if (isnTipoFoco.equals(11)){
				selectSubFoco(event);
			}else{
				for(FocoPrescricaoSepse foco : lstFocoPrescricaoSepse) {
					for (TipoFoco tipoFoco : foco.getLstTipoFoco()) {
						if(tipoFoco.getIsnTipoFoco().equals(isnTipoFoco)){
							sliMedicamentosAgrupados = agruparProdutos(new ArrayList<>(tipoFoco.getLstPresricaoItemSepse()));
						}
					}
				}
			}
		} catch (Exception e) {
			e.printStackTrace();
		}
	}
	
	public void selectSubTipoFoco(ActionEvent event) {
		resetTipoFoco();
		try {
			for(FocoPrescricaoSepse foco : lstSubFocoPrescricaoSepse) {
				for (TipoFoco tipoFoco : foco.getLstTipoFoco()) {
					if(tipoFoco.getIsnTipoFoco().equals(isnSubTipoFoco)){
						sliMedicamentosAgrupados = agruparProdutos(new ArrayList<>(tipoFoco.getLstPresricaoItemSepse()));
					}
				}
			}
		} catch (Exception e) {
			e.printStackTrace();
		}
	}
	
	private void resetTipoFoco(){
		this.sliMedicamentosAgrupados = new ArrayList<>();
		this.indexList = null;
	}
	
	public void selectMedicamentos(ActionEvent event) {

		if (this.indexList != null) {
			this.listPrescricoes = new ArrayList<>();
			this.listPrescricoes = this.lstAgrupamento.get(this.indexList);
		}
	}
	
	private void salvarPrescricoes(PrescricaoPep prescricaoSalva) throws Exception{
		FacesContext context = FacesContext.getCurrentInstance();
		PrescricaoForm prescricaoForm = (PrescricaoForm) context.getApplication().evaluateExpressionGet(context,"#{prescricaoForm}",PrescricaoForm.class);
		
		if (prescricaoSalva == null || prescricaoSalva.getIsnPrescricaoPep() == null){
			prescricaoForm.setUsuarioCoren(this.usuario);
			prescricaoForm.setSenhaAssinatura(this.senha);		
			prescricaoForm.getObjPrescricaoPep().setDatPrescricao(new Date());
			prescricaoForm.getObjPrescricaoPep().setIsnPrescricaoTipo((verificarSeExistePrescricao() ? 9 : 10));
			prescricaoForm.setPacienteOtimizado(pacienteOtimizado);
			prescricaoForm.gravarPrescricaoPepi();
		}
		incluirPrescricoes(prescricaoForm, prescricaoSalva);
	}
	
	
	public boolean verificarSeExistePrescricao() throws Exception{
		PrescricaoPep prescricaoPep = new PrescricaoPep();
		prescricaoPep.setIsnInternacao(getPacienteOtimizado().getIsnInternacao());
		HashMap<String, Object> filtro = new HashMap<String, Object>();
		filtro.put("datCancelamentoNull",true);
		prescricaoPep.setFiltro(filtro);
		
		List<PrescricaoPep> lstObjPrescricaoPep = PrescricaoPepImpl.getInstancia().pesquisar(prescricaoPep, 0);

		if (lstObjPrescricaoPep != null && lstObjPrescricaoPep.size() > 0) 
		{
			return true;
		}
		return false;
	}
	
	
	private void incluirPrescricoes(final PrescricaoForm prescricaoForm, PrescricaoPep prescricaoSalva) throws Exception {

		if (this.listPrescricoes != null && this.listPrescricoes.size() > 0)
			for (PrescricaoItemSepse itemSepse : this.listPrescricoes) {
				popularPrescricaoItem(prescricaoForm, itemSepse, prescricaoSalva);
			}
	}
	
	public void popularPrescricaoItem(final PrescricaoForm prescricaoForm, final PrescricaoItemSepse itemSepse, PrescricaoPep prescricaoSalva) throws Exception {
		PrescricaoPepItem item = new PrescricaoPepItem();
		item.setIsnPrescricaoPep((prescricaoSalva == null || prescricaoSalva.getIsnPrescricaoPep() == null) ? prescricaoForm.getObjPrescricaoPep().getIsnPrescricaoPep() : prescricaoSalva.getIsnPrescricaoPep());
		item.setIsnTipoPrescricao(20);
		
		item.setDscPrescricao(itemSepse.getProduto().getDscProduto() + " / " + "ADMINISTRAR  " + Integer.parseInt(itemSepse.getDscDose()) + " " + itemSepse.getDscUnidade() + " / "
				+ itemSepse.getPrescricaoVia().getDscPrescricaoVia().toUpperCase() + " / "
				+ itemSepse.getPrescricaoPosologia().getDscPrescricaoPosologia().toUpperCase());
		item.setDatCadastro(new Date());
		item.setFlgSeNecessario("N");
		item.setFlgAlterado("S");
		item.setFlgAtivo("S");
		item.setFlgDc("S");
		item.setIsnProdutoAlmox(itemSepse.getIsnProduto());
		item.setDscDiluicao("");
		item.setQtdDose(Double.valueOf(itemSepse.getDscDose()));
		item.setIsnPrescricaoVia(itemSepse.getIsnPrescricaoVia());
		item.setIsnPrescricaoPosologia(itemSepse.getIsnPrescricaoPosologia());
		item.setDscComplemento(itemSepse.getDscComplemento());
		item.setFlgAcm("N");
		item.setDscApresentacao(itemSepse.getDscUnidade());
		System.out.println(item.getDscApresentacao() +" passou aki");
		PrescricaoPepItemImpl.getInstancia().inserir(item);
	}
	
	
	public List<SelectItem> agruparProdutos(List<PrescricaoItemSepse> set) {
		ordernarListaPrescricaoItemSepsePorIsn(set);	
		final List<PrescricaoItemSepse> lstProdutoPrincipal = new ArrayList<>();
		final List<PrescricaoItemSepse> lstProduto = new ArrayList<>();
		this.lstAgrupamento = new ArrayList<>();

		for (PrescricaoItemSepse p : set) {
			if (p.getIsnProdutoPrincipal() == null) {
				lstProdutoPrincipal.add(p);
			} else {
				lstProduto.add(p);
			}
		}

		if (!lstProduto.isEmpty()) {
			this.lstAgrupamento = getAgruparProdutos(lstProdutoPrincipal, lstProduto);
			final Map<Integer, PrescricaoItemSepse> map = getProdutos(lstProdutoPrincipal, lstProduto);
			if (isnTipoFoco.equals(9) || isnTipoFoco.equals(6))
				this.lstAgrupamento = setAgrupamentoUnicoNoFim(map, lstAgrupamento);
			else
				this.lstAgrupamento = setAgrupamentoUnicoNoInicio(map, lstAgrupamento);
		} else {
			this.lstAgrupamento = setAgrupamentoSemReferencia(lstProdutoPrincipal);
		}		
		
		final List<SelectItem> lst = new ArrayList<>();
		StringBuilder stringBuilder;
		
		for (int i = 0; i < this.lstAgrupamento.size(); i++) {
			final List<PrescricaoItemSepse> list = this.lstAgrupamento.get(i);
			stringBuilder = new StringBuilder();
			for (PrescricaoItemSepse pre : list) {
				stringBuilder.append(pre.getProduto().getDscProduto()).append("\n / ");
			}
			lst.add(new SelectItem(i,stringBuilder.toString()));
		}
		return lst;
	}

	private void ordernarListaPrescricaoItemSepsePorIsn(List<PrescricaoItemSepse> set) {
		Collections.sort (set, new Comparator() {  
	            public int compare(Object s1, Object s2) {  
	            	PrescricaoItemSepse item1 = (PrescricaoItemSepse) s1;  
	            	PrescricaoItemSepse item2 = (PrescricaoItemSepse) s2;  
	                return item1.getIsnPrescricaoItemSepse().compareTo(item2.getIsnPrescricaoItemSepse());  
	            }  
	        });
	}

	public List<List<PrescricaoItemSepse>> setAgrupamentoSemReferencia(
			List<PrescricaoItemSepse> lstProdutoPrincipal) {
		final List<List<PrescricaoItemSepse>> lstAgrupamento = new ArrayList<>();
		for (PrescricaoItemSepse presc : lstProdutoPrincipal) {
			final List<PrescricaoItemSepse> lst = new ArrayList<>();
			lst.add(presc);
			lstAgrupamento.add(lst);
		}
		return lstAgrupamento;
	}

	public List<List<PrescricaoItemSepse>> getAgruparProdutos(List<PrescricaoItemSepse> lstProdutoPrincipal,
			List<PrescricaoItemSepse> lstProduto) {
		final List<List<PrescricaoItemSepse>> lstAgrupamento = new ArrayList<>();
		for (PrescricaoItemSepse presc : lstProdutoPrincipal) {
			for (PrescricaoItemSepse prescricao : lstProduto) {
				if (presc.getIsnProduto().intValue() == prescricao.getIsnProdutoPrincipal().intValue()) {
					final List<PrescricaoItemSepse> lst = new ArrayList<>();
					lst.add(presc);
					lst.add(prescricao);
					lstAgrupamento.add(lst);
				}
			}
		}
		return lstAgrupamento;
	}

	public List<List<PrescricaoItemSepse>> setAgrupamentoUnicoNoFim(Map<Integer, PrescricaoItemSepse> map,
			List<List<PrescricaoItemSepse>> lstAgrupamento) {
		for (Entry<Integer, PrescricaoItemSepse> key : map.entrySet()) {
			final List<PrescricaoItemSepse> lst = new ArrayList<>();
			lst.add(key.getValue());
			lstAgrupamento.add(lst);
		}
		return lstAgrupamento;
	}

	public List<List<PrescricaoItemSepse>> setAgrupamentoUnicoNoInicio(Map<Integer, PrescricaoItemSepse> map,
			List<List<PrescricaoItemSepse>> lstAgrupamento) {
		List<List<PrescricaoItemSepse>> lstAgrupamentoTemp  = new ArrayList<>();
		for (Entry<Integer, PrescricaoItemSepse> key : map.entrySet()) {
			final List<PrescricaoItemSepse> lst = new ArrayList<>();
			lst.add(key.getValue());
			lstAgrupamentoTemp.add(lst);
		}
		lstAgrupamentoTemp.addAll(lstAgrupamento);
		return lstAgrupamentoTemp;
	}
	
	public Map<Integer, PrescricaoItemSepse> getProdutos(List<PrescricaoItemSepse> lstProdutoPrincipal,
			List<PrescricaoItemSepse> lstProduto) {
		final Map<Integer, PrescricaoItemSepse> map = new LinkedHashMap<>();
		for (PrescricaoItemSepse presc : lstProdutoPrincipal) {
			if (naoTemProdutoPrincipalNaLitaDeProdutosSecundarios(presc, lstProduto)){
				map.put(presc.getIsnProduto(), presc);
			}
		}
		return map;
	}
	
	private boolean naoTemProdutoPrincipalNaLitaDeProdutosSecundarios(PrescricaoItemSepse presc,
			List<PrescricaoItemSepse> lstProduto) {
		for (PrescricaoItemSepse prescricaoItemSepse : lstProduto) {
			if (prescricaoItemSepse.getIsnProdutoPrincipal().equals(presc.getIsnProduto())){
				return false;
			}
		}
		return true;
	}

	private void iniciarMapProtocoloSepseSinais() {
		this.checkMapProtocoloSepseSinais = new HashMap<ProtocoloSepseSinais,Boolean>();
		List<ProtocoloSepseSinais> lstProtocoloSepseSinaisTemp = new ArrayList<>();
		lstProtocoloSepseSinaisTemp.addAll(this.lstProtocoloSepseSinais);
		if (lstProtocoloSepseSinaisTemp  != null && !lstProtocoloSepseSinaisTemp.isEmpty()) {
			Collections.reverse(lstProtocoloSepseSinaisTemp); 
			for (ProtocoloSepseSinais protocoloSepseSinais : lstProtocoloSepseSinaisTemp) {
				this.checkMapProtocoloSepseSinais.put(protocoloSepseSinais, Boolean.FALSE);
			}
		}
	}
	
	public void adicionarSinaisResp(ActionEvent event){
		adicionarProtocoloSepseSinaisResp();
		verificarStatusEtapa(null);
	}
	
	private void adicionarProtocoloSepseSinaisResp(){
		final List<ProtocoloSepseSinaisResp> sinaisSepse = new ArrayList<>();
        boolean hasSemDisfuncao = false;
        boolean hasSemSuspeita = false;
        Entry<ProtocoloSepseSinais, Boolean> disfuncaoEntry = null;
        Entry<ProtocoloSepseSinais, Boolean> semSuspeitaEntry = null;
        Integer emptyList = 0;
		
        for (Entry<ProtocoloSepseSinais, Boolean> entry : checkMapProtocoloSepseSinais.entrySet()) {
        	if (entry.getValue()) {
        		if(entry.getKey().getIsnProtocoloSepseSinais() == 10) {
        			hasSemDisfuncao = true;
        			
        			// DESMARCA ITEM 10 SE QUALQUER OUTRO FOR MARCADO
        			if (sinalClicado != null && sinalClicado.getIsnProtocoloSepseSinais() == 10) {
        				hasSemDisfuncao = false;
        				entry.setValue(false);
        				disfuncaoEntry = entry;
        			}
        		} else {
        			if(entry.getKey().getIsnProtocoloSepseSinais() == 11) {
            			hasSemSuspeita = true;
            			
            			// DESMARCA ITEM 11 SE QUALQUER OUTRO FOR MARCADO
            			if (sinalClicado != null && sinalClicado.getIsnProtocoloSepseSinais() == 11) {
            				hasSemSuspeita = false;
            				entry.setValue(false);
            				semSuspeitaEntry = entry;
            			}
            		}
        		}
        		emptyList++;
        	}
        }
        
        if (emptyList < 2 && sinalClicado != null && sinalClicado.getIsnProtocoloSepseSinais() == 10 && disfuncaoEntry != null) { 
        	sinalClicado = null;
        	disfuncaoEntry.setValue(true);
        }
        
        if (emptyList < 2 && sinalClicado != null && sinalClicado.getIsnProtocoloSepseSinais() == 11 && semSuspeitaEntry != null) { 
        	sinalClicado = null;
        	semSuspeitaEntry.setValue(true);
        }
        
        // DESMARCA TODOS OUTROS ITENS SE OS ITENS 10 OU 11 FOREM MARCADOS
		for (Entry<ProtocoloSepseSinais, Boolean> entry : checkMapProtocoloSepseSinais.entrySet()) {
			if (entry.getValue()) {
				if(entry.getKey().getIsnProtocoloSepseSinais() == 11) {
					this.protocoloSepse.setSuspeitaInfeccao(false);
				} else {
					this.protocoloSepse.setSuspeitaInfeccao(true);
				}
				
				if ((hasSemDisfuncao && entry.getKey().getIsnProtocoloSepseSinais() != 10) || (hasSemSuspeita && entry.getKey().getIsnProtocoloSepseSinais() != 11)) {
					entry.setValue(false);
				} else {
					final ProtocoloSepseSinaisResp sinaisResp = getNovoSinalSepse(entry.getKey());
					sinaisSepse.add(sinaisResp);
				}
			}
		}
		ordernarSinaisSepsePorNumeroOrdem(sinaisSepse);
		this.lstProtocoloSepseSinaisResp = new ArrayList<>(sinaisSepse);
	}
	
	private void ordernarSinaisSepsePorNumeroOrdem(List<ProtocoloSepseSinaisResp> sinaisSepse) {
		Collections.sort (sinaisSepse, new Comparator() {  
            public int compare(Object s1, Object s2) {  
            	ProtocoloSepseSinaisResp item1 = (ProtocoloSepseSinaisResp) s1;  
            	ProtocoloSepseSinaisResp item2 = (ProtocoloSepseSinaisResp) s2;  
                return item1.getNumOrdem().compareTo(item2.getNumOrdem());  
            }  
        });
	}

	private ProtocoloSepseSinaisResp getNovoSinalSepse(ProtocoloSepseSinais sinais) {
		final ProtocoloSepseSinaisResp pSinaisResp = new ProtocoloSepseSinaisResp();
		pSinaisResp.setIsnProtocoloSepseSinais(sinais.getIsnProtocoloSepseSinais());;
		pSinaisResp.setDscProtocoloSepseSinais(sinais.getDscProtocoloSepseSinais());;
		pSinaisResp.setNumOrdem(sinais.getNumOrdem());
		return pSinaisResp;
	}
	
	public void proximaEtapaSepse() throws Exception {
		this.setMensagem("");
		this.etapaFinalizada = false;

		if (isNaoTemSuspeitaInfeccao()) {
			salvarSepse();
			carregarProtocoloSepse();
			return;
		}
		
		if (this.viewPager == 0 && isHda()) {
			this.setMensagem("É necessário informar o HDA.");
			return;
		}
		
		if(this.viewPager == 1 && ( this.protocoloSepse.getCodTela1() == null || (this.protocoloSepse.getCodTela1() == 8 && !hasOutrosSinaisAlerta())) ) {
			this.setMensagem("É necessário informar uma descrição para o item OUTROS.");
			return;
		}
		
		if(this.viewPager == 1 && (this.protocoloSepse.getCodTela1() == null || this.protocoloSepse.getCodTela1() == 0)) {
			this.setMensagem("É necessário selecionar ao menos um item.");
			return;
		}
		
		if (this.viewPager == 2 && this.lstProtocoloSepseSinaisResp.isEmpty()) {
			this.setMensagem("É necessário selecionar ao menos um item.");
			return;
		}				
				
		avancarViewPager(null);
		verificarStatusEtapa(null);
	}
	
	public boolean hasOutrosSinaisAlerta() {
		return (this.protocoloSepse.getOutrosSinaisAlerta() != null && !this.protocoloSepse.getOutrosSinaisAlerta().isEmpty());
	}
	
	public void avancarViewPager(ActionEvent event){
		this.viewPager += 1;
	}
	
	public void voltarViewPager(ActionEvent event) {
		this.viewPager -= 1;
		verificarStatusEtapa(null);
	}
	
	public void verificarStatusEtapa(ActionEvent event) {
		
		if (isEtapaZero()) {
			this.statusEtapa = isSuspeitaInfeccaoNulo();
		}
		if(isEtapaUm()){
			this.statusEtapa = isSinaisDeAlerta();
		}
		if(isEtapaDois()){
			this.statusEtapa = isSinaisResp();
		}
	}
	
	private boolean isEtapaZero() {
		return this.viewPager == 0;
	}

	private boolean isEtapaUm() {
		return this.viewPager == 1;
	}

	private boolean isEtapaDois() {
		return this.viewPager == 2;
	}

	private boolean isEtapaTres() {
		return this.viewPager == 3;
	}
	
	private boolean isSuspeitaInfeccaoNulo(){
		return (protocoloSepse.getSuspeitaInfeccao() == null);
	}
	
	private boolean isSinaisDeAlerta(){
		return false; // (protocoloSepse.getCodTela1() == null || protocoloSepse.getCodTela1() == 0);
		
	}
	
	private boolean isSinaisResp(){
		return false;//(this.lstProtocoloSepseSinaisResp.isEmpty());
	}
	
	private boolean isHda(){
		return protocoloSepse.getDscHda().isEmpty();
	}
	
	private boolean isMedico(){
		return getPermissaoMed() != null && getPermissaoMed().equals("S");
	}
	
	private boolean isHdaOdonto(){
		return objIa.getDscHdaOdonto().isEmpty();
	}
	
	private boolean isOdonto(){
		return getPermissaoOdonto() != null && getPermissaoOdonto().equals("S");
	}
	
	private boolean isNaoTemSuspeitaInfeccao() {
		return (this.protocoloSepse.getSuspeitaInfeccao() != null && !this.protocoloSepse.getSuspeitaInfeccao());
	}
	
	private void salvarSepse() throws Exception {
		this.etapaFinalizada = true;
		this.protocoloSepse.setDatCadastro(new Date());
		this.protocoloSepse.setIsnProfissional(getIdMedico());
		this.protocoloSepse.setIsnProfissionalEnfermagem(getIdEnfermeiro());
		this.protocoloSepse.setIsnInternacao(pacienteOtimizado.getIsnInternacao());
		final Internacao internacao = getInternacaoAtual();
		this.protocoloSepse.setDatInicioAtendimento(internacao.getDatAtendimentoMedico());
		this.protocoloSepse.setIsnVolumePrescricaoSepse((protocoloSepse.getIsnVolumePrescricaoSepse() == null || protocoloSepse.getIsnVolumePrescricaoSepse().equals(0))?null:protocoloSepse.getIsnVolumePrescricaoSepse());
		protocoloSepse.setListProtocoloSepseSinaisResp(null);
		protocoloSepse = ProtocoloSepseImpl.getInstancia().inserir(protocoloSepse);
		salvarSinaisSepse(protocoloSepse);
		setHdaProfissionalEPa();
		
	  // BEGIN - ATUALIZANDO SUSPEITA INFECCAO --	
		// atualizarSinalInfeccaoRecepcao(pacienteOtimizado.getIsnInternacao(), "N");
      // END - ATUALIZANDO SUSPEITA INFECCAO --
		
		viewPager = 0;
		evolucaoSepse = new EvolucaoSepse();
	}
	
	private void setHdaProfissionalEPa(){
		if(isMedico() && (objIa.getDscAtendimento() == null || objIa.getDscAtendimento().trim().equals(""))){
			objIa.setDscAtendimento(protocoloSepse.getDscHda());
		}
		if(isOdonto() && (objIa.getDscHdaOdonto() == null || objIa.getDscHdaOdonto().trim().equals(""))){
			objIa.setDscHdaOdonto(protocoloSepse.getDscHda());
		}
	    if((objIa.getDscPa() == null || objIa.getDscPa().trim().equals("")) && protocoloSepse.getDscPa() != null)
	    	objIa.setDscPa(protocoloSepse.getDscPa() + " X " + protocoloSepse.getDscPaFinal());
	}
	
	private Internacao getInternacaoAtual(){
		InternacaoFacade i = new InternacaoFacadeImpl();
		Internacao internacao = i.buscarInternacao(pacienteOtimizado.getIsnInternacao());
		return internacao;
	}
	
	private Integer getIdMedico() throws Exception {
		Integer id = jsfUtil.getUsuarioLogado().getIsnConselho();
		return (id != null && id == 6) ? jsfUtil.getUsuarioLogado().getIsnUsuario() : null;
	}
	
	private Integer getIdEnfermeiro() throws Exception {
		Integer id = jsfUtil.getUsuarioLogado().getIsnConselho();
		return (id != null && id != 6) ? jsfUtil.getUsuarioLogado().getIsnUsuario() : null;
	}
	
	public void prepararAbrirSepse() throws Exception {
		this.setMensagem("");

		if (this.listProtocoloSepse != null && this.listProtocoloSepse.size() > 0) {
			final ProtocoloSepse p = listProtocoloSepse.get(0);
			if (p.getSuspeitaInfeccao() != null && p.getSuspeitaInfeccao() && p.getAtivo24h()) {
				this.setMensagem("Existe um protocolo aberto e ativo há menos de 24h.");
			}
		}

		this.lstExameSolicSepse = new ArrayList<ExameSolicitacaoPepBean>();
		this.protocoloSepse = new ProtocoloSepse();

		buscarUltimaClassificaoDeRiscoPorInternacao();
		buscarSinaisSirsAdicionadosNaClassificacaoDeRisco();
		carregarEtapasDoPanelProtocoloSepse();
	}
	
	private void buscarUltimaClassificaoDeRiscoPorInternacao(){
		ClassificacaoRiscoFacade crf = new ClassificacaoRiscoFacadeImpl();
		this.cr = crf.maximoClassificacaoRisco(paciente.getIsnInternacao());
	}
	
	public void prepararAbrirProtocoloSepse(){
		this.setMensagem("");
		if (listProtocoloSepse == null && listProtocoloSepse.size() <= 0){
			this.setMensagem("É necessário que o médico realize a abetura do Protocolo Sepse.");
			return;
		}else{
			if ((protocoloSepse.getCodTela1() != null && protocoloSepse.getCodTela1().equals(6)) || (protocoloSepse.getSuspeitaInfeccao() != null && protocoloSepse.getSuspeitaInfeccao().equals(false))){
				this.setMensagem("Paciente não possui sepse.");
				return;
			}	
		}
		if (!FuncUtil.isNull(protocoloSepse.getIsnProfissionalEnfermagem())){
				this.setMensagem("Não é permitido realizar alteração no Protocolo Sepse.");
				return;
		}
	}
	
	public void gravarProtocoloSepse() throws Exception{
		this.setMensagem("");
		
		if ((protocoloSepse.getHoraAtb() == null || protocoloSepse.getHoraAtb().isEmpty()) ||
				(protocoloSepse.getHoraColetaExame() == null || protocoloSepse.getHoraColetaExame().isEmpty())){
				this.setMensagem("Preencha todos os campos da Sepse!");
				return;
		}
		if (FuncUtil.isNull(protocoloSepse.getCodVolumeReposicao())){
			this.setMensagem("Preencha todos os campos da Sepse!");
			return;
		} else {
			if(protocoloSepse.getCodVolumeReposicao() != 2) {
				protocoloSepse.setVolumeReposicao(null);
				protocoloSepse.setHoraReposicao(null);
				protocoloSepse.setIsnSintomaSepseEnf(null);
				justificativaRepoVolemica.setDscJustificativaReposicaoVolemica(null);
			}
		}
		if (obrigaInformarReposicaoVolemica()){
			if (naoTemDadosDaReposicaoVolemica()){
				this.setMensagem("Preencha todos os campos da Sepse!");
				return;
			}
			if (protocoloSepse.getIsnSintomaSepseEnf() != null && protocoloSepse.getIsnSintomaSepseEnf().equals(3) && 
					justificativaRepoVolemica.getDscJustificativaReposicaoVolemica().isEmpty()){
				this.setMensagem("Informe o campo Justificativa!");
				return;
			}
		}
		
		protocoloSepse.setDatCadastroEnfermagem(new Date());
		
		protocoloSepse.setDatAtb(FuncUtil.adicionarHoraMinutoSegundoData(new Date(), protocoloSepse.getHoraAtb() + ":00"));
		if(jsfUtil.getUsuarioLogado().getIsnConselho() == 6) {
			protocoloSepse.setIsnProfissional(jsfUtil.getUsuarioLogado().getIsnUsuario());
		} else {
			protocoloSepse.setIsnProfissionalEnfermagem(jsfUtil.getUsuarioLogado().getIsnUsuario());
		}
//		protocoloSepse = ProtocoloSepseImpl.getInstancia().alterar(protocoloSepse);
		ProtocoloSepseImpl.getInstancia().alterarSepse(protocoloSepse, justificativaRepoVolemica);
		justificativaRepoVolemica = new JustificativaReposicaoVolemica();

		carregarProtocoloSepseEnfermagem();
	}
	
	private boolean naoTemDadosDaReposicaoVolemica() {
		return (protocoloSepse.getVolumeReposicao() == null || protocoloSepse.getVolumeReposicao() <= 0.0) ||
				(protocoloSepse.getHoraReposicao() == null || protocoloSepse.getHoraReposicao().isEmpty()) ||
				FuncUtil.isNull(protocoloSepse.getIsnSintomaSepseEnf());
	}


	private boolean obrigaInformarReposicaoVolemica() {
		return protocoloSepse.getCodVolumeReposicao() != null && (protocoloSepse.getCodVolumeReposicao().equals(2));
	}
	
	public void resetar(ActionEvent event){
		
		if(protocoloSepse != null && !protocoloSepse.getIsnSintomaSepseEnf().equals(3)){
			justificativaRepoVolemica = new JustificativaReposicaoVolemica();
		}
	}
	
	public void ordenarLista(List<ExameSolicitacaoPepBean> lstExameSolic){
		Collections.sort(lstExameSolic, new Comparator<Object>() {
			public int compare(Object obj1, Object obj2) {
				ExameSolicitacaoPepBean u1 = (ExameSolicitacaoPepBean) obj1;
				ExameSolicitacaoPepBean u2 = (ExameSolicitacaoPepBean) obj2;
				return u2.getIsnExameSolicAux().compareTo(
						u1.getIsnExameSolicAux());
			}
		});
	}
	
	public List<String> converterStringParaListString(String strConverter){
		if (strConverter == null){
			return new ArrayList<String>();
		}
        String replace = strConverter.replace("[","");
        String replace1 = replace.replace("]","");
        if (replace1.trim().equals("")){
        	return new ArrayList<String>();
        }else{
	        List<String> myList = Arrays.asList(replace1.split(","));
	        return myList;
        }
	}
	
	public void validarSepseGrave(ActionEvent event) {
		protocoloSepse.setFlgChoqueSeptico("N");
	}
	
	public void validarSepseChoque(ActionEvent event) {
		protocoloSepse.setFlgSepseGrave("N");
	}
	
	public void validarTela1(ActionEvent ev){
		this.setMensagem("");
		if (protocoloSepse.getCodTela1() == null || protocoloSepse.getCodTela1().equals(0)){
			this.setMensagem("Selecione uma opção!");
		}else if (protocoloSepse.getCodTela1().equals(6)){
			try {
				gravarSepse(1);
			} catch (Exception e) {
				e.printStackTrace();
			}
		}
	}
	
	public void calcularVolume() {
		if (protocoloSepse.getPeso() != null && protocoloSepse.getPeso() > 0.0) {
			protocoloSepse.setVolume(protocoloSepse.getPeso() * 30);
		}
	}
	
	public void resetarVolume(ActionEvent event) {
		if (protocoloSepse.getIsnVolumePrescricaoSepse().equals(1))
			calcularVolume();
		else{
			protocoloSepse.setVolume(null);
			return;			
		}
	}
	
	public int retornaCountSepse() throws Exception{
		ProtocoloSepse p = new ProtocoloSepse();
		p.setIsnInternacao(pacienteOtimizado.getIsnInternacao());
		List<ProtocoloSepse> listProtocoloSepseTemp = ProtocoloSepseImpl.getInstancia().pesquisar(p, 0);
		if (listProtocoloSepseTemp == null || listProtocoloSepseTemp.size() <= 0){
			return 0;
		}
		
		for (ProtocoloSepse protocoloSepse : listProtocoloSepseTemp) {
			if ((protocoloSepse.getCodTela1() != null && !protocoloSepse.getCodTela1().equals(6)) && (protocoloSepse.getSuspeitaInfeccao() != null && protocoloSepse.getSuspeitaInfeccao().equals(true)) &&
					protocoloSepse.getDscPa() != null && protocoloSepse.getDscPaFinal() != null && protocoloSepse.getPeso() != null && protocoloSepse.getAtivo24h()){
				return listProtocoloSepseTemp.size();
			}	
		}
		
		return 0;
	}
	
	public boolean retornaCountEvolucao() throws Exception{
		int tempo = getSegundosEntreDataAtual(protocoloSepse.getDatCadastro());
		boolean temEvolucao = false;
		if ((tempo > 10800 && tempo < 21600)){
			temEvolucao = retornarSeTemEvolucaoDeAcordoComOTempo(MAIOR_3_MENOR_6);
		}else if (tempo >= 21600 && tempo < 43200) {
			temEvolucao = retornarSeTemEvolucaoDeAcordoComOTempo(MAIOR_6_MENOR_12);
		}else if (tempo >= 43200  && tempo < 79200){
			temEvolucao = retornarSeTemEvolucaoDeAcordoComOTempo(MAIOR_12_MENOR_22);
		}else if (tempo >= 79200){
			temEvolucao = retornarSeTemEvolucaoDeAcordoComOTempo(MAIOR_22);
		}
		return temEvolucao;
	}
	
	public void validarSepse(Integer validarCampos){
		this.setMensagem("");
		if (validarCampos == VALIDAR_CAMPOS) {

			if ((protocoloSepse.getDscPa() == null || protocoloSepse.getDscPa().trim().equals("")) ||
			    (protocoloSepse.getDscPaFinal() == null || protocoloSepse.getDscPaFinal().trim().equals(""))){
				this.setMensagem("Campo PA é obrigatório!");
				return;
			} else if (protocoloSepse.getPeso() == null || protocoloSepse.getPeso() <= 0.0) {
				this.setMensagem("Campo Peso é obrigatório!");
				return;
			} else if (this.listPrescricoes == null || this.listPrescricoes.size() <= 0){
				this.setMensagem("Deve ser selecionado ao menos um Antibiótico, nos campos da Prescrição Médica!");
				return;	
			} else if (protocoloSepse.getIsnVolumePrescricaoSepse() == null || protocoloSepse.getIsnVolumePrescricaoSepse().equals(0)) {
				this.setMensagem("Campo Volume é obrigatório!");
				return;
			} else if ((protocoloSepse.getIsnVolumePrescricaoSepse().equals(1) || protocoloSepse.getIsnVolumePrescricaoSepse().equals(2)) && 
					(protocoloSepse.getVolume() == null || protocoloSepse.getVolume() <= 0.0)) {
				this.setMensagem("Campo Volume (valor) é obrigatório!");
				return;
			} else if ((protocoloSepse.getIsnVolumePrescricaoSepse().equals(2) || protocoloSepse.getIsnVolumePrescricaoSepse().equals(4))
					&& (justificativaRepoVolemica.getDscJustificativaReposicaoVolemica() == null || justificativaRepoVolemica.getDscJustificativaReposicaoVolemica().trim().equals(""))) {
				this.setMensagem("Campo Justificativa é obrigatório.");
				return;
			} else if (getLstExameSolicSepse() == null || getLstExameSolicSepse().size() <= 0) {
				this.setMensagem("Campo Exames é obrigatório!");
				return;
			} else if ((protocoloSepse.getFlgSepseGrave() == null || protocoloSepse.getFlgSepseGrave().equals(false))
					&& (protocoloSepse.getFlgChoqueSeptico() == null
							|| protocoloSepse.getFlgChoqueSeptico().equals(false))) {
				this.setMensagem("É obrigatório informar se o paciente tem Sepse  ou Choque Séptico!");
				return;
			}
		}
	}
	
	public void gravarSepse(Integer validarCampos) throws Exception {
		this.setMensagem("");
		

		if (usuario == null || "".equalsIgnoreCase(usuario.trim())) {
			this.setMensagem("Conselho é obrigatório!");
			return;
		}
		if (senha == null || "".equalsIgnoreCase(senha.trim())) {
			this.setMensagem("Senha é obrigatório!");
			return;			
		}
		
		Usuario usuarioDg = new Usuario();
		String senhaEnpritpt = IsghEncodeDecode.encrypt(senha.toUpperCase());
		usuarioDg.setDscLogin(usuario.toUpperCase());
		usuarioDg.setDscSenha(senhaEnpritpt);
		usuarioDg = (Usuario) UsuarioImpl.getInstancia().get(usuarioDg,
				UsuarioImpl.JOIN_USUARIO_GRUPO | UsuarioImpl.JOIN_USUARIOGRUPO_GRUPO, Criteria.DISTINCT_ROOT_ENTITY);

		if (usuarioDg == null) {
			this.setMensagem("Usuário/senha inválidos!");
			return;	
		}
		
		if (!ValidaPermissaoUsuario.getInstancia().verificaPermissao(usuarioDg, funcUtil.getAcaoAtender())) {
			this.setMensagem("Usuário sem permissão para essa ação!");
			return;	
		}

		try {
			if (retornaCountSepse() > 0) {
				this.setMensagem("Não é permitido inserir mais de um Protocolo Sepse por internação. Atualize a página.");
				carregarProtocoloSepse();
				return;
			}

			protocoloSepse.setDatCadastro(new Date());

			// ADICIONANDO MEDICO QUE INSERIU A SEPSE
			if (jsfUtil.getUsuarioLogado().getIsnConselho() == 6) {
				protocoloSepse.setIsnProfissional(usuarioDg.getIsnUsuario());
			} else {
				protocoloSepse.setIsnProfissionalEnfermagem(usuarioDg.getIsnUsuario());
			}

			protocoloSepse.setIsnInternacao(pacienteOtimizado.getIsnInternacao());
			if (validarCampos != VALIDAR_CAMPOS) {
				protocoloSepse.setDscPa(null);
				protocoloSepse.setDscPaFinal(null);
				protocoloSepse.setPeso(null);
				protocoloSepse.setVolume(null);
			}

			// INSERINDO A DATA DE INICIO DE ATENDIMENTO NA SEPSE
			InternacaoFacade i = new InternacaoFacadeImpl();
			Internacao internacao = i.buscarInternacao(pacienteOtimizado.getIsnInternacao());
			protocoloSepse.setDatInicioAtendimento(internacao.getDatAtendimentoMedico());			
			
			if(indexList != null){
				StringBuilder dscPrescricoesBuilder = new StringBuilder();
				dscPrescricoesBuilder.append(retornarDescricaoDoSelectItemPorIsn(sliFocoSepse, isnFocoSepse));
				dscPrescricoesBuilder.append(" | ");
				dscPrescricoesBuilder.append(retornarDescricaoDoSelectItemPorIsn(sliFocoPrescricaoSepse, isnFocoPrescricaoSepse));
				dscPrescricoesBuilder.append(" | ");
				
				if(isnTipoFoco != 0){
					int indexOf1 = 0;
					for (SelectItem selectItem : sliTipoFoco) {
						if(selectItem.getValue() != null && selectItem.getValue().equals(isnTipoFoco)){
							indexOf1 = sliTipoFoco.indexOf(selectItem);
							break;
						}
					}
					
					if(!sliTipoFoco.get(indexOf1).getLabel().equals("--Selecione--")){
						dscPrescricoesBuilder.append(sliTipoFoco.get(indexOf1).getLabel());
						dscPrescricoesBuilder.append(" | ");
					}
				}
				
				if(isnSubTipoFoco != null && isnSubTipoFoco != 0){
					int indexOf2 = 0;
					for (SelectItem selectItem : sliSubTipoFoco) {
						if(selectItem.getValue() != null && selectItem.getValue().equals(isnSubTipoFoco)){
							indexOf2 = sliSubTipoFoco.indexOf(selectItem);
							break;
						}
					}
					
					if(!sliSubTipoFoco.get(indexOf2).getLabel().equals("--Selecione--")){
						dscPrescricoesBuilder.append(sliSubTipoFoco.get(indexOf2).getLabel());
						dscPrescricoesBuilder.append(" | ");
					}
				}
				
				if(indexList != null && sliMedicamentosAgrupados != null && sliMedicamentosAgrupados.size() > 0){
					int indexOf3 = 0;
					for (SelectItem selectItem : sliMedicamentosAgrupados) {
						if(selectItem.getValue() != null && selectItem.getValue().equals(indexList)){
							indexOf3 = sliMedicamentosAgrupados.indexOf(selectItem);
							break;
						}
					}
					
					dscPrescricoesBuilder.append(sliMedicamentosAgrupados.get(indexOf3).getLabel());
				}
				
				protocoloSepse.setDscPrescricoes(dscPrescricoesBuilder.toString());
			}
			
  		  // BEGIN - ATUALIZANDO SUSPEITA INFECCAO --	
			// String flgInfec = (protocoloSepse.getSuspeitaInfeccao() != null && protocoloSepse.getSuspeitaInfeccao() )? "S": "N";
			// atualizarSinalInfeccaoRecepcao(protocoloSepse.getIsnInternacao(), flgInfec);
	      // END - ATUALIZANDO SUSPEITA INFECCAO --
				      
			protocoloSepse.setListProtocoloSepseSinaisResp(null);
			protocoloSepse = ProtocoloSepseImpl.getInstancia().inserir(protocoloSepse);
			salvarSinaisSepse(protocoloSepse);
			
			ProtocoloSepseImpl.getInstancia().alterarSepseMedica(protocoloSepse, justificativaRepoVolemica);
			justificativaRepoVolemica = new JustificativaReposicaoVolemica();

			if (estaNaRecepcaoOuSalaDeEspera == false) {
				vincularInternacaoAtendimentoSepse(protocoloSepse.getIsnProtocoloSepse());
			}

			if (validarCampos == VALIDAR_CAMPOS) {
				PrescricaoPep prescricaoSalva = gravarPrescricaoSepse(protocoloSepse.getVolume());
				// gravando os exames
				listExameSelecionado = new ArrayList<ExamePepBean>();
				for (ExameSolicitacaoPepBean exameSolicitacaoPepBean : getLstExameSolicSepse()) {
					ExamePepBean examePepBean = new ExamePepBean();
					JSFUtil.copiarPropriedades(exameSolicitacaoPepBean.getExamePepBean(), examePepBean);
					examePepBean.setVemDaSepse(true);
					listExameSelecionado.add(examePepBean);
				}

				inserirExame();
				salvarPrescricoes(prescricaoSalva);

				lstExameSolicSepse = new ArrayList<ExameSolicitacaoPepBean>();
				gravarEmailSepse();
				setHdaProfissionalEPa();
				viewPager = 0;
				evolucaoSepse = new EvolucaoSepse();
			}
			carregarProtocoloSepse();
		} catch (Exception e) {
			e.printStackTrace();
		}
	}
    
	// ATUALIZAR O CAMPO "SuspeitaInfeccao" DA CLASSIFICAÇAO DE RISCO CAUSAVA INCONSISTENCIA NO RELATÓRIO EXCEL.
	// Pois esse campo indica se houve suspeita de infecção por parte do enfermeiro(a), não podendo ser alterado após realizar a classificação de risco.
	/*public void atualizarSinalInfeccaoRecepcao(Integer internacao, String suspInfeccao) {
		try {
			PacEmerOtmTemp pacEmerOtmTemp = new PacEmerOtmTemp();
		    pacEmerOtmTemp.setIsnInternacao(internacao);
		
			pacEmerOtmTemp = PacEmerOtmTempImpl.getInstancia().get(pacEmerOtmTemp, 0);
			if (pacEmerOtmTemp != null){
				pacEmerOtmTemp.setFlgSuspeitaInfeccao( suspInfeccao );
				PacEmerOtmTempImpl.getInstancia().alterar(pacEmerOtmTemp);
				
				ClassificacaoRiscoPepBean cr = new ClassificacaoRiscoPepBean();
		        cr.setIsnInternacao(internacao);
		        List<ClassificacaoRiscoPepBean> listClassificacaoTemp = ClassificacaoRiscoImpl.getInstancia().pesquisar(cr, 0);
		        if (listClassificacaoTemp != null || listClassificacaoTemp.size() > 0){
		        	listClassificacaoTemp.get(0).setFlgSuspeitaInfeccao( suspInfeccao );
		        	ClassificacaoRiscoImpl.getInstancia().alterar(listClassificacaoTemp.get(0));
		        }
			}
		} catch (Exception e) {
			e.printStackTrace();
		}
	}*/
	
	private void salvarSinaisSepse(ProtocoloSepse protocoloSepse) throws Exception {
		if(lstProtocoloSepseSinaisResp != null && lstProtocoloSepseSinaisResp.size() > 0){
			for (ProtocoloSepseSinaisResp protocoloSepseSinaisResp : lstProtocoloSepseSinaisResp) {
				ProtocoloSepseSinaisResp vo = new ProtocoloSepseSinaisResp();
				vo.setProtocoloSepse(protocoloSepse);
				vo.setIsnProtocoloSepseSinais(protocoloSepseSinaisResp.getIsnProtocoloSepseSinais());
				vo.setDscProtocoloSepseSinais(protocoloSepseSinaisResp.getDscProtocoloSepseSinais());
				ProtocoloSepseSinaisRespImpl.getInstancia().inserir(vo);
			}
		}
	}
	
	private String retornarDescricaoDoSelectItemPorIsn( List<SelectItem> sliGenerica , Integer chave) {
		for (SelectItem selectItem : sliGenerica) {
			if (selectItem.getValue() != null && selectItem.getValue().equals(chave)){
				return selectItem.getLabel();
			}				
		}
		return "";
	}
	
	public void vincularInternacaoAtendimentoSepse(Integer isnProtocoloSepse) throws Exception{
		if (pacienteOtimizado.getIsnInternacao() != null && !pacienteOtimizado.getIsnInternacao().equals(0)){
			List<InternacaoAtendimento> listaAtendimento = InternacaoAtendimentoImpl.getInstancia().pesquisar(new InternacaoAtendimento(pacienteOtimizado.getIsnInternacao()), 0);
			InternacaoAtendimento atendOld =  ((listaAtendimento != null && listaAtendimento.size() > 0)?listaAtendimento.get(0):null);
			atendOld.setIsnProtocoloSepse(protocoloSepse.getIsnProtocoloSepse());
			InternacaoAtendimentoImpl.getInstancia().alterar(atendOld);
		}
	}
	
	public void removerExame(){
		lstExameSolicSepse.remove(exameSolicPepBean);
	}
	
	public void gravarEmailSepse() throws Exception{
		Parametro parametro = new Parametro();
		parametro.setIsnParametro(ParametroImpl.DESCRICAO_UPA);
		parametro = ParametroImpl.getInstancia().get(parametro, 0);
		
		String dscUnidade = "UPA: " + parametro.getVlrParametro();
		
		String texto = 
				   "<h2> <p> Caro, este e-mail foi enviado automaticamente pelo sistema ARS VITAE, com o intuito de alertar a indicação de Paciente com protocolo SEPSE. </p> </h2> "+
				   "<p> Foi cadastrado protocolo SEPSE na unidade <b>" + dscUnidade + " </b> para o seguinte paciente: </p>" +
				   "<p> </p>"+
				   "<p>Nome: " + pacienteOtimizado.getDscNome() + "</p>" +
			       "<p>Prontuário: " + pacienteOtimizado.getNumProntuario() + "</p>" +
			       "<p>Data e Hora: " + new SimpleDateFormat("dd/MM/yyyy HH:mm").format(new Date()) + "</p>"; 
		
		EmailSepse emailSepse = new EmailSepse(new Date(), texto, 1);
		new EmailSepseFacadeImpl().inserir(emailSepse);
	}
	
	public PrescricaoPep gravarPrescricaoSepse(Double qtdVolume) throws Exception{
		PrescricaoPep retorno = new PrescricaoPep();
		try {
			PrescricaoPep prescricaoPep = new PrescricaoPep();
			prescricaoPep.setIsnInternacao(pacienteOtimizado.getIsnInternacao());
			String dscPrescricao = "SOLUÇÃO FISIOLÓGICA 0,9% - FR";
			dscPrescricao = dscPrescricao + " / " + qtdVolume + " ML / INTRAVENOSA";
			prescricaoPep.setDscPrescricao(dscPrescricao);
			prescricaoPep.setPaginaOrigem(this.getPaginaOrigem());
			prescricaoPep.setFlgImp("N");
			prescricaoPep.setIsnInternacaoLeito(pacienteOtimizado.getIsnInternacaoLeito());
			retorno = PrescricaoPepImpl.getInstancia().verificarPrescricao(prescricaoPep);
		} catch (Exception e) {
			e.printStackTrace();
		}
		return retorno;
	}
	
	public void gravarPrescricaoPepiSepse() {
		/*
		PrescricaoPep objPrescricaoPep = new PrescricaoPep();
		objPrescricaoPep.setDatPrescricao(new Date());
		
		carregarPrescricao();
		
		if (lstPrescricaoPep != null && lstPrescricaoPep.size() > 0)
			objPrescricaoPep.setIsnPrescricaoTipo(ACRESCIMO);
		else
			objPrescricaoPep.setIsnPrescricaoTipo(ADMISSAO);
		 
		objPrescricaoPep.setIsnPrescricaoTipo(11);
		try {
			objPrescricaoPep.setIsnProfissional(jsfUtil.getUsuarioLogado().getIsnUsuario());
			Integer internacaoLeito = new InternacaoLeitoFacadeImpl().buscaMaxInternacaoLeitoOcupado(pacienteOtimizado.getIsnInternacao()).getIsnInternacaoLeito();
			PrescricaoPep prescricaoPep = new PrescricaoPep();
			prescricaoPep.setIsnInternacao(pacienteOtimizado.getIsnInternacao());
			List<PrescricaoPep> listaPrescricaoPepi = PrescricaoPepImpl.getInstancia().pesquisar(prescricaoPep, PrescricaoPepImpl.JOIN_USUARIO
																							   | PrescricaoPepImpl.JOIN_USUARIO_CONCLUSAO
																							   | PrescricaoPepImpl.JOIN_PRESCRICAO_TIPO,
																							   Criteria.DISTINCT_ROOT_ENTITY);		
			objPrescricaoPep.setIsnInternacao(pacienteOtimizado.getIsnInternacao());
			objPrescricaoPep.setIsnInternacaoLeito(internacaoLeito);
			objPrescricaoPep =  PrescricaoPepImpl.getInstancia().criarPrescricao(listaPrescricaoPepi,objPrescricaoPep);
			//apenas para pegar o usuario e tipo de prescricao impressos no cabecalho da tela de prescricoes itens
			PrescricaoPep filter = new PrescricaoPep();
			filter.setIsnPrescricaoPep(objPrescricaoPep.getIsnPrescricaoPep());
			objPrescricaoPep = PrescricaoPepImpl.getInstancia().get(filter, PrescricaoPepImpl.JOIN_PRESCRICAO_TIPO
																| PrescricaoPepImpl.JOIN_USUARIO
																| PrescricaoPepImpl.JOIN_USUARIO_CONCLUSAO);
			
		} catch (Exception e) {
			e.getMessage();
			return null; 
		}
		return objPrescricaoPep;
		*/
	}
	
	
	
	public void carregarProtocoloSepseByIsnInternacao() throws Exception{
		
		ProtocoloSepse p = new ProtocoloSepse();
		
		p.setIsnInternacao(isnInternacao);
		listProtocoloSepse = ProtocoloSepseImpl.getInstancia().pesquisar(p, ProtocoloSepseImpl.JOIN_EXAME|ProtocoloSepseImpl.JOIN_PROFISSIONAL|ProtocoloSepseImpl.JOIN_PROTOCOLO_SEPSE_SINAIS_RESP, Criteria.DISTINCT_ROOT_ENTITY);
		ordenarListaProtocoloSepse();
		for (ProtocoloSepse protocoloSepse : listProtocoloSepse) {
			strProtocoloSepseSinaisResp = "";
			protocoloSepse.setExames(new ArrayList<ExameSolicitacaoPepBean>());
			protocoloSepse.setExames(retornarExamesDoSepse(protocoloSepse.getIsnProtocoloSepse()));
			for (ProtocoloSepseSinaisResp protocoloSepseSinaisResp : protocoloSepse.getListProtocoloSepseSinaisResp()) {
				strProtocoloSepseSinaisResp += protocoloSepseSinaisResp.getDscProtocoloSepseSinais() + "<br/> \r\n";
			}
			protocoloSepse.setStrProtocoloSepseSinaisResp(strProtocoloSepseSinaisResp);
		}
		
		if (listProtocoloSepse != null && listProtocoloSepse.size() > 0){
			popularClassificacaoRiscoSepse(listProtocoloSepse.get(0).getIsnInternacao());
		}
		
	}
	
	public void carregaHistoricoEvolucaoSepse() throws Exception {
		carregarProtocoloSepse();
		listEvolucaoSepseAtendimento = new ArrayList<EvolucaoSepse>();
		for(ProtocoloSepse ps : listProtocoloSepse) {
			EvolucaoSepse evolucaoSepse = new EvolucaoSepse();
			evolucaoSepse.setIsnProtocoloSepse(ps.getIsnProtocoloSepse());	
			final List<EvolucaoSepse> lst =  EvolucaoSepseImpl.getInstancia().pesquisar(evolucaoSepse, EvolucaoSepseImpl.JOIN_PROFISSIONAL);
			for(EvolucaoSepse es : lst) {
				listEvolucaoSepseAtendimento.add(es);
			}
		}	
		
		
		
	}
	
	public void carregarProtocoloSepse() throws Exception{
		ProtocoloSepse p = new ProtocoloSepse();
		p.setIsnInternacao(pacienteOtimizado.getIsnInternacao());
		listProtocoloSepse = ProtocoloSepseImpl.getInstancia().pesquisar(p, ProtocoloSepseImpl.JOIN_EXAME|ProtocoloSepseImpl.JOIN_PROFISSIONAL|ProtocoloSepseImpl.JOIN_PROTOCOLO_SEPSE_SINAIS_RESP, Criteria.DISTINCT_ROOT_ENTITY);
		ordenarListaProtocoloSepse();
		for (ProtocoloSepse protocoloSepse : listProtocoloSepse) {
			strProtocoloSepseSinaisResp = "";
			protocoloSepse.setExames(new ArrayList<ExameSolicitacaoPepBean>());
			protocoloSepse.setExames(retornarExamesDoSepse(protocoloSepse.getIsnProtocoloSepse()));
			for (ProtocoloSepseSinaisResp protocoloSepseSinaisResp : protocoloSepse.getListProtocoloSepseSinaisResp()) {
				strProtocoloSepseSinaisResp += protocoloSepseSinaisResp.getDscProtocoloSepseSinais() + "<br/> \r\n";
			}
			protocoloSepse.setStrProtocoloSepseSinaisResp(strProtocoloSepseSinaisResp);
		}
		
		if (listProtocoloSepse != null && listProtocoloSepse.size() > 0){
			popularClassificacaoRiscoSepse(listProtocoloSepse.get(0).getIsnInternacao());
		}
		
	}
	
	public void ordenarListaProtocoloSepse(){
		Collections.sort(listProtocoloSepse, new Comparator<Object>() {
			public int compare(Object obj1, Object obj2) {
				ProtocoloSepse u1 = (ProtocoloSepse) obj1;
				ProtocoloSepse u2 = (ProtocoloSepse) obj2;
				return u2.getIsnProtocoloSepse().compareTo(u1.getIsnProtocoloSepse());
			}
		});
	}
	
	public List<ExameSolicitacaoPepBean> retornarExamesDoSepse(Integer isnProtocoloSepse) throws Exception{
		if (isnProtocoloSepse == null || isnProtocoloSepse.equals(0)){
			return new ArrayList<ExameSolicitacaoPepBean>();
		}
		ExameSolicitacaoPepBean exameSolicitacaoPepBeanTemp = new ExameSolicitacaoPepBean();
		exameSolicitacaoPepBeanTemp.setIsnProtocoloSepse(isnProtocoloSepse);
		List<ExameSolicitacaoPepBean> list = ExameSolicitacaoImpl.getInstancia().pesquisar(exameSolicitacaoPepBeanTemp, ExameSolicitacaoImpl.JOIN_EXAME |
																														ExameSolicitacaoImpl.JOIN_EXAME_SITUACAO,
																														Criteria.DISTINCT_ROOT_ENTITY);
		return list;
	}
	
	public void carregarProtocoloSepseEnfermagem() throws Exception{
		listProtocoloSepseEnfermagem = new ArrayList<ProtocoloSepse>();
		ProtocoloSepse p = new ProtocoloSepse();
		p.setIsnInternacao(pacienteOtimizado.getIsnInternacao());
		List<ProtocoloSepse> listProtocoloSepseEnf = ProtocoloSepseImpl.getInstancia().pesquisar(p, ProtocoloSepseImpl.JOIN_EXAME|ProtocoloSepseImpl.JOIN_PROFISSIONAL, Criteria.DISTINCT_ROOT_ENTITY);
		if (listProtocoloSepseEnf != null && listProtocoloSepseEnf.size() > 0){
			if (listProtocoloSepseEnf.get(0) != null && listProtocoloSepseEnf.get(0).getDscPa() != null && !listProtocoloSepseEnf.get(0).getDscPa().trim().equals("") &&
					listProtocoloSepseEnf.get(0).getPeso() != null && !listProtocoloSepseEnf.get(0).getPeso().equals(0.0)){
				listProtocoloSepseEnfermagem.add(listProtocoloSepseEnf.get(0));
			}
		}
	}
	
	public void popularClassificacaoRiscoSepse(Integer isnInternacao) throws Exception{
		strRiscoSepse = "";
		if (isnInternacao != null && !isnInternacao.equals(0)){
			classificacaoRiscoSepse = new ClassificacaoRisco();
			classificacaoRiscoSepse = new ClassificacaoRiscoFacadeImpl().maximoClassificacaoRisco(isnInternacao);
			
			SinaisSirsRisco filter = new SinaisSirsRisco();
			filter.setIsnInternacaoRisco(classificacaoRiscoSepse.getIsnInternacaoRisco());
			List<SinaisSirsRisco> list = SinaisSirsRiscoImpl.getInstancia().pesquisar(filter , 0);
			for (SinaisSirsRisco sinaisSirsRisco : list) {
				strRiscoSepse += sinaisSirsRisco.getDscSinaisSirs() + "<br/> \r\n";
			}
		}
	}
	
	public String retornarStrCod(Integer cod){
		switch (cod) {
		case 1:
			return "01 - Rebaixamento do nível de consciência";
		case 2:
			return "02 - Hipertermia (temperatura > 37,8°C)";
		case 3:
			return "03 - Taquipnéia (FR > 22 RPM)";
		case 4:
			return "04 - Taquicardia (Fc > 100bpm)";
		case 5:
			return "05 - Dessaturação (Sp02 < 92%)";
		case 6:
			return "06 - Hipotermia (temperatura < 35°C)";
		case 7:
			return "07 - Não apresenta sinais de SIRS";			
		default:
			return "";
		}
	}
	
	public String imprimirAberturaSepse(){
		return imprimirAberturaSepseGenerico(null);
	}
	
	public String printAberturaSepse(ProtocoloSepse ps) {
		isnInternacao = ps.getIsnInternacao();
		return imprimirAberturaSepseGenerico(ps.getIsnProtocoloSepse());
	}
	
	public String imprimirAberturaSepseIndividual(Integer isnProtocoloSepse){		
		return imprimirAberturaSepseGenerico(isnProtocoloSepse);
	}
	
	public String imprimirAberturaSepseGenerico(Integer p_protocolo_sepse)
	{
		Connection con = null;
		try {
			HttpServletRequest request = (HttpServletRequest) FacesContext
					.getCurrentInstance().getExternalContext().getRequest();

			String imagemRelatorio = retornaStrParametro(ParametroImpl.LOGO_UPA, false);
			String pathJasper = request.getRealPath("WEB-INF/classes/relatorio");
			String pathJasperImg = request.getRealPath("IMG/" + this.IMG_NAME);
			String pathJasperImg2 = request.getRealPath("images/paciente/" + imagemRelatorio);
			String os = System.getProperty("os.name");
			File pasta = new File((os.toLowerCase().indexOf("linux") > -1 ? "/" : "\\"));
			pathJasper += pasta;

			JasperReport jasperReport = (JasperReport) JRLoader
					.loadObject(pathJasper + "/" + this.REPORT_NAME8
							+ ".jasper");

			if (jasperReport == null) {
				FacesContext.getCurrentInstance().addMessage(
						null,
						new FacesMessage(FacesMessage.SEVERITY_WARN,
								"Nenhum relatório selecionado.", null));
			}
			
			Integer isnInternacaoGeneric = (isnInternacao == null || isnInternacao.intValue() == 0) ? pacienteOtimizado.getIsnInternacao() : isnInternacao;
			
			Map parameters = setaParametrosDoRelatorioSepse(pathJasper, pathJasperImg, pathJasperImg2, isnInternacaoGeneric, 
					(p_protocolo_sepse == null ? listProtocoloSepse.get(0).getIsnProtocoloSepse() : p_protocolo_sepse));
			// PARAMETROS CONEXAO BANCO DE DADOS - INICIO
			String urlBd = "", userBd = "", senhaBd = "";
			urlBd = retornaStrParametro(ParametroImpl.URL_CONEXAO_BANCO_DADOS, false);
			userBd = retornaStrParametro(ParametroImpl.USUARIO_BANCO_DADOS, false);
			senhaBd = retornaStrParametro(ParametroImpl.SENHA_CRIPTOGRAFADA_BANCO_DADOS, true);
			// PARAMETROS CONEXAO BANCO DE DADOS - FIM
			con = imprimirRelatorioEmPdf(request, jasperReport, parameters, urlBd, userBd, senhaBd);
			con.close();
		} catch (Exception e) {
			if (con != null) {
				try {
					con.close();
				} catch (SQLException e1) {
					e1.printStackTrace();
				}
			}
			e.printStackTrace();
		}

		return null;
	}

	private Connection imprimirRelatorioEmPdf(HttpServletRequest request, JasperReport jasperReport, Map parameters,
			String urlBd, String userBd, String senhaBd) throws SQLException, JRException, IOException {
		Connection con;
		con = (Connection) DriverManager.getConnection(urlBd, userBd,
				senhaBd);

		JasperPrint impressao = JasperFillManager.fillReport(jasperReport,
				parameters, con);

		String pathPdf = "/temp/" + request.getRequestedSessionId()
				+ String.valueOf(Math.random() * 10000) + this.REPORT_NAME8
				+ ".pdf";

		JasperExportManager.exportReportToPdfFile(impressao,
				request.getRealPath("") + pathPdf);

		HttpServletResponse response = (HttpServletResponse) FacesContext
				.getCurrentInstance().getExternalContext().getResponse();
		response.sendRedirect(request.getContextPath() + pathPdf);
		return con;
	}

	private Map setaParametrosDoRelatorioSepse(String pathJasper, String pathJasperImg, String pathJasperImg2, Integer p_internacao, Integer p_protocolo_sepse) {
		Map parameters = new HashMap();
		parameters.put("CAMINHO_SUB_REPORT", pathJasper);
		parameters.put("CAMINHO_IMG", pathJasperImg);
		parameters.put("CAMINHO_IMG2", pathJasperImg2);
		parameters.put("p1", p_internacao);
		parameters.put("p2", p_protocolo_sepse);
		parameters.put("STRRISCOSEPSE", strRiscoSepse);
		populaParametroSepseSinais();
		parameters.put("STRPROTOCOLOSEPSESINAISRESP", strProtocoloSepseSinaisResp);
		return parameters;
	}

	private void populaParametroSepseSinais() {
		if(!strProtocoloSepseSinaisResp.equals("")){
			String[] split = strProtocoloSepseSinaisResp.split("<br/> \r\n");
			List<String> list = Arrays.asList(split);
			strProtocoloSepseSinaisResp = "";
			for (String string : list) {
				strProtocoloSepseSinaisResp += string + "<br/> \r\n";
			}
		}
	}

	private String retornaStrParametro(int filtro, boolean ehSenha) throws Exception {
		Parametro parametro = new Parametro(filtro);
		parametro = ParametroImpl.getInstancia().get(parametro, 0);
		if (ehSenha)
			return IsghEncodeDecode.decrypt(parametro.getVlrParametro());
		else
			return parametro.getVlrParametro();
	}
	
	private void popularEstaNaRecepcaoOuSalaDeEspera() throws Exception{
		InternacaoLeitoBean internacaoLeitoBean = new InternacaoLeitoBean();
		internacaoLeitoBean.setIsnInternacaoLeito(pacienteOtimizado.getIsnInternacaoLeito());
		internacaoLeitoBean = InternacaoLeitoImpl.getInstancia().get(internacaoLeitoBean, 0);
		
		if ((internacaoLeitoBean.getFlgRecepcao() != null && internacaoLeitoBean.getFlgRecepcao().equals("S")) || 
				(pacienteOtimizado.getIsnClinica().equals(FuncUtil.obterCodigoClinicaEmergencia()))){
			setEstaNaRecepcaoOuSalaDeEspera(true);
		}else{
			setEstaNaRecepcaoOuSalaDeEspera(false);
		}
	}
	
	public void limparSepse(){
		protocoloSepse = new ProtocoloSepse();
	}
	
	public static long getSerialversionuid() {
		return serialVersionUID;
	}

	public void setTotaisRisco(Integer totaisRisco[]) {
		this.totaisRisco = totaisRisco;
	}

	public Integer[] getTotaisRisco() {
		return totaisRisco;
	}

	public void setLstPacientesEmergencia(
			List<PacienteEmergencia> lstPacientesEmergencia) {
		this.lstPacientesEmergencia = lstPacientesEmergencia;
	}

	public List<PacienteEmergencia> getLstPacientesEmergencia() {
		return lstPacientesEmergencia;
	}

	public void setTotalEmergencia(Integer totalEmergencia) {
		this.totalEmergencia = totalEmergencia;
	}

	public Integer getTotalEmergencia() {
		return totalEmergencia;
	}

	public void setUsuario(String usuario) {
		this.usuario = usuario;
	}

	public String getUsuario() {
		return usuario;
	}

	public void setSenha(String senha) {
		this.senha = senha;
	}

	public String getSenha() {
		return senha;
	}

	public void setAvisoValidacao(Integer avisoValidacao) {
		this.avisoValidacao = avisoValidacao;
	}

	public Integer getAvisoValidacao() {
		return avisoValidacao;
	}

	public void setPaciente(PacienteEmergencia paciente) {
		this.paciente = paciente;
	}

	public PacienteEmergencia getPaciente() {
		return paciente;
	}

	public void setLstRiscos(List<SelectItem> lstRiscos) {
		this.lstRiscos = lstRiscos;
	}

	public List<SelectItem> getLstRiscos() {
		// COMENTADO POIS ESTA LISTA SERA POPULADA SOMENTE QUANDO ABRIR O PANEL
		// DE CLASSIFICACAO DE RISCO

		// if (lstRiscos==null) {
		// List<Risco> lista = new InternacaoFacadeImpl().listarRiscos();
		// lstRiscos = new ArrayList<SelectItem>();
		// lstRiscos.add(new SelectItem(0,"SELECIONE"));
		// for (Risco r : lista) {
		// lstRiscos.add(new SelectItem(r.getIsnRisco(), r.getDscRisco()));
		// }
		// }
		if (lstRiscos == null)
			lstRiscos = new ArrayList<SelectItem>();
		return lstRiscos;
	}

	public void setIsnRisco(Integer isnRisco) {
		this.isnRisco = isnRisco;
	}

	public Integer getIsnRisco() {
		return isnRisco;
	}

	public void setIsnEspecialidadeEmergencia(Integer isnEspecialidadeEmergencia) {
		this.isnEspecialidadeEmergencia = isnEspecialidadeEmergencia;
	}

	public Integer getIsnEspecialidadeEmergencia() {
		return isnEspecialidadeEmergencia;
	}

	public void setLstEspecialidadeEmergencia(
			List<SelectItem> lstEspecialidadeEmergencia) {
		this.lstEspecialidadeEmergencia = lstEspecialidadeEmergencia;
	}

	public List<SelectItem> getLstEspecialidadeEmergencia() {
		// COMENTADO POIS ESTA LISTA SERA POPULADA SOMENTE QUANDO ABRIR O PANEL
		// DE CLASSIFICACAO DE RISCO

		// if (lstEspecialidadeEmergencia==null) {
		// List<EspecialidadeEmergencia> lista = new
		// EspecialidadeEmergenciaFacadeImpl().listarEspecialidadeEmergencia();
		// lstEspecialidadeEmergencia = new ArrayList<SelectItem>();
		// lstEspecialidadeEmergencia.add(new SelectItem(0,"SELECIONE"));
		// for ( EspecialidadeEmergencia ee : lista) {
		// lstEspecialidadeEmergencia.add(new
		// SelectItem(ee.getIsnEspecialidadeEmergencia(),
		// ee.getDscEspecialidadeEmergencia()));
		// }
		// }
		if (lstEspecialidadeEmergencia == null)
			lstEspecialidadeEmergencia = new ArrayList<SelectItem>();
		return lstEspecialidadeEmergencia;
	}

	public void setSliReferencia(ArrayList<SelectItem> sliReferencia) {
		this.sliReferencia = sliReferencia;
	}

	public ArrayList<SelectItem> getSliReferencia() {
		return sliReferencia;
	}

	public void setSliEixos(ArrayList<SelectItem> sliEixos) {
		this.sliEixos = sliEixos;
	}

	public ArrayList<SelectItem> getSliEixos() {
		return sliEixos;
	}

	public void setIsnReferencia(Integer isnReferencia) {
		this.isnReferencia = isnReferencia;
	}

	public Integer getIsnReferencia() {
		return isnReferencia;
	}

	public void setTextoAtendimento(String textoAtendimento) {
		this.textoAtendimento = textoAtendimento;
	}

	public String getTextoAtendimento() {
		return textoAtendimento;
	}

	public void setSliMotivosAlta(ArrayList<SelectItem> sliMotivosAlta) {
		this.sliMotivosAlta = sliMotivosAlta;
	}

	public ArrayList<SelectItem> getSliMotivosAlta() {
		if (sliMotivosAlta == null) {
			sliMotivosAlta = new ArrayList<SelectItem>();
			sliMotivosAlta.add(new SelectItem(EnumMotivosAlta.SELECIONE,
					"SELECIONE"));
			sliMotivosAlta.add(new SelectItem(EnumMotivosAlta.DECISAO_MEDICAO,
					"DECISÃO MÉDICA"));
			sliMotivosAlta.add(new SelectItem(
					EnumMotivosAlta.DECISAO_ADMINISTRATIVA,
					"DECISÃO ADMINISTRATIVA"));
			sliMotivosAlta.add(new SelectItem(
					EnumMotivosAlta.SOLICITACAO_PACIENTE,
					"SOLICITAÇÃO DE FAMILIARES/PAC."));
			sliMotivosAlta
					.add(new SelectItem(EnumMotivosAlta.EVASAO, "EVASÃO"));
			// sliMotivosAlta.add(new
			// SelectItem(EnumMotivosAlta.OUTRO_HOSPITAL,"OUTRO HOSPITAL"));
		}
		return sliMotivosAlta;
	}

	public void setIsnDestino(Integer isnDestino) {
		this.isnDestino = isnDestino;
	}

	public Integer getIsnDestino() {
		return isnDestino;
	}

	public void setImagensRiscos(String[] imagensRiscos) {
		this.imagensRiscos = imagensRiscos;
	}

	public String[] getImagensRiscos() {
		return imagensRiscos;
	}

	public void setSliFluxogramas(ArrayList<SelectItem> sliFluxogramas) {
		this.sliFluxogramas = sliFluxogramas;
	}

	public ArrayList<SelectItem> getSliFluxogramas() {

		// COMENTADO POIS ESTA LISTA SERA POPULADA SOMENTE QUANDO ABRIR O PANEL
		// DE CLASSIFICACAO DE RISCO

		// if (sliFluxogramas == null) {
		// List<Fluxograma> lista = new
		// FluxogramaFacadeImpl().listarFluxogramas();
		// sliFluxogramas = new ArrayList<SelectItem>();
		// sliFluxogramas.add(new SelectItem(0,"SELECIONE"));
		// for ( Fluxograma f : lista) {
		// sliFluxogramas.add(new SelectItem(f.getIsnFluxograma(),
		// f.getDscFluxograma()));
		// }
		// objFluxograma.setIsnFluxograma(FluxogramaFacadeImpl.NAO_INFORMADO);
		// }
		if (sliFluxogramas == null)
			sliFluxogramas = new ArrayList<SelectItem>();
		return sliFluxogramas;
	}

	public void setTextoDiscriminador(String textoDiscriminador) {
		this.textoDiscriminador = textoDiscriminador;
	}

	public String getTextoDiscriminador() {
		return textoDiscriminador;
	}

	public void setIsnFluxograma(Integer isnFluxograma) {
		this.isnFluxograma = isnFluxograma;
	}

	public Integer getIsnFluxograma() {
		return isnFluxograma;
	}

	public void setSliDestinos(ArrayList<SelectItem> sliDestinos) {
		this.sliDestinos = sliDestinos;
	}

	public ArrayList<SelectItem> getSliDestinos() {
		if (sliDestinos == null) {
			// List<EspecialidadeEmergencia> lista = new
			// EspecialidadeEmergenciaFacadeImpl().listarEspecialidadeEmergencia();
			List<DestinoMedico> lista = new DestinoMedicoFacadeImpl()
					.listarDestinoMedico();
			sliDestinos = new ArrayList<SelectItem>();
			sliDestinos.add(new SelectItem(0, "SELECIONE"));
			// sliDestinos.add(new SelectItem(1,"ALTA"));
			for (DestinoMedico dm : lista) {
				if (dm.getIsnDestinoMedico() != null
						&& dm.getIsnDestinoMedico().intValue() != 1) // 1-Alta
				{
					sliDestinos.add(new SelectItem(dm.getIsnDestinoMedico(), dm
							.getDscDestinoMedico()));
				}
			}

			// for ( EspecialidadeEmergencia ee : lista) {
			// sliDestinos.add(new
			// SelectItem(ee.getIsnEspecialidadeEmergencia(),
			// ee.getDscEspecialidadeEmergencia()));
			// }

		}
		return sliDestinos;
	}

	public List<PacienteEmergencia> getLstPacientesEmergenciaPendentes() {
		return lstPacientesEmergenciaPendentes;
	}

	public void setLstPacientesEmergenciaPendentes(
			List<PacienteEmergencia> lstPacientesEmergenciaPendentes) {
		this.lstPacientesEmergenciaPendentes = lstPacientesEmergenciaPendentes;
	}

	public ClassificacaoRisco getCr() {
		return cr;
	}

	public void setCr(ClassificacaoRisco cr) {
		this.cr = cr;
	}

	public ArrayList<SelectItem> getSliAcidente() {

		if (sliAcidente == null) {
			sliAcidente = new ArrayList<SelectItem>();
			sliAcidente.add(new SelectItem(0, "SELECIONE"));
			sliAcidente.add(new SelectItem(1, "SIM"));
			sliAcidente.add(new SelectItem(2, "NÃO"));
		}
		return sliAcidente;
	}

	public void setSliAcidente(ArrayList<SelectItem> sliAcidente) {
		this.sliAcidente = sliAcidente;
	}

	public ArrayList<SelectItem> getSliAgressao() {

		if (sliAgressao == null) {
			sliAgressao = new ArrayList<SelectItem>();
			sliAgressao.add(new SelectItem(0, "SELECIONE"));
			sliAgressao.add(new SelectItem(1, "SIM"));
			sliAgressao.add(new SelectItem(2, "NÃO"));
		}

		return sliAgressao;
	}

	public void setSliAgressao(ArrayList<SelectItem> sliAgressao) {
		this.sliAgressao = sliAgressao;
	}

	public Cid10 getObjCid10() {
		return objCid10;
	}

	public void setObjCid10(Cid10 objCid10) {
		this.objCid10 = objCid10;
	}

	public String getHipotesesDiagnostico() {
		return hipotesesDiagnostico;
	}

	public void setHipotesesDiagnostico(String hipotesesDiagnostico) {
		this.hipotesesDiagnostico = hipotesesDiagnostico;
	}

	public String getComorbidade() {
		return comorbidade;
	}

	public void setComorbidade(String comorbidade) {
		this.comorbidade = comorbidade;
	}

	public String getStrPeso() {
		return strPeso;
	}

	public void setStrPeso(String strPeso) {
		this.strPeso = strPeso;
	}

	public boolean isMostraPanelAtendimento() {
		return mostraPanelAtendimento;
	}

	public void setMostraPanelAtendimento(boolean mostraPanelAtendimento) {
		this.mostraPanelAtendimento = mostraPanelAtendimento;
	}

	public InternacaoAtendimento getObjIa() {
		return objIa;
	}

	public void setObjIa(InternacaoAtendimento objIa) {
		this.objIa = objIa;
	}

	public List<ExameSolicitacaoPepBean> getLstExameSolicEmergencia() {
		return lstExameSolicEmergencia;
	}

	public void setLstExameSolicEmergencia(
			List<ExameSolicitacaoPepBean> lstExameSolicEmergencia) {
		this.lstExameSolicEmergencia = lstExameSolicEmergencia;
	}

	public String getUrl() {
		return url;
	}

	public void setUrl(String url) {
		this.url = url;
	}

	public List<PrescricaoUpaBean> getLstPrescricao() throws Exception {
		this.setDscPrescricao(null);
		this.setEstadoDivPrescricao(1);

		// InternacaoFacade objPFacade = new InternacaoFacadeImpl();
		// Internacao obji = new Internacao();
		// obji = objPFacade.buscarInternacao(paciente.getIsnInternacao());
		//
		// int join = PrescricaoUpaImpl.JOIN_USUARIO;
		//
		// PrescricaoUpaBean prescricaoUpa = new PrescricaoUpaBean();
		// prescricaoUpa.setIsnInternacao(obji.getIsnInternacao());
		// prescricaoUpa.setFlgAtivo("S");

		if (paciente != null && paciente.getIsnInternacao() != null
				&& paciente.getIsnInternacao().intValue() > 0) {
			PrescricaoUpaBean prescricaoUpa = new PrescricaoUpaBean();
			prescricaoUpa.setIsnInternacao(paciente.getIsnInternacao());
			prescricaoUpa.setFlgAtivo("S");

			int join = PrescricaoUpaImpl.JOIN_USUARIO;

			lstPrescricao = PrescricaoUpaImpl.getInstancia().pesquisar(
					prescricaoUpa, join);
		}

		return lstPrescricao;
	}

	public Prescricao getPrescricao() {
		return prescricao;
	}

	public void setPrescricao(Prescricao prescricao) {
		this.prescricao = prescricao;
	}

	public String getMsgRelatorio() {
		return msgRelatorio;
	}

	public void setMsgRelatorio(String msgRelatorio) {
		this.msgRelatorio = msgRelatorio;
	}

	public Integer getIsnInternacao() {
		return isnInternacao;
	}

	public void setIsnInternacao(Integer isnInternacao) {
		this.isnInternacao = isnInternacao;
	}

	public Fluxograma getObjFluxograma() {
		return objFluxograma;
	}

	public void setObjFluxograma(Fluxograma objFluxograma) {
		this.objFluxograma = objFluxograma;
	}

	public Integer getEstadoDivPrescricao() {
		return estadoDivPrescricao;
	}

	public void setEstadoDivPrescricao(Integer estadoDivPrescricao) {
		this.estadoDivPrescricao = estadoDivPrescricao;
	}

	public String getTeste() {
		return teste;
	}

	public void setTeste(String teste) {
		this.teste = teste;
	}

	public String getHorInicialRisco() {
		return horInicialRisco;
	}

	public void setHorInicialRisco(String horInicialRisco) {
		this.horInicialRisco = horInicialRisco;
	}

	public Date getDatInicialRisco() {
		return datInicialRisco;
	}

	public void setDatInicialRisco(Date datInicialRisco) {
		this.datInicialRisco = datInicialRisco;
	}

	public String getHorInicialAtendimento() {
		return horInicialAtendimento;
	}

	public void setHorInicialAtendimento(String horInicialAtendimento) {
		this.horInicialAtendimento = horInicialAtendimento;
	}

	public Date getDatInicialAtendimento() {
		return datInicialAtendimento;
	}

	public void setDatInicialAtendimento(Date datInicialAtendimento) {
		this.datInicialAtendimento = datInicialAtendimento;
	}

	public List<InternacaoDoc> getListaInternacaoDoc() {
		/*
		 * try { InternacaoDoc doc = new InternacaoDoc();
		 * doc.setIsnInternacao(getPaciente().getIsnInternacao()); Integer[]
		 * tipoIn = new Integer[] { InternacaoDocTipoImpl.RECEITA_CONTROLADA,
		 * InternacaoDocTipoImpl.RECEITA_LIVRE }; doc.setFiltro(new
		 * HashMap<String, Object>());
		 * doc.getFiltro().put("isnInternacaoDocTipoIN", tipoIn);
		 * setListaInternacaoDoc(InternacaoDocImpl.getInstancia().pesquisar(doc,
		 * 0)); } catch (Exception e) { setListaInternacaoDoc(new
		 * ArrayList<InternacaoDoc>()); }
		 */
		return listaInternacaoDoc;
	}

	public void setListaInternacaoDoc(List<InternacaoDoc> listaInternacaoDoc) {
		this.listaInternacaoDoc = listaInternacaoDoc;
	}

	public List<InternacaoDoc> getListaInternacaoDocAtestado() {
		/*
		 * try { InternacaoDoc doc = new InternacaoDoc();
		 * doc.setIsnInternacao(getPaciente().getIsnInternacao());
		 * doc.setIsnInternacaoDocTipo(InternacaoDocTipoImpl.ATESTADO);
		 * setListaInternacaoDocAtestado
		 * (InternacaoDocImpl.getInstancia().pesquisar(doc, 0)); } catch
		 * (Exception e) { setListaInternacaoDocAtestado(new
		 * ArrayList<InternacaoDoc>()); }
		 */
		return listaInternacaoDocAtestado;
	}

	public void setListaInternacaoDocAtestado(
			List<InternacaoDoc> listaInternacaoDocAtestado) {
		this.listaInternacaoDocAtestado = listaInternacaoDocAtestado;
	}

	public void setLstPrescricao(List<PrescricaoUpaBean> lstPrescricao) {
		this.lstPrescricao = lstPrescricao;
	}

	public boolean isOrigemTelaRecpcao() {
		return origemTelaRecpcao;
	}

	public void setOrigemTelaRecpcao(boolean origemTelaRecpcao) {
		this.origemTelaRecpcao = origemTelaRecpcao;
	}

	public String getPermissaoEnf() {
		return permissaoEnf;
	}

	public void setPermissaoEnf(String permissaoEnf) {
		this.permissaoEnf = permissaoEnf;
	}

	public String getPermissaoMed() {
		return permissaoMed;
	}

	public void setPermissaoMed(String permissaoMed) {
		this.permissaoMed = permissaoMed;
	}

	public String getMensagem() {
		return mensagem;
	}

	public void setMensagem(String mensagem) {
		this.mensagem = mensagem;
	}

	public List<InternacaoEvolucao> getListaEvolucao() {
		/*
		 * try { if(paciente != null && paciente.getIsnInternacao() != null &&
		 * paciente.getIsnInternacao().intValue() > 0) { InternacaoEvolucao evo
		 * = new InternacaoEvolucao();
		 * evo.setIsnInternacao(paciente.getIsnInternacao());
		 * evo.setFlgAtivo("S");
		 * setListaEvolucao(InternacaoEvolucaoImpl.getInstancia().pesquisar(evo,
		 * InternacaoEvolucaoImpl.JOIN_USUARIO)); } } catch (Exception e) {
		 * setListaEvolucao(new ArrayList<InternacaoEvolucao>()); }
		 */
		return listaEvolucao;
	}

	public void setListaEvolucao(List<InternacaoEvolucao> listaEvolucao) {
		this.listaEvolucao = listaEvolucao;
	}

	public String getDscEvolucao() {

		return dscEvolucao;
	}

	public void setDscEvolucao(String dscEvolucao) {
		this.dscEvolucao = dscEvolucao;
	}

	public Integer getIsnInternacaoEvolucao() {
		return isnInternacaoEvolucao;
	}

	public void setIsnInternacaoEvolucao(Integer isnInternacaoEvolucao) {
		this.isnInternacaoEvolucao = isnInternacaoEvolucao;
	}

	public List<InternacaoAtendimentoPepBean> getListaInternacaoAtendimento()
			throws Exception {
		return listaInternacaoAtendimento;
	}

	public void setListaInternacaoAtendimento(
			List<InternacaoAtendimentoPepBean> listaInternacaoAtendimento) {
		this.listaInternacaoAtendimento = listaInternacaoAtendimento;
	}

	public boolean isUsuarioMedico() {
		try {
			usuarioMedico = false;
			Usuario usuario = new Usuario();
			usuario.setIsnUsuario(jsfUtil.getUsuarioLogado().getIsnUsuario());
			usuario = UsuarioImpl.getInstancia().get(
					usuario,
					UsuarioImpl.JOIN_USUARIO_GRUPO
							| UsuarioImpl.JOIN_USUARIOGRUPO_GRUPO,
					Criteria.DISTINCT_ROOT_ENTITY);

			if (usuario != null && usuario.getUsuarioGrupoBean() != null
					&& !usuario.getUsuarioGrupoBean().isEmpty()) {
				for (UsuarioGrupo usrGrp : usuario.getUsuarioGrupoBean()) {
					if (usrGrp.getGrupoBean().getDscGrupo()
							.equalsIgnoreCase("MEDICOS")) {
						usuarioMedico = true;
						break;
					}
				}
			} else {
				usuarioMedico = false;
			}
		} catch (Exception e) {
			usuarioMedico = false;
			e.printStackTrace();
		}
		return usuarioMedico;
	}

	public void carregarHistoricoGeral() {
		listaExames = new ArrayList<ExameSolicitacaoPepBean>();
		listaAtendimentos = new ArrayList<InternacaoAtendimento>();
		listaPrescricaoPep = new ArrayList<PrescricaoPep>();
		listaDocAtestado = new ArrayList<InternacaoDoc>();
		listaDocReceituario = new ArrayList<InternacaoDoc>();
		listaInternacoes = new InternacaoFacadeImpl()
				.listarInternacaoResumo(this.getPaciente().getIsnPaciente());
	}

	public String carregarReceituarioHistoricoGeral() {
		try {
			InternacaoDoc doc = new InternacaoDoc();
			doc.setIsnInternacao(internacaoSelecionada.getIsnInternacao());
			Integer[] tipoIn = new Integer[] {
					InternacaoDocTipoImpl.RECEITA_CONTROLADA,
					InternacaoDocTipoImpl.RECEITA_LIVRE };
			doc.setFiltro(new HashMap<String, Object>());
			doc.getFiltro().put("isnInternacaoDocTipoIN", tipoIn);
			setListaDocReceituario(InternacaoDocImpl.getInstancia().pesquisar(
					doc, 0));
		} catch (Exception e) {
			setListaDocReceituario(new ArrayList<InternacaoDoc>());
		}

		return "";
	}

	public String carregarExamesHistoricoGeral() throws Exception {
		try {
			ExameSolicitacaoPepBean exameSolicitacaoPepBean = new ExameSolicitacaoPepBean();
			exameSolicitacaoPepBean.setIsnInternacao(internacaoSelecionada
					.getIsnInternacao());
			exameSolicitacaoPepBean.setFiltroMap(new HashMap<String, Object>());
			exameSolicitacaoPepBean
					.getFiltroMap()
					.put("isnExameSituacaoNotIn",
							new Integer[] { ExameSolicitacaoImpl.EXAME_SOLICITACAO_SITUACAO_CANCELADA });

			List<ExameSolicitacaoPepBean> lstExameSolicEmergencia2 = ExameSolicitacaoImpl
					.getInstancia()
					.pesquisar(
							exameSolicitacaoPepBean,
							ExameSolicitacaoImpl.JOIN_EXAME
									| ExameSolicitacaoImpl.JOIN_EXAME_SITUACAO
									| ExameSolicitacaoImpl.JOIN_EXAME_SOLIC_WS_DETALHE);
			setListaExames(lstExameSolicEmergencia2);
		} catch (Exception e) {
			setListaExames(new ArrayList<ExameSolicitacaoPepBean>());
		}

		return "";
	}

	public String carregarAtestadoHistoricoGeral() {
		try {
			InternacaoDoc doc = new InternacaoDoc();
			doc.setIsnInternacao(internacaoSelecionada.getIsnInternacao());
			Integer[] tipoIn = new Integer[] { InternacaoDocTipoImpl.ATESTADO,
					InternacaoDocTipoImpl.ATESTADO_LIVRE };

			doc.setFiltro(new HashMap<String, Object>());
			doc.getFiltro().put("isnInternacaoDocTipoIN", tipoIn);

			this.setListaDocAtestado(InternacaoDocImpl.getInstancia()
					.pesquisar(doc, 0));

		} catch (Exception e) {
			setListaDocAtestado(new ArrayList<InternacaoDoc>());
		}
		return "";
	}

	public void carregarAtendimentosHistoricoGeral() {
		listaAtendimentos = new InternacaoAtendimentoFacadeImpl()
				.listaAtendimentosResumo(internacaoSelecionada
						.getIsnInternacao());
	}

	public void carregarPrescricoesHistoricoGeral() {
		try {
			PrescricaoPep pep = new PrescricaoPep();
			pep.setIsnInternacao(internacaoSelecionada.getIsnInternacao());
			HashMap<String, Object> filtroPep = new HashMap<String, Object>();
			filtroPep.put("flgAtivo", "S");
			pep.setFiltro(filtroPep);

			List<PrescricaoPep> lista = PrescricaoPepImpl
					.getInstancia()
					.pesquisar(
							pep,
							PrescricaoPepImpl.JOIN_USUARIO
									| PrescricaoPepImpl.JOIN_USUARIO_CONCLUSAO
									| PrescricaoPepImpl.JOIN_PRESCRICAO_PEP_ITEM,
							Criteria.DISTINCT_ROOT_ENTITY);

			if (lista != null && lista.size() > 0) {
				this.setListaPrescricaoPep(lista);
			}
		} catch (Exception e) {
			e.printStackTrace();
		}
	}
	
	private List<TipoAcidenteVeiculo> carregaListaTipoAcidenteVeiculo() {
		List<TipoAcidenteVeiculo> lista = null;
		try {
			TipoAcidenteVeiculoFacade tipoAcidenteVeiculoFacade = new TipoAcidenteVeiculoFacadeImpl();
			lista = tipoAcidenteVeiculoFacade.buscaTipoAcidenteVeiculo();
		} catch (Exception e) {
			e.printStackTrace();
		}
		return lista;
	}
	
	private List<PosicaoAcidente> carregaListaPosicaoAcidente() {
		List<PosicaoAcidente> lista = null;
		try {
			PosicaoAcidenteFacade posicaoAcidenteFacade = new PosicaoAcidenteFacadeImpl();
			lista = posicaoAcidenteFacade.buscaPosicaoAcidente();
		} catch (Exception e) {
			e.printStackTrace();
		}
		return lista;
	}
	
	private List<RegiaoAfetada> carregaListaRegiaoAfetada() {
		List<RegiaoAfetada> lista = null;
		try {
			RegiaoAfetadaFacade regiaoAfetadaFacade = new RegiaoAfetadaFacadeImpl();
			lista = regiaoAfetadaFacade.buscaListaRegiaoAfetada();
		} catch (Exception e) {
			e.printStackTrace();
		}
		return lista;
	}

	public List<InternacaoBean> getListaInternacoes() {
		return listaInternacoes;
	}

	public void setListaInternacoes(List<InternacaoBean> listaInternacoes) {
		this.listaInternacoes = listaInternacoes;
	}

	public void setUsuarioMedico(boolean usuarioMedico) {
		this.usuarioMedico = usuarioMedico;
	}

	public String getNomeProfissionalAtendimento() {
		return nomeProfissionalAtendimento;
	}

	public void setNomeProfissionalAtendimento(
			String nomeProfissionalAtendimento) {
		this.nomeProfissionalAtendimento = nomeProfissionalAtendimento;
	}

	public boolean isPossuiChamada() {
		return possuiChamada;
	}

	public void setPossuiChamada(boolean possuiChamada) {
		this.possuiChamada = possuiChamada;
	}

	public Integer getIsnEixoSelecionado() {
		return isnEixoSelecionado;
	}

	public void setIsnEixoSelecionado(Integer isnEixoSelecionado) {
		this.isnEixoSelecionado = isnEixoSelecionado;
	}

	public Integer getAvisoLiberacaoPaciente() {
		return avisoLiberacaoPaciente;
	}

	public void setAvisoLiberacaoPaciente(Integer avisoLiberacaoPaciente) {
		this.avisoLiberacaoPaciente = avisoLiberacaoPaciente;
	}

	public boolean isAlta() {
		return alta;
	}

	public void setAlta(boolean alta) {
		this.alta = alta;
	}

	public List<InternacaoTransBean> getListaTransferencia() {
		return listaTransferencia;
	}

	public void setListaTransferencia(
			List<InternacaoTransBean> listaTransferencia) {
		this.listaTransferencia = listaTransferencia;
	}

	public Integer getOrigemTelaParaAtendimento() {
		return origemTelaParaAtendimento;
	}

	public void setOrigemTelaParaAtendimento(Integer origemTelaParaAtendimento) {
		this.origemTelaParaAtendimento = origemTelaParaAtendimento;
	}

	public List<PacienteEmergenciaOtimizadoBean> getListaPacientesRecepcao() {
		return listaPacientesRecepcao;
	}

	public void setListaPacientesRecepcao(
			List<PacienteEmergenciaOtimizadoBean> listaPacientesRecepcao) {
		this.listaPacientesRecepcao = listaPacientesRecepcao;
	}

	public PacienteEmergenciaOtimizadoBean getPacienteOtimizado() {
		return pacienteOtimizado;
	}

	public void setPacienteOtimizado(
			PacienteEmergenciaOtimizadoBean pacienteOtimizado) {
		this.pacienteOtimizado = pacienteOtimizado;
	}

	public InternacaoReferenciaBean getInternacaoReferenciaBean() {
		return internacaoReferenciaBean;
	}

	public void setInternacaoReferenciaBean(
			InternacaoReferenciaBean internacaoReferenciaBean) {
		this.internacaoReferenciaBean = internacaoReferenciaBean;
	}

	public List<ExamePepBean> getListExameSelecionado() {
		return listExameSelecionado;
	}

	public void setListExameSelecionado(List<ExamePepBean> listExameSelecionado) {
		this.listExameSelecionado = listExameSelecionado;
	}

	public Integer getIsnExameSolic() {
		return isnExameSolic;
	}

	public void setIsnExameSolic(Integer isnExameSolic) {
		this.isnExameSolic = isnExameSolic;
	}

	public Integer getIsnExameSolicWsDetalhe() {
		return isnExameSolicWsDetalhe;
	}

	public void setIsnExameSolicWsDetalhe(Integer isnExameSolicWsDetalhe) {
		this.isnExameSolicWsDetalhe = isnExameSolicWsDetalhe;
	}

	public List<PrescricaoPepItem> getLstPrescricaoPepItem() {
		return lstPrescricaoPepItem;
	}

	public void setLstPrescricaoPepItem(
			List<PrescricaoPepItem> lstPrescricaoPepItem) {
		this.lstPrescricaoPepItem = lstPrescricaoPepItem;
	}

	public List<PrescricaoPep> getLstPrescricaoPepAnt() {
		return lstPrescricaoPepAnt;
	}

	public void setLstPrescricaoPepAnt(List<PrescricaoPep> lstPrescricaoPepAnt) {
		this.lstPrescricaoPepAnt = lstPrescricaoPepAnt;
	}

	public List<PrescricaoPep> getLstPrescricaoPepAtual() {
		return lstPrescricaoPepAtual;
	}

	public void setLstPrescricaoPepAtual(
			List<PrescricaoPep> lstPrescricaoPepAtual) {
		this.lstPrescricaoPepAtual = lstPrescricaoPepAtual;
	}

	public List<PrescricaoPepItem> getLstPrescricaoPepItemAtual() {
		return lstPrescricaoPepItemAtual;
	}

	public void setLstPrescricaoPepItemAtual(
			List<PrescricaoPepItem> lstPrescricaoPepItemAtual) {
		this.lstPrescricaoPepItemAtual = lstPrescricaoPepItemAtual;
	}

	public List<PrescricaoPep> getLstPrescricaoPep() {
		return lstPrescricaoPep;
	}

	public void setLstPrescricaoPep(List<PrescricaoPep> lstPrescricaoPep) {
		this.lstPrescricaoPep = lstPrescricaoPep;
	}

	/**
	 * @return the objPrescricaoPepItem
	 */
	public PrescricaoPepItem getObjPrescricaoPepItem() {
		return objPrescricaoPepItem;
	}

	/**
	 * @param objPrescricaoPepItem
	 *            the objPrescricaoPepItem to set
	 */
	public void setObjPrescricaoPepItem(PrescricaoPepItem objPrescricaoPepItem) {
		this.objPrescricaoPepItem = objPrescricaoPepItem;
	}

	/**
	 * @return the objPrescricaoPepItemCopia
	 */
	public PrescricaoPepItem getObjPrescricaoPepItemCopia() {
		return objPrescricaoPepItemCopia;
	}

	/**
	 * @param objPrescricaoPepItemCopia
	 *            the objPrescricaoPepItemCopia to set
	 */
	public void setObjPrescricaoPepItemCopia(
			PrescricaoPepItem objPrescricaoPepItemCopia) {
		this.objPrescricaoPepItemCopia = objPrescricaoPepItemCopia;
	}

	/**
	 * @return the objPrescricaoPepCopia
	 */
	public PrescricaoPep getObjPrescricaoPepCopia() {
		return objPrescricaoPepCopia;
	}

	/**
	 * @param objPrescricaoPepCopia
	 *            the objPrescricaoPepCopia to set
	 */
	public void setObjPrescricaoPepCopia(PrescricaoPep objPrescricaoPepCopia) {
		this.objPrescricaoPepCopia = objPrescricaoPepCopia;
	}

	/**
	 * @return the objPrescricaoPepRelatorio
	 */
	public PrescricaoPep getObjPrescricaoPepRelatorio() {
		return objPrescricaoPepRelatorio;
	}

	/**
	 * @param objPrescricaoPepRelatorio
	 *            the objPrescricaoPepRelatorio to set
	 */
	public void setObjPrescricaoPepRelatorio(
			PrescricaoPep objPrescricaoPepRelatorio) {
		this.objPrescricaoPepRelatorio = objPrescricaoPepRelatorio;
	}

	/**
	 * @return the paginaOrigem
	 */
	public String getPaginaOrigem() {
		return paginaOrigem;
	}

	/**
	 * @param paginaOrigem
	 *            the paginaOrigem to set
	 */
	public void setPaginaOrigem(String paginaOrigem) {
		this.paginaOrigem = paginaOrigem;
	}

	public String getPermissaoOdonto() {
		return permissaoOdonto;
	}

	public void setPermissaoOdonto(String permissaoOdonto) {
		this.permissaoOdonto = permissaoOdonto;
	}

	public JSFUtil getJsfUtil() {
		return jsfUtil;
	}

	public void setJsfUtil(JSFUtil jsfUtil) {
		this.jsfUtil = jsfUtil;
	}

	public Date getDataInicio() {
		return dataInicio;
	}

	public void setDataInicio(Date dataInicio) {
		this.dataInicio = dataInicio;
	}

	public boolean isPacienteNaRecepcao() {
		return isPacienteNaRecepcao;
	}

	public void setPacienteNaRecepcao(boolean isPacienteNaRecepcao) {
		this.isPacienteNaRecepcao = isPacienteNaRecepcao;
	}

	public List<SelectItem> getLstRiscosDengue() {
		return lstRiscosDengue;
	}

	public void setLstRiscosDengue(List<SelectItem> lstRiscosDengue) {
		this.lstRiscosDengue = lstRiscosDengue;
	}

	public String getDscCorGrupoDengue() {
		return dscCorGrupoDengue;
	}

	public void setDscCorGrupoDengue(String dscCorGrupoDengue) {
		this.dscCorGrupoDengue = dscCorGrupoDengue;
	}

	/**
	 * @return the cid10Atendimento
	 */
	public String getCid10Atendimento() {
		return cid10Atendimento;
	}

	/**
	 * @param cid10Atendimento
	 *            the cid10Atendimento to set
	 */
	public void setCid10Atendimento(String cid10Atendimento) {
		this.cid10Atendimento = cid10Atendimento;
	}

	/**
	 * @return the objIaPep
	 */
	public InternacaoAtendimentoPepBean getObjIaPep() {
		return objIaPep;
	}

	/**
	 * @param objIaPep
	 *            the objIaPep to set
	 */
	public void setObjIaPep(InternacaoAtendimentoPepBean objIaPep) {
		this.objIaPep = objIaPep;
	}

	public List<AssistenteSocialDeclaracaoBean> getListaDeclaracaoCompareciemtno() {
		return listaDeclaracaoCompareciemtno;
	}

	public void setListaDeclaracaoCompareciemtno(
			List<AssistenteSocialDeclaracaoBean> listaDeclaracaoCompareciemtno) {
		this.listaDeclaracaoCompareciemtno = listaDeclaracaoCompareciemtno;
	}

	/**
	 * @return the lstPrescricaoEnfermagem
	 */
	public List<PrescricaoEnfermagemPep> getLstPrescricaoEnfermagem() {
		return lstPrescricaoEnfermagem;
	}

	/**
	 * @param lstPrescricaoEnfermagem
	 *            the lstPrescricaoEnfermagem to set
	 */
	public void setLstPrescricaoEnfermagem(
			List<PrescricaoEnfermagemPep> lstPrescricaoEnfermagem) {
		this.lstPrescricaoEnfermagem = lstPrescricaoEnfermagem;
	}

	/**
	 * @return the lstPrescricaoEnfermagemPepi
	 */
	public List<InternacaoPrescPep> getLstPrescricaoEnfermagemPepi() {
		return lstPrescricaoEnfermagemPepi;
	}

	/**
	 * @param lstPrescricaoEnfermagemPepi
	 *            the lstPrescricaoEnfermagemPepi to set
	 */
	public void setLstPrescricaoEnfermagemPepi(
			List<InternacaoPrescPep> lstPrescricaoEnfermagemPepi) {
		this.lstPrescricaoEnfermagemPepi = lstPrescricaoEnfermagemPepi;
	}

	/**
	 * @return the objInternacaoPrescricao
	 */
	public InternacaoPrescPep getObjInternacaoPrescricao() {
		return objInternacaoPrescricao;
	}

	/**
	 * @param objInternacaoPrescricao
	 *            the objInternacaoPrescricao to set
	 */
	public void setObjInternacaoPrescricao(
			InternacaoPrescPep objInternacaoPrescricao) {
		this.objInternacaoPrescricao = objInternacaoPrescricao;
	}

	/**
	 * @return the lstPrescricaoEnfermagemItem
	 */
	public List<ItemInternacaoPrescPep> getLstPrescricaoEnfermagemItem() {
		return lstPrescricaoEnfermagemItem;
	}

	/**
	 * @param lstPrescricaoEnfermagemItem
	 *            the lstPrescricaoEnfermagemItem to set
	 */
	public void setLstPrescricaoEnfermagemItem(
			List<ItemInternacaoPrescPep> lstPrescricaoEnfermagemItem) {
		this.lstPrescricaoEnfermagemItem = lstPrescricaoEnfermagemItem;
	}

	/**
	 * @return the lstPrescricaoEnfermagemItemTemp
	 */
	public List<ItemInternacaoPrescPep> getLstPrescricaoEnfermagemItemTemp() {
		return lstPrescricaoEnfermagemItemTemp;
	}

	/**
	 * @param lstPrescricaoEnfermagemItemTemp
	 *            the lstPrescricaoEnfermagemItemTemp to set
	 */
	public void setLstPrescricaoEnfermagemItemTemp(
			List<ItemInternacaoPrescPep> lstPrescricaoEnfermagemItemTemp) {
		this.lstPrescricaoEnfermagemItemTemp = lstPrescricaoEnfermagemItemTemp;
	}

	/**
	 * @return the lstPrescricaoEnfermagemItemInc
	 */
	public List<ItemInternacaoPrescPep> getLstPrescricaoEnfermagemItemInc() {
		return lstPrescricaoEnfermagemItemInc;
	}

	/**
	 * @param lstPrescricaoEnfermagemItemInc
	 *            the lstPrescricaoEnfermagemItemInc to set
	 */
	public void setLstPrescricaoEnfermagemItemInc(
			List<ItemInternacaoPrescPep> lstPrescricaoEnfermagemItemInc) {
		this.lstPrescricaoEnfermagemItemInc = lstPrescricaoEnfermagemItemInc;
	}

	/**
	 * @return the sliTipoPrescricaoEnfermagemPadrao
	 */
	public List<SelectItem> getSliTipoPrescricaoEnfermagemPadrao() {
		return sliTipoPrescricaoEnfermagemPadrao;
	}

	/**
	 * @param sliTipoPrescricaoEnfermagemPadrao
	 *            the sliTipoPrescricaoEnfermagemPadrao to set
	 */
	public void setSliTipoPrescricaoEnfermagemPadrao(
			List<SelectItem> sliTipoPrescricaoEnfermagemPadrao) {
		this.sliTipoPrescricaoEnfermagemPadrao = sliTipoPrescricaoEnfermagemPadrao;
	}

	/**
	 * @return the isnTipoPrescricaoEnfermagemPadrao
	 */
	public Integer getIsnTipoPrescricaoEnfermagemPadrao() {
		return isnTipoPrescricaoEnfermagemPadrao;
	}

	/**
	 * @param isnTipoPrescricaoEnfermagemPadrao
	 *            the isnTipoPrescricaoEnfermagemPadrao to set
	 */
	public void setIsnTipoPrescricaoEnfermagemPadrao(
			Integer isnTipoPrescricaoEnfermagemPadrao) {
		this.isnTipoPrescricaoEnfermagemPadrao = isnTipoPrescricaoEnfermagemPadrao;
	}

	/**
	 * @return the sliPrescricaoPepTipo
	 */
	public List<SelectItem> getSliPrescricaoPepTipo() {
		return sliPrescricaoPepTipo;
	}

	/**
	 * @param sliPrescricaoPepTipo
	 *            the sliPrescricaoPepTipo to set
	 */
	public void setSliPrescricaoPepTipo(List<SelectItem> sliPrescricaoPepTipo) {
		this.sliPrescricaoPepTipo = sliPrescricaoPepTipo;
	}

	/**
	 * @return the isnPrescricaoPepTipo
	 */
	public Integer getIsnPrescricaoPepTipo() {
		return isnPrescricaoPepTipo;
	}

	/**
	 * @param isnPrescricaoPepTipo
	 *            the isnPrescricaoPepTipo to set
	 */
	public void setIsnPrescricaoPepTipo(Integer isnPrescricaoPepTipo) {
		this.isnPrescricaoPepTipo = isnPrescricaoPepTipo;
	}

	/**
	 * @return the sliTipoPrescricaoPep
	 */
	public List<SelectItem> getSliTipoPrescricaoPep() {
		return sliTipoPrescricaoPep;
	}

	/**
	 * @param sliTipoPrescricaoPep
	 *            the sliTipoPrescricaoPep to set
	 */
	public void setSliTipoPrescricaoPep(List<SelectItem> sliTipoPrescricaoPep) {
		this.sliTipoPrescricaoPep = sliTipoPrescricaoPep;
	}

	/**
	 * @return the isnTipoPrescricaoPep
	 */
	public Integer getIsnTipoPrescricaoPep() {
		return isnTipoPrescricaoPep;
	}

	/**
	 * @param isnTipoPrescricaoPep
	 *            the isnTipoPrescricaoPep to set
	 */
	public void setIsnTipoPrescricaoPep(Integer isnTipoPrescricaoPep) {
		this.isnTipoPrescricaoPep = isnTipoPrescricaoPep;
	}

	/**
	 * @return the sliTipoPrescricaoEnfermagemPep
	 */
	public List<SelectItem> getSliTipoPrescricaoEnfermagemPep() {
		return sliTipoPrescricaoEnfermagemPep;
	}

	/**
	 * @param sliTipoPrescricaoEnfermagemPep
	 *            the sliTipoPrescricaoEnfermagemPep to set
	 */
	public void setSliTipoPrescricaoEnfermagemPep(
			List<SelectItem> sliTipoPrescricaoEnfermagemPep) {
		this.sliTipoPrescricaoEnfermagemPep = sliTipoPrescricaoEnfermagemPep;
	}

	/**
	 * @return the isnTipoPrescricaoEnfermagemPep
	 */
	public Integer getIsnTipoPrescricaoEnfermagemPep() {
		return isnTipoPrescricaoEnfermagemPep;
	}

	/**
	 * @param isnTipoPrescricaoEnfermagemPep
	 *            the isnTipoPrescricaoEnfermagemPep to set
	 */
	public void setIsnTipoPrescricaoEnfermagemPep(
			Integer isnTipoPrescricaoEnfermagemPep) {
		this.isnTipoPrescricaoEnfermagemPep = isnTipoPrescricaoEnfermagemPep;
	}

	/**
	 * @return the usuarioCoren
	 */
	public String getUsuarioCoren() {
		return usuarioCoren;
	}

	/**
	 * @param usuarioCoren
	 *            the usuarioCoren to set
	 */
	public void setUsuarioCoren(String usuarioCoren) {
		this.usuarioCoren = usuarioCoren;
	}

	/**
	 * @return the senhaAssinatura
	 */
	public String getSenhaAssinatura() {
		return senhaAssinatura;
	}

	/**
	 * @param senhaAssinatura
	 *            the senhaAssinatura to set
	 */
	public void setSenhaAssinatura(String senhaAssinatura) {
		this.senhaAssinatura = senhaAssinatura;
	}

	/**
	 * @return the codigo
	 */
	public int getCodigo() {
		return codigo;
	}

	/**
	 * @param codigo
	 *            the codigo to set
	 */
	public void setCodigo(int codigo) {
		this.codigo = codigo;
	}

	/**
	 * @return the codigoErro
	 */
	public Integer getCodigoErro() {
		return codigoErro;
	}

	/**
	 * @param codigoErro
	 *            the codigoErro to set
	 */
	public void setCodigoErro(Integer codigoErro) {
		this.codigoErro = codigoErro;
	}

	/**
	 * @return the lstPrescricaoEnfermagemItemUltima
	 */
	public List<ItemInternacaoPrescPep> getLstPrescricaoEnfermagemItemUltima() {
		return lstPrescricaoEnfermagemItemUltima;
	}

	/**
	 * @param lstPrescricaoEnfermagemItemUltima
	 *            the lstPrescricaoEnfermagemItemUltima to set
	 */
	public void setLstPrescricaoEnfermagemItemUltima(
			List<ItemInternacaoPrescPep> lstPrescricaoEnfermagemItemUltima) {
		this.lstPrescricaoEnfermagemItemUltima = lstPrescricaoEnfermagemItemUltima;
	}

	public List<ExameSolicitacaoPepBean> getListaExames() {
		return listaExames;
	}

	public void setListaExames(List<ExameSolicitacaoPepBean> listaExames) {
		this.listaExames = listaExames;
	}

	public Integer getCodNTI() {
		return codNTI;
	}

	public void setCodNTI(Integer codNTI) {
		this.codNTI = codNTI;
	}

	public Integer getCodNAC() {
		return codNAC;
	}

	public void setCodNAC(Integer codNAC) {
		this.codNAC = codNAC;
	}

	public FuncUtil getFuncUtil() {
		return funcUtil;
	}

	public void setFuncUtil(FuncUtil funcUtil) {
		this.funcUtil = funcUtil;
	}

	public InternacaoBean getInternacaoSelecionada() {
		return internacaoSelecionada;
	}

	public void setInternacaoSelecionada(InternacaoBean internacaoSelecionada) {
		this.internacaoSelecionada = internacaoSelecionada;
	}

	public static String getReportName() {
		return REPORT_NAME;
	}

	public static String getReportName2() {
		return REPORT_NAME2;
	}

	public static String getReportName3() {
		return REPORT_NAME3;
	}

	public static String getReportName4() {
		return REPORT_NAME4;
	}

	public static String getReportName5() {
		return REPORT_NAME5;
	}

	public static String getReportName6() {
		return REPORT_NAME6;
	}

	public static String getReportName7() {
		return REPORT_NAME7;
	}

	public static String getImgName() {
		return IMG_NAME;
	}

	public List<PrescricaoPep> getListaPrescricaoPep() {
		return listaPrescricaoPep;
	}

	public void setListaPrescricaoPep(List<PrescricaoPep> listaPrescricaoPep) {
		this.listaPrescricaoPep = listaPrescricaoPep;
	}

	public List<InternacaoAtendimento> getListaAtendimentos() {
		return listaAtendimentos;
	}

	public void setListaAtendimentos(
			List<InternacaoAtendimento> listaAtendimentos) {
		this.listaAtendimentos = listaAtendimentos;
	}

	public Boolean getUsarClassificacaoToLife() {
		return FuncUtil.getConfiguracoesBean().getUsarClassificacaoToLife();
	}

	public Boolean isUsuarioLogadoMedico() {
		try {
			if (this.jsfUtil.getUsuarioLogado() != null
					&& this.jsfUtil.getUsuarioLogado().getIsnConselho() != null) {
				return this.jsfUtil.getUsuarioLogado().getIsnConselho()
						.intValue() == 6;
			}
		} catch (Exception e) {
			e.printStackTrace();
		}
		return false;
	}

	public Boolean isUsuarioLogadoOdonto() {
		try {
			if (this.jsfUtil.getUsuarioLogado() != null
					&& this.jsfUtil.getUsuarioLogado().getIsnConselho() != null) {
				return this.jsfUtil.getUsuarioLogado().getIsnConselho()
						.intValue() == 9;
			}
		} catch (Exception e) {
			e.printStackTrace();
		}
		return false;
	}

	public Boolean isUsuarioLogadoEnfermeiro() {
		try {
			if (this.jsfUtil.getUsuarioLogado() != null
					&& this.jsfUtil.getUsuarioLogado().getIsnConselho() != null) {
				return this.jsfUtil.getUsuarioLogado().getIsnConselho()
						.intValue() == 2;
			}
		} catch (Exception e) {
			e.printStackTrace();
		}
		return false;
	}
	
	public String getIsnExameSolicAux() {
		return isnExameSolicAux;
	}

	public void setIsnExameSolicAux(String isnExameSolicAux) {
		this.isnExameSolicAux = isnExameSolicAux;
	}

	public String getDscMnemonico() {
		return dscMnemonico;
	}

	public void setDscMnemonico(String dscMnemonico) {
		this.dscMnemonico = dscMnemonico;
	}

	public String getFilePath() {
		return filePath;
	}

	public void setFilePath(String filePath) {
		this.filePath = filePath;
	}

	public String getFlgEmergencia() {
		return flgEmergencia;
	}

	public void setFlgEmergencia(String flgEmergencia) {
		this.flgEmergencia = flgEmergencia;
	}

	public List<InternacaoDoc> getListaDocAtestado() {
		return listaDocAtestado;
	}

	public void setListaDocAtestado(List<InternacaoDoc> listaDocAtestado) {
		this.listaDocAtestado = listaDocAtestado;
	}

	public List<InternacaoDoc> getListaDocReceituario() {
		return listaDocReceituario;
	}

	public void setListaDocReceituario(List<InternacaoDoc> listaDocReceituario) {
		this.listaDocReceituario = listaDocReceituario;
	}

	public Boolean getImprimirTodos() {
		return imprimirTodos;
	}

	public void setImprimirTodos(Boolean imprimirTodos) {
		this.imprimirTodos = imprimirTodos;
	}

	public ExameSolicitacaoPepBean getExameSolicLaudo() {
		return exameSolicLaudo;
	}

	public void setExameSolicLaudo(ExameSolicitacaoPepBean exameSolicLaudo) {
		this.exameSolicLaudo = exameSolicLaudo;
	}

	public Parametro getCodigoMatrixOrigem() {
		return codigoMatrixOrigem;
	}

	public void setCodigoMatrixOrigem(Parametro codigoMatrixOrigem) {
		this.codigoMatrixOrigem = codigoMatrixOrigem;
	}

	public Parametro getLaboratorioInterfaceamento() {
		return laboratorioInterfaceamento;
	}

	public void setLaboratorioInterfaceamento(
			Parametro laboratorioInterfaceamento) {
		this.laboratorioInterfaceamento = laboratorioInterfaceamento;
	}

	public Double getPeso() {
		return peso;
	}

	public void setPeso(Double peso) {
		this.peso = peso;
	}

	public Double getAltura() {
		return altura;
	}

	public void setAltura(Double altura) {
		this.altura = altura;
	}

	public String getFlgGestante() {
		return flgGestante;
	}

	public void setFlgGestante(String flgGestante) {
		this.flgGestante = flgGestante;
	}

	public String getDscMedicamentos() {
		return dscMedicamentos;
	}

	public void setDscMedicamentos(String dscMedicamentos) {
		this.dscMedicamentos = dscMedicamentos;
	}

	public ExameSolicitacaoPepBean getExameSolicPepBean() {
		return exameSolicPepBean;
	}

	public void setExameSolicPepBean(ExameSolicitacaoPepBean exameSolicPepBean) {
		this.exameSolicPepBean = exameSolicPepBean;
	}

	public String getDscMnemonicoSil() {
		return dscMnemonicoSil;
	}

	public void setDscMnemonicoSil(String dscMnemonicoSil) {
		this.dscMnemonicoSil = dscMnemonicoSil;
	}

	public Boolean getFlgDicom() {
		return flgDicom;
	}

	public void setFlgDicom(Boolean flgDicom) {
		this.flgDicom = flgDicom;
	}

	public Integer getPedidoBloqueado() {
		return pedidoBloqueado;
	}

	public void setPedidoBloqueado(Integer pedidoBloqueado) {
		this.pedidoBloqueado = pedidoBloqueado;
	}

	public Integer getNumAtendimentos() {
		return numAtendimentos;
	}

	public void setNumAtendimentos(Integer numAtendimentos) {
		this.numAtendimentos = numAtendimentos;
	}

	public InternacaoLeito getInternacaoLeitoAtual() {
		return internacaoLeitoAtual;
	}

	public void setInternacaoLeitoAtual(InternacaoLeito internacaoLeitoAtual) {
		this.internacaoLeitoAtual = internacaoLeitoAtual;
	}

	public String getFlgAltaMedica() {
		return flgAltaMedica;
	}

	public void setFlgAltaMedica(String flgAltaMedica) {
		this.flgAltaMedica = flgAltaMedica;
	}

	public Paciente getObjPaciente() {
		return objPaciente;

	}

	public void setObjPaciente(Paciente objPaciente) {
		this.objPaciente = objPaciente;


	}
	public Integer getAvisoBaixarPaciente() {
		return avisoBaixarPaciente;
	}

	public void setAvisoBaixarPaciente(Integer avisoBaixarPaciente) {
		this.avisoBaixarPaciente = avisoBaixarPaciente;
	}

	public List<PacienteAlergia> getLstPacienteAlergia() {
		return lstPacienteAlergia;
	}

	public void setLstPacienteAlergia(List<PacienteAlergia> lstPacienteAlergia) {
		this.lstPacienteAlergia = lstPacienteAlergia;
	}

	public PacienteAlergia getPacienteAlergia() {
		return pacienteAlergia;
	}

	public void setPacienteAlergia(PacienteAlergia pacienteAlergia) {
		this.pacienteAlergia = pacienteAlergia;
	}

	public boolean isAlertaAlergia() {
		return alertaAlergia;
	}

	public void setAlertaAlergia(boolean alertaAlergia) {
		this.alertaAlergia = alertaAlergia;
	}

	public String getFlgRiscoQueda() {
		return flgRiscoQueda;
	}

	public void setFlgRiscoQueda(String flgRiscoQueda) {
		this.flgRiscoQueda = flgRiscoQueda;
	}

	public Integer getIsnSepse() {
		return isnSepse;
	}

	public void setIsnSepse(Integer isnSepse) {
		this.isnSepse = isnSepse;
	}
	
	public InternacaoAtendimentoCausa getInternacaoAtendimentoCausaAcPai() {
		return internacaoAtendimentoCausaAcPai;
	}

	public void setInternacaoAtendimentoCausaAcPai(
			InternacaoAtendimentoCausa internacaoAtendimentoCausaAcPai) {
		this.internacaoAtendimentoCausaAcPai = internacaoAtendimentoCausaAcPai;
	}

	public InternacaoAtendimentoCausa getInternacaoAtendimentoCausaAcFilho() {
		return internacaoAtendimentoCausaAcFilho;
	}

	public void setInternacaoAtendimentoCausaAcFilho(
			InternacaoAtendimentoCausa internacaoAtendimentoCausaAcFilho) {
		this.internacaoAtendimentoCausaAcFilho = internacaoAtendimentoCausaAcFilho;
	}

	public InternacaoAtendimentoCausa getInternacaoAtendimentoCausaAg() {
		return internacaoAtendimentoCausaAg;
	}

	public void setInternacaoAtendimentoCausaAg(
			InternacaoAtendimentoCausa internacaoAtendimentoCausaAg) {
		this.internacaoAtendimentoCausaAg = internacaoAtendimentoCausaAg;
	}

	public List<InternacaoAtendimentoCausa> getListaInternacaoAtendimentoCausaAcPai() {
		return listaInternacaoAtendimentoCausaAcPai;
	}

	public void setListaInternacaoAtendimentoCausaAcPai(
			List<InternacaoAtendimentoCausa> listaInternacaoAtendimentoCausaAcPai) {
		this.listaInternacaoAtendimentoCausaAcPai = listaInternacaoAtendimentoCausaAcPai;
	}

	public List<InternacaoAtendimentoCausa> getListaInternacaoAtendimentoCausaAcFilho() {
		return listaInternacaoAtendimentoCausaAcFilho;
	}

	public void setListaInternacaoAtendimentoCausaAcFilho(
			List<InternacaoAtendimentoCausa> listaInternacaoAtendimentoCausaAcFilho) {
		this.listaInternacaoAtendimentoCausaAcFilho = listaInternacaoAtendimentoCausaAcFilho;
	}

	public List<InternacaoAtendimentoCausa> getListaInternacaoAtendimentoCausaAg() {
		return listaInternacaoAtendimentoCausaAg;
	}

	public void setListaInternacaoAtendimentoCausaAg(
			List<InternacaoAtendimentoCausa> listaInternacaoAtendimentoCausaAg) {
		this.listaInternacaoAtendimentoCausaAg = listaInternacaoAtendimentoCausaAg;
	}

	public boolean isFlgDengue() {
		return flgDengue;
	}

	public void setFlgDengue(boolean flgDengue) {
		this.flgDengue = flgDengue;
	}

	public boolean isFlgChoque() {
		return flgChoque;
	}

	public void setFlgChoque(boolean flgChoque) {
		this.flgChoque = flgChoque;
	}

	public boolean isFlgAlerta() {
		return flgAlerta;
	}

	public void setFlgAlerta(boolean flgAlerta) {
		this.flgAlerta = flgAlerta;
	}

	public boolean isFlgSangramento() {
		return flgSangramento;
	}

	public void setFlgSangramento(boolean flgSangramento) {
		this.flgSangramento = flgSangramento;
	}

	public boolean isFlgSituacaoExtra() {
		return flgSituacaoExtra;
	}

	public void setFlgSituacaoExtra(boolean flgSituacaoExtra) {
		this.flgSituacaoExtra = flgSituacaoExtra;
	}

	public boolean isFlgLaco() {
		return flgLaco;
	}

	public void setFlgLaco(boolean flgLaco) {
		this.flgLaco = flgLaco;
	}

	public AtendimentoDengue getAtendimentoDengue() {
		return atendimentoDengue;
	}

	public void setAtendimentoDengue(AtendimentoDengue atendimentoDengue) {
		this.atendimentoDengue = atendimentoDengue;
	}

	public Map<String, Boolean> getCheckMapAlerta() {
		return checkMapAlerta;
	}

	public Map<String, Boolean> getCheckMapSituacao() {
		return checkMapSituacao;
	}

	public List<String> getItensDscSituacao() {
		return itensDscSituacao;
	}

	public List<String> getItensDscAlerta() {
		return itensDscAlerta;
	}

	public String getMensagemAlertaDengue() {
		return mensagemAlertaDengue;
	}

	public void setMensagemAlertaDengue(String mensagemAlertaDengue) {
		this.mensagemAlertaDengue = mensagemAlertaDengue;
	}

	public boolean isFlgPeso() {
		return flgPeso;
	}

	public void setFlgPeso(boolean flgPeso) {
		this.flgPeso = flgPeso;
	}

	public Double getPesoDengue() {
		return pesoDengue;
	}

	public void setPesoDengue(Double pesoDengue) {
		this.pesoDengue = pesoDengue;
	}

	public boolean isFlgLiberarConfirmar() {
		return flgLiberarConfirmar;
	}

	public void setFlgLiberarConfirmar(boolean flgLiberarConfirmar) {
		this.flgLiberarConfirmar = flgLiberarConfirmar;
	}

	public String getTipoGrupo() {
		return tipoGrupo;
	}

	public void setTipoGrupo(String tipoGrupo) {
		this.tipoGrupo = tipoGrupo;
	}

	public String getMensagemHidratacao() {
		return mensagemHidratacao;
	}

	public void setMensagemHidratacao(String mensagemHidratacao) {
		this.mensagemHidratacao = mensagemHidratacao;
	}

	public String getMsgAlerta() {
		return msgAlerta;
	}

	public void setMsgAlerta(String msgAlerta) {
		this.msgAlerta = msgAlerta;
	}

	public String getFecharPanelDengue() {
		return fecharPanelDengue;
	}

	public void setFecharPanelDengue(String fecharPanelDengue) {
		this.fecharPanelDengue = fecharPanelDengue;
	}

	public StringBuilder getStringExame() {
		return stringExame;
	}

	public void setStringExame(StringBuilder stringExame) {
		this.stringExame = stringExame;
	}

	public boolean isFlgCid10Dengue() {
		return flgCid10Dengue;
	}

	public void setFlgCid10Dengue(boolean flgCid10Dengue) {
		this.flgCid10Dengue = flgCid10Dengue;
	}

	public boolean isFlgBloqueiaConfirmar() {
		return flgBloqueiaConfirmar;
	}

	public void setFlgBloqueiaConfirmar(boolean flgBloqueiaConfirmar) {
		this.flgBloqueiaConfirmar = flgBloqueiaConfirmar;
	}

	public Date getDatSintomas() {
		return datSintomas;
	}

	public void setDatSintomas(Date datSintomas) {
		this.datSintomas = datSintomas;
	}

	public Date getDatSintomaDengue() {
		return datSintomaDengue;
	}

	public void setDatSintomaDengue(Date datSintomaDengue) {
		this.datSintomaDengue = datSintomaDengue;
	}

	public boolean isFlgMenor12() {
		return flgMenor12;
	}

	public void setFlgMenor12(boolean flgMenor12) {
		this.flgMenor12 = flgMenor12;
	}

	public List<TipoAcidenteVeiculo> getListaTipoAcidenteVeiculo() {
		return listaTipoAcidenteVeiculo;
	}

	public void setListaTipoAcidenteVeiculo(List<TipoAcidenteVeiculo> listaTipoAcidenteVeiculo) {
		this.listaTipoAcidenteVeiculo = listaTipoAcidenteVeiculo;
	}

	public List<PosicaoAcidente> getListaPosicaoAcidente() {
		return listaPosicaoAcidente;
	}

	public void setListaPosicaoAcidente(List<PosicaoAcidente> listaPosicaoAcidente) {
		this.listaPosicaoAcidente = listaPosicaoAcidente;
	}

	public List<RegiaoAfetada> getListaRegiaoAfetada() {
		return listaRegiaoAfetada;
	}

	public void setListaRegiaoAfetada(List<RegiaoAfetada> listaRegiaoAfetada) {
		this.listaRegiaoAfetada = listaRegiaoAfetada;
	}

	public InternacaoAtendimentoAcidente getObjIac() {
		return objIac;
	}

	public void setObjIac(InternacaoAtendimentoAcidente objIac) {
		this.objIac = objIac;
	}

	public Integer getIsnTipoAcidenteVeiculo() {
		return isnTipoAcidenteVeiculo;
	}

	public void setIsnTipoAcidenteVeiculo(Integer isnTipoAcidenteVeiculo) {
		this.isnTipoAcidenteVeiculo = isnTipoAcidenteVeiculo;
	}

	public Integer getIsnPosicaoAcidente() {
		return isnPosicaoAcidente;
	}

	public void setIsnPosicaoAcidente(Integer isnPosicaoAcidente) {
		this.isnPosicaoAcidente = isnPosicaoAcidente;
	}

	public String[] getObjsRegiaoAfetada() {
		return objsRegiaoAfetada;
	}

	public void setObjsRegiaoAfetada(String[] objsRegiaoAfetada) {
		this.objsRegiaoAfetada = objsRegiaoAfetada;
	}

	public ProtocoloSepse getProtocoloSepse() {
		return protocoloSepse;
	}

	public void setProtocoloSepse(ProtocoloSepse protocoloSepse) {
		this.protocoloSepse = protocoloSepse;
	}
	
	public Integer getIsnSepsePaciente() {
		return isnSepsePaciente;
	}

	public void setIsnSepsePaciente(Integer isnSepsePaciente) {
		this.isnSepsePaciente = isnSepsePaciente;
	}

	public List<ProtocoloSepse> getListProtocoloSepse() {
		return listProtocoloSepse;
	}

	public void setListProtocoloSepse(List<ProtocoloSepse> listProtocoloSepse) {
		this.listProtocoloSepse = listProtocoloSepse;
	}

	public List<ExameSolicitacaoPepBean> getLstExameSolicSepse() {
		return lstExameSolicSepse;
	}

	public void setLstExameSolicSepse(List<ExameSolicitacaoPepBean> lstExameSolicSepse) {
		this.lstExameSolicSepse = lstExameSolicSepse;
	}

	public ClassificacaoRisco getClassificacaoRiscoSepse() {
		return classificacaoRiscoSepse;
	}

	public void setClassificacaoRiscoSepse(ClassificacaoRisco classificacaoRiscoSepse) {
		this.classificacaoRiscoSepse = classificacaoRiscoSepse;
	}

	public String getStrRiscoSepse() {
		return strRiscoSepse;
	}

	public void setStrRiscoSepse(String strRiscoSepse) {
		this.strRiscoSepse = strRiscoSepse;
	}
	
	public Boolean getErro() {
		return erro;
	}

	public void setErro(Boolean erro) {
		this.erro = erro;
	}

	public String getUrlReport() {
		return urlReport;
	}

	public void setUrlReport(String urlReport) {
		this.urlReport = urlReport;
	}

	public Boolean getEstaNaRecepcaoOuSalaDeEspera() {
		return estaNaRecepcaoOuSalaDeEspera;
	}

	public void setEstaNaRecepcaoOuSalaDeEspera(Boolean estaNaRecepcaoOuSalaDeEspera) {
		this.estaNaRecepcaoOuSalaDeEspera = estaNaRecepcaoOuSalaDeEspera;
	}

	public Boolean getMostrarBotaoCancelamentoSepse() {
		return mostrarBotaoCancelamentoSepse;
	}

	public void setMostrarBotaoCancelamentoSepse(Boolean mostrarBotaoCancelamentoSepse) {
		this.mostrarBotaoCancelamentoSepse = mostrarBotaoCancelamentoSepse;
	}

	public List<ProtocoloSepse> getListProtocoloSepseEnfermagem() {
		return listProtocoloSepseEnfermagem;
	}

	public void setListProtocoloSepseEnfermagem(List<ProtocoloSepse> listProtocoloSepseEnfermagem) {
		this.listProtocoloSepseEnfermagem = listProtocoloSepseEnfermagem;
	}

	public List<SelectItem> getSliProcedimentos() throws Exception {
		if (sliProcedimentos == null) {
			Procedimento procedimento = new Procedimento();
			procedimento.setFlgOdontologico("S");
			List<Procedimento> lista = ProcedimentoImpl.getInstancia().pesquisar(procedimento, 0);
			sliProcedimentos = new ArrayList<SelectItem>();
			sliProcedimentos.add(new SelectItem(0, "SELECIONE"));
			for (Procedimento p : lista) {
				sliProcedimentos.add(new SelectItem(p.getIsnPC(), p.getNoProcedimento()));
			}
		}
		return sliProcedimentos;
	}

	public void setSliProcedimentos(List<SelectItem> sliProcedimentos) {
		this.sliProcedimentos = sliProcedimentos;
	}

	public Integer getIsnProcedimento() {
		return isnProcedimento;
	}

	public void setIsnProcedimento(Integer isnProcedimento) {
		this.isnProcedimento = isnProcedimento;
	}

	public List<InternacaoAtendimentoProcedimento> getLstInternacaoAtendimentoProcedimentos() {
		return lstInternacaoAtendimentoProcedimentos;
	}

	public void setLstInternacaoAtendimentoProcedimentos(List<InternacaoAtendimentoProcedimento> lstInternacaoAtendimentoProcedimentos) {
		this.lstInternacaoAtendimentoProcedimentos = lstInternacaoAtendimentoProcedimentos;
	}

	public InternacaoAtendimentoProcedimento getInternacaoAtendimentoProcedimento() {
		return internacaoAtendimentoProcedimento;
	}

	public void setInternacaoAtendimentoProcedimento(InternacaoAtendimentoProcedimento internacaoAtendimentoProcedimento) {
		this.internacaoAtendimentoProcedimento = internacaoAtendimentoProcedimento;
	}

	public String getPermitirFechaPanelAlergia()
	{
		return permitirFechaPanelAlergia;
	}

	public void setPermitirFechaPanelAlergia(String permitirFechaPanelAlergia)
	{
		this.permitirFechaPanelAlergia = permitirFechaPanelAlergia;
	}

	public Date getDatSintomaChikungunya() {
		return datSintomaChikungunya;
	}

	public void setDatSintomaChikungunya(Date datSintomaChikungunya) {
		this.datSintomaChikungunya = datSintomaChikungunya;
	}

	public boolean isFlgChikungunya() {
		return flgChikungunya;
	}

	public void setFlgChikungunya(boolean flgChikungunya) {
		this.flgChikungunya = flgChikungunya;
	}

	public JustificativaReposicaoVolemica getJustificativaRepoVolemica() {
		return justificativaRepoVolemica;
	}

	public void setJustificativaRepoVolemica(JustificativaReposicaoVolemica justificativaRepoVolemica) {
		this.justificativaRepoVolemica = justificativaRepoVolemica;
	}

	public ExameSolicSemBaixaVO getObjExameSolicSemBaixaVO() {
		return objExameSolicSemBaixaVO;
	}

	public void setObjExameSolicSemBaixaVO(ExameSolicSemBaixaVO objExameSolicSemBaixaVO) {
		this.objExameSolicSemBaixaVO = objExameSolicSemBaixaVO;
	}

	public List<SinaisSirs> getListSinaisSirs() {
		if(listSinaisSirs == null){
			listSinaisSirs = new ArrayList<>();
		}
		return listSinaisSirs;
	}

	public void setListSinaisSirs(List<SinaisSirs> listSinaisSirs) {
		this.listSinaisSirs = listSinaisSirs;
	}

	public Map<SinaisSirs, Boolean> getCheckMapSinaisSirs() {
		return checkMapSinaisSirs;
	}

	public void setCheckMapSinaisSirs(Map<SinaisSirs, Boolean> checkMapSinaisSirs) {
		this.checkMapSinaisSirs = checkMapSinaisSirs;
	}

	public List<SinaisSirsRisco> getLstSinaisSirsRisco() {
		return lstSinaisSirsRisco;
	}

	public void setLstSinaisSirsRisco(List<SinaisSirsRisco> lstSinaisSirsRisco) {
		this.lstSinaisSirsRisco = lstSinaisSirsRisco;
	}

	public Integer getViewPager() {
		return viewPager;
	}

	public void setViewPager(Integer viewPager) {
		this.viewPager = viewPager;
	}

	public List<ProtocoloSepseSinais> getLstProtocoloSepseSinais() {
		return lstProtocoloSepseSinais;
	}

	public void setLstProtocoloSepseSinais(List<ProtocoloSepseSinais> lstProtocoloSepseSinais) {
		this.lstProtocoloSepseSinais = lstProtocoloSepseSinais;
	}

	public Map<ProtocoloSepseSinais, Boolean> getCheckMapProtocoloSepseSinais() {
		return checkMapProtocoloSepseSinais;
	}

	public void setCheckMapProtocoloSepseSinais(Map<ProtocoloSepseSinais, Boolean> checkMapProtocoloSepseSinais) {
		this.checkMapProtocoloSepseSinais = checkMapProtocoloSepseSinais;
	}

	public Boolean getStatusEtapa() {
		return statusEtapa;
	}

	public void setStatusEtapa(Boolean statusEtapa) {
		this.statusEtapa = statusEtapa;
	}

	public List<ProtocoloSepseSinaisResp> getLstProtocoloSepseSinaisResp() {
		return lstProtocoloSepseSinaisResp;
	}

	public void setLstProtocoloSepseSinaisResp(List<ProtocoloSepseSinaisResp> lstProtocoloSepseSinaisResp) {
		this.lstProtocoloSepseSinaisResp = lstProtocoloSepseSinaisResp;
	}

	public Boolean getEtapaFinalizada() {
		return etapaFinalizada;
	}

	public void setEtapaFinalizada(Boolean etapaFinalizada) {
		this.etapaFinalizada = etapaFinalizada;
	}

	public EvolucaoSepse getEvolucaoSepse() {
		return evolucaoSepse;
	}

	public void setEvolucaoSepse(EvolucaoSepse evolucaoSepse) {
		this.evolucaoSepse = evolucaoSepse;
	}

	public String getNomePanel() {
		return nomePanel;
	}

	public void setNomePanel(String nomePanel) {
		this.nomePanel = nomePanel;
	}

	public ArrayList<SelectItem> getSlievolucaoSepseSinais() {
		if (slievolucaoSepseSinais == null) {
			
			try {
				this.evolucaoSepseSinais = EvolucaoSepseSinaisImpl.getInstancia().pesquisar(new EvolucaoSepseSinais(), 0);
				this.slievolucaoSepseSinais = new ArrayList<SelectItem>();

				for (EvolucaoSepseSinais ev : evolucaoSepseSinais) {
					slievolucaoSepseSinais
							.add(new SelectItem(ev.getIsnEvolucaoSepseSinais(), ev.getDscEvolucaoSepseSinais()));
				}
			} catch (Exception e) {
				e.printStackTrace();
			}
		}
		return slievolucaoSepseSinais;
	}

	public void setSlievolucaoSepseSinais(ArrayList<SelectItem> slievolucaoSepseSinais) {
		this.slievolucaoSepseSinais = slievolucaoSepseSinais;
	}

	public List<FocoPrescricaoSepse> getLstFocoPrescricaoSepse() {
		return lstFocoPrescricaoSepse;
	}

	public void setLstFocoPrescricaoSepse(List<FocoPrescricaoSepse> lstFocoPrescricaoSepse) {
		this.lstFocoPrescricaoSepse = lstFocoPrescricaoSepse;
	}

	public List<SelectItem> getSliFocoPrescricaoSepse() {
		return sliFocoPrescricaoSepse;
	}

	public void setSliFocoPrescricaoSepse(List<SelectItem> sliFocoPrescricaoSepse) {
		this.sliFocoPrescricaoSepse = sliFocoPrescricaoSepse;
	}

	public List<SelectItem> getSliTipoFoco() {
		if (sliTipoFoco == null) {
			sliTipoFoco = new ArrayList<>();
		}
		return sliTipoFoco;
	}

	public void setSliTipoFoco(List<SelectItem> sliTipoFoco) {
		this.sliTipoFoco = sliTipoFoco;
	}

	public List<SelectItem> getSliMedicamentosAgrupados() {
		if(sliMedicamentosAgrupados == null){
			sliMedicamentosAgrupados = new ArrayList<>();
		}
		return sliMedicamentosAgrupados;
	}

	public void setSliMedicamentosAgrupados(List<SelectItem> sliMedicamentosAgrupados) {
		this.sliMedicamentosAgrupados = sliMedicamentosAgrupados;
	}

	public Integer getIsnTipoFoco() {
		return isnTipoFoco;
	}

	public void setIsnTipoFoco(Integer isnTipoFoco) {
		this.isnTipoFoco = isnTipoFoco;
	}
	public Integer getMedicamentos() {
		return indexList;
	}

	public void setMedicamentos(Integer indexList) {
		this.indexList = indexList;
	}

	public Integer getIndexList() {
		return indexList;
	}

	public void setIndexList(Integer indexList) {
		this.indexList = indexList;
	}

	public Integer getIsnSubTipoFoco() {
		return isnSubTipoFoco;
	}

	public void setIsnSubTipoFoco(Integer isnSubTipoFoco) {
		this.isnSubTipoFoco = isnSubTipoFoco;
	}

	public List<SelectItem> getSliSubTipoFoco() {
		if (sliSubTipoFoco == null) {
			sliSubTipoFoco = new ArrayList<>();
		}
		return sliSubTipoFoco;
	}

	public void setSliSubTipoFoco(List<SelectItem> sliSubTipoFoco) {
		this.sliSubTipoFoco = sliSubTipoFoco;
	}

	public List<FocoPrescricaoSepse> getLstSubFocoPrescricaoSepse() {
		return lstSubFocoPrescricaoSepse;
	}

	public void setLstSubFocoPrescricaoSepse(List<FocoPrescricaoSepse> lstSubFocoPrescricaoSepse) {
		this.lstSubFocoPrescricaoSepse = lstSubFocoPrescricaoSepse;
	}

	public String getStrProtocoloSepseSinaisResp() {
		return strProtocoloSepseSinaisResp;
	}

	public void setStrProtocoloSepseSinaisResp(String strProtocoloSepseSinaisResp) {
		this.strProtocoloSepseSinaisResp = strProtocoloSepseSinaisResp;
	}

	public List<SelectItem> getSliVolumeSepse() {
		return sliVolumeSepse;
	}

	public void setSliVolumeSepse(List<SelectItem> sliVolumeSepse) {
		this.sliVolumeSepse = sliVolumeSepse;
	}
    
	public ProtocoloSepseSinais getSinalClicado() {
		return sinalClicado;
	}

	public void setSinalClicado(ProtocoloSepseSinais sinalClicado) {
		this.sinalClicado = sinalClicado;
	}

	public List<SelectItem> getSliFocoSepse() {
		return sliFocoSepse;
	}

	public void setSliFocoSepse(List<SelectItem> sliFocoSepse) {
		this.sliFocoSepse = sliFocoSepse;
	}

	public Integer getIsnFocoPrescricaoSepse() {
		return isnFocoPrescricaoSepse;
	}

	public void setIsnFocoPrescricaoSepse(Integer isnFocoPrescricaoSepse) {
		this.isnFocoPrescricaoSepse = isnFocoPrescricaoSepse;
	}

	public Integer getIsnFocoSepse() {
		return isnFocoSepse;
	}

	public void setIsnFocoSepse(Integer isnFocoSepse) {
		this.isnFocoSepse = isnFocoSepse;
	}
	
	public List<EvolucaoSepse> getListEvolucaoSepseAtendimento(){
		return this.listEvolucaoSepseAtendimento;
	}
}