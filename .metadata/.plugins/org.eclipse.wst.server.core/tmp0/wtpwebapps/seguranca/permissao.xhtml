<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
				xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:h="http://java.sun.com/jsf/html"
				xmlns:a4j="http://richfaces.org/a4j"
				xmlns:rich="http://richfaces.org/rich"
				xmlns:f="http://java.sun.com/jsf/core"
				xmlns:t="http://myfaces.apache.org/tomahawk"
				template="crud_template.xhtml">
	
	<script type="text/javascript" src="http://www.tidbits.com.br/download/_scripts/modal/jquery-modal-1.0.pack.js"></script>
	
	<ui:param name="crudBean" value="#{permissaoForm}" />
	
	<ui:define name="saveStateObjectsDefined">		
		<t:saveState value="#{crudBean.listaPermissoes}" />
		<t:saveState value="#{crudBean.listaPermissoesDestino}" />
		<t:saveState value="#{crudBean.listaSistemas}" />
		<t:saveState value="#{crudBean.grupo}" />
		<t:saveState value="#{crudBean.listaUsuarioGrupo}" />
		<t:saveState value="#{crudBean.listaPermissoesGrupo}" />
		
		
		
	</ui:define>
	
	<!-- KEEPALIVE -->
	<a4j:keepAlive beanName="permissaoForm"></a4j:keepAlive>
	
	<ui:define name="requiredFieldsMessage">
		<h:outputText value="#{bundle.todosCamposObrigatorios}" rendered="#{crudBean.updating}"/>
	</ui:define>
	
	<ui:define name="content">
		
		<!-- Painel de Cadastro -->		
		<h:panelGroup id="panelGroupDeCadastro" style="height:100%;width:100%;" rendered="#{crudBean.updating}">
			<f:subview id="viewEdicao">
				<table class="tabela">					
					<tr>
						<td class="tdCor" width="16%">Descrição </td>
						<td class="tdBranco">
							<h:outputText value="#{crudBean.grupo.dscGrupo}"/>
						</td>
					</tr>
					<tr>
						<td class="tdCor" width="16%">Sistema *</td>
						<td class="tdBranco">
							<h:selectOneMenu value="#{crudBean.entity.telaAcaoBean.sistemaBean}" converter="simpleIndexConverter">								
								<t:selectItems var="o" itemValue="#{o}" itemLabel="#{o.dscSistema}" value="#{crudBean.listaSistemas}"/>
								<a4j:support event="onchange" reRender="formulario" action="#{crudBean.carregarPermissoes}"/>
							</h:selectOneMenu>
						</td>
					</tr>
				</table>
				<table class="tabela">
					<tr>
						<td class="tdCor" style="text-align: center;width: 50%">Não Participa</td>
						<td class="tdCor" style="text-align: center;width: 40%">Participa</td>
					</tr>
					<tr>
						<td class="tdBranco" colspan="2">
							<h:panelGroup id="permissoes" style="height:100%;width:100%;">
								<rich:pickList value="#{crudBean.listaPermissoesDestino}"
												sourceListWidth="550" 
												listsHeight="200" 
												targetListWidth="450" 
												showButtonsLabel="false" 
												removeTitle="" 
												copyAllTitle="" 
												copyTitle=""
												id="pick"
												orderable="true"
												converter="simpleIndexConverter">
									<t:selectItems var="o" itemValue="#{o.value}" itemLabel="#{o.label}" value="#{crudBean.listaPermissoes}"/>
								</rich:pickList>
							</h:panelGroup>
						</td>
					</tr>
				</table>
			</f:subview>
		</h:panelGroup>
		
		<!-- Painel de visualização -->
		<h:panelGroup id="panelGroupDeVisualizacao" style="height:100%;width:100%;" rendered="#{crudBean.viewing}">
			
			<f:subview id="viewListagem">
				<rich:dataTable id="tblData" value="#{crudBean.listaPermissoesGrupo}" binding="#{crudBean.tblData}" var="rst" style="width: 100%;" rowClasses="impar">
					<f:facet name="header">
						<rich:columnGroup>
							<rich:column style="width: 100%; text-align: center;" colspan="2">
								<h:outputText value="Grupo: #{crudBean.grupo.dscGrupo}" />			
							</rich:column>
						</rich:columnGroup>
					</f:facet>
					
					<rich:column style="text-align: left;" colspan="2">
						<b><h:outputText value="#{rst.isnSistema}" /> - <h:outputText value="#{rst.dscSistema}" /></b>						
					</rich:column>
					
					<rich:subTable id="tblPermissoes" 
					               var="filhas" 
					               value="#{rst.listTelaAcaoFilhos}" 
					               rendered="#{not empty rst.listTelaAcao}" 
					               rowClasses="#{myRow mod 2 == 0 ? 'par' : 'impar'}">
						<rich:column style="margin-left: 500px;" 
									 onmouseover="javascript:this.style.backgroundColor='#FFFFCC'" 
									 onmouseout="javascript:this.style.backgroundColor=''">								
							<a4j:commandLink style="border:white; width: 12px; height: 12px;" title="VISUALIZAR" action="#{crudBean.visualizarLog}" reRender="formulario, panelTitle">
								<table>
									<tr>
										<td width="60px;" align="right">
											<h:graphicImage value="/imagens/cadeado.gif" style="vertical-align: middle;"/> 
										</td>
										<td style="padding-left: 10px;">
											<h:outputText value="#{filhas.dscTelaAcao}" /> - <h:outputText value="#{filhas.acaoBean.dscAcao}" />
										</td>								
									</tr>
								</table>
							</a4j:commandLink>
						</rich:column>
					</rich:subTable>
					
				</rich:dataTable>
				
				<br/>
				
				<rich:dataTable value="#{crudBean.listaUsuarioGrupo}" 
				                var="usuarioGrupo" 
				                style="width: 100%;" 
				                rowClasses="impar"
				                onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
								onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'"
								rows="5"
								rowKeyVar="linha"
								reRender="ds">
						
					<f:facet name="header">
						<rich:columnGroup>
							<rich:column style="width: 100%; text-align: center;" colspan="5">
								<h:outputText value="Usuário(s) Pertencente(s) ao grupo #{crudBean.grupo.dscGrupo}" />
							</rich:column>
							<rich:column style="width: 5%; text-align: center;" breakBefore="true">
								<h:outputText value="Código" />
							</rich:column>
							<rich:column style="width: 40%; text-align: center;">
								<h:outputText value="Nome" />
							</rich:column>
							<rich:column style="width: 15%; text-align: center;">
								<h:outputText value="Setor" />
							</rich:column>
							<rich:column style="width: 15%; text-align: center;">
								<h:outputText value="Login" />
							</rich:column>
							<rich:column style="width: 25%; text-align: center;">
								<h:outputText value="Email do ISGH" />
							</rich:column>
						</rich:columnGroup>
					</f:facet>
					<rich:column style="text-align: left;">
						<h:outputText value="#{usuarioGrupo.usuarioBean.isnUsuario}"/>
					</rich:column>
					<rich:column style="text-align: left;">
						<h:outputText value="#{usuarioGrupo.usuarioBean.dscUsuario}"/>
					</rich:column>
					<rich:column style="text-align: left;">
						<h:outputText value="#{usuarioGrupo.usuarioBean.setorBean.dscSetor}"/>
					</rich:column>
					<rich:column style="text-align: left;">
						<h:outputText value="#{usuarioGrupo.usuarioBean.dscLogin}"/>
					</rich:column>
					<rich:column style="text-align: left;">
						<h:outputText value="#{usuarioGrupo.usuarioBean.dscEmailIsgh}"/>
					</rich:column>
					<f:facet name="footer">
						<rich:datascroller id="ds" ajaxSingle="false" />
					</f:facet>
				</rich:dataTable>
				
			</f:subview>


		</h:panelGroup>
	
			
	</ui:define>

		
			
	<ui:define name="buttonItens">
			
		<!-- Painel dos botoes de edicao -->
		<h:panelGroup rendered="#{crudBean.updating || crudBean.viewing}">
			<a4j:commandButton image="imagens/bntGravar.png" style="border: 0; width: 154px; height: 29px;" id="gravar" value="Gravar" actionListener="#{crudBean.inserir}" rendered="#{crudBean.inserting}" reRender="formulario, panelTitle"/>
			<h:outputText value=" "/>
			<a4j:commandButton image="imagens/bntCancelar.png" style="border: 0; width: 154px; height: 29px;" id="cancelar" value="Tela de Pesquisa" action="#{grupoForm.preparaPesquisar}" reRender="formulario, panelTitle" />
			<t:commandLink id="impUser" action="#{crudBean.imprimir}" target="blank">
				<h:graphicImage url="/imagens/bntImprimir.png" style="border: 0; width: 154px; height: 29px;" title="IMPRIMIR" rendered="#{crudBean.currentState == 'view'}"/>
			</t:commandLink>
			
			
		</h:panelGroup>
		
	</ui:define>

</ui:composition>
