<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
					  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich">

<ui:composition template="template.xhtml">
	<ui:define name="headHtml">
		<!-- cs_relatorio_sinan.xhtml -->
		<link rel="stylesheet" type="text/css" href="CSS/layoutCsPaciente.css" />
	</ui:define>
	<ui:define name="conteudo">

		<a4j:keepAlive beanName="relatorioSinanForm" />
		<rich:modalPanel id="panelStatus" autosized="true">
			<h:panelGrid columns="2">
				<h:graphicImage url="IMG/ajax-loader.gif" style="border:0px" />
				<h:outputText value="Carregando..." />
			</h:panelGrid>
		</rich:modalPanel>
		<style>
			.alert-danger{
				font-weight:bold;
				font-size:10pt;
				color:red;
			}
		</style>
		<a4j:form id="formPesquisa">
			<div class="cabAreaPesquisa">RELATÓRIO SINAN</div>
			<div class="areaPesquisa">
				<div>
					<h:outputLabel for="menuCategoria" value="Tipo:" /><h:outputLabel value="*" style="color:red;" /><br/>
					<h:selectOneMenu id="menuCategoria" style="width: 200px;" value="#{relatorioSinanForm.isnTipoPesquisa}">
						<f:selectItem itemLabel="Selecione" itemValue="0"/>
						<f:selectItem itemLabel="Geral" itemValue="1"/>
						<f:selectItem itemLabel="Atendimento Médico" itemValue="2"/>
						<f:selectItem itemLabel="Classificação de Risco" itemValue="3"/>
					</h:selectOneMenu>
					<h:selectOneMenu id="menuCid" style="width: 100px;" value="#{relatorioSinanForm.fluxoAedes}">
						<f:selectItem itemLabel="Chikungunya" itemValue="0"/>
						<f:selectItem itemLabel="Dengue" itemValue="1"/>
					</h:selectOneMenu>
				</div>
				
				<div>
					<h:outputLabel value="Período:" /><h:outputLabel value="*" style="color:red;" /><br/>
					<h:panelGrid columns="3" cellpading="0" cellspacing="0">
						<rich:calendar value="#{relatorioSinanForm.dtInicio}"
									   datePattern="dd/MM/yyyy" 
									   cellWidth="18px" 
									   cellHeight="18px" 
									   style="width:180px" 
									   showWeeksBar="false" 
									   inputSize="10" 
									   enableManualInput="true" 
									   oninputkeypress="return formataData(event, this);" 
									   maxlength="10" />
						<rich:calendar value="#{relatorioSinanForm.dtFim}"
									   datePattern="dd/MM/yyyy" 
									   cellWidth="18px" 
									   cellHeight="18px" 
									   style="width:180px" 
									   showWeeksBar="false" 
									   inputSize="10" 
									   enableManualInput="true" 
									   oninputkeypress="return formataData(event, this);" 
									   maxlength="10" />
					</h:panelGrid>
				</div>
				<div>
					<rich:spacer height="12px"/><br/>
					<a4j:commandButton image="IMG/pesquisa.gif" 
									   id="btnPesquisar" 
									   actionListener="#{relatorioSinanForm.pesquisar}" 
									   oncomplete="validarConfirmacao('#{relatorioSinanForm.mensagens}');"
					     			   reRender="formPesquisa, formPesquisa:totalPesq"/>					
				</div>
				<div>
					<rich:spacer height="12px"/><br/>
					<a4j:commandButton id="btnImprimirGeral" value="Imprimir" styleClass="botaoModal"
								   title="Imprimir todos"
								   action="#{relatorioSinanForm.imprimirRelatorio('0')}" 
								   oncomplete="if(avisosValidacao(#{relatorioSinanForm.erro})) window.open('#{relatorioSinanForm.url}', '_tab');"
				     			   reRender="formPesquisa:relatorioSinan"
				     			   rendered="#{not empty relatorioSinanForm.listaSinan}"/>
				</div>
				<div style="float:right">
		           <label>Registros:</label><br/>
		           <h:outputText id="totalPesq" value="#{relatorioSinanForm.quantidadeRegistros}" styleClass="totalizador2" />
				</div>
				<br style="clear:both;"/>	
			</div>
			<div>
				<rich:dataTable style="width: 100%;"
					onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
					onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'"
				    id="relatorioSinan"
					value="#{relatorioSinanForm.listaSinan}"
					var="item" rowKeyVar="index"
					rows="25" reRender="ds">
					<f:facet name="header">
						<rich:columnGroup>
							<rich:column>
								<h:outputText value="Índice" />
							</rich:column>						
							<rich:column>
								<h:outputText value="Doença" />
							</rich:column>
							<rich:column>
								<h:outputText value="Internação" />
							</rich:column>
							<rich:column>
								<h:outputText value="Data Notificação" />
							</rich:column>
							<rich:column>
								<h:outputText value="Tipo Notificação" />
							</rich:column>
							<rich:column>
								<h:outputText value="Prontuário" />
							</rich:column>
							<rich:column>
								<h:outputText value="Paciente" />
							</rich:column>
							<rich:column>
								<h:outputText value="Evolução" />
							</rich:column>
							<rich:column>
								<h:outputText value="Imprimir" />
							</rich:column>
						</rich:columnGroup>
					</f:facet>
					<h:column><h:outputText value="#{index + 1}" /></h:column>
					<rich:column sortable="true" sortBy="#{item.doenca}" >
						<h:outputText value="#{item.doenca}" />									
					</rich:column>
					<rich:column sortable="true" sortBy="#{item.internacao}">
						<h:outputText value="#{item.internacao}" />								
					</rich:column>	
					<rich:column sortable="true" sortBy="#{item.dataNotificacao}" style="text-align:center">
						<h:outputText value="#{item.dataNotificacao}" />
						<h:outputText value=" #{item.horaNotificacao}" />
					</rich:column>		
					<rich:column sortable="true" sortBy="#{item.tipoNotificacao}">
						<h:outputText value="#{item.tipoNotificacao}" />									
					</rich:column>		
					<rich:column sortable="true" sortBy="#{item.prontuario}">
						<h:outputText value="#{item.prontuario}" />									
					</rich:column>			
					<rich:column sortable="true" sortBy="#{item.nomePaciente}">
						<h:outputText value="#{item.nomePaciente}" />									
					</rich:column>		
					<rich:column>
						<h:outputText value="#{item.evolucao}" escape="false" />									
					</rich:column>	
					<rich:column style="text-align: center;">
						<a4j:commandLink id="imprimirParecer" target="_tab" action="#{relatorioSinanForm.imprimirRelatorio('1')}"
				                 oncomplete="if(avisosValidacao(#{relatorioSinanForm.erro})) window.open('#{relatorioSinanForm.url}', '_tab');">	
				               <h:graphicImage id="imgRelatorioImprimir" url="IMG/prescricao/print.gif" style="border:0;"/>
 							   <f:setPropertyActionListener value="#{item}" target="#{relatorioSinanForm.objSinan}"/>	
						</a4j:commandLink>
					</rich:column>
					<f:facet name="footer">
						<h:outputText value="Não há registro para este período." rendered="#{empty relatorioSinanForm.lista}" />								
					    <rich:datascroller fastControls="auto" id="ds" ajaxSingle="false" />
					</f:facet>
			</rich:dataTable>
		</div>
	</a4j:form>

	<script>
    <!--
		function avisosValidacao(erro) {
			if (erro == 1) {
				alert("Não há registros para a geração do relatório.");
		    	return false;
			}
			return true;
		}	
    
		function validarConfirmacao(msg)
		{
			if(msg != '')
			{
				alert(msg);			
			}
		}
	//-->
    </script>
    
	<a4j:status id="loading" onstart="Richfaces.showModalPanel('panelStatus')" onstop="Richfaces.hideModalPanel('panelStatus')" />
	
	</ui:define>
</ui:composition>
</html>