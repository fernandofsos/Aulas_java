<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:ui="http://java.sun.com/jsf/facelets"
	  xmlns:f="http://java.sun.com/jsf/core"
	  xmlns:h="http://java.sun.com/jsf/html"
	  xmlns:a4j="http://richfaces.org/a4j"
	  xmlns:rich="http://richfaces.org/rich">

<ui:composition template="template_pep.xhtml">

<ui:define name="conteudo">
	<style>
	<!--
    .rf-panel-header {
    	color: #0054BD;
    }

    .panel {
    	vertical-align: top;
    }

    .top {
     width: 200px;
     height: 100px;
    }

    .head2 {
     height: 18px;
     text-align: center;
     vertical-align: middle;
     padding: 4px 0;
    }

    .pbody {
     /*overflow: auto;*/
    }
    
    .tblResumo td{
    	width:50%;
    }
    
    .textEmpty{
    	font-size:110%;
    	font-weight:bold;
    	line-height:40px;
    	color:grey;
    }
    .scrolls{
        width:300px;
        height:80px;
        overflow:auto;
    }
    
    .col{
    	width:90%;
    }
    
    .areaPesquisa { 
    	padding: 10px; 
    	background: #BED6F8; 
    	margin: 0 0 10px 0; 
        border: solid 1px #bbb; 
        display:block
    }
    .campoTexto{ width:300px; }
	//-->    
	</style>
	<script>
	<!--
		function confirmaDeletar(){
			if(confirm("Confirma deletar esse item?")) return true;
			else return false;
		}
	
		function confirmaSuspender(){
			if(confirm("Confirma suspender esse item?")) return true;
			else return false;
		}
	//-->
	</script>
	<a4j:keepAlive beanName="pacientePepiForm" />
	
	<!-- *****  MODAL PANEL ASSINATURA  -->
	<rich:modalPanel id="panelSenha" autosized="true" width="480" resizeable="false" headerClass="headerPanel">
		<!-- BARRA DE TITULO MODAL-->	
		<h3><h:graphicImage value="/images/icons/access.png" style="border:0" /><rich:spacer width="5" />Validação de Senha</h3>
		<f:facet name="controls">
			<h:panelGroup>
				<h:graphicImage value="IMG/fechar.png" id="hidelink2" />
				<rich:componentControl for="panelSenha" attachTo="hidelink2" operation="hide" event="onclick" />
			</h:panelGroup>
		</f:facet>
		<!-- FIM DA BARRA DE TITULO MODAL-->
		<!-- CAMPOS DE BUSCA -->
		<h:form id="senha">	      
			<div>
				<hr></hr>
				<div class="linhaFormulario" >
				    <div style="float: left; margin-right: 40px">		
						<label class="label largura110" >Usuário/Conselho:</label>
						<h:inputText value="#{pacientePepiForm.usuarioCoren}" maxlength="20" styleClass="inputText" style="width: 80px"/>
					</div>
					<div style="float: left;">		
						<label class="label largura110" >Senha/Assinatura:</label>
						<h:inputSecret value="#{pacientePepiForm.senhaAssinatura}" maxlength="20" style="width: 80px"/>
					</div>
				</div>		
			</div>
			<br clear="all"/>
			<div style="text-align: center; margin-top: 40px">
				<a4j:commandButton id="btnGravarPrescricaoPep" 
								   value="OK" 
								   action="#{pacientePepiForm.concluirPrescricaoEnfermagemPepi}"
								   style="margin-right: 10px" 
								   styleClass="botaoModal"
								   oncomplete="avisosValidacao(#{pacientePepiForm.avisoValidacao}, 'panelSenha', false)">   		
				</a4j:commandButton>	
				<a4j:commandButton id="btnCancelAlta"  value="Cancelar"  styleClass="botaoModal">
					<rich:componentControl for="panelSenha" attachTo="btnCancelAlta" operation="hide" event="onclick" />
				</a4j:commandButton>
			</div>
		</h:form>
		<!-- FIM CONTEUDO MODAL -->
	</rich:modalPanel>
	<!-- FINAL DO MODAL PANEL ASSINATURA -->

	<rich:panel headerClass="head2">
        <f:facet name="header">
            <h:outputText value="Prescrição Enfermagem" style="text-align:center;font-size:110%"></h:outputText>
        </f:facet>
        
        <rich:panel bodyClass="pbody">
			<f:facet name="header"><h:outputText value="Prescrição Padrão"></h:outputText></f:facet>
			<h:form id="frmPrescricaoEnf">
				<div class="areaPesquisa">
            		Prescrição de <strong><h:outputText value="#{pacientePepiForm.objInternacaoPrescPep.datCadastro}" ><f:convertDateTime pattern=" dd/MM/yyyy" timeZone="GMT-3" /></h:outputText></strong>
          			as <strong><h:outputText value="#{pacientePepiForm.objInternacaoPrescPep.datCadastro}" ><f:convertDateTime pattern=" HH:mm" timeZone="GMT-3" /></h:outputText></strong>
          			por <strong><h:outputText value="#{pacientePepiForm.objInternacaoPrescPep.usuario.dscUsuario}" /></strong><br/>
	          		
	                <h:selectOneMenu value="#{pacientePepiForm.isnTipoPrescricaoEnfermagemPadrao}" style="margin-right: 8px">
						<f:selectItems value="#{pacientePepiForm.sliTipoPrescricaoEnfermagemPadrao}"/>
						<a4j:support event="onchange" reRender="dtPrescricaoEnfermagemPepiItem" action="#{pacientePepiForm.handleTipoPrescricaoEnfermagemChange}" />
					</h:selectOneMenu>
				</div>
				<div style="overflow:scroll; overflow-y:scroll; overflow-x:hidden; position:relative; height:120px; border:1px solid #BED6F8">
					<h:panelGroup style="overflow:scroll; overflow-y:scroll; overflow-x:hidden; position:relative; height:80px;">
						<rich:dataTable id="dtPrescricaoEnfermagemPepiItem"
								onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
				           		onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'"
								value="#{pacientePepiForm.lstPrescricaoEnfermagemItem}" 
								var="item" 
								style="width:100%;"
								rowKeyVar="rowCount">
								
							<f:facet name="header">
								<rich:columnGroup>
									<rich:column style="width:5%">
										<h:panelGroup layout="block">  
											<table>   
											<tr>  
												<td valign="top"><h:selectBooleanCheckbox id="t0" onclick="checkAll( this.id, this.checked );" /></td>  
												<td><h:outputLabel value="Incluir" for="t0" /></td>  
											</tr>  
											</table>  
							            </h:panelGroup>
									</rich:column>
									<rich:column>Prescrição Padronizada</rich:column>
									<rich:column>Complemento</rich:column>
									<rich:column>Aprazamento</rich:column>
								</rich:columnGroup>
							</f:facet>
							<rich:column>
								<h:inputHidden value="#{item.isnItemPrescricaoPresc}" />
    							<h:selectBooleanCheckbox value="#{item.insertItem}" />
							</rich:column>		
							<rich:column>
								<h:outputText value="#{item.dscPrescricao}"/>
							</rich:column>	
							<rich:column>
						  		<h:inputTextarea value="#{item.dscObs}" styleClass="campoTexto" />
							</rich:column>
							<rich:column>
								<h:inputTextarea value="#{item.dscAprazamento}" cols="10" styleClass="campoTexto" />
							</rich:column>
						</rich:dataTable>
					</h:panelGroup>
				</div>
				<div>
					<div align="right" style="padding-top: 6px" >
				   		<a4j:commandButton value="Incluir" action="#{pacientePepiForm.incluirLstPrescricaoEnfermagemItemInc}" reRender="dtPrescricaoEnfermagemInc,dtPrescricaoEnfermagemPepiItem" styleClass="botaoModal" />
				   	</div>
				</div>
			</h:form>
		</rich:panel>
		
		<rich:panel bodyClass="pbody">
			<f:facet name="header"><h:outputText value="Prescrição"></h:outputText></f:facet>
			<h:form id="frmPrescricaoEnfInc">
				<div>
					<rich:dataTable id="dtPrescricaoEnfermagemInc"
							onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
			           		onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'"
							value="#{pacientePepiForm.lstPrescricaoEnfermagemItemInc}" 
							var="itemInc" 
							style="width:100%;" rowKeyVar="rowCount">
						<f:facet name="header">
							<rich:columnGroup>
								<rich:column style="width:5%">
									<h:panelGroup layout="block">  
										<table>   
										<tr>  
											<td valign="top"><h:selectBooleanCheckbox id="t1" onclick="checkAll( this.id, this.checked );" /></td>  
											<td><h:outputLabel value="Excluir" for="t1" /></td>  
										</tr>  
										</table>  
						            </h:panelGroup>
								</rich:column>
								<rich:column>Tipo</rich:column>
								<rich:column>Prescrição</rich:column>
								<rich:column>Aprazamento</rich:column>
							</rich:columnGroup>
						</f:facet>
						<rich:column>
							<h:inputHidden value="#{itemInc.isnItemPrescricaoPresc}" />
   							<h:selectBooleanCheckbox value="#{itemInc.deleteItem}" />
						</rich:column>
						<rich:column>
					  		<h:outputText value="#{itemInc.tipoPrescricao.dscTipoPrescricao}" />
						</rich:column>
						<rich:column>
							<h:outputText value="#{itemInc.dscObs}"/>
						</rich:column>
						<rich:column>
							<h:outputText value="#{itemInc.dscAprazamento}" />
						</rich:column>
					</rich:dataTable>
				</div>
				<div>
					<div align="right" style="padding-top: 6px" >
				   		<a4j:commandButton value="Excluir" styleClass="botaoModal" action="#{pacientePepiForm.excluirLstPrescricaoEnfermagemItemInc}" reRender="dtPrescricaoEnfermagemInc,dtPrescricaoEnfermagemPepiItem"  /><rich:spacer width="10"/>
				   		<a4j:commandButton value="Concluir Prescrição" styleClass="botaoModal" onclick="#{rich:component('panelSenha')}.show()" /><rich:spacer width="10"/>
				   		<a4j:commandButton value="Cancelar" styleClass="botaoModal" action="#{pacientePepiForm.voltaPrescricoesEnfermagemPepi}" >
			   				<f:setPropertyActionListener target="#{pacientePepiForm.numAbaPrescricao}" value="tab1" />
			   			</a4j:commandButton>
				   	</div>
				</div>
			</h:form>
		</rich:panel>
		
	</rich:panel>
    <script>
    <!--
	    function expandItens(obj,idItens) {
		    var detailsId = obj.id.substring(0, obj.id.lastIndexOf(':')) + ':' + idItens;
		    var details = document.getElementById(detailsId);
		    if (details.style.display == 'none') {
		        details.style.display = 'block';
		        obj.src = 'IMG/collapse.gif';
		    } else {
		        details.style.display = 'none';
		        obj.src = 'IMG/expand.gif';
		    }
		}

		function chamaPanelObs(tipo){
			if (tipo==0) {
				Richfaces.showModalPanel("pnlPrescricaoPep");
			}else{
				alert("Não é possivel adicionar uma nova observação!")
			}	
		}

		function avisosValidacao(erro, panel, show) {
			if (erro == 1) {
				alert("Usuário/Conselho e Senha/Assinatura inválidos.");
		    	return false;
			} else if (erro == 2) {
				alert("Usuário sem permissão para esta ação.");
		    	return false;
			} else if(erro == 3){
				alert("Erro ao gravar no banco de dados. Contate o NTI.");
				return false;
			} else if(erro == 4){
				alert("A lista de Prescrições deve possuir no mínimo um item.");
				return false;
			} else {
		    	if (show) {
		        	Richfaces.showModalPanel(panel);
		    	} else {
		    		Richfaces.hideModalPanel(panel);
		    	}	 	
			} 		    	
		}
	
	//-->
    </script>
    <script type="text/javascript">  
  	//<![CDATA[  
    // RichFaces datatable select all -checkbox  
    function checkAll( inputId, state ){
		var idNew = inputId.substr(0, inputId.lastIndexOf(':'));
		var idtab = idNew;
		var elemetos = document.getElementById(idtab);
		var inputs = elemetos.getElementsByTagName('input');  
		for (var i = 0; i <= inputs.length; i++){
			var input = inputs[i];
			if (input != undefined) {
				if(input.getAttribute('type') == 'checkbox' && state){
					input.checked=true;  
          		}else{
          			input.checked=false;
          		}
        	}
      	}
    }
    //]]>  
   </script>  

    
</ui:define>
</ui:composition>
</html>