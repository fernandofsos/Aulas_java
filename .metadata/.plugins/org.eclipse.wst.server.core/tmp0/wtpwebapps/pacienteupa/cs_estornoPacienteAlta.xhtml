<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
					  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:ui="http://java.sun.com/jsf/facelets"
	  xmlns:f="http://java.sun.com/jsf/core"
	  xmlns:h="http://java.sun.com/jsf/html"
	  xmlns:a4j="http://richfaces.org/a4j"
	  xmlns:rich="http://richfaces.org/rich">

<ui:composition template="template.xhtml">
<ui:define name="headHtml">
	<!-- cs_estornoPacienteAlta.xhtml -->
	
	<title>SISTEMA DE PACIENTE - Pesquisar Paciente</title>	
</ui:define>
<ui:define name="conteudo">
<a4j:keepAlive beanName="estornoPacienteAltaForm" />

<rich:modalPanel id="panelStatus" autosized="true" >  
 	<h:panelGrid columns="2"> 
 		<h:graphicImage url="IMG/ajax-loader.gif" style="border:0px"/> 
 		<h:outputText value="Carregando..." />
 	</h:panelGrid> 
</rich:modalPanel> 

<!-- FINAL DO MODAL PANEL ASSINATURA -->
	
<rich:modalPanel id="panelEstorno" autosized="true" width="570" resizeable="false" headerClass="headerPanel">
	<!-- BARRA DE TITULO MODAL-->	
	<f:facet name="header">
		<h:outputText value="ESTORNO DA INTERNAÇÃO"></h:outputText>		
	</f:facet>

	<f:facet name="controls">
		<h:panelGroup>
			<h:graphicImage value="IMG/fechar.png" id="hidelink2" />
			<rich:componentControl for="panelEstorno" attachTo="hidelink2" operation="hide" event="onclick" />
		</h:panelGroup>
	</f:facet>
	
	<!-- FIM DA BARRA DE TITULO MODAL-->

	<!-- CAMPOS DE BUSCA -->
	<h:form id="Alta">	      
		<div class="dadosPaciente geralCampos">
		    <div class="col400" style="width:330px">
			   	<label style="width: 60px;">Paciente:</label>
				<h:outputText value="#{estornoPacienteAltaForm.objEstornoPacienteAltaVo.dscNome}" style="font-weight: bold" />
			</div>
			<div class="col120">
				<label>Nº Prontuário: </label>
				<h:outputText value="#{estornoPacienteAltaForm.objEstornoPacienteAltaVo.numProntuario}" style="font-weight: bold" />
			</div>
			<div class="col400">
			   	<label style="width: 60px; display: inline-block">Clínica </label>
				<h:outputText value="#{estornoPacienteAltaForm.objEstornoPacienteAltaVo.dscClinica}" style="font-weight: bold" />
			</div>				
		</div>

       <div class="geralCampos">
			<div class="linhaFormulario textoConfirmacao" >
			    <div style="float: left; margin-right: 40px">		
					<label class="label largura110" >Usuário/Conselho:</label>
					<h:inputText value="#{estornoPacienteAltaForm.usuario}" maxlength="20" styleClass="inputText" style="width: 80px"/>
				</div>
				<div style="float: left;">		
					<label class="label largura110" >Senha/Assinatura:</label>
					<h:inputSecret value="#{estornoPacienteAltaForm.senha}" maxlength="20"  styleClass="inputText" style="width: 80px"/>
				</div>
			</div>		
		</div>
		<br clear="all"/>
			
		<div style="text-align: center; margin-top: 10px">
			<a4j:commandButton id="btnAssinatura"
							   value="OK" 
							   onclick="this.disabled=true"
							   action="#{estornoPacienteAltaForm.extornarInternacao}"
				   			   oncomplete="this.disabled=false; avisosEstorno(#{estornoPacienteAltaForm.avisoErro})"
							   style="margin-right:10px;width:100px;" 
							   styleClass="botaoModal"
							   reRender="tabelaPaciente,totalRegs">   		
			</a4j:commandButton>				
			<a4j:commandButton id="btnCancelAlta"  value="Cancelar"  styleClass="botaoModal">
				<rich:componentControl for="panelEstorno" attachTo="btnCancelAlta" operation="hide" event="onclick" />
			</a4j:commandButton>
		</div>
	</h:form>
	<!-- FIM CONTEUDO MODAL -->
</rich:modalPanel>


<a4j:form id="formContent">
    <div style="margin-bottom: 55px">
        <a4j:commandButton id="btnReload" action="#{estornoPacienteAltaForm.pesquisar}" value="BTN RELOAD" style="display: none" reRender="tabelaPaciente,totalRegs" />
   	    <div class="cabAreaPesquisa">ESTORNO PACIENTE ALTA</div>	    
	    <div class="areaPesquisa" style="height:70px">
	    	<div class="colLeft">
                <div class="col180" style="width:250px">         	
        			<label>Pesquisar Nome/Prontuário:</label><br/>
					<h:inputText id="inputPesquisa" 
					             value="#{estornoPacienteAltaForm.filtroLista}"
					             styleClass="campoTexto"  
					             style="width: 220px;" />
				</div>
	           <div class="col70">
	                <rich:spacer height="12px"/><br/>
	           		<a4j:commandButton image="IMG/pesquisa.gif" id="btnPesquisa" 
	           		        action="#{estornoPacienteAltaForm.pesquisar}" 
		    				oncomplete="avisosPesquisa(#{estornoPacienteAltaForm.avisoErroPesquisa})"		    				
		    				reRender="tabelaPaciente,totalRegs" />
		    		<rich:hotKey key="return" selector="#inputPesquisa" 
		    		             handler="#{rich:element('btnPesquisa')}.click()"/>		
		    	</div>			    	
			</div>			
			<div class="col150">
			    <label>Resultado:</label><br/>
			    <h:outputText class="totalizador2" value="#{estornoPacienteAltaForm.total}" id="totalRegs"/> 
			</div>
			<br/>
	        <div style="clear:both"/>      
	    </div>
		<div id="">
			<rich:dataTable id="tabelaPaciente"
					onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
					onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'"
					value="#{estornoPacienteAltaForm.lstEstornoPacienteAlta}" 
					var="internado" 
					rows="30"					 
					style="width: 100%"										 
					reRender="ds,totalPesq">
				<f:facet name="header">
					<rich:columnGroup>				
						<h:column>
							<h:outputText value="Prontuário" /> 
						</h:column>
						<h:column>
							<h:outputText value="Paciente" />
						</h:column>
						<h:column>
							<h:outputText value="Clinica / Enf / Leito" />
						</h:column>						
						<h:column>
							<h:outputText value="Data Alta" />
						</h:column>
						<h:column>
							<h:outputText value="Ações" />
						</h:column>
					</rich:columnGroup>
				</f:facet>
				
				
				<!--  Prontuário -->	
				<rich:column width="5%">
					<center>
						<h:outputText value="#{internado.numProntuario}" />
					</center>
				</rich:column>
				
				<!--  Paciente -->
				<rich:column width="30%">				    
					<h:outputText value="#{internado.dscNome} " />
				</rich:column>
				
				<!--  Clinica / Enf / Leito -->
				<rich:column width="35%">
					<h:outputText value="#{internado.clinica} " /> 
				</rich:column>
				
				<!--  Data Alta -->
				<rich:column width="10%" >
					<h:outputText value="#{internado.datAlta}"  >		
				    	<f:convertDateTime pattern="dd/MM/yyyy HH:mm" timeZone="GMT-3" />	       
					</h:outputText>
				</rich:column>
				
				<rich:column width="15%" style="text-align:center">
					<a4j:commandButton id="btnExtornar" 
									     reRender="panelEstorno"
									     value="Estornar"
									     action="#{estornoPacienteAltaForm.limpar}"
									     oncomplete="Richfaces.showModalPanel('panelEstorno')">
									     <f:setPropertyActionListener value="#{internado}" target="#{estornoPacienteAltaForm.objEstornoPacienteAltaVo}"/>
					</a4j:commandButton>
					     
				</rich:column>
				
				<f:facet name="footer">
					<rich:datascroller id="ds" ajaxSingle="false" />
				</f:facet>
			</rich:dataTable>
		</div>
	</div>
	
	<script type="text/javascript">
	     
		function avisosPesquisa(erro) {
		     if (erro==1) {
		    	 alert("Nenhum resultado encontrado!");
		     } 
	    }
	
		function avisosEstorno(erro) {
		     			     
		     if (erro==1) {
		    	 alert("Usuário e/ou senha inválidos!");
		     }
		     else if (erro==2) {
			    	 alert("Usuário sem permissão!");	
		     } else if (erro==3) {
		       	 alert("Paciente já estornado! Atualize a página");
		     	 var item = document.getElementById("formContent:btnReload");
			     console.log(item);
				 item.click();
		    } else {
		    	 alert("Paciente estornado com sucesso!");
		    	 Richfaces.hideModalPanel('panelEstorno'); 
		    	 Richfaces.hideModalPanel('panelSenha');
		    }       
	     }
	     
	</script>
	<a4j:status id="statusPanel"  
           onstart="Richfaces.showModalPanel('panelStatus');" 
           onstop="#{rich:component('panelStatus')}.hide()" >
    </a4j:status> 
</a4j:form>	
</ui:define>
</ui:composition>
</html>