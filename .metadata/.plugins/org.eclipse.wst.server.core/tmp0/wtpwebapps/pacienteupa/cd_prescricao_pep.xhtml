<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
					  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:ui="http://java.sun.com/jsf/facelets"
	  xmlns:f="http://java.sun.com/jsf/core"
	  xmlns:h="http://java.sun.com/jsf/html"
	  xmlns:a4j="http://richfaces.org/a4j"
	  xmlns:rich="http://richfaces.org/rich">

<head>
	<!-- cd_prescricao_pep.xhtml -->
</head>

<body>
	<style>
	<!--
    .rf-panel-header {
    	color: #0054BD;
    }

    .panel {
    	vertical-align: top;
    }

    .top {
     width: 200px;
     height: 100px;
    }

    .head2 {
     height: 18px;
     text-align: center;
     vertical-align: middle;
     padding: 4px 0;
    }

    .pbody {
     height: 185px;
     /*overflow: auto;*/
    }
    
    .tblResumo td{
    	width:50%;
    }
    
    .textEmpty{
    	font-size:110%;
    	font-weight:bold;
    	line-height:40px;
    	color:grey;
    }
    .scrolls{
        width:300px;
        height:80px;
        overflow:auto;
    }
    
    .col{
    	width:90%;
    }
    .campo {font-size: 13px; width:400px;height:100px; border: solid 1px #ccc; text-transform: uppercase; }
	//-->
	</style>
	<a4j:keepAlive beanName="emergenciaForm" />
	<a4j:keepAlive beanName="prescricaoForm" />
	<a4j:keepAlive beanName="templateForm" />
	<!-- *****  MODAL PANEL ASSINATURA  -->
	<rich:modalPanel id="panelSenha" autosized="true" width="400" resizeable="false">
		<f:facet name="header">
    		<h:panelGroup>
				<h:graphicImage value="/images/icons/access.png" style="border:0; margin-right:10px; vertical-align:middle" />
				<h:outputText value="Validação de Senha" style="font-size:11px; font-weight:bold;"/>
			</h:panelGroup>
    	</f:facet>
	
		<f:facet name="controls">
			<h:panelGroup>
				<h:graphicImage value="IMG/fechar.png" id="hidelink2" />
				<rich:componentControl for="panelSenha" attachTo="hidelink2" operation="hide" event="onclick" />
			</h:panelGroup>
		</f:facet>
		<!-- FIM DA BARRA DE TITULO MODAL-->
	
		<!-- CAMPOS DE BUSCA -->
		<h:form id="frmSenha">	      
			<div>
				<fieldset class="fsPepResp">
				    <div style="float: left; margin-right: 20px">	
						<h:outputLabel value="Usuário/Conselho" for="inputConselho"/><h:outputLabel value="*" style="color:red;" /><br/>
						<h:inputText id="inputConselho" value="#{prescricaoForm.usuarioCoren}" maxlength="20" styleClass="inputText" style="width: 150px">
							<a4j:support event="onchange"  actionListener="#{prescricaoForm.pesquisaNomeMedicoCoren}" reRender="nomeMedico" oncomplete="setarFocoSenha();" />
						</h:inputText>
					</div>
					<div style="float: left;">	
						<h:outputLabel value="Senha/Assinatura" for="inputAssinatura" /><h:outputLabel value="*" style="color:red;" /><br/>
						<h:inputSecret value="#{prescricaoForm.senhaAssinatura}" id="inputAssinatura" maxlength="20" styleClass="inputText" style="width: 150px;"/>
					</div>
					<div style="clear:both;">
						<span style="width:400px; height:14px; padding:3px; display:block;">
							<strong>
								<h:outputText id="nomeMedico" value="#{prescricaoForm.nomeMedico}" style="font-size:11px;"/>
							</strong>
						</span>
					</div>
				</fieldset>
			</div>
			<br clear="all"/>
			<div style="text-align: center; margin-top: 10px">
				
				<a4j:commandButton id="btnGravarPrescricaoPep1" 
							   value="OK" 
							   action="#{prescricaoForm.gravarPrescricaoPepi}"
							   style="margin-right:10px;width:100px;" 
							   styleClass="botaoModal"
							   oncomplete="validaDataPrescricao(#{prescricaoForm.codigo})">  
				<f:setPropertyActionListener value="#{false}" target="#{prescricaoForm.pacienteNaRecepcao}" /> 
				<f:setPropertyActionListener value="#{null}" target="#{prescricaoForm.listaIsnProdutoAntibiotico}" /> 
				<f:setPropertyActionListener value="#{null}" target="#{prescricaoForm.listaIsnProdutosAntibioticoSemFicha}" /> 
				<f:setPropertyActionListener value="#{null}" target="#{prescricaoForm.listaFichaItemProrrogacao}" /> 
				<f:setPropertyActionListener value="#{null}" target="#{prescricaoForm.mapeamentoProdutosAntibioticoProrrogacao}" /> 

				</a4j:commandButton> 
						
				<a4j:commandButton id="btnCancelAlta" value="Cancelar" styleClass="botaoModal" style="width:100px;">
					<rich:componentControl for="panelSenha" attachTo="btnCancelAlta" operation="hide" event="onclick" />
				</a4j:commandButton>
				
			</div>
		</h:form>
		<!-- FIM CONTEUDO MODAL -->
	</rich:modalPanel>
	<!-- FINAL DO MODAL PANEL ASSINATURA -->
	
    	<div>
    		<ui:include src="cd_template_emergencia.xhtml"/>
    	</div>
    		<a4j:status id="loading" onstart="#{rich:component('panelStatus')}.show()" onstop="#{rich:component('panelStatus')}.hide()" />
    		
   		<br/>    		
		
		<h:panelGroup layout="block" style="float:left;width:55%;margin-left:20px;">
		<h:form id="formPrescricao">
				<rich:tabPanel switchType="client" selectedTab="tab0">
					<rich:tab label="Prescrição" name="tab0" id="medica" >

						<table>
						<tr>
							<td><label style="font-size:11px;">Data:</label><h:outputText value="*" style="color:red; font-size:11px;" /></td>
							<td align="left">
								<rich:calendar datePattern="dd/MM/yyyy"
								   			   id="inputData" disabled="#{emergenciaForm.pacienteNaRecepcao}"								   								      
								   			   enableManualInput="true"  
			   							       oninputkeypress="return formataData(event, this);"								   								   
											   converter="ConversorDeDatas"
											   inputClass="campoTexto"								   
											   value="#{prescricaoForm.objPrescricaoPep.datPrescricao}" />
							</td>
						</tr>
						<tr>
							<td><label style="font-size:11px;">Tipo:</label><h:outputText value="*" style="font-size:11px; color:red;" /></td>
							<td align="left">
								<h:selectOneMenu id="ddpTipo" disabled="#{prescricaoForm.objPrescricaoPep.isnPrescricaoTipo == 10}"
												 style="font-size:11px; width: 180px" 
								 				 styleClass="selectItens"
								 				 value="#{prescricaoForm.objPrescricaoPep.isnPrescricaoTipo}">
									<f:selectItems value="#{prescricaoForm.sliPrescricaoPepTipo}" />
									<a4j:support event="onchange" ajaxSingle="true" reRender="formPrescricao" />
								</h:selectOneMenu>
							</td>
						</tr>
						<tr>
							<td><label style="font-size:11px;">Observação:</label></td>
							<td>
								<h:inputTextarea value="#{prescricaoForm.objPrescricaoPep.dscObs}" styleClass="campo" onkeyup="verificaTamanho('formPrescricao',this, 100, 'lblDscObs');" onblur="upper(this);" /><br/>
								<label id="lblDscObs" class="campoVazio2 campoTextoAtendMedic">(100 caracteres restantes)</label>
							</td>
						</tr>
						<tr>
							<td colspan="2" align="right">
								<a4j:commandButton id="btnGravarPrescricaoPep1" 
											   value="OK" rendered="#{!emergenciaForm.pacienteNaRecepcao}"
											   action="#{prescricaoForm.limpaFormUsuario}"
											   style="margin-right:10px;width:100px;" 
											   styleClass="botaoModal"
											   oncomplete="#{rich:component('panelSenha')}.show()"
											   reRender="panelSenha">  
								</a4j:commandButton> 	  					   			

								<a4j:commandButton id="btnGravarPrescricaoPep2" 
											   value="OK" rendered="#{emergenciaForm.pacienteNaRecepcao}"
											   action="#{prescricaoForm.gravarPrescricaoPepi}"
											   oncomplete="validaDataPrescricao(#{prescricaoForm.codigo})" 
											   style="margin-right:10px;width:100px;" 
											   styleClass="botaoModal">  
									<f:setPropertyActionListener value="#{emergenciaForm.pacienteNaRecepcao}" target="#{prescricaoForm.pacienteNaRecepcao}" /> 
									<f:setPropertyActionListener value="#{null}" target="#{prescricaoForm.listaIsnProdutoAntibiotico}" /> 
									<f:setPropertyActionListener value="#{null}" target="#{prescricaoForm.listaIsnProdutosAntibioticoSemFicha}" /> 
									<f:setPropertyActionListener value="#{null}" target="#{prescricaoForm.listaFichaItemProrrogacao}" /> 
									<f:setPropertyActionListener value="#{null}" target="#{prescricaoForm.mapeamentoProdutosAntibioticoProrrogacao}" /> 
								</a4j:commandButton> 	  					   			

								
								
									   	  	    	      
  								<a4j:commandButton id="btnCancelar" 
									  	    	   value="Cancelar"	  	      			  	    		
									  	    	   style='width:100px;'
									  	    	   styleClass="botaoModal100 botaoExcluir"
									  	    	   action ="#{prescricaoForm.carregaPagina}">
									<f:setPropertyActionListener value="#{false}" target="#{emergenciaForm.alertaAlergia}" /> 
							    </a4j:commandButton>
							</td>
						</tr>
						</table>
				</rich:tab>
			</rich:tabPanel>
			
		</h:form>
		</h:panelGroup>
    <script>
    <!--
    function expandItens(obj,idItens)
	{		
		var detailsId = obj.id.substring(0, obj.id.lastIndexOf(':')) + ':' + idItens;
		var details = document.getElementById(detailsId);
		if (details.style.display == 'none') 
		{
		       details.style.display = '';
		       obj.src = 'IMG/collapse.gif';
		 } 
		 else 
		 {
		       details.style.display = 'none';
		       obj.src = 'IMG/expand.gif';
		 }
	}
		function validaDataPrescricao(codigo){
			if (codigo == 1) {
				//Richfaces.hideModalPanel("panelSenha");
				alert("Data da Prescrição invalida!");
			} else if (codigo == 2) {
				//Richfaces.hideModalPanel("panelSenha");
				alert("Tipo prescrição campo obrigatório!");	
			} else if (codigo == 3) {
				alert("Só é permitida a criação de uma Prescrição Completa por dia!");
			} else if (codigo == 4) {
				alert("Só é permitida a criação de uma Prescrição Completa se existir Prescrição Completa no dia anterior");
			} else if (codigo == 5) {
				alert("Só é permitido realizar prescrições futuras para o Tipo Completa.");
			} else if (codigo == 6) {
				alert("Usuário/Conselho e Senha/Assinatura inválidos.");
			} else if (codigo == 7) {
				alert("Usuário sem permissão para esta ação.");
			} else if (codigo == 8) {
				alert("Para realizar essa prescrição é necessário haver um relatório de admissão para o paciente.")
			} else if (codigo == 9) {
				alert("Não é permitido a criação de uma Prescrição Completa quando há uma Prescrição Admissão no mesmo dia!");
			} else if (codigo == 10) {
				alert("Só é permitido cadastrar prescrição futura para o dia posterior a data atual.");
			} else if (codigo == 11) {
				alert("Não é permitido a criação de uma Prescrição Futura quando há Prescrição em aberto!");
			} else if (codigo == 12) {
				alert("Não é permitido a criação de uma Prescrição Futura quando não há Prescrição Completa no dia!");
			}
		}

		function validaPrescricaoEnfermagem(codigo){
			if (codigo == 1) {
				alert("Usuário/Conselho e Senha/Assinatura inválidos.");
		    	return false;
			} else if (codigo == 2) {
				alert("Usuário sem permissão para esta ação.");
		    	return false;
			} else{
				Richfaces.hideModalPanel("panelSenhaEnfermagem");
			}			
		}

		function avisosValidacao(erro, panel, show) {
			if (erro == 1) {
				alert("Usuário/Conselho e Senha/Assinatura inválidos.");
		    	return false;
			} else if (erro == 2) {
				alert("Usuário sem permissão para esta ação.");
		    	return false;
			} else if(erro == 3){
				alert("Erro ao gravar no banco de dados. Contate o NTI.");
				return false;
			} else {
		    	if (show) {
		        	Richfaces.showModalPanel(panel);
		    	} else {
		    		Richfaces.hideModalPanel(panel);
		    	}	 	
			} 		    	
		}
		
		function setarFocoSenha(){	
			document.getElementById('frmSenha:inputAssinatura').focus();
		}
	
		function setarFocoSenha2(){	
			document.getElementById('senhaEnf:inputAssinatura2').focus();
		}
		
		function setarFocoSenhaHemo(){	
			document.getElementById('frmSenhaHemo:inputAssinatura').focus();
		}
		
	//-->
    </script>
</body>
</html>