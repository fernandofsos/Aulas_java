<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baixando as imagens do Exame</title>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
	
    <script src="js/jquery-2.1.0.min.js"></script>
	
    <script src="js/dicomtix.min.js"></script>
    <script src="js/dicomtixUtil.min.js"></script>
    <script src="js/dicomtixConfig.min.js"></script>
    <script src="js/dicomtixWeb.min.js"></script>
  </head>
  <body style="background-color:black;">
	<div id="wrap" style="margin-top:-10px;">
	    <div class="row-fluid">
			<div class="col-sm-2" style="padding-left:5px;">
				<img style="margin-left:10px;margin-top:15px;" src="IMG/logo-header.png"/>
				<img style="vertical-align:middle;" src="IMG/carregando.gif"/>
			</div>
			<p id="spanStatus" style="margin-left:10px; color: white; font-size: 120%; text-align: center;">Carregando...<br/><br/></p>
		</div>
		
		<div class="row-fluid">
			<div class="col-sm-2" style="padding-left:5px;">
				<img src="IMG/logo-statix-cor2-pequeno.jpg"/>
			</div>
			<div class="col-sm-8 col-sm-offset-2 col-sm-pull-2">
				
			</div>
		</div>
	</div>
	
	<form id="formDicomtix" name="formDicomtix">
	</form>
	
	<script>
	  function erro(mensagem){
	    //alert('Deu erro. Mensagem: ' + mensagem);
		document.getElementById("spanStatus").innerHTML = mensagem;
	  }
	  
	  function sucesso(mensagem){
	    alert('Deu certo. Mensagem: ' + mensagem);
	  }
	  
	  function progresso(nrImagemBaixada, nrImagensTotal, mensagem){
	    if(nrImagensTotal > 0){
			document.getElementById("spanStatus").innerHTML = 'Total de imagens: ' + nrImagensTotal + '<br/>Imagens Baixadas: ' +  nrImagemBaixada + '<br/>(' + ((nrImagemBaixada / nrImagensTotal) * 100).toFixed(2) + '%)';
		} else if(mensagem){
			document.getElementById("spanStatus").innerHTML = mensagem + '<br/><br/>';
		}
	  }
	  
	   $( window ).load(function() {
	      if(window.location.search){
			var dados = window.location.search.substr(1).split(';');
			//alert('Dados: ' + dados);
			//alert('Tamanho dos Dados: ' + dados.length);
			if(dados.length && dados.length == 3){
				//console.log('Usuário: ' + dados[0]);
				//console.log('Senha: ' + MD5(dados[1]));
				//console.log('Exame id: ' + dados[2]);
				dicomtixWeb.getExame(dados[0], dados[1], dados[2], '', erro, progresso);
				//window.location.search = '';
			} else {
				document.getElementById("spanStatus").innerHTML = "Exame id não enviado";
			}
		  }
	  });
		  
	</script>
  </body>
</html>