<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
					  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:ui="http://java.sun.com/jsf/facelets"
	  xmlns:f="http://java.sun.com/jsf/core"
	  xmlns:h="http://java.sun.com/jsf/html"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:t="http://myfaces.apache.org/tomahawk">

<ui:composition template="template.xhtml">
	<ui:define name="headHtml" />
	<ui:define name="conteudo">
		<a4j:keepAlive beanName="exameDetalhadoForm" />
		
		
		
		<rich:modalPanel id="panelStatus" autosized="true">  
	 		<h:panelGrid columns="2" width="180"> 
	 			<h:graphicImage url="IMG/ajax-loader.gif" style="border:0px"/> 
	 			<h:outputText value="Atualizando, aguarde..." />
	 		</h:panelGrid> 
		</rich:modalPanel>
		
		<!-- MODAL PANEL DE PROFISSIONAL -->
		<rich:modalPanel id="panProfissional" autosized="false" width="900" height="500" resizeable="false" headerClass="headerPanel3">
	    	<f:facet name="header">
				<h:panelGroup>
	       			<h:outputText value="Pesquisa de Profissional"></h:outputText>
	       		</h:panelGroup>
	    	</f:facet>
	    	<f:facet name="controls">
	    	 	<h:panelGroup>
	        		<h:graphicImage value="IMG/fechar.png" id="fechaPanel"/>
	        		<rich:componentControl for="panProfissional" attachTo="fechaPanel" operation="hide" event="onclick" />
	        	</h:panelGroup>
	    	</f:facet>
	    	<h:form id="formProfissional">
	    		<fieldset style="background-color: #F5F5F5">
		    		<div>
					    <div class="colLeft">     
		       				<label class="font12"><b>Nome: *</b></label>
		       			</div>
		       			<div class="colLeft">
		       				<h:inputText value="#{exameDetalhadoForm.strMedico}" maxlength="50" styleClass="campoTexto" onblur="this.value.toUpperCase();" style="width:450px;" id="nmProfissional" onkeypress="return enter(event);"/>
		       			</div>	       			       
		    		</div>
		    		<div>
					    <div class="colLeft" style="width: 100%; margin-top:10px;">
		       				<a4j:commandButton styleClass="botaoModal" oncomplete="validaPesquisa('#{exameDetalhadoForm.mensagem}');" id="pesquisar" value="Pesquisar" actionListener="#{exameDetalhadoForm.pesquisarProfissional}" reRender="formProfissional"/>
		       			</div>
		    		</div>
	    		</fieldset>
	    		<div>
					<rich:dataTable id="tabelaProfissional"
							onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
							onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'"
							value="#{exameDetalhadoForm.listaProfissionais}" 
							var="listaProfissional" 
							rows="10"
							rowKeyVar="linha" 
							style="width: 100%; cursor: pointer;">
						<f:facet name="header">
							<rich:columnGroup>
								<h:column>
									<h:outputText width="5%"/>
								</h:column>
								<h:column>
									<h:outputText value="Nome" />
								</h:column>
								<h:column>
									<h:outputText value="CRM" />
								</h:column>
							</rich:columnGroup>
						</f:facet>
						<rich:column align="center" width="5%" sortable="true">
							<a4j:commandLink reRender="pnProfissional" oncomplete="#{rich:component('panProfissional')}.hide()">
								<h:graphicImage id="imgSelecionar" url="IMG/selecionar.png" style="border:0;" />
								<f:setPropertyActionListener value="#{listaProfissional}" target="#{exameDetalhadoForm.objMedico}"/>						
							</a4j:commandLink>
						</rich:column>
						<rich:column sortable="true">
							<h:outputText value="#{listaProfissional.dscUsuario}" />
						</rich:column>
						<rich:column sortable="true">
							<h:outputText value="#{listaProfissional.dscLogin}" />
						</rich:column>
						<f:facet name="footer">
							<rich:datascroller id="ds" ajaxSingle="false" />
						</f:facet>
					</rich:dataTable>
				</div>
	    	</h:form>
	 	</rich:modalPanel>
		<!-- FINAL DO MODAL PANEL DE PROFISSIONAL -->

	 	<h:form id="formExame">
	 		<div class="cabAreaPesquisa">GERAL EXAMES</div>			
	    	<h:panelGroup styleClass="areaPesquisa" layout="block" id="filtros">
		       	<div>
		       		<h:selectOneRadio value="#{exameDetalhadoForm.tipoPesquisa}">
                        <f:selectItem itemLabel="PESQUISA" itemValue="1" />
                        <f:selectItem itemLabel="RELATÓRIO BPA INDIVIDUALIZADO" itemValue="2" />
						<f:selectItem itemLabel="RELATÓRIO BPA CONSOLIDADO" itemValue="3" />
						<a4j:support event="onclick" reRender="filtros,panelTabelaExameDetalhado"/>
                    </h:selectOneRadio>
		       	</div>
		       	<br style="clear: both;"/>
		       	<h:panelGroup id="pnProfissional" rendered="#{exameDetalhadoForm.tipoPesquisa eq 1}" style="font-size:1em">
			       	<div>
			       		<h:outputLabel value="Prontuário"/><br/>
			       		<h:inputText id="inputProntuario" 
								     value="#{exameDetalhadoForm.exameSolicitacao.filtro.numProntuario}"
								     style="width:100px;"
								     maxlength="20"
								     styleClass="campoTexto"/>
			       	</div>
			       	<br style="clear: both;"/>
			       	<div>
			       		<table cellpadding="0" cellspacing="0" border="0">
		       			<tr>
		       				<td>
		       					<h:outputLabel value="Médico" for="iptMedico"/><br/>
		       					<h:inputText value="#{exameDetalhadoForm.objMedico.dscUsuario}" disabled="true" id="iptMedico" onblur="upper(this);" style="width:305px; height:16px; text-transform:uppercase;"/>
		       				</td>
		       				<td valign="bottom" style="padding-left:5px;">
		       					<a4j:commandButton image="IMG/pesquisa.gif" 
		 										   immediate="true"
		 			                                      id="btnProfissional"
						           		          action="#{exameDetalhadoForm.abrirProfissional}"
						           		      oncomplete="Richfaces.showModalPanel('panProfissional');"
							    		        reRender="panProfissional" />
							</td>
							<td valign="bottom" style="padding-left:5px;">
								<a4j:commandButton image="IMG/excluir.png" title="Retirar Profissional"
		 										   immediate="true"
		 			                                      id="btnExcluirProfissional"
						           		          action="#{exameDetalhadoForm.excluirProfissional}"
							    		        reRender="formExame" />
		       				</td>
		       			</tr>        			
		       			</table>
			       	</div>
			       	<br style="clear: both;"/>
			       	<div>
			       		<h:outputLabel value="Exame" for="selExames"/><br/>
						<h:selectOneMenu id="isnExame" 
								      value="#{exameDetalhadoForm.objExame}" converter="simpleIndexConverter">
								<f:selectItem itemValue="" itemLabel="Selecione" />
								<f:selectItems var="o" itemValue="o" itemLabel="o.dscExame" value="#{exameDetalhadoForm.lstExames}" />
						</h:selectOneMenu>
										
			       	</div>
			       	<div>
			       		<h:outputLabel value="Agrupamento" for="selExameAgrupamento"/><br/>
			       		<h:selectOneMenu id="isnAgrupamento"
								      value="#{exameDetalhadoForm.objAgrupamento}" converter="simpleIndexConverter">
								<f:selectItem itemValue="" itemLabel="Selecione" />
								<f:selectItems var="o" itemValue="o" itemLabel="o.dscExameAgrupamento" value="#{exameDetalhadoForm.lstAgrupamentos}" />
						</h:selectOneMenu>
			       	</div>
			       	<div>
			       		<h:outputLabel value="Situação" for="selExameSituacao"/><br/>
			       		<h:selectOneMenu id="isnExameSituacao"
								      value="#{exameDetalhadoForm.objExameSituacao}" converter="simpleIndexConverter">
								<f:selectItem itemValue="" itemLabel="Selecione" />
								<f:selectItems var="o" itemValue="o" itemLabel="o.dscExameSituacao" value="#{exameDetalhadoForm.lstExameSituacoes}" />
						</h:selectOneMenu>
			       	</div>
			       	<div>
			       		<h:outputLabel value="Grupo" for="selExameGrupo"/><br/>						
						<h:selectOneMenu id="isnExameGrupo"
								      value="#{exameDetalhadoForm.objExameGrupo}" converter="simpleIndexConverter">
								<f:selectItem itemValue="" itemLabel="Selecione" />
								<f:selectItems var="o" itemValue="o" itemLabel="o.dscExameGrupo" value="#{exameDetalhadoForm.lstExameGrupo}" />
						</h:selectOneMenu>
						
			       	</div>
			       	<div>
			       		<h:outputLabel value="Urgente" for="flgUrgente"/><br/>
			       		<h:selectBooleanCheckbox id="flgUrgente" value="#{exameDetalhadoForm.flgUrgente}"/>			       		
			       	</div>
			       	<br style="clear: both;"/>
			    </h:panelGroup>
			    <br style="clear: both;"/>
		       	
		       	<h:panelGroup rendered="#{exameDetalhadoForm.tipoPesquisa eq 1}">
			       	<div>
			       		<h:outputLabel value="Clínica" for="selClinicas1"/><br/>
						<h:selectOneMenu id="isnClinica"
							      value="#{exameDetalhadoForm.objClinica}" converter="simpleIndexConverter">
							<f:selectItem itemValue="" itemLabel="Selecione" />
							<f:selectItems var="o" itemValue="o" itemLabel="o.dscClinica" value="#{exameDetalhadoForm.lstClinicas}" />
					</h:selectOneMenu>
			       	</div>			
		       	</h:panelGroup>
		       	
		       	<h:panelGroup rendered="#{exameDetalhadoForm.tipoPesquisa eq 2 or exameDetalhadoForm.tipoPesquisa eq 3}">
		       		<div>
			       		<h:outputLabel value="Agrupar por" for="selAgrupamento"/><br/>
			       		<h:selectOneMenu value="#{exameDetalhadoForm.agrupamento}" id="selAgrupamento">
	                        <f:selectItem itemLabel="EXAMES" itemValue="1" />
	                        <f:selectItem itemLabel="CONSULTAS" itemValue="2" />
	                        <f:selectItem itemLabel="PROCEDIMENTOS" itemValue="3" />
	                        <a4j:support event="onchange" reRender="formExame" />
	                    </h:selectOneMenu>
	                </div>
		       	</h:panelGroup>
		       	
		       	<h:panelGroup rendered="#{exameDetalhadoForm.tipoPesquisa eq 3}">
			       	<div style="#{(exameDetalhadoForm.agrupamento eq 2)?'':'display:none'}">
			       		<h:outputLabel value="Consultas" for="selConsultas"/><br/>
			       		<h:selectOneRadio value="#{exameDetalhadoForm.tipoConsulta}" id="selConsultas">
	                        <f:selectItem itemLabel="MÉDICOS" itemValue="1" />
	                        <f:selectItem itemLabel="ODONTÓLOGOS" itemValue="2" />
	                        <f:selectItem itemLabel="ENFERMEIROS" itemValue="3" />
	                        
	                    </h:selectOneRadio>
			       	</div>
                </h:panelGroup>
       			<br style="clear:both;"/>
		       	<div>
	    			<h:outputLabel value="Data Realização"/><h:outputText value="*" styleClass="asterisco"/><br/>
		       		<rich:calendar id="datRealizacaoInicial" value="#{exameDetalhadoForm.datRealizacaoInicio}" datePattern="dd/MM/yyyy" showWeeksBar="false" enableManualInput="true" oninputkeypress="return formataData(event, this)" maxlength="10"/>
   						<font size="1"><h:outputText value=" a "/></font>
   					<rich:calendar id="datRealizacaoFinal" value="#{exameDetalhadoForm.datRealizacaoFim}" datePattern="dd/MM/yyyy" showWeeksBar="false" enableManualInput="true" oninputkeypress="return formataData(event, this)" maxlength="10"/>   	       	    
		       	</div>
		       	<div style="#{(exameDetalhadoForm.tipoPesquisa eq 2 or exameDetalhadoForm.tipoPesquisa eq 3)?'display:none':''}">
	    			<h:outputLabel value="Data Solicitação"/><h:outputText value="*" styleClass="asterisco"/><br/>
		       		<rich:calendar id="datSolicInicial" 
		       	               value="#{exameDetalhadoForm.datSolicitacaoInicio}" 
		       		           datePattern="dd/MM/yyyy"
		       		           showWeeksBar="false" enableManualInput="true" oninputkeypress="return formataData(event, this)" maxlength="10" />
					<h:outputLabel value=" a " />	        		               
		       		<rich:calendar id="datSolicFinal" 
		       	               value="#{exameDetalhadoForm.datSolicitacaoFim}" 
		       	               datePattern="dd/MM/yyyy"
		       	               showWeeksBar="false" enableManualInput="true" oninputkeypress="return formataData(event, this)" maxlength="10" />    	       	    
		       	</div>
		       
		       	<div class="col150" style="float:right; #{(exameDetalhadoForm.tipoPesquisa eq 1)?'':'display:none;'}">
				    <label>Resultado:</label>
				    <h:outputText class="totalizador2" value="#{exameDetalhadoForm.total}" id="totalRegs"/> 
				</div>
		       	<br style="clear: both;"/>
		       	
		       	<h:panelGroup rendered="#{exameDetalhadoForm.tipoPesquisa eq 1}">
	    			<h:outputLabel value="Ordenar Por:"/><br/>
		       		<h:selectOneMenu value="#{exameDetalhadoForm.orderBy}" id="selOrdenacao">
					   <f:selectItem itemValue="1" itemLabel="Prontuário" />
					   <f:selectItem itemValue="2" itemLabel="Paciente" />
					   <f:selectItem itemValue="3" itemLabel="Exame" />
					   <f:selectItem itemValue="4" itemLabel="Solicitação" />
					   <f:selectItem itemValue="5" itemLabel="Realização" />	
					</h:selectOneMenu>   	    
		       	</h:panelGroup>
		       	
		       	<br style="clear:both;"/>
		       	
		       	<div style="height: 30px;">     
       				<label>Pelo menos um dos campos com <font color="red">*</font> é obrigatório!</label>
    			</div>
    			<br style="clear: both;"/>
		       	<div>
		       		<a4j:commandButton value="PESQUISAR"
		       						  id="btnPesquisarExameDetalhado"
				       	              action="#{exameDetalhadoForm.pesquisarExameDetalhado}" 
				       	              oncomplete="validar('#{exameDetalhadoForm.mensagem}');"
				       	              styleClass="botaoModal" style="margin-right:10px;" reRender="totalRegs,panelTabelaExameDetalhado, filtros" rendered="#{exameDetalhadoForm.tipoPesquisa eq 1}">
					</a4j:commandButton>
					
		       	   	<a4j:commandButton value="BPA INDIVIDUALIZADO"
		       	   					  id="btnPesquisarBPA"
				       	              action="#{exameDetalhadoForm.pesquisarBPA}"
				       	              oncomplete="avisosPesquisaBPA(#{exameDetalhadoForm.erroPesquisa}, 'linkBPAI');"
				       	              styleClass="botaoModal" style="margin-right:10px;" rendered="#{exameDetalhadoForm.tipoPesquisa eq 2 and exameDetalhadoForm.agrupamento eq 1}">
					</a4j:commandButton>
					<t:commandLink id="linkBPAI" value="BPA INDIVIDUALIZADO" action="#{exameDetalhadoForm.imprimirBPAI}" target="blank" style="display:none" />
					
					<a4j:commandButton value="BPA INDIVIDUALIZADO"
				       	              action="#{exameDetalhadoForm.pesquisarBPACP}"
				       	              oncomplete="avisosPesquisaBPA(#{exameDetalhadoForm.erroPesquisa}, 'linkBPAPI');"
				       	              styleClass="botaoModal" style="margin-right:10px;" rendered="#{exameDetalhadoForm.tipoPesquisa eq 2 and exameDetalhadoForm.agrupamento eq 3}">
					</a4j:commandButton>
					<t:commandLink id="linkBPAPI" value="BPA CONSOLIDADO" action="#{exameDetalhadoForm.imprimirBPAPI}" target="blank" style="display:none" />
					
					<a4j:commandButton value="BPA CONSOLIDADO "
									  id="btnPesquisarBPAC"
				       	              action="#{exameDetalhadoForm.pesquisarBPAC}"
				       	              oncomplete="avisosPesquisaBPA(#{exameDetalhadoForm.erroPesquisa}, 'linkBPAC');"
				       	              styleClass="botaoModal" rendered="#{exameDetalhadoForm.tipoPesquisa eq 3 and exameDetalhadoForm.agrupamento eq 1}">
					</a4j:commandButton>
					<t:commandLink id="linkBPAC" value="BPA CONSOLIDADO" action="#{exameDetalhadoForm.imprimirBPAC}" target="blank" style="display:none" />
					
					<a4j:commandButton value="BPA CONSOLIDADO "
				       	              action="#{exameDetalhadoForm.pesquisarBPACE}"
				       	              oncomplete="avisosPesquisaBPA(#{exameDetalhadoForm.erroPesquisa}, 'linkBPACAPE');"
				       	              styleClass="botaoModal" rendered="#{exameDetalhadoForm.tipoPesquisa eq 3 and exameDetalhadoForm.agrupamento eq 2}">
					</a4j:commandButton>
					<t:commandLink id="linkBPACAPE" value="BPA CONSOLIDADO" action="#{exameDetalhadoForm.imprimirBPACAPE}" target="blank" style="display:none" />
					
					<a4j:commandButton value="BPA CONSOLIDADO "
				       	              action="#{exameDetalhadoForm.pesquisarBPACP}"
				       	              oncomplete="avisosPesquisaBPA(#{exameDetalhadoForm.erroPesquisa}, 'linkBPACP');"
				       	              styleClass="botaoModal" rendered="#{exameDetalhadoForm.tipoPesquisa eq 3 and exameDetalhadoForm.agrupamento eq 3}">
					</a4j:commandButton>
					<t:commandLink id="linkBPACP" value="BPA CONSOLIDADO" action="#{exameDetalhadoForm.imprimirBPACP}" target="blank" style="display:none" />
					
					<h:commandLink styleClass="botaoModal" id="linkImprimir" target="_blank" action="#{exameDetalhadoForm.imprimir}"  rendered="#{exameDetalhadoForm.tipoPesquisa eq 1 and exameDetalhadoForm.total>0}"
		    				oncomplete="avisosPesquisa(#{exameDetalhadoForm.erroPesquisa})"
		    				reRender="tabelaPaciente,totalPesq" style="border:0">
		    			<h:graphicImage url="IMG/impressora.png" style="border:0;"></h:graphicImage>	
		    		</h:commandLink>	
		    		
		    		<br style="clear:both;"/>
		        </div>	
		        
		        <br style="clear:both;"/>
	    	</h:panelGroup>
	    	
	    	<div style="margin-bottom:50px">
	    		
				<h:panelGroup id="panelTabelaExameDetalhado">
					<rich:dataTable id="tabelaExamesDetalhado"
							onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
							onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'"
							value="#{exameDetalhadoForm.listaExamesDetalhada}" 
							var="rst" 
							rows="18"
							rowKeyVar="linha" 
							style="width: 100%; cursor: pointer; display:table"
							reRender="ds"
							rendered="#{exameDetalhadoForm.tipoPesquisa eq 1 and exameDetalhadoForm.total>0}">					
						
						<rich:column style="text-align: right; width: 5%;" sortBy="#{rst.internacaoPepBean.pacientePepBean.numProntuario}">
							<f:facet name="header">
								<h:outputText value="Prontuário"/>
							</f:facet>
							<h:outputText value="#{rst.internacaoPepBean.pacientePepBean.numProntuario}" />
						</rich:column>
						
						<rich:column style="text-align: left; width: 38%;" sortBy="#{rst.internacaoPepBean.pacientePepBean.dscNome}">
							<f:facet name="header">
								<h:outputText value="Paciente" />
							</f:facet>
							<h:outputText value="#{rst.internacaoPepBean.pacientePepBean.dscNome}" />
						</rich:column>
		
						<rich:column style="text-align: left; width: 37%;" sortBy="#{rst.examePepBean.dscExame}">
							<f:facet name="header">
								<h:outputText value="Exame" />
							</f:facet>					
							<h:outputText value="#{rst.examePepBean.dscExame}" />
						</rich:column>
						
						<rich:column style="text-align: center; width: 10%;" sortBy="#{rst.datSolicitacao}">
							<f:facet name="header">
								<h:outputText value="Data de Solicitação"/>
							</f:facet>
							<h:outputText value="#{rst.datSolicitacao}" />
						</rich:column>
						
						<rich:column style="text-align: center; width: 10%;" sortBy="#{rst.datRealizacao}">
							<f:facet name="header">
								<h:outputText value="Data de Realização" />
							</f:facet>
							<h:outputText value="#{rst.datRealizacao}" />
						</rich:column>
						
						<f:facet name="footer">
							<rich:datascroller id="ds" ajaxSingle="false" />
						</f:facet>
					</rich:dataTable>
				</h:panelGroup>
				
	    	</div>
	 	
		 	<a4j:status id="statusPanel"
				   onstart="Richfaces.showModalPanel('panelStatus');" 
				    onstop="#{rich:component('panelStatus')}.hide()">
			</a4j:status>  
        
		</h:form>
		
		<script>
		<!--
		function validar(msg)
		{
			if(msg != '')
			{
				alert(msg);
			}
			else
			{
				Richfaces.showModalPanel('panConsultaDetalhada');
			}
		}	
		function avisosPesquisa(erro) {
			if (erro == 1) {
				alert("Informe pelo menos um período de datas.");
			} else if (erro == 2) {
				alert("O intervalo entre as datas deve ser de no máximo um mês (31 dias).");
			} else if (erro == 3) {
				alert("A pesquisa não retornou nada, para esses parâmetros de busca.");
			}
		}

		function avisosPesquisaBPA(erro, id) {
			if (erro == 1) {
				alert("O campo Tipo de Atendimento é obrigatório.");
			} else if (erro == 2) {
				alert("O período de Data de Realização é obrigatório.");
			} else if (erro == 3) {
				alert("O intervalo entre as datas deve ser de no máximo um mês (31 dias).");
			} else if (erro == 4) {
				alert("A pesquisa não retornou nada, para esses parâmetros de busca.");
			} else {
				document.getElementById("formExame:"+id).click();
			}
		}
		//-->
		</script>
				
	</ui:define>
	
</ui:composition>

</html>