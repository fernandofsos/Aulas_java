<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
					  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:ui="http://java.sun.com/jsf/facelets"
	  xmlns:f="http://java.sun.com/jsf/core"
	  xmlns:h="http://java.sun.com/jsf/html"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:t="http://myfaces.apache.org/tomahawk"
      xmlns:rich="http://richfaces.org/rich">

<ui:composition template="template.xhtml">

<ui:define name="headHtml">
	<!-- cs_relatorioEpidemiologico.xhtml -->
</ui:define>

<ui:define name="conteudo">  
    
    <style>
    table.legenda div{
		float:left;
		height:20px;
		padding:5px;
		white-space:nowrap;
		font-size:11px;
	}
	.rich-table-subheadercell {
		font-size:14px;
	}
    </style>
    
	<a4j:keepAlive beanName="relatorioEpidemiologicoForm" />
	<a4j:keepAlive beanName="cid10Form"/>
		
	<rich:modalPanel id="panelCid10" autosized="false" width="900" height="650" resizeable="false" headerClass="headerPanel3">
		<f:facet name="header">
			<h:outputText value="CID10"/>
	   	</f:facet>
	   	<f:facet name="controls">
	   	 	<h:panelGroup>
	       		<h:graphicImage value="IMG/fechar.png" id="fechaPanelCid10"/>
	       		<rich:componentControl for="panelCid10" attachTo="fechaPanelCid10" operation="hide" event="onclick" />
	       	</h:panelGroup>
	   	</f:facet>
		<!-- FORM -->
		<h:form id="formTabelaCid10">
			<h:panelGroup styleClass="areaPesquisa" layout="block" id="totaisEmergencia" style="height:120px;" >
        	
	        		<table cellpadding="10">
	        		<tr>
	        			<td valign="top">
			        		<label>Pesquisar:</label><br/>
							<h:inputText id="inputPesquisa" 
							             value="#{cid10Form.valorPesquisa}"
							             styleClass="campoTexto"  
							             style="width: 170px;" />
							             
							<a4j:commandButton image="IMG/pesquisa.gif" 
				           	        id="btnPesquisa" 
				           	        action="#{cid10Form.buscar}" 
					    			oncomplete="avisosPesquisa(#{cid10Form.erroCid10})" 
					    			style="margin-left:10px; vertical-align:middle;"
					    			reRender="dtCid10,totalRegs,ddpGrupos,ddpCategorias" >
					    		<f:setPropertyActionListener target="#{cid10Form.tipoBusca}" value="#{0}"/>	
					    	</a4j:commandButton>
					    	<rich:hotKey key="return" selector="#inputPesquisa" handler="#{rich:element('btnPesquisa')}.click()"/>
					    	<br/>
							<a4j:commandLink action="#{cid10Form.buscar()}" 
							                 value="Listar Apenas os Relevantes" 
							                 reRender="dtCid10,totalRegs,ddpGrupos,ddpCategorias"
							                 styleClass="linkGeral">
								<f:setPropertyActionListener target="#{cid10Form.tipoBusca}" value="#{1}"/>
							</a4j:commandLink><br/>
							<a4j:commandLink action="#{cid10Form.buscar()}" 
							                 value="Listar com Pesquisa Adicional" 
							                 reRender="dtCid10,totalRegs,ddpGrupos,ddpCategorias"
							                 styleClass="linkGeral">
								<f:setPropertyActionListener target="#{cid10Form.tipoBusca}" value="#{2}"/>
							</a4j:commandLink>
	        			</td>
	        			<td valign="top">
				            <label>Categorias:</label><br/>
				           	<h:selectOneMenu id="ddpCategorias" 
								             value="#{cid10Form.isnCategoria}" 
								             style="width:390px;" styleClass="selectItens">
								<f:selectItems value="#{cid10Form.sliCategoriasCid}" />
								<a4j:support action="#{cid10Form.listarGruposPorCategoria}"
									         event="onchange"						              
									         ajaxSingle="true"
									         reRender="ddpGrupos,dtCid10,totalRegs"/>
							</h:selectOneMenu><br></br>
							<label>Grupo:</label><br/>
				           	<h:selectOneMenu id="ddpGrupos" 
								             value="#{cid10Form.isnGrupo}" 
								             style="width:390px;" styleClass="selectItens">
								<f:selectItems value="#{cid10Form.sliGruposCid}" />
								<a4j:support action="#{cid10Form.listarCid10}"
									         event="onchange"						              
									         ajaxSingle="true"
									         reRender="dtCid10,totalRegs"/>
							</h:selectOneMenu>	
	        			</td>
	        			<td valign="top">
						    <div style="text-align: right">
					       	   	<label>Resultado:</label><br/>
							    <h:outputText styleClass="totalizador2" value="#{cid10Form.totalRegistros}" id="totalRegs"/> 
					        </div>
	        			</td>
	        		</tr>
	        		</table>

	    	</h:panelGroup>
	    	<div style="height: 470px; overflow:scroll;overflow-y:scroll;overflow-x:hidden;">
				<!-- DATATABLE -->
				<rich:dataTable 
					id="dtCid10" 
					onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
		            onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'"
					value="#{cid10Form.lstCid10}" 
					var="cid10"
					rows="12"
					rowKeyVar="linha" 
					style="width: 98%; font-size: 12px"
					reRender="ds">	
							
					<f:facet name="header">
						<rich:columnGroup>
							<h:column >
								<h:outputText value="Sel." />
							</h:column>					
							<h:column>
								<h:outputText value="Código" />
							</h:column>
							<h:column>
								<h:outputText value="Descrição" />
							</h:column>		
							<h:column>
								<h:outputText value="Categoria/Grupo" />
							</h:column>
							<h:column rendered="#{cid10Form.tipoBusca==2}">
								<h:outputText value="Pesquisa Adicional" />
							</h:column>						
							<h:column>
								<h:outputText value="---" />
							</h:column>
						</rich:columnGroup>
					</f:facet>
					
					<rich:column width="5%">
						<center>
							<a4j:commandLink id="selecionar"
							oncomplete="carregaCid10(); #{rich:component('panelCid10')}.hide();" reRender="formulario:isnCid10Id">
								<h:graphicImage id="imgSel02" url="IMG/selecionar.png" style="border:0;" />
								<f:setPropertyActionListener value="#{cid10.codCid10}" target="#{relatorioEpidemiologicoForm.codCid10}" />
								<f:setPropertyActionListener value="#{cid10}" target="#{cid10Form.objCid10}" />
							</a4j:commandLink>
							<a4j:jsFunction name="carregaCid10" reRender="formulario:isnCid10Id"/>

						</center>
					</rich:column>
						
					<rich:column width="8%" style="text-align: center; font-size: 12px">
						<h:outputText value="#{cid10.codCid10}" />
					</rich:column>
						
					<rich:column style="font-size: 11px">
						<h:outputText value="#{cid10.dscCid10}" />
					</rich:column>
								
					<rich:column>
						<h:outputText value="#{cid10.cid10Grupo.cid10Categoria.dscCid10Categoria}" />
					</rich:column>
								
					<rich:column rendered="#{cid10Form.tipoBusca==2}">
						<h:outputText value="#{cid10.dscAtalho}" />
					</rich:column>
					
					<rich:column>
					    <h:graphicImage id="imgFav" url="#{(cid10.flgFavorito=='S')?'IMG/star_yellow.png':'IMG/star_grey.png'}" style="border:0;" />				
					</rich:column>
					<!-- RODAPE DA TABELA -->	
					<f:facet name="footer">
				       	<rich:datascroller fastControls="auto"  maxPages="5" id="ds" ajaxSingle="false" />
				    </f:facet>
				</rich:dataTable>
				<br/><br/><br/>
			</div>
		</h:form>
	</rich:modalPanel>
		
   	<h:form id="formulario">
   		<div style="margin-bottom: 55px">	  
   	    	<div class="cabAreaPesquisa">Relatório Epidemiológico</div>	  
		    	<div class="areaPesquisa">
					<div>
						<h:outputLabel value="Cid 10"/><br/>
						
						<a4j:commandButton id="btnA" value="CID 10"
							reRender="formTabelaCid10"
							action="#{cid10Form.buscarLista}" 
							onclick="#{rich:component('panelCid10')}.show()"
							style="height:19px;padding:0px;width:50px;"
							styleClass="botaoModal" />
										
						<h:inputText id="isnCid10Id"
							value="#{relatorioEpidemiologicoForm.codCid10}" onblur="upper(this);"
							maxlength="300" styleClass="campoTexto"
							style="width: 100px; margin-left:10px;" />
										
					</div>				
					<div>
				    	<h:outputLabel value="De" for="datInicial" />  <h:outputLabel value=" *" style="color:red;" /> <br/>
				    	<rich:calendar id="datInicial" value="#{relatorioEpidemiologicoForm.dataInicio}" datePattern="dd/MM/yyyy" showWeeksBar="false" enableManualInput="true" oninputkeypress="return formataData(event, this)" />	     				
				    </div>
				    <div>
					    <h:outputLabel value="até" for="datFinal" />  <h:outputLabel value=" *" style="color:red;" /> <br/>
				    	<rich:calendar id="datFinal" value="#{relatorioEpidemiologicoForm.dataFim}" datePattern="dd/MM/yyyy" showWeeksBar="false" enableManualInput="true" oninputkeypress="return formataData(event, this)" />
				    </div>
				    <div>				    
					    <a4j:commandButton value="Pesquisar" id="btnPesquisa" style="margin-top:10px;" styleClass="botaoModal" 
					    reRender="formulario" action="#{relatorioEpidemiologicoForm.carregarRelatorio}" 
					    oncomplete="avisoErro(#{relatorioEpidemiologicoForm.erroPesquisa})"/>
				    </div>
				    <div class="col120" style="text-align: center; ">		       
				   	   <label style="font: 500; font-size: 13px;"><b>Total Registros</b></label><br/>
				       <label class="totalizador">#{relatorioEpidemiologicoForm.totalGeral}</label>
				    </div>				
		    	</div>
				<h:commandLink style="float:right;border:0px;" action="#{relatorioEpidemiologicoForm.imprimirExcel}" 
									rendered="#{!empty relatorioEpidemiologicoForm.listRelatorioEpidemiologicoVO}" >
					 <h:graphicImage id="image" url="IMG/icone_xls.png" style="float:right;border:0px;"/>
				</h:commandLink>
				<br/>
				<br/>
		    	<div>
		    		<rich:dataTable value="#{relatorioEpidemiologicoForm.listRelatorioEpidemiologicoVO}"
					            var="epi" style="width:100%" rowIndexVar="row"
							    id="oTableNovo" rows="15" reRender="ds"
							    onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
							    onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'">

							<f:facet name="header">
								<rich:columnGroup>
									<h:column>
										<h:outputText value="Dt. Registro" />
									</h:column>
									<h:column>
										<h:outputText value="CID" />
									</h:column>
									<h:column>
										<h:outputText value="Descrição CID" />
									</h:column>
									<h:column>
										<h:outputText value="Situação" />
									</h:column>
									<h:column>
										<h:outputText value="HDA" />
									</h:column>
									<h:column>
										<h:outputText value="Prontuário" />
									</h:column>
									<h:column>
										<h:outputText value="Usuário" />
									</h:column>									
									<h:column>
										<h:outputText value="UF" />
									</h:column>
									<h:column>
										<h:outputText value="Nome Profissional" />
									</h:column>
									<h:column>
										<h:outputText value="Semana Epidemiologia" />
									</h:column>
								</rich:columnGroup>
							</f:facet>

							<rich:column style="text-align: left; font-size: 11px" sortable="true" sortBy="#{epi.datRegistro}">
								<h:outputText value="#{epi.datRegistro}">
									<f:convertDateTime pattern="dd/MM/yyyy HH:mm" timeZone="GMT-3" />
								</h:outputText>
							</rich:column>
							<rich:column style="text-align: left; font-size: 11px" sortable="true" sortBy="#{epi.codCid10}">
								<h:outputText value="#{epi.codCid10}" />
							</rich:column>
							<rich:column style="text-align: left; font-size: 11px" sortable="true" sortBy="#{epi.dscCid10}">
								<h:outputText value="#{epi.dscCid10}" />
							</rich:column>
							<rich:column style="text-align: left; font-size: 11px" sortable="true" sortBy="#{epi.situacao}">
								<h:outputText value="#{epi.situacao}" />
							</rich:column>
							<rich:column style="text-align: left; font-size: 11px" sortable="true" sortBy="#{epi.hda}">
								<h:outputText value="#{epi.hda}" />
							</rich:column>
							<rich:column style="text-align: left; font-size: 11px" sortable="true" sortBy="#{epi.numProntuario}">
								<h:commandLink value="#{epi.numProntuario}" style="cursor:text;" onclick="return false;"/>
								<rich:toolTip direction="bottom-right" layout="block" styleClass="tooltipEmergencia">
									<h:outputText value="Nº Cartão Nacional: #{epi.cartaoNacional}" /><br/>
									<h:outputText value="Nascimento: #{epi.nascimento}" /><br/>
									<h:outputText value="Nome da Mãe: #{epi.nomeMae}"/><br/>
									<h:outputText value="Sexo: #{epi.sexo}"/><br/>
									<h:outputText value="Idade: #{epi.idade}"/><br/>
									<h:outputText value="Endereço: #{epi.endereco}" /><br/>
									<h:outputText value="Complemento: #{epi.complemento}" /><br/>
									<h:outputText value="Bairro: #{epi.bairro}" /><br/>
									<h:outputText value="Município: #{epi.municipio}" />
								</rich:toolTip>
							</rich:column>
							<rich:column style="text-align: left; font-size: 11px" sortable="true" sortBy="#{epi.nomePaciente}">
								<h:outputText value="#{epi.nomePaciente}" />
							</rich:column>
							<rich:column style="text-align: left; font-size: 11px" sortable="true" sortBy="#{epi.ufPaciente}">
								<h:outputText value="#{epi.ufPaciente}" />
							</rich:column>
							<rich:column style="text-align: left; font-size: 11px" sortable="true" sortBy="#{epi.nomeProfissional}">
								<h:outputText value="#{epi.nomeProfissional}" />
							</rich:column>
							<rich:column style="text-align: left; font-size: 11px" sortable="true" sortBy="#{epi.semanaEpidemiologia}">
								<h:outputText value="#{epi.semanaEpidemiologia}">
									<f:convertDateTime pattern="dd/MM/yyyy" timeZone="GMT-3" />
								</h:outputText>
							</rich:column>	
							
							<f:facet name="footer">
								<rich:datascroller id="ds" ajaxSingle="false" />
							</f:facet>					    
					</rich:dataTable>
				</div>
   		</div>
		
   	</h:form>
   	<script type="text/javascript">
	<!--
   		function avisoErro(erro){
			if(erro == 1 ){
				alert('Data Inicial não pode ser vazia!');
				return false;
			}else if(erro == 2 ){
				alert('Data Final não pode ser vazia!');
				return false;
			}else if(erro == 3 ){
				alert('O campo Data Final deve ser igual ou maior que o campo Data Inicial!');   					
				return false;
			}else if(erro == 4 ){
				alert('O campo Cid 10 é obrigatório!');   					
				return false;
			}else if(erro == 5 ){
				alert('O campo Eixo é obrigatório!');   					
				return false;
			}else{
				return true;
			}
  		}
   	-->
   	</script>
   	
   	<rich:modalPanel id="panelStatus" autosized="true">  
 		<h:panelGrid columns="2"> 
 			<h:graphicImage url="IMG/ajax-loader.gif" style="border:0px"/> 
 			<h:outputText value="Carregando..." />
 		</h:panelGrid> 
	</rich:modalPanel>
	
	<a4j:status id="loading" onstart="Richfaces.showModalPanel('panelStatus')" onstop="Richfaces.hideModalPanel('panelStatus')" />
   	
</ui:define>
</ui:composition>
</html>