<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
					  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:ui="http://java.sun.com/jsf/facelets"
	  xmlns:f="http://java.sun.com/jsf/core"
	  xmlns:h="http://java.sun.com/jsf/html"
	  xmlns:a4j="http://richfaces.org/a4j"
	  xmlns:t="http://myfaces.apache.org/tomahawk"
	  xmlns:rich="http://richfaces.org/rich">
	  
<ui:composition template="template.xhtml">
<ui:define name="headHtml">
	<title>SISTEMA DE PACIENTE - Pesquisar Paciente</title>	
</ui:define>
<ui:define name="conteudo">
<a4j:keepAlive beanName="decisaoClinicaForm" />

<rich:modalPanel id="panelStatus" autosized="true" >  
	<h:panelGrid columns="2"> 
		<h:graphicImage url="IMG/ajax-loader.gif" style="border:0px"/> 
		<h:outputText value="Carregando..." />
	</h:panelGrid> 
</rich:modalPanel> 

<a4j:status id="status" 
              onstart="#{rich:component('panelStatus')}.show()" 
              onstop="#{rich:component('panelStatus')}.hide()" >
</a4j:status>


<rich:modalPanel id="panProfissional" autosized="false" width="900"
	height="500" resizeable="false" headerClass="headerPanel3">
	<!-- BARRA DE TITULO MODAL-->
	<f:facet name="header">
		<h:panelGroup>
			<h:outputText value="Pesquisa de Profissional"></h:outputText>
		</h:panelGroup>
	</f:facet>
	<f:facet name="controls">
		<h:panelGroup>
			<h:graphicImage value="IMG/fechar.png" id="fechaPanel" />
			<rich:componentControl for="panProfissional" attachTo="fechaPanel"
				operation="hide" event="onclick" />
		</h:panelGroup>
	</f:facet>

	<h:form id="formProfissional">
		<fieldset style="background-color: #F5F5F5">

			<div style="height: 30px;">
				<div class="colLeft" style="width: 15%;">
					<label class="font10"><b>Nome:</b></label>
				</div>
				<div class="colLeft largura220">
					<h:inputText value="#{decisaoClinicaForm.nmUsuario}" maxlength="50"
						styleClass="campoTexto largura200"
						onblur="this.value.toUpperCase();" style="width: 450px;"
						id="nmProfissional" onkeypress="return enter(event);" />
				</div>
			</div>
			<div style="height: 20px">
				<div class="colLeft" style="width: 100%;">
					<a4j:commandButton style="width: 80px; height: 20px;"
						oncomplete="validaMarcacao('#{decisaoClinicaForm.mensagem}');"
						id="Pesquisar" value="PESQUISAR"
						action="#{decisaoClinicaForm.pesquisarProfissional}"
						reRender="formProfissional" />
				</div>
			</div>
		</fieldset>

		<div>
			<rich:dataTable id="tabelaProfissional"
				onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
				onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'"
				value="#{decisaoClinicaForm.listaUsuario}" var="rst" rows="10"
				rowKeyVar="linha" style="width: 100%; cursor: pointer;">
				<f:facet name="header">
					<rich:columnGroup>
						<h:column>
							<h:outputText width="5%" />
						</h:column>
						<h:column>
							<h:outputText width="20%" value="Nome" />
						</h:column>
					</rich:columnGroup>
				</f:facet>

				<rich:column align="center" width="5%" sortable="true">
					<a4j:commandLink reRender="pnProfissional" oncomplete="#{rich:component('panProfissional')}.hide()">
						<h:graphicImage id="imgSelecionar" url="IMG/selecionar.png" style="border:0;" />
						<f:setPropertyActionListener value="#{rst}" target="#{decisaoClinicaForm.objUsuario}" />
					</a4j:commandLink>
				</rich:column>

				<rich:column width="65%" sortable="true">
					<h:outputText value="#{rst.dscUsuario}" />
				</rich:column>

				<f:facet name="footer">
					<rich:datascroller id="ds" ajaxSingle="false" />
				</f:facet>
			</rich:dataTable>
		</div>

		<script>
		function validaMarcacao(msg)
		{
			var n = msg.search('sucesso!');
			if(msg != '')
			{
			  if (n == -1)
		      {
			  	  alert(msg);
				  return false;
			  }else{
			  	  alert(msg);
				  return true;
			  }
			}else{
			   return true;			
			}
		}

			function enter(e) 
			{
				var keycode;
				
				if (window.event) 
				{
					keycode = window.event.keyCode;
				} 
				else 
				{
					keycode = e.which;	
				}
				if (keycode == 13) 
				{
					alert('Não é possível utilizar a tecla Enter');
					return false;
				}
			}
		</script>
	</h:form>
</rich:modalPanel>

<a4j:form id="formulario">
   	    <div style="margin-bottom: 55px">	  
   	    <div class="cabAreaPesquisa">RELATÓRIO DECISÃO CLÍNICA</div>	  
	    <div style="padding: 10px;background: #BED6F8;margin: 0 0 10px 0;border: solid 1px #bbb;">	              
						
			<div style="float:left; width:100px; font-size:14px;margin-top:20px">Período:</div> 
			<div style="float:left; width:300px;margin-top:20px">
				<rich:calendar value="#{decisaoClinicaForm.datInicio}" inputStyle="width:80px; height:15px; font-size:12px !important" datePattern="dd/MM/yyyy" />
					a 
				<rich:calendar value="#{decisaoClinicaForm.datFim}" inputStyle="width:80px; height:15px; margin-left:10px; font-size:12px !important" datePattern="dd/MM/yyyy" />
			</div>

			<div style="clear:both"></div>

			<div style="float:left; width:100px; margin-top:20px; font-size:14px">Profissional:</div>
			<div style="float:left; width:500px; margin-top:20px">
				<h:panelGroup id="pnProfissional">
					<a4j:commandButton image="IMG/pesquisa.gif" id="btnProfissional" 
						action="#{decisaoClinicaForm.abrirProfissional}"
						oncomplete="Richfaces.showModalPanel('panProfissional');"
						reRender="panProfissional" >
					</a4j:commandButton>
					#{decisaoClinicaForm.objUsuario.dscUsuario}
				</h:panelGroup>
			</div>  
	       	       
			<div style="clear:both"></div>
	       
	       <div style="margin-top:20px">
	       
	          <t:commandLink 
	          	id="imprimirRelatorioLink" 
	          	action="#{decisaoClinicaForm.gerarRelatorio}" 
	          	target="_blank" 
	          	style="display:none"
	          	>							
			  </t:commandLink>
			  
			  <a4j:commandButton 
			  	action="#{decisaoClinicaForm.preparaGerarRelatorio}" 
			  	value="Gerar Relatório" 
			  	styleClass="botaoModal" 
			  	style="margin-top:5px;margin-bottom:10px; margin-left:60px"  
			  	oncomplete="validarPesquisa('#{decisaoClinicaForm.mensagem}')"/>
				
				<a4j:commandButton value="Limpar"
												action="#{decisaoClinicaForm.limparFormularioRel}"
				       		                   style="margin-top:5px;margin-bottom:10px; margin-left:60px" 
				       		                   styleClass="botaoModal"
				       		                   reRender="formulario">
				</a4j:commandButton> 
	       </div>
	       
	       <div style="clear:both"></div>
	             
 	</div>
		
	</div>
	<script type="text/javascript">
	     
	     function validarPesquisa(msg) {
	     	if (msg != '') {
	     		alert(msg);
	     	}
	     	else {
	     		var item = document.getElementById("formulario:imprimirRelatorioLink");
				item.click();
	     	}
	     	
	     	
	     }
	     
	</script>
		
</a4j:form>	
</ui:define>
</ui:composition>
</html>