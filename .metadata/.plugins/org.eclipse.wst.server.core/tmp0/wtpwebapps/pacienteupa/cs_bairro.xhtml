<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
					  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:t="http://myfaces.apache.org/tomahawk">

	<ui:composition template="template.xhtml">
		<ui:define name="conteudo">
			<a4j:keepAlive beanName="bairroForm"/>
			
			<rich:modalPanel id="panelEdicao" autosized="true" width="400" resizeable="false" headerClass="headerPanel">
				<f:facet name="header">
					<h:outputText value="#{(bairroForm.novoBairro) ? 'Novo Bairro' : 'Alterar Bairro'}"/>		
				</f:facet>
				<f:facet name="controls">
					<h:panelGroup>
						<h:graphicImage value="IMG/fechar.png" id="fechaCl" />
						<rich:componentControl for="panelEdicao" attachTo="fechaCl" operation="hide" event="onclick" />
					</h:panelGroup>
				</f:facet>
				
				<h:form id="edicaoBairro">
					<div class="geralCampos" style="font-size: 12px">			
				    	<label>Bairro:</label><br/>
						<h:inputText value="#{bairroForm.dscBairro}" styleClass="campoTexto" maxlength="50" style="width: 350px"/>
						<br/>
						<label>Sinônimo(s):</label><br/>
						<h:inputText value="#{bairroForm.dscSinonimo}" styleClass="campoTexto" maxlength="100" style="width: 350px"/>
						<br/>
						<label>Regional:</label><br/>
						<h:selectOneMenu value="#{bairroForm.isnRegional}" converter="simpleIndexConverter">
							<f:selectItem itemValue="" itemLabel="SELECIONE" />
							<t:selectItems var="o" itemValue="#{o.isnRegional}" itemLabel="#{o.dscRegional}" value="#{bairroForm.listaRegional}" />
						</h:selectOneMenu>
						<br/>
						<label>Ativo:</label><br/>
						<h:selectOneRadio value="#{bairroForm.flgAtivo}" styleClass="radioButton">
							<f:selectItem itemValue="S" itemLabel="Sim"/>
							<f:selectItem itemValue="N" itemLabel="Não"/>
						</h:selectOneRadio>
					</div>
					<div style="text-align: center; margin-top: 10px">
					   <a4j:commandButton id="btnOk" 
						                  value="OK"
					                      action="#{bairroForm.cadastrar}"
					                      oncomplete="avisosValidacao(#{bairroForm.codigoErro})"
					                      reRender="formulario"
								          style="margin-right: 10px" 
								          styleClass="botaoModal"/>
								   
						<a4j:commandButton id="btnCancel"  
						                   value="Cancelar" 
						                   styleClass="botaoModal"
						                   style="margin-right: 10px">
							<rich:componentControl for="panelEdicao" attachTo="btnCancel" operation="hide" event="onclick" />
						</a4j:commandButton>
					</div>
				</h:form>	
			</rich:modalPanel>
			
			<a4j:form id="formulario">
		    	<div style="margin-bottom: 55px">		
					<!-- INÍCIO DA BUSCA BAIRRO -->
					<div class="cabAreaPesquisa">CADASTROS / CONSULTA DE BAIRROS</div>		
			    	<div class="areaPesquisa">    	        	     
			            <div class="colLeft">
			                <div class="col180">         	
			        			<label>Pesquisar:</label><br/>
								<h:inputText id="inputPesquisa" 
								             value="#{bairroForm.strBairro}"
								             styleClass="campoTexto"  
								             style="width: 170px;" />
							</div>
							<div class="col180" >
							    <label>Campos:</label><br/>
								<h:selectOneMenu value="#{bairroForm.campoPesquisa}" styleClass="selectItens" style="width: 170px;">
				           			<f:selectItem itemLabel="Bairro" itemValue="1"/>	           		
				           			<f:selectItem itemLabel="Sinônimo" itemValue="2"/>	           		
				           		</h:selectOneMenu> 
				           </div>
				           <div class="col70">
				                <rich:spacer height="12px"/><br/>
				           		<a4j:commandButton image="IMG/pesquisa.gif"
				           		                   id="btnPesquisa" 
				           		                   action="#{bairroForm.buscaBairro}" 
				           		                   oncomplete="avisosPesquisa(#{bairroForm.aviso})" 
				           		                   reRender="tabelaBairro,totalRegs" />
					    		<rich:hotKey key="return" selector="#inputPesquisa" handler="#{rich:element('btnPesquisa')}.click()"/>		
					    	</div>
						</div>
						<div class="col150">
						    <label>Resultado:</label>
						    <h:outputText class="totalizador2" value="#{bairroForm.totalRegistros}" id="totalRegs"/> 
						</div>
						<div class="col180" style="text-align: right">	    
							<a4j:commandButton value="Novo Bairro" 
						                   oncomplete="Richfaces.showModalPanel('panelEdicao')" 
						                   reRender="panelEdicao"
						                   styleClass="botaoNovoItem"
						                   actionListener="#{bairroForm.preparaInserir}"
						                   ajaxSingle="true">			                          
								<f:setPropertyActionListener value="#{true}" target="#{bairroForm.novoBairro}" />
							</a4j:commandButton>
						</div>	
					</div>
					<!-- FIM DA BUSCA BAIRRO -->
				
					<rich:dataTable id="tabelaBairro"
							onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
							onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'"
							value="#{bairroForm.lstBairro}" 
							var="listaBairro" 
							rows="40"
							rowKeyVar="linha" 
							style="width: 100%"										 
							reRender="ds">
						<f:facet name="header">
							<rich:columnGroup>
								<h:column>
									<h:outputText value="Sel"/>
								</h:column>
								<h:column>
									<h:outputText value="Bairro" />
								</h:column>
								<h:column>
									<h:outputText value="Sinônimo(s)" />
								</h:column>
								<h:column>
									<h:outputText value="Regional" />
								</h:column>
								<h:column>
									<h:outputText value="Usuário Cadastro" />
								</h:column>
								<h:column>
									<h:outputText value="Data Cadastro" />
								</h:column>
								<h:column>
									<h:outputText value="Ativo" />
								</h:column>
							</rich:columnGroup>
						</f:facet>
						
						<rich:column style="text-align: center; width: 5%">
							<a4j:commandLink oncomplete="Richfaces.showModalPanel('panelEdicao')" 
							                 reRender="panelEdicao"
							                 ajaxSingle="true">			
							    <h:graphicImage id="imgSel" url="IMG/selecionar.png" style="border:0;" />
							    <f:setPropertyActionListener value="#{listaBairro}" target="#{bairroForm.objBairro}" />				    						
							    <f:setPropertyActionListener value="#{listaBairro.dscBairro}" target="#{bairroForm.dscBairro}" />
							    <f:setPropertyActionListener value="#{listaBairro.dscSinonimo}" target="#{bairroForm.dscSinonimo}" />
							    <f:setPropertyActionListener value="#{listaBairro.regional.isnRegional}" target="#{bairroForm.isnRegional}" />
							    <f:setPropertyActionListener value="#{listaBairro.flgAtivo}" target="#{bairroForm.flgAtivo}" />
								<f:setPropertyActionListener value="#{false}" target="#{bairroForm.novoBairro}"/>		
							</a4j:commandLink>
						</rich:column>
						
						<rich:column style="text-align: left; width: 20%">
							<h:outputText value="#{listaBairro.dscBairro}" />
						</rich:column>
						<rich:column>
							<h:outputText value="#{listaBairro.dscSinonimo}" />
						</rich:column>
						<rich:column sortable="true">
							<h:outputText value="#{listaBairro.regional.dscRegional}" />
						</rich:column>
						<rich:column sortable="true">
							<h:outputText value="#{listaBairro.usuarioCad.dscUsuario}" />
						</rich:column>
						<rich:column sortable="true" style="text-align: center;">
							<h:outputText value="#{listaBairro.datCadastro}" converter="ConversorDeDataHora"/>
						</rich:column>
						
						<rich:column sortable="true" style="text-align: center;">
							<h:outputText value="Sim" rendered="#{listaBairro.flgAtivo == 'S'}"/>
							<h:outputText value="Não" rendered="#{listaBairro.flgAtivo == 'N'}"/>
						</rich:column>
						
						<f:facet name="footer">
							<rich:datascroller id="ds" ajaxSingle="false" />
						</f:facet>
					</rich:dataTable>
				</div>
				
				<script type="text/javascript">
				     function avisosPesquisa(tipo) 
				     {
					     if (tipo == 1) 
					     {
					    	 alert("Não há bairro(s) cadastrado(s) que atenda(m) a esta pesquisa.");
					     } 
					     else if (tipo == 2) 
					     {
						     alert("Digite pelo menos 3 letras ou números.");
					     }
				     }
				     
				     function avisosValidacao(erro) 
				     {
						if (erro == 1)
						{
							alert("Usuário sem permissão!");
						} 
						else if (erro == 2) 
						{
							Richfaces.hideModalPanel('panelEdicao');
							alert("O bairro foi cadastrado com sucesso!");
						} 
						else if (erro == 3)
						{
							alert("O campo bairro é obrigatório!");
						} 
						else if (erro == 4) 
						{
							alert("O campo regional é obrigatório!");
						} 
						else if (erro == 5)
						{
							alert("Bairro já cadastrado!");
						}	
						else if (erro == 6) 
						{
							Richfaces.hideModalPanel('panelEdicao');
							alert("O bairro foi alterado com sucesso!");		
						} 
					}
				</script>
			</a4j:form>
		</ui:define>
	</ui:composition>
</html>