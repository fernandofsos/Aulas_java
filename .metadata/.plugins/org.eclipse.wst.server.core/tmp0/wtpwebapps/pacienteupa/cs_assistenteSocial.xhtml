<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
					  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:ui="http://java.sun.com/jsf/facelets"
	  xmlns:f="http://java.sun.com/jsf/core"
	  xmlns:h="http://java.sun.com/jsf/html"
	  xmlns:a4j="http://richfaces.org/a4j"
	  xmlns:rich="http://richfaces.org/rich">

<ui:composition template="template.xhtml">
<ui:define name="headHtml">
	<link rel="stylesheet" type="text/css" href="CSS/layoutCsPaciente.css" />
	</ui:define>
	<ui:define name="conteudo">

<a4j:keepAlive beanName="assistenteSocialForm" />

	<rich:modalPanel id="panelStatus" autosized="true">  
 		<h:panelGrid columns="2"> 
 			<h:graphicImage url="IMG/ajax-loader.gif" style="border:0px"/> 
 			<h:outputText value="Carregando..." />
 		</h:panelGrid> 
	</rich:modalPanel>

	 <rich:modalPanel id="panPaciente" autosized="false" width="600" height="400" resizeable="true" headerClass="headerPanel3">
		
    	<f:facet name="header">
			<h:panelGroup>
       			<h:outputText value="DADOS DO PACIENTE"></h:outputText>
       		</h:panelGroup>
    	</f:facet>
    	<f:facet name="controls">
    	 	<h:panelGroup>
        		<h:graphicImage value="IMG/fechar.png" id="fechaPanel"/>
        		<rich:componentControl for="panPaciente" attachTo="fechaPanel" operation="hide" event="onclick" />
        	</h:panelGroup>
    	</f:facet>
    	<div>
    		<ui:include src="panelDadosPaciente.xhtml"/>
    	</div> 
   	</rich:modalPanel>

<a4j:form>   
	<div style="margin-bottom: 55px">		
		<!-- INICIO DA BUSCA PACINETE -->
		<div class="cabAreaPesquisa">SERVIÇO SOCIAL - CONSULTA DE PACIENTES</div>		
    	<div class="areaPesquisa">    	        	     
            <div class="colLeft">
                <div class="col180">         	
        			<label>Pesquisar:</label><br/>
					<h:inputText id="inputPesquisa" 
					             value="#{assistenteSocialForm.strPaciente}"
					             styleClass="campoTexto"  
					             style="width: 170px;" />
				</div>
				<div class="col180" >
				    <label>Campos:</label><br/>
					<h:selectOneMenu value="#{assistenteSocialForm.campoPesquisa}" 
					    styleClass="selectItens" style="width: 170px;">
	           			<f:selectItem itemLabel="Nome/Prontuario" itemValue="1"/>	           		
	           			<f:selectItem itemLabel="Nome Mãe" itemValue="2"/>	 
	           			<f:selectItem itemLabel="Nome Social" itemValue="6"/>          		
	           			<f:selectItem itemLabel="Data Nascimento" itemValue="3"/>
	           			<f:selectItem itemLabel="Naturaliade" itemValue="4"/>
	           			<f:selectItem itemLabel="Data de Cadastro" itemValue="5"/>
	           		</h:selectOneMenu> 
	           </div>
	           <div class="col70">
	                <rich:spacer height="12px"/><br/>
	           		<a4j:commandButton image="IMG/pesquisa.gif" id="btnPesquisa" 
	           		        action="#{assistenteSocialForm.buscaPaciente}" 
		    				oncomplete="avisosPesquisa(#{assistenteSocialForm.avisoUsuario})"		    				
		    				reRender="tabelaPaciente,totalRegs" />
		    		<rich:hotKey key="return" selector="#inputPesquisa" 
		    		             handler="#{rich:element('btnPesquisa')}.click()"/>		
		    	</div>			    	
			</div>			
			<div class="col150">
			    <label>Resultado:</label>
			    <h:outputText class="totalizador2" value="#{assistenteSocialForm.totalRegistros}" id="totalRegs"/> 
			</div>
			<div class="col170" style="text-align: center">	    	
			</div>			
    	</div>	
		<!-- FIM CAMPOS DE BUSCA -->
		
		<!-- CONTEUDO DO MODAL -->
		<div>
			<rich:dataTable id="tabelaPaciente"
					onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
					onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'"
					value="#{assistenteSocialForm.lstPaciente}" 
					var="listaPaciente" 
					rows="40"
					rowKeyVar="linha" 
					style="width: 100%"										 
					reRender="ds">
				<f:facet name="header">
					<rich:columnGroup>
						<h:column >
							<h:outputText value="Sel." />
						</h:column>
						<h:column>
							<h:outputText value="Pront." />
						</h:column>
						<h:column>
							<h:outputText value="Nome" />
						</h:column>
						<h:column>
							<h:outputText value="Sexo" />
						</h:column>
						<h:column>
							<h:outputText value="Data Nasc." />
						</h:column>
						<h:column>
							<h:outputText value="Mãe" />
						</h:column>
						<h:column>
							<h:outputText value="Natural" />
						</h:column>
					</rich:columnGroup>
				</f:facet>
				
				<rich:column width="5%">
					<center>
						<a4j:commandLink id="selecionar" action="#{assistenteSocialForm.irParaHistoricoSocial}"
						                 title="Acessar Histórico Serviço Social do Paciente" >						                   
							<h:graphicImage id="imgSelecionar02" url="IMG/selecionar.png" style="border:0;" />
							<f:setPropertyActionListener value="#{listaPaciente}" target="#{assistenteSocialForm.objPaciente}" />							
						</a4j:commandLink>
					</center>
				</rich:column>
				
				<rich:column width="5%" sortable="true">
					<h:outputText value="#{listaPaciente.numProntuario}" />
				</rich:column>
				
				<rich:column width="30%">
          			<a4j:commandLink styleClass="link" oncomplete="#{rich:component('panPaciente')}.show();" value="#{listaPaciente.dscNome}" action="#{farmaciaForm.popularDadosPacienteGeral}" reRender="panPaciente">
          				<f:setPropertyActionListener target="#{farmaciaForm.isnPaciente}" value="#{listaPaciente.isnPaciente}" />
          			</a4j:commandLink>					
				</rich:column>

				<rich:column width="5%">
					<h:outputText value="#{listaPaciente.sexo.dscSexo}" />
				</rich:column>
		
				<rich:column width="5%">
					<h:outputText value="#{listaPaciente.datNascimento}" >
						<f:convertDateTime pattern="dd/MM/yyyy" />
					</h:outputText>
				</rich:column>
		
				<rich:column width="30%">
					<h:outputText value="#{listaPaciente.dscMae}" />
				</rich:column>
		
				<rich:column width="10%">
					<center>
						<h:outputText value="#{listaPaciente.dscNaturalidade}" />
					</center>	
				</rich:column>
		
				<f:facet name="footer">
					<rich:datascroller id="ds" ajaxSingle="false" />
				</f:facet>
			</rich:dataTable>
		</div>
	</div>
	
    <a4j:status id="statusPanel"
		   	onstart="Richfaces.showModalPanel('panelStatus');" 
		    onstop="#{rich:component('panelStatus')}.hide()">
	</a4j:status>	
	
	<script type="text/javascript">
	     function avisosPesquisa(tipo) {
		     if (tipo==1) {
			     alert("Digite pelo menos 3 letras ou numeros.");
		     } else if (tipo==2) {
		    	 alert("Não há pacientes cadastrados que atendam a esta pesquisa.");
		     } else if (tipo==3) {
		    	 alert("Valor de pesquisa não é uma data.");
		     } 
	     }
	</script>
</a4j:form>	
</ui:define>
</ui:composition>
</html>