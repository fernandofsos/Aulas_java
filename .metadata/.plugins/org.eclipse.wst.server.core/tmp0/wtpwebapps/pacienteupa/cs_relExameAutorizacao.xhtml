<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
					  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:ui="http://java.sun.com/jsf/facelets"
	  xmlns:f="http://java.sun.com/jsf/core"
	  xmlns:h="http://java.sun.com/jsf/html"
	  xmlns:a4j="http://richfaces.org/a4j"
	  xmlns:t="http://myfaces.apache.org/tomahawk"
	  xmlns:rich="http://richfaces.org/rich">
	  
<ui:composition template="template.xhtml">
<ui:define name="headHtml">
	<title>SISTEMA DE PACIENTE - Pesquisar Paciente</title>	
</ui:define>
<ui:define name="conteudo">
<a4j:keepAlive beanName="exameAutorizacaoForm" />

<rich:modalPanel id="panelStatus" autosized="true" >  
	<h:panelGrid columns="2"> 
		<h:graphicImage url="IMG/ajax-loader.gif" style="border:0px"/> 
		<h:outputText value="Carregando..." />
	</h:panelGrid> 
</rich:modalPanel> 

<a4j:status id="status" 
              onstart="#{rich:component('panelStatus')}.show()" 
              onstop="#{rich:component('panelStatus')}.hide()" >
</a4j:status>


<rich:modalPanel id="panProfissional" autosized="false" width="900"
	height="500" resizeable="false" headerClass="headerPanel3">
	<!-- BARRA DE TITULO MODAL-->
	<f:facet name="header">
		<h:panelGroup>
			<h:outputText value="Pesquisa de Profissional"></h:outputText>
		</h:panelGroup>
	</f:facet>
	<f:facet name="controls">
		<h:panelGroup>
			<h:graphicImage value="IMG/fechar.png" id="fechaPanel" />
			<rich:componentControl for="panProfissional" attachTo="fechaPanel"
				operation="hide" event="onclick" />
		</h:panelGroup>
	</f:facet>

	<h:form id="formProfissional">
		<fieldset style="background-color: #F5F5F5">

			<div style="height: 30px;">
				<div class="colLeft" style="width: 15%;">
					<label class="font10"><b>Nome:</b></label>
				</div>
				<div class="colLeft largura220">
					<h:inputText value="#{exameAutorizacaoForm.nmUsuario}" maxlength="50"
						styleClass="campoTexto largura200"
						onblur="this.value.toUpperCase();" style="width: 450px;"
						id="nmProfissional" onkeypress="return enter(event);" />
				</div>
			</div>
			<div style="height: 20px">
				<div class="colLeft" style="width: 100%;">
					<a4j:commandButton style="width: 80px; height: 20px;"
						oncomplete="validaMarcacao('#{exameAutorizacaoForm.mensagem}');"
						id="Pesquisar" value="PESQUISAR"
						action="#{exameAutorizacaoForm.pesquisarProfissional}"
						reRender="formProfissional" />
				</div>
			</div>
		</fieldset>

		<div>
			<rich:dataTable id="tabelaProfissional"
				onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
				onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'"
				value="#{exameAutorizacaoForm.listaUsuario}" var="rst" rows="10"
				rowKeyVar="linha" style="width: 100%; cursor: pointer;">
				<f:facet name="header">
					<rich:columnGroup>
						<h:column>
							<h:outputText width="5%" />
						</h:column>
						<h:column>
							<h:outputText width="20%" value="Nome" />
						</h:column>
					</rich:columnGroup>
				</f:facet>

				<rich:column align="center" width="5%" sortable="true">
					<a4j:commandLink reRender="pnProfissional" oncomplete="#{rich:component('panProfissional')}.hide()">
						<h:graphicImage id="imgSelecionar" url="IMG/selecionar.png" style="border:0;" />
						<f:setPropertyActionListener value="#{rst}" target="#{exameAutorizacaoForm.objUsuario}" />
					</a4j:commandLink>
				</rich:column>

				<rich:column width="65%" sortable="true">
					<h:outputText value="#{rst.dscUsuario}" />
				</rich:column>

				<f:facet name="footer">
					<rich:datascroller id="ds" ajaxSingle="false" />
				</f:facet>
			</rich:dataTable>
		</div>

		<script>
		function validaMarcacao(msg)
		{
			var n = msg.search('sucesso!');
			if(msg != '')
			{
			  if (n == -1)
		      {
			  	  alert(msg);
				  return false;
			  }else{
			  	  alert(msg);
				  return true;
			  }
			}else{
			   return true;			
			}
		}

			function enter(e) 
			{
				var keycode;
				
				if (window.event) 
				{
					keycode = window.event.keyCode;
				} 
				else 
				{
					keycode = e.which;	
				}
				if (keycode == 13) 
				{
					alert('Não é possível utilizar a tecla Enter');
					return false;
				}
			}
		</script>
	</h:form>
</rich:modalPanel>

<a4j:form id="formulario">
   	    <div style="margin-bottom: 55px">	  
   	    <div class="cabAreaPesquisa">RELATÓRIO DE EXAMES AUTORIZAÇÃO</div>	  
	    <div style="padding: 10px;background: #BED6F8;margin: 0 0 10px 0;border: solid 1px #bbb;">	              
		
		<div style="float:left; width:100px; font-size:14px">Agrupar por :</div> 
			<div style="float:left; width:300px">
				
				<h:selectOneMenu styleClass="selectItens" style="width:160px" value="#{exameAutorizacaoForm.agruparPor}">
					<f:selectItem itemLabel="Exames" itemValue="E"/>
					<f:selectItem itemLabel="Profissional" itemValue="P"/>
					<a4j:support event="onchange" reRender="formulario"/>
				</h:selectOneMenu>
			</div>
				<div style="clear:both"></div>
			<div style="float:left; width:100px; font-size:14px;margin-top:20px">Período:</div> 
			<div style="float:left; width:300px;margin-top:20px">
				<rich:calendar value="#{exameAutorizacaoForm.datInicio}" inputStyle="width:80px; height:15px; font-size:12px !important" datePattern="dd/MM/yyyy" />
					a 
				<rich:calendar value="#{exameAutorizacaoForm.datFim}" inputStyle="width:80px; height:15px; margin-left:10px; font-size:12px !important" datePattern="dd/MM/yyyy" />
			</div>
			<div style="clear:both"></div>

			<div style="float:left; width:100px; margin-top:20px; font-size:14px">Situação:</div>
			<div style="float:left; width:300px; margin-top:20px">
				<h:selectOneMenu value="#{exameAutorizacaoForm.flgAutorizacao}" styleClass="selectItens" style="width:160px">
					<f:selectItem itemLabel="Todos" itemValue=""/>
					<f:selectItem itemLabel="Autorização Pendente" itemValue="P" />
					<f:selectItem itemLabel="Autorizado" itemValue="A"/>
					<f:selectItem itemLabel="Não Autorizado" itemValue="N"/>
				</h:selectOneMenu>
			</div>

			<div style="clear:both"></div>

			<div style="float:left; width:100px; margin-top:20px; font-size:14px">Profissional:</div>
			<div style="float:left; width:500px; margin-top:20px">
				<h:panelGroup id="pnProfissional">
					<a4j:commandButton image="IMG/pesquisa.gif" id="btnProfissional" 
						action="#{exameAutorizacaoForm.abrirProfissional}"
						oncomplete="Richfaces.showModalPanel('panProfissional');"
						reRender="panProfissional" >
					</a4j:commandButton>
					#{exameAutorizacaoForm.objUsuario.dscUsuario}
				</h:panelGroup>
			</div>  
	       	       
			<div style="clear:both"></div>
	       
	       <div style="margin-top:20px">
	       
	          <t:commandLink 
	          	id="imprimirRelatorioLink" 
	          	action="#{exameAutorizacaoForm.gerarRelatorio}" 
	          	target="_blank" 
	          	style="display:none"
	          	>							
			  </t:commandLink>
			  
			   <t:commandLink 
	          	id="imprimirRelatorioResumoLink" 
	          	action="#{exameAutorizacaoForm.gerarRelatorioResumoProficional}" 
	          	target="_blank" 
	          	style="display:none"
	          	>							
			  </t:commandLink>
			  
			  <a4j:commandButton 
			  	action="#{exameAutorizacaoForm.preparaGerarRelatorio}" 
			  	value="Gerar Relatório" 
			  	styleClass="botaoModal" 
			  	rendered="#{exameAutorizacaoForm.agruparPor.equals('E')}"
			  	style="margin-top:5px;margin-bottom:10px; margin-left:60px"  
			  	oncomplete="validarRelatorio('#{exameAutorizacaoForm.mensagem}')"/>
 
 				<a4j:commandButton  
			  	action="#{exameAutorizacaoForm.preparaGerarResumo}" 
			  	value="Gerar Relatório" 
			  	styleClass="botaoModal" 
			  	rendered="#{exameAutorizacaoForm.agruparPor.equals('P')}"
			  	style="margin-top:5px;margin-bottom:10px; margin-left:60px" 
			  	oncomplete="validarRelatorio('#{exameAutorizacaoForm.mensagem}')" 
			  	/>
				
				<a4j:commandButton value="Limpar"
												action="#{exameAutorizacaoForm.limparFormularioRel}"
				       		                   style="margin-top:5px;margin-bottom:10px; margin-left:60px" 
				       		                   styleClass="botaoModal"
				       		                   reRender="formulario">
				</a4j:commandButton> 
	       </div>
	       
	       <div style="clear:both"></div>
	             
 	</div>
		
		 		                   
		       		                   
		       		                   
		
	</div>
	<script type="text/javascript">
	     function avisosPesquisa(erro) {
		     if (erro==2) {
		    	 alert("Não há pacientes cadastrados que atendam a esta pesquisa.");
		     }
	     }

	     function abrirRelatorio(msg, isnInternacao)
	     {		     
		     if (msg=='EMPTY') 
			 {
		     	alert("Não existe transferência(s) para este paciente!");
		     }
		     else
			 {
			 	window.open('cd_internacaoTrans.jsf?paramRel=relISGH_'+isnInternacao);
			 }
	     }
	     
	     function validarPesquisa(msg) {
	     	if (msg != '') {
	     		alert(msg);
	     	}
	     	
	     }
	     
	     function validarSenha(msg) {
	    	 
	 		if (msg == '1') {
	 			alert('Usuário/Conselho e Senha/Assinatura inválidos.');
	 		}
	 		else if (msg == '2') {
	 			alert('É necessário escolher pelo menos um exame!');
	 			Richfaces.hideModalPanel("panelSenha");
	 		}
	 		else if (msg == '3') {
	 			alert('Campo Justificativa Obrigatório!');
	 		}
	 		else {
	 			Richfaces.hideModalPanel("panelSenha");
	 		}
	 	}
	     
	   //abre e fecha detalhes do datatable
		function expandItens(obj,idItens)
		{		
			var detailsId = obj.id.substring(0, obj.id.lastIndexOf(':')) + ':' + idItens;
			var details = document.getElementById(detailsId);
			if (details.style.display == 'none') 
			{
			       details.style.display = 'table';
			       obj.src = 'IMG/collapse.gif';
			 } 
			 else 
			 {
			       details.style.display = 'none';
			       obj.src = 'IMG/expand.gif';
			 }
		}	
		 
		 function toggleDetails2(image, idItens) 
		 {
		    var detailsId = image.id.substring(0, image.id.lastIndexOf(':')) + ':' + idItens;
		    var details = document.getElementById(detailsId);
		    if (details.style.display == 'none') 
			{
		        details.style.display = 'table';
		        image.src = 'IMG/collapse.gif';
		    } 
		    else 
			{
		        details.style.display = 'none';
		        image.src = 'IMG/expand.gif';
		    }
		 }
		 
		 function setarFocoSenha(){	
			document.getElementById('frmSenha:inputAssinatura').focus();
		}
		 
		 function validarRelatorio(msg) {
	    	 if (msg == '1') {
	    		 alert('A data fim deve ser maior que a data início!');
	    	 }
	    	 else if (msg == '2') {
	    		 alert('Nenhum registro encontrado!');
	    	 }else if(msg=='3'){
	    		 var item = document.getElementById("formulario:imprimirRelatorioLink");
				 item.click();
	    	 }
	    	 else {
	    		 var item = document.getElementById("formulario:imprimirRelatorioResumoLink");
				    item.click();
	    	 }
	    	 
	    	 
	    	 
	     }
		 
	</script>
		
</a4j:form>	
</ui:define>
</ui:composition>
</html>