<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
					  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich">

<ui:composition template="template.xhtml">
<ui:define name="conteudo">	
	<!-- KEEPALIVE -->
	<a4j:keepAlive beanName="leitoForm"></a4j:keepAlive>
	
	<rich:modalPanel id="panelEdicao" autosized="true" width="400" resizeable="false" headerClass="headerPanel">
		<f:facet name="header">
			<h:outputText value="#{(leitoForm.novoLeito)?'Novo Leito':'Alterar/Excluir Leito'}"></h:outputText>		
		</f:facet>
		<f:facet name="controls">
			<h:panelGroup>
				<h:graphicImage value="IMG/fechar.png" id="fechaCl" />
				<rich:componentControl for="panelEdicao" attachTo="fechaCl" operation="hide" event="onclick" />
			</h:panelGroup>
		</f:facet>
		
		<h:form id="EdicaoClinica">
			<div class="geralCampos" style="font-size: 12px">			
		    	<label>Nome do Leito:</label><br/>
				<h:inputText value="#{leitoForm.objLeito.dscLeito}" styleClass="campoTexto" 
				             maxlength="30" style="width: 350px"/>
				<br/>        
				<label>Enfermaria:</label><br/>
				<h:selectOneMenu value="#{leitoForm.objLeito.enfermaria.isnEnfermaria}">
					<f:selectItems value="#{leitoForm.sliEnfermaria}"/>
				</h:selectOneMenu>             								             
			</div>
			<div style="text-align: center; margin-top: 10px">
				<a4j:commandButton id="btnOk" value="OK" 
						   action="#{leitoForm.inserir()}"
						   oncomplete="this.disabled=false; avisosValidacao(#{leitoForm.codigoErro},'panelEdicao')" 
						   reRender="idLeitoForm"
						   style="margin-right: 10px" 
						   styleClass="botaoModal"
						   onclick="this.disabled=true"
						   rendered="#{leitoForm.novoLeito}" >				
				</a4j:commandButton>			

				<a4j:commandButton id="btnOk2" value="OK" 
						   action="#{leitoForm.alterar()}"
						   oncomplete="this.disabled=false; avisosValidacao(#{leitoForm.codigoErro},'panelEdicao')" 
						   reRender="idLeitoForm"
						   style="margin-right: 10px" 
						   styleClass="botaoModal"
						   onclick="this.disabled=true"
						   rendered="#{! leitoForm.novoLeito}" >				
				</a4j:commandButton>			
				
				<a4j:commandButton id="btnCancel"  
				                   value="Cancelar" 
				                   styleClass="botaoModal"
				                   style="margin-right: 10px">
					<rich:componentControl for="panelEdicao" attachTo="btnCancel" operation="hide" event="onclick" />
				</a4j:commandButton>
				
				<a4j:commandButton id="btnExcluir" value="Excluir" 
						   action="#{leitoForm.excluir()}"
						   onclick="this.disabled=true; if (!confirm('Confirma Exclusão?')) return false"
						   oncomplete="this.disabled=false; avisosValidacao(#{leitoForm.codigoErro},'panelEdicao')" 
						   reRender="idLeitoForm"						    
						   styleClass="botaoModal"						    
						   rendered="#{! leitoForm.novoLeito}">						   				
				</a4j:commandButton>
			</div>
		</h:form>	
	</rich:modalPanel>
	
	<h:form id="idLeitoForm">		
		<div class="cabAreaPesquisa">LEITOS</div>
        <div class="areaPesquisa">
            <div class="colLeft">
         		<div class="col250">         	
        			<label>Pesquisar:</label><br/>
					<h:inputText id="inputPesquisa" 
					             value="#{leitoForm.strLeito}"
					             styleClass="campoTexto"  
					             style="width: 240px;" />
				</div>					
	       		<div class="col70">
	           		<rich:spacer height="12px"/><br/>
	       			<a4j:commandButton image="IMG/pesquisa.gif" id="btnPesquisa" 
	           		    	    action="#{leitoForm.buscar}" 
		    					oncomplete="avisosValidacao(#{leitoForm.codigoErro})"		    				
		    					reRender="dtLeitos,totalRegs" />
		   			<rich:hotKey key="return" selector="#inputPesquisa" 
				   	             handler="#{rich:element('btnPesquisa')}.click()"/>		
		    	</div>	
		    	<div class="col200" style="text-align: center;">
			   		<label>Resultado:</label>
			   		<h:outputText class="totalizador2" value="#{leitoForm.totalLeitos}" id="totalRegs"/> 
				</div>
			</div>
			<div class="col250" style="text-align: right">	    
				<a4j:commandButton value="Novo Leito" 
			                   oncomplete="Richfaces.showModalPanel('panelEdicao')" 
			                   reRender="panelEdicao"
			                   styleClass="botaoNovoItem"
			                   ajaxSingle="true">			                          
					<f:setPropertyActionListener value="#{true}" target="#{leitoForm.novoLeito}" />
				</a4j:commandButton>
			</div>	
			<br style="clear:both;"/>				
		</div>
		    
		<!-- DATATABLE -->
		<rich:dataTable 
			id="dtLeitos" 
			onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
            onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'"
			value="#{leitoForm.lstLeito}" 
			var="leito"
			width="100%"
			reRender="ds"
			rows="30" >
			<f:facet name="header">
				<rich:columnGroup>
					<h:column><h:outputText value="Sel" /></h:column>
					<h:column><h:outputText value="Descrição" /></h:column>
					<h:column><h:outputText value="Clinica/Enfermaria" /></h:column>
					<h:column><h:outputText value="Situaçao" /></h:column>					
				</rich:columnGroup>
			</f:facet>

			<rich:column style="text-align: center">
				<a4j:commandLink oncomplete="Richfaces.showModalPanel('panelEdicao')" 
				                 reRender="panelEdicao"
				                 ajaxSingle="true">			
				    <h:graphicImage id="imgSel" url="IMG/selecionar.png" style="border:0;" />
				    <f:setPropertyActionListener value="#{leito}" target="#{leitoForm.objLeito}" />				    						
					<f:setPropertyActionListener value="#{false}" target="#{leitoForm.novoLeito}"/>		
				</a4j:commandLink>
			</rich:column>
			
			<!-- DESCRICAO LEITO -->
			<rich:column width="30%">
				<h:outputText value="#{leito.dscLeito}" />
			</rich:column>
				
				<!-- ENFERMARIA -->
			<rich:column width="30%" >
				<h:outputText value="#{leito.enfermaria.dscEnfermaria}" />
			</rich:column>
			
			<rich:column width="30%" >
				<h:outputText value="ATIVO" rendered="#{leito.flgLeito == 'A'}"/>
				<h:outputText value="INATIVO" rendered="#{leito.flgLeito != 'A'}"/>
			</rich:column>
				
				<!-- RODAPE DA TABELA -->	
			<f:facet name="footer">
		       	<rich:datascroller id="ds" ajaxSingle="false" />
	        </f:facet>
		</rich:dataTable>
		<br/>
		<br/>
		<br/>
	</h:form>
	<script type="text/javascript">
		function avisosValidacao(erro,panel) {
			if (erro==0) {
				Richfaces.hideModalPanel(panel);				
			} 
			else if (erro==1) {
				alert("O Campo Nome do Leito é obrigatório!");				
			} 
			else if (erro==2) {
				alert("O Campo Enfermaria é obrigatório!");				
			} 
			else if (erro==3) {
				alert("Usuário sem permissão!");				
			} 
		}
	</script>	
</ui:define>
</ui:composition>

</html>