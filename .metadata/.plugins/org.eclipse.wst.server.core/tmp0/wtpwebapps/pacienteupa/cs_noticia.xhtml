<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
					  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich">

<ui:composition template="template.xhtml">

<ui:define name="headHtml">
	<!-- cs_noticia.xhtml -->
	<style>
	.hide-button {
		display:none;
	}
	</style>
</ui:define>

<ui:define name="conteudo">
	<a4j:keepAlive beanName="noticiaForm" />
	
	<rich:modalPanel id="panelEdicao" autosized="true" width="400" resizeable="false">
		<f:facet name="header">
			<h:outputText value="#{(noticiaForm.novaNoticia)?'Nova Notícia':'Editar Notícia'}" />		
		</f:facet>
		<f:facet name="controls">
			<h:panelGroup>
				<h:graphicImage value="IMG/fechar.png" id="fechaCl" style="border:0" />
				<rich:componentControl for="panelEdicao" attachTo="fechaCl" operation="hide" event="onclick" />
			</h:panelGroup>
		</f:facet>
		<h:form id="formNoticia">
			<div class="geralCampos" style="font-size: 12px">			
		    	<h:outputLabel value="Título:" for="inputTitulo" /><br/>
				<h:inputText value="#{noticiaForm.noticia.dscTitulo}" id="inputTitulo" styleClass="campoTextolc" style="width:395px;" maxlength="100" />
				<br/>        
				<h:outputLabel value="Descrição:" for="inputDescricao" /><br/>
				<h:inputTextarea id="inputDescricao" 
					              style="width:395px; height:100px"
								  value="#{noticiaForm.noticia.dscDescricao}" 
								  onkeyup="verificaTamanho('formNoticia',this, 1000, 'lblNoticiaDescricao')" 
								  styleClass="campoTextolc"/>
				<br/><label id="lblNoticiaDescricao" class="labelChar">(1000 caracteres restantes)</label>				
				<div style="margin-bottom:5px">
					<h:outputLabel value="Arquivo:" />
					<h:outputText value="não possui" rendered="#{(noticiaForm.noticia.extArquivo == null and noticiaForm.noticia.pathArquivo == null)}" />
					<a4j:commandLink action="#{noticiaForm.deletarArquivo}" 
									onclick="if (!confirm('Deletar esse arquivo?')) return false" 
									reRender="formNoticia,formNoticias"
									rendered="#{(noticiaForm.noticia.extArquivo != null and noticiaForm.noticia.pathArquivo != null)}"
							        ajaxSingle="true" 
									title="Clique para deletar esse arquivo!">
						<h:outputText value="#{noticiaForm.noticia.pathArquivo}" />
						<h:graphicImage id="imgDeletar2" url="IMG/excluir.png" style="border:0; vertical-align:middle" />
					</a4j:commandLink>				
				</div>
				<rich:fileUpload fileUploadListener="#{noticiaForm.listener}" 
									id="upload" 
									acceptedTypes="pdf,png,jpg,jpeg,gif" 
									ontyperejected="alert('Apenas arquivos PDF, PNG, JPEG e GIF são aceitos');" 
									listHeight="100" 
									maxFilesQuantity="1"
									sizeErrorLabel="Arquivo deve ter no maximo 3MB"
									addControlLabel="Escolher arquivo..."
									cleanButtonClass="hide-button"
									clearControlLabel=""
									oncomplete="this.clear(); this.enable();">
					<a4j:support event="onuploadcomplete" reRender="upload,formNoticia" />
		        </rich:fileUpload>
		        <h:outputText value="Obs.: As imagens devem ter no máximo 980px de largura e 580px de altura." style="font-size:10px" />
		        <br/>
		        <h:outputLabel value="Ativar:" for="chkAtivar" />
				<h:selectBooleanCheckbox value="#{noticiaForm.chkAtivar}" id="chkAtivar" />
				<br/>
			</div>
			<div style="text-align: center; margin-top: 10px">
				<a4j:commandButton id="btnOk" value="OK" 
								   action="#{noticiaForm.salvarNoticia}"
								   oncomplete="this.disabled=false; avisosValidacao(#{noticiaForm.codigoErro},'panelEdicao')" 
								   reRender="formNoticias:dtNoticias,formNoticias:dtNoticias"
								   style="margin-right: 10px" 
								   styleClass="botaoModal"
								   onclick="this.disabled=true">
				</a4j:commandButton>
				<a4j:commandButton id="btnCancel"  
				                   value="Cancelar" 
				                   styleClass="botaoModal"
				                   style="margin-right: 10px">
					<rich:componentControl for="panelEdicao" attachTo="btnCancel" operation="hide" event="onclick" />
				</a4j:commandButton>
			</div>
		</h:form>	
	</rich:modalPanel>
	
	<rich:modalPanel id="panelPdfEdicao" width="1000" autosized="true" resizeable="false">
		<f:facet name="header">
			<h:outputText value="Notícia" />
		</f:facet>
		<f:facet name="controls">
			<h:panelGroup>
				<h:graphicImage value="IMG/fechar.png" id="fechaPopup" style="border:0" />
				<rich:componentControl for="panelPdfEdicao" attachTo="fechaPopup" operation="hide" event="onclick" />
			</h:panelGroup>
		</f:facet>
		<h2><h:outputText value="#{noticiaForm.noticia.dscTitulo}" /></h2>
		<h:form id="formArquivo">
			<div style="width:1000px; height:600px; #{(noticiaForm.noticia.extArquivo != null and noticiaForm.noticia.pathArquivo != null and noticiaForm.noticia.extArquivo eq 'PDF')?'':'display:none'}">
				<object data="noticias/#{noticiaForm.noticia.pathArquivo}" width="1000" height="580" type="application/pdf">
		    		<embed src="noticias/#{noticiaForm.noticia.pathArquivo}" type="application/pdf" />
				</object>
			</div>
			<div style="#{(noticiaForm.noticia.extArquivo != null and noticiaForm.noticia.extArquivo ne 'PDF')?'':'display:none'}">
				<h:graphicImage value="noticias/#{noticiaForm.noticia.pathArquivo}" rendered="#{not empty noticiaForm.noticia.pathArquivo}" />
			</div>
			<div style="#{(noticiaForm.noticia.extArquivo == null and noticiaForm.noticia.dscDescricao != null)?'':'display:none'}">
				<blockquote>
					<h:outputText value="#{noticiaForm.noticia.dscDescricaoPrint}" escape="false" />
				</blockquote>
			</div>
		</h:form>
	</rich:modalPanel>
	
    <h:form id="formNoticias">
		<div style="margin-bottom: 60px">	
	    	<div class="cabAreaPesquisa">NOTÍCIAS</div>
	        <div class="areaPesquisa">
	            <div class="colLeft">
	         		<div>
	        			<label>Pesquisar:</label><br/>
						<h:inputText id="inputPesquisa" 
						             value="#{noticiaForm.strPesquisa}"
						             styleClass="campoTextolc"  
						             style="width: 240px;" />
					</div>					
		       		<div>
		           		<rich:spacer height="12px"/><br/>
		       			<a4j:commandButton image="IMG/pesquisa.gif" id="btnPesquisa" 
		           		    	    action="#{noticiaForm.pesquisar}" 
			    					oncomplete="avisosValidacao(#{noticiaForm.codigoErro})"		    				
			    					reRender="dtNoticias,totalRegs" />
			   			<rich:hotKey key="return" selector="#inputPesquisa" 
					   	             handler="#{rich:element('btnPesquisa')}.click()"/>
			    	</div>	
			    	<div style="text-align: center;">
				   		<label>Resultado:</label>
				   		<h:outputText class="totalizador2" value="#{noticiaForm.totalNoticias}" id="totalRegs"/> 
					</div>
				</div>
				<div style="text-align: right">
					<rich:spacer height="12px"/><br/>
					<a4j:commandButton value="Nova Notícia" 
				                   oncomplete="Richfaces.showModalPanel('panelEdicao')" 
				                   reRender="panelEdicao"
				                   styleClass="botaoNovoItem"
				                   actionListener="#{noticiaForm.preparaInserir}"
				                   ajaxSingle="true">			                          
						<f:setPropertyActionListener value="#{true}" target="#{noticiaForm.novaNoticia}" />
					</a4j:commandButton>
				</div>	
				<br style="clear:both;"/>				
			</div>
		   	<rich:dataTable id="dtNoticias" 
							onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
				           	onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'"
							value="#{noticiaForm.lstNoticias}" 
							var="noticia"
							width="100%"
							reRender="ds"
							rows="20">
				<f:facet name="header">
					<rich:columnGroup>
						<h:column><h:outputText value="Sel" /></h:column>
						<h:column><h:outputText value="Data" /></h:column>
						<h:column><h:outputText value="Título" /></h:column>
						<h:column><h:outputText value="Arquivo" /></h:column>
						<h:column><h:outputText value="Destaque" /></h:column>
						<h:column><h:outputText value="Ativa" /></h:column>
					</rich:columnGroup>
				</f:facet>
				<rich:column style="text-align:center; width:5%">
					<a4j:commandLink action="#{noticiaForm.selNoticia}" oncomplete="Richfaces.showModalPanel('panelEdicao')" 
					                 reRender="panelEdicao"
					                 ajaxSingle="true" title="Clique para editar notícia!">
					    <h:graphicImage id="imgSel" url="IMG/selecionar.png" style="border:0;" />
					    <f:setPropertyActionListener value="#{noticia}" target="#{noticiaForm.noticia}" />
						<f:setPropertyActionListener value="#{false}" target="#{noticiaForm.novaNoticia}"/>
					</a4j:commandLink>
				</rich:column>
				<rich:column style="text-align:center; width:10%">
					<h:outputText value="#{noticia.datCadastro}" />
				</rich:column>
				<rich:column>
					<h:outputText value="#{noticia.dscTitulo}" />
				</rich:column>
				<rich:column style="text-align:center; width:10%">
					<a4j:commandLink action="#{noticiaForm.showPdf}" oncomplete="Richfaces.showModalPanel('panelPdfEdicao')" 
					                 reRender="panelPdfEdicao"
					                 ajaxSingle="true" title="Preview dessa Notícia!">
						<h:graphicImage value="images/icons/doc_32.png" style="border:0;" />
						<f:setPropertyActionListener value="#{noticia}" target="#{noticiaForm.noticia}" />
					</a4j:commandLink>
				</rich:column>
				<rich:column style="text-align:center; width:5%">
					<a4j:commandLink action="#{noticiaForm.retirarNoticiaDestaque}" onclick="if (!confirm('Retirar essa notícia do destaque (popup página inicial)?')) return false" 
					                 reRender="dtNoticias"
					                 ajaxSingle="true" rendered="#{noticia.flgDestaque eq 'S'}" title="Clique para retirar essa notícia do destaque (popup página inicial)!">
						<h:graphicImage value="IMG/star_yellow.png" style="border:0;" rendered="#{noticia.flgDestaque eq 'S'}" />
						<f:setPropertyActionListener value="#{noticia}" target="#{noticiaForm.noticia}" />
					</a4j:commandLink>
					
					<a4j:commandLink action="#{noticiaForm.setarNoticiaDestaque}" onclick="if (!confirm('Escolher essa notícia como destaque (popup página inicial)?')) return false" 
					                 reRender="dtNoticias"
					                 ajaxSingle="true" rendered="#{noticia.flgDestaque ne 'S' and noticia.flgAtivo eq 'S'}" title="Clique para escolher essa notícia como destaque (popup página inicial)!">
						<h:graphicImage value="IMG/star_grey.png" style="border:0;" />
						<f:setPropertyActionListener value="#{noticia}" target="#{noticiaForm.noticia}" />
					</a4j:commandLink>
					
					<h:graphicImage value="IMG/star_grey.png" title="Ative essa notícia antes, para colocá-la em destaque!" style="border:0;" rendered="#{noticia.flgDestaque ne 'S' and noticia.flgAtivo ne 'S'}" />
					
				</rich:column>
				<rich:column style="text-align:center; width:5%">
					<h:graphicImage value="IMG/check.gif" title="Ativa" rendered="#{(noticia.flgAtivo eq 'S')}" />
					<h:graphicImage value="IMG/uncheck.gif" title="Inativa" rendered="#{(noticia.flgAtivo ne 'S')}" />
				</rich:column>
				<f:facet name="footer">
	        		<rich:datascroller fastControls="auto" id="ds" ajaxSingle="false" />
	        	</f:facet>
			</rich:dataTable>
		</div>		
	</h:form>
	<script type="text/javascript">
		function avisosValidacao(erro,panel) {
			if (erro == 0) {
				Richfaces.hideModalPanel(panel);
			} else if (erro == 1) {
				alert("Usuário sem permissão!");
			} else if (erro == 2) {
				alert("Título da Notícia é obrigatório!");
			}
		}
		
		function confirmarExclusao() {
			if (confirm("Confirma a exclusão?")) {				
				return true;
			} else {
				return false;
			} 
		}
	</script>
</ui:define>
</ui:composition>
</html>