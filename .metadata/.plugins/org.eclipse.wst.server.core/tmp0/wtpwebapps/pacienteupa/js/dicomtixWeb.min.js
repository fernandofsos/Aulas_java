"use strict";function objectToString(a){var b="";for(nmProp in a)b+=a[nmProp];return b}var dicomtixWeb={getExame:function(a,b,c,d,e,f){var g=dicomtixConfig.protocolo+"://"+dicomtixConfig.host+":"+dicomtixConfig.porta+"/"+dicomtixConfig.aplicacao+"/api/usuario",h=dicomtixConfig.protocolo+"://"+dicomtixConfig.host+":"+dicomtixConfig.porta+"/"+dicomtixConfig.aplicacao+"/api/exame",i=dicomtixConfig.url_imagem,a={login:a,senha:MD5(b)};$.post(g,a,function(a){f&&f(0,0,"Usu�rio validado: "+a.nome);var b=document.getElementById("dicomtixUsuarioObj");b||(b=document.createElement("input"),b.setAttribute("type","hidden"),b.setAttribute("name","dicomtixUsuarioObj"),b.setAttribute("id","dicomtixUsuarioObj"),document.getElementById("formDicomtix").appendChild(b)),b.value=JSON.stringify(a);var g={studyId:c,instituicao:a.instituicao};$.post(h,g,function(a){var b=a[0];f&&f(0,0,"Exame validado: "+b.patientName),b.nrImagensBaixadas=0,b.nrImagensErro=0,b.nrImagens=0,b.seriesList.forEach(function(a){a.instanceList.forEach(function(){b.nrImagens++})}),f&&f(0,b.nrImagens),b.seriesList.forEach(function(a){a.instanceList.forEach(function(a){var c=a.imageId;"http"!=c.substr(0,4)&&(c=i+a.imageId);try{var g=cornerstone.loadAndCacheImage(c);g.done(function(){if(b.nrImagensBaixadas++,f&&f(b.nrImagensErro+b.nrImagensBaixadas,b.nrImagens),b.nrImagensBaixadas+b.nrImagensErro==b.nrImagens){d&&d("Exame baixado com sucesso!");var a=window.open("detalhe.html","_blank","fullscreen=yes");a&&(a.document.title=b.patientName,a.name=b.studyId)}}),g.fail(function(){b.nrImagensErro++,f&&f(b.nrImagensErro+b.nrImagensBaixadas,b.nrImagens)})}catch(h){e&&e("Erro inesperado no downlaod das imagens: "+h.message)}})});var c=document.getElementById("dicomtixExameObj");c||(c=document.createElement("input"),c.setAttribute("type","hidden"),c.setAttribute("name","dicomtixExameObj"),c.setAttribute("id","dicomtixExameObj"),document.getElementById("formDicomtix").appendChild(c)),c.value=JSON.stringify(b)}).fail(function(a){e&&(console&&console.log("Erro ao obter exame"),e("Erro na consulta do exame. "+objectToString(a)))})}).fail(function(a){e&&(console&&console.log("Erro ao obter usuario"),e("Erro na valida��o do usu�rio."+objectToString(a)))})}};