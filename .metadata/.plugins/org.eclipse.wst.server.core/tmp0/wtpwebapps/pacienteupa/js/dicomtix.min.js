var cornerstone=function(a){"use strict";function b(a){if(void 0===a)throw"setMaximumSizeBytes: parameter numBytes must not be undefined";if(void 0===a.toFixed)throw"setMaximumSizeBytes: parameter numBytes must be a number";k=a,c()}function c(){function a(a,b){return a.timeStamp>b.timeStamp?-1:a.timeStamp<b.timeStamp?1:0}if(!(k>=l))for(i.sort(a);l>k;){var b=i[i.length-1];l-=b.sizeInBytes,delete h[b.imageId],i.pop()}}function d(a,b){if(void 0===a)throw"getImagePromise: imageId must not be undefined";if(void 0===b)throw"getImagePromise: imagePromise must not be undefined";if(h.hasOwnProperty(a)===!0)throw"putImagePromise: imageId already in cache";var d={imageId:a,imagePromise:b,timeStamp:new Date,sizeInBytes:0};h[a]=d,i.push(d),b.then(function(a){if(d.loaded=!0,d.image=a,void 0===a.sizeInBytes)throw"putImagePromise: image does not have sizeInBytes property or";if(void 0===a.sizeInBytes.toFixed)throw"putImagePromise: image.sizeInBytes is not a number";d.sizeInBytes=a.sizeInBytes,l+=d.sizeInBytes,c()})}function e(a){if(void 0===a)throw"getImagePromise: imageId must not be undefined";var b=h[a];return void 0===b?void 0:(b.timeStamp=new Date,b.imagePromise)}function f(){return{maximumSizeInBytes:k,cacheSizeInBytes:l,numberOfImagesCached:i.length}}function g(){var a=k;k=0,c(),k=a}void 0===a&&(a={});var h={},i=[];try{window.opener&&window.opener.cornerstone&&window.opener.cornerstone.imageCache&&(window.opener.cornerstone.imageCache.images&&(h=window.opener.cornerstone.imageCache.images,console.log("atualizou o array de imagens com os dados do pai")),window.opener.cornerstone.imageCache.cachedImages&&(i=window.opener.cornerstone.imageCache.cachedImages,i.forEach(function(a){a.imagePromise=$.Deferred(),a.imagePromise.resolve(a.image)}),console.log("atualizou o array de cached Imagens com os dados do pai")))}catch(j){console.log(j)}var k=1073741824,l=0;return a.imageCache={putImagePromise:d,getImagePromise:e,setMaximumSizeBytes:b,getCacheInfo:f,purgeCache:g,cachedImages:i,images:h},a}(cornerstone),cornerstone=function(a){"use strict";function b(){var a=0,b=/MSIE (\d+\.\d+);/.test(navigator.userAgent),c=!!navigator.userAgent.match(/Trident\/7.0/),d=navigator.userAgent.indexOf("rv:11.0");return b&&(a=new Number(RegExp.$1)),-1!=navigator.appVersion.indexOf("MSIE 10")&&(a=10),c&&-1!=d&&(a=11),a}return void 0===a&&(a={}),a.ieVersion=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(b,c,d,e,f){if(void 0===b)throw"getStoredPixels: parameter element must not be undefined";c=Math.round(c),d=Math.round(d);for(var g=a.getEnabledElement(b),h=[],i=0,j=g.image.getPixelData(),k=0;f>k;k++)for(var l=0;e>l;l++){var m=(k+d)*g.image.columns+(l+c);h[i++]=j[m]}return h}return void 0===a&&(a={}),a.getStoredPixels=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(a,b){if(void 0===a)throw"getDefaultViewport: parameter canvas must not be undefined";if(void 0===b)throw"getDefaultViewport: parameter image must not be undefined";var c={scale:1,translation:{x:0,y:0},voi:{windowWidth:b.windowWidth,windowCenter:b.windowCenter},invert:b.invert,pixelReplication:!1},d=a.height/b.rows,e=a.width/b.columns;return c.scale=d>e?e:d,c}return void 0===a&&(a={}),a.getDefaultViewport=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(a,b,c,d){void 0===a.lut&&(a.lut=[]);var e,f,g,h,i=a.lut,j=a.maxPixelValue,k=a.slope,l=a.intercept,m=b,n=c;if(d===!0)for(h=a.minPixelValue;j>=h;h++)e=h*k+l,f=255*((e-n)/m+.5),g=Math.min(Math.max(f,0),255),i[h]=Math.round(255-g);else for(h=a.minPixelValue;j>=h;h++)e=h*k+l,f=255*((e-n)/m+.5),g=Math.min(Math.max(f,0),255),i[h]=Math.round(g)}return void 0===a&&(a={}),a.generateLut=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(b){var c=a.getEnabledElement(b),d=a.getDefaultViewport(c.canvas,c.image);c.viewport.scale=d.scale,c.viewport.translation.x=d.translation.x,c.viewport.translation.y=d.translation.y,a.updateImage(b)}return void 0===a&&(a={}),a.fitToWindow=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(a){if(void 0===a)throw"getEnabledElement: parameter element must not be undefined";for(var b=0;b<f.length;b++)if(f[b].element==a)return f[b];throw"element not enabled"}function c(a){if(void 0===a)throw"getEnabledElement: enabledElement element must not be undefined";f.push(a)}function d(a){if(void 0===a)throw"disable: element element must not be undefined";for(var b=0;b<f.length;b++)if(f[b].element===a)return f[b].element.removeChild(f[b].canvas),void f.splice(b,1)}function e(a){var b=[];return f.forEach(function(c){c.image&&c.image.imageId===a&&b.push(c)}),b}void 0===a&&(a={});var f=[];return a.getEnabledElement=b,a.addEnabledElement=c,a.disable=d,a.getEnabledElementsByImageId=e,a}(cornerstone),cornerstone=function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b);return d.data.hasOwnProperty(c)===!1&&(d.data[c]={}),d.data[c]}function c(b,c){var d=a.getEnabledElement(b);delete d.data[c]}return void 0===a&&(a={}),a.getElementData=b,a.removeElementData=c,a}(cornerstone),cornerstone=function(a){"use strict";function b(b){if(void 0===b)throw"enable: parameter element cannot be undefined";var c=document.createElement("canvas");b.appendChild(c);var d={element:b,canvas:c,image:void 0,data:{}};return a.addEnabledElement(d),a.resize(b,!0),b}return void 0===a&&(a={}),a.enable=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(b,c){var d=new Date;b.image.render(b,c);var e=b.canvas.getContext("2d"),f=new Date,g=f-d,h={canvasContext:e,renderTimeInMs:g};a.event(b,"CornerstoneImageRendered",h)}return void 0===a&&(a={}),a.drawImage=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(b,c,d){if(void 0===b)throw"displayImage: parameter element cannot be undefined";if(void 0===c)throw"displayImage: parameter image cannot be undefined";var e=a.getEnabledElement(b);if(e.image=c,void 0===e.viewport&&(e.viewport=a.getDefaultViewport(e.canvas,c)),d)for(var f in d)null!==d[f]&&(e.viewport[f]=d[f]);var g,h=new Date;if(void 0!==e.lastImageTimeStamp){var i=h.getTime()-e.lastImageTimeStamp;g=(1e3/i).toFixed()}e.lastImageTimeStamp=h.getTime();var j={frameRate:g};a.event(e,"CornerstoneNewImage",j),a.updateImage(b)}return void 0===a&&(a={}),a.displayImage=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}function c(a,c,e){if(void 0===a)throw"cornerstoneEvent: parameter enabledElement cannot be undefined";if(void 0===c)throw"cornerstoneEvent: parameter eventName cannot be undefined";void 0===e&&(e={}),e.viewport=a.viewport,e.element=a.element,e.image=a.image,e.enabledElement=a;var f;f=11>=d?new b(c,{detail:e,bubbles:!1,cancelable:!1}):new CustomEvent(c,{detail:e,bubbles:!1,cancelable:!1}),a.element.dispatchEvent(f)}void 0===a&&(a={});var d=a.ieVersion();return b.prototype=window.Event.prototype,a.event=c,a}(cornerstone),cornerstone=function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b);d.viewport.scale=c.scale,d.viewport.translation.x=c.translation.x,d.viewport.translation.y=c.translation.y,d.viewport.voi.windowWidth=c.voi.windowWidth,d.viewport.voi.windowCenter=c.voi.windowCenter,d.viewport.invert=c.invert,d.viewport.pixelReplication=c.pixelReplication,d.viewport.voi.windowWidth<1&&(d.viewport.voi.windowWidth=1),d.viewport.scale<1e-4&&(d.viewport.scale=.25),a.updateImage(b)}function c(b){var c=a.getEnabledElement(b),d=c.viewport;return void 0===d?void 0:{scale:d.scale,translation:{x:d.translation.x,y:d.translation.y},voi:{windowWidth:d.voi.windowWidth,windowCenter:d.voi.windowCenter},invert:d.invert,pixelReplication:d.pixelReplication}}return void 0===a&&(a={}),a.getViewport=c,a.setViewport=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(b){var c=a.getEnabledElement(b);if(void 0===c.image)throw"updateImage: image has not been loaded yet";a.drawImage(c)}return void 0===a&&(a={}),a.updateImage=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(a,b,c){for(var d=3,e=0,f=a.length,g=a,h=b,i=c;f>e;)i[d]=h[g[e++]],d+=4}function c(a,b,c){for(var d=0,e=0,f=a.width*a.height*4,g=a.getPixelData(),h=b,i=c;f>e;)i[d++]=h[g[e++]],i[d++]=h[g[e++]],i[d]=h[g[e]],e+=2,d+=2}return void 0===a&&(a={}),a.storedPixelDataToCanvasImageData=b,a.storedColorPixelDataToCanvasImageData=c,a}(cornerstone),cornerstone=function(a){"use strict";function b(a,b,c){if(void 0===a)throw"setToPixelCoordinateSystem: parameter enabledElement must not be undefined";if(void 0===b)throw"setToPixelCoordinateSystem: parameter context must not be undefined";b.setTransform(1,0,0,1,0,0),b.translate(a.canvas.width/2,a.canvas.height/2);var d=a.viewport.scale,e=a.viewport.scale;a.image.rowPixelSpacing<a.image.columnPixelSpacing?d*=a.image.columnPixelSpacing/a.image.rowPixelSpacing:a.image.columnPixelSpacing<a.image.rowPixelSpacing&&(e*=a.image.rowPixelSpacing/a.image.columnPixelSpacing),b.scale(d,e),b.translate(a.viewport.translation.x,a.viewport.translation.y),void 0===c?c=1:b.scale(c,c),b.translate(-a.image.width/2/c,-a.image.height/2/c)}return void 0===a&&(a={}),a.setToPixelCoordinateSystem=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(a,b){b.width=a.clientWidth,b.height=a.clientHeight,b.style.width=a.clientWidth+"px",b.style.height=a.clientHeight+"px"}function c(c,d){var e=a.getEnabledElement(c);b(c,e.canvas),void 0!==e.image&&(d===!0?a.fitToWindow(c):a.updateImage(c))}return void 0===a&&(a={}),a.resize=c,a}(cornerstone),cornerstone=function(a){"use strict";function b(b,c){if(void 0===b)throw"drawImage: enabledElement parameter must not be undefined";var d=b.image;if(void 0===d)throw"drawImage: image must be loaded before it can be drawn";var e=b.canvas.getContext("2d");e.setTransform(1,0,0,1,0,0),e.fillStyle="black",e.fillRect(0,0,b.canvas.width,b.canvas.height),b.viewport.pixelReplication===!0?(e.imageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1):(e.imageSmoothingEnabled=!0,e.mozImageSmoothingEnabled=!0),a.setToPixelCoordinateSystem(b,e),b.viewport.voi.windowWidth===b.image.windowWidth&&b.viewport.voi.windowCenter===b.image.windowCenter&&b.viewport.invert===!1?e.drawImage(d.getImage(),0,0,d.width,d.height,0,0,d.width,d.height):a.renderColorImage(b,c)}return void 0===a&&(a={}),a.renderWebImage=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(a){j.width=a.width,j.height=a.height,g=j.getContext("2d"),g.fillStyle="white",g.fillRect(0,0,j.width,j.height),h=g.getImageData(0,0,a.width,a.height)}function c(b,c,d){return void 0!==b.lut&&b.lut.windowCenter===c.voi.windowCenter&&b.lut.windowWidth===c.voi.windowWidth&&b.lut.invert===c.invert&&d!==!0?b.lut:(a.generateLut(b,c.voi.windowWidth,c.voi.windowCenter,c.invert),b.lut.windowWidth=c.voi.windowWidth,b.lut.windowCenter=c.voi.windowCenter,b.lut.invert=c.invert,b.lut)}function d(a,b){return b.imageId!==i||k.windowCenter!==a.viewport.voi.windowCenter||k.windowWidth!==a.viewport.voi.windowWidth||k.invert!==a.viewport.invert?!0:!1}function e(e,f,i){if(d(e,f)===!1&&i!==!0)return j;(j.width!==f.width||j.height!=f.height)&&b(f);var k=c(f,e.viewport,i);return a.storedPixelDataToCanvasImageData(f.getPixelData(),k,h.data),g.putImageData(h,0,0),j}function f(b,c){if(void 0===b)throw"drawImage: enabledElement parameter must not be undefined";var d=b.image;if(void 0===d)throw"drawImage: image must be loaded before it can be drawn";var f=b.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0),f.fillStyle="black",f.fillRect(0,0,b.canvas.width,b.canvas.height),b.viewport.pixelReplication===!0?(f.imageSmoothingEnabled=!1,f.mozImageSmoothingEnabled=!1):(f.imageSmoothingEnabled=!0,f.mozImageSmoothingEnabled=!0),a.setToPixelCoordinateSystem(b,f);var g=e(b,d,c);f.drawImage(g,0,0,d.width,d.height,0,0,d.width,d.height),i=d.imageId,k.windowCenter=b.viewport.voi.windowCenter,k.windowWidth=b.viewport.voi.windowWidth,k.invert=b.viewport.invert}void 0===a&&(a={});var g,h,i,j=document.createElement("canvas"),k={};return a.renderGrayscaleImage=f,a}(cornerstone),cornerstone=function(a){"use strict";function b(a){j.width=a.width,j.height=a.height,g=j.getContext("2d"),g.fillStyle="white",g.fillRect(0,0,j.width,j.height),h=g.getImageData(0,0,a.width,a.height)}function c(b,c){return void 0!==b.lut&&b.lut.windowCenter===c.voi.windowCenter&&b.lut.windowWidth===c.voi.windowWidth&&b.lut.invert===c.invert?b.lut:(a.generateLut(b,c.voi.windowWidth,c.voi.windowCenter,c.invert),b.lut.windowWidth=c.voi.windowWidth,b.lut.windowCenter=c.voi.windowCenter,b.lut.invert=c.invert,b.lut)}function d(a,b){return b.imageId!==i||k.windowCenter!==a.viewport.voi.windowCenter||k.windowWidth!==a.viewport.voi.windowWidth||k.invert!==a.viewport.invert?!0:!1}function e(e,f,i){if(e.viewport.voi.windowWidth===e.image.windowWidth&&e.viewport.voi.windowCenter===e.image.windowCenter&&e.viewport.invert===!1)return f.getCanvas();if(d(e,f)===!1&&i!==!0)return j;(j.width!==f.width||j.height!=f.height)&&b(f);var k=c(f,e.viewport);return a.storedColorPixelDataToCanvasImageData(f,k,h.data),g.putImageData(h,0,0),j}function f(b,c){if(void 0===b)throw"drawImage: enabledElement parameter must not be undefined";var d=b.image;if(void 0===d)throw"drawImage: image must be loaded before it can be drawn";var f=b.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0),f.fillStyle="black",f.fillRect(0,0,b.canvas.width,b.canvas.height),b.viewport.pixelReplication===!0?(f.imageSmoothingEnabled=!1,f.mozImageSmoothingEnabled=!1):(f.imageSmoothingEnabled=!0,f.mozImageSmoothingEnabled=!0),f.save(),a.setToPixelCoordinateSystem(b,f);var g=e(b,d,c);f.drawImage(g,0,0,d.width,d.height,0,0,d.width,d.height),f.restore(),i=d.imageId,k.windowCenter=b.viewport.voi.windowCenter,k.windowWidth=b.viewport.voi.windowWidth,k.invert=b.viewport.invert}void 0===a&&(a={});var g,h,i,j=document.createElement("canvas"),k={};return a.renderColorImage=f,a}(cornerstone),cornerstone=function(a){"use strict";function b(b,c,d){var e=a.getEnabledElement(b);if(void 0===e.image)throw"image has not been loaded yet";var f=b.getBoundingClientRect(),g=c-f.left-window.scrollX,h=d-f.top-window.scrollY,i=g-f.width/2,j=h-f.height/2,k=e.viewport,l=e.viewport.scale,m=e.viewport.scale;e.image.rowPixelSpacing<e.image.columnPixelSpacing?l*=e.image.columnPixelSpacing/e.image.rowPixelSpacing:e.image.columnPixelSpacing<e.image.rowPixelSpacing&&(m*=e.image.rowPixelSpacing/e.image.columnPixelSpacing);var n=i/l,o=j/m,p=n-k.translation.x,q=o-k.translation.y;return p+=e.image.columns/2,q+=e.image.rows/2,{x:p,y:q}}return void 0===a&&(a={}),a.pageToPixel=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(b){var c=a.getEnabledElementsByImageId(b);c.forEach(function(b){a.drawImage(b,!0)})}return void 0===a&&(a={}),a.invalidateImageId=b,a}(cornerstone),cornerstone=function(a){"use strict";function b(a){var b,c=a.indexOf(":"),d=a.substring(0,c),e=h[d];return void 0===e||null===e?void 0!==g?b=g(a):void 0:b=e(a)}function c(c){if(void 0===c)throw"loadImage: parameter imageId must not be undefined";var d=a.imageCache.getImagePromise(c);if(void 0!==d)return d;if(d=b(c),void 0===d)throw"loadImage: no image loader for imageId";return d}function d(c){if(void 0===c)throw"loadAndCacheImage: parameter imageId must not be undefined";var d=a.imageCache.getImagePromise(c);if(void 0!==d)return d;if(d=b(c),void 0===d)throw"loadAndCacheImage: no image loader for imageId";return a.imageCache.putImagePromise(c,d),d}function e(a,b){h[a]=b}function f(a){var b=g;return g=a,b}void 0===a&&(a={});var g,h={};return a.loadImage=c,a.loadAndCacheImage=d,a.registerImageLoader=e,a.registerUnknownImageLoader=f,a}(cornerstone),cornerstoneMath=function(a){"use strict";function b(a){return a*a}function c(a,c){return b(a.x-c.x)+b(a.y-c.y)}function d(a,b){var d=c(a.start,a.end);if(0===d)return c(b,a.start);var e=((b.x-a.start.x)*(a.end.x-a.start.x)+(b.y-a.start.y)*(a.end.y-a.start.y))/d;if(0>e)return c(b,a.start);if(e>1)return c(b,a.end);var f={x:a.start.x+e*(a.end.x-a.start.x),y:a.start.y+e*(a.end.y-a.start.y)};return c(b,f)}function e(a,b){return Math.sqrt(d(a,b))}return void 0===a&&(a={}),a.lineSegment={distanceToPoint:e},a}(cornerstoneMath),cornerstoneMath=function(a){"use strict";return void 0===a&&(a={}),a.Matrix4=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.elements=new Float32Array(16);var q=this.elements;q[0]=void 0!==a?a:1,q[4]=b||0,q[8]=c||0,q[12]=d||0,q[1]=e||0,q[5]=void 0!==f?f:1,q[9]=g||0,q[13]=h||0,q[2]=i||0,q[6]=j||0,q[10]=void 0!==k?k:1,q[14]=l||0,q[3]=m||0,q[7]=n||0,q[11]=o||0,q[15]=void 0!==p?p:1},a.Matrix4.prototype.makeRotationFromQuaternion=function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return b[0]=1-(m+o),b[4]=k-r,b[8]=l+q,b[1]=k+r,b[5]=1-(j+o),b[9]=n-p,b[2]=l-q,b[6]=n+p,b[10]=1-(j+m),b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this},a.Matrix4.prototype.multiplyMatrices=function(a,b){var c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],i=c[12],j=c[1],k=c[5],l=c[9],m=c[13],n=c[2],o=c[6],p=c[10],q=c[14],r=c[3],s=c[7],t=c[11],u=c[15],v=d[0],w=d[4],x=d[8],y=d[12],z=d[1],A=d[5],B=d[9],C=d[13],D=d[2],E=d[6],F=d[10],G=d[14],H=d[3],I=d[7],J=d[11],K=d[15];return e[0]=f*v+g*z+h*D+i*H,e[4]=f*w+g*A+h*E+i*I,e[8]=f*x+g*B+h*F+i*J,e[12]=f*y+g*C+h*G+i*K,e[1]=j*v+k*z+l*D+m*H,e[5]=j*w+k*A+l*E+m*I,e[9]=j*x+k*B+l*F+m*J,e[13]=j*y+k*C+l*G+m*K,e[2]=n*v+o*z+p*D+q*H,e[6]=n*w+o*A+p*E+q*I,e[10]=n*x+o*B+p*F+q*J,e[14]=n*y+o*C+p*G+q*K,e[3]=r*v+s*z+t*D+u*H,e[7]=r*w+s*A+t*E+u*I,e[11]=r*x+s*B+t*F+u*J,e[15]=r*y+s*C+t*G+u*K,this},a.Matrix4.prototype.multiply=function(a,b){return void 0!==b?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},a.Matrix4.prototype.getInverse=function(a,b){var c=this.elements,d=a.elements,e=d[0],f=d[4],g=d[8],h=d[12],i=d[1],j=d[5],k=d[9],l=d[13],m=d[2],n=d[6],o=d[10],p=d[14],q=d[3],r=d[7],s=d[11],t=d[15];c[0]=k*p*r-l*o*r+l*n*s-j*p*s-k*n*t+j*o*t,c[4]=h*o*r-g*p*r-h*n*s+f*p*s+g*n*t-f*o*t,c[8]=g*l*r-h*k*r+h*j*s-f*l*s-g*j*t+f*k*t,c[12]=h*k*n-g*l*n-h*j*o+f*l*o+g*j*p-f*k*p,c[1]=l*o*q-k*p*q-l*m*s+i*p*s+k*m*t-i*o*t,c[5]=g*p*q-h*o*q+h*m*s-e*p*s-g*m*t+e*o*t,c[9]=h*k*q-g*l*q-h*i*s+e*l*s+g*i*t-e*k*t,c[13]=g*l*m-h*k*m+h*i*o-e*l*o-g*i*p+e*k*p,c[2]=j*p*q-l*n*q+l*m*r-i*p*r-j*m*t+i*n*t,c[6]=h*n*q-f*p*q-h*m*r+e*p*r+f*m*t-e*n*t,c[10]=f*l*q-h*j*q+h*i*r-e*l*r-f*i*t+e*j*t,c[14]=h*j*m-f*l*m-h*i*n+e*l*n+f*i*p-e*j*p,c[3]=k*n*q-j*o*q-k*m*r+i*o*r+j*m*s-i*n*s,c[7]=f*o*q-g*n*q+g*m*r-e*o*r-f*m*s+e*n*s,c[11]=g*j*q-f*k*q-g*i*r+e*k*r+f*i*s-e*j*s,c[15]=f*k*m-g*j*m+g*i*n-e*k*n-f*i*o+e*j*o;var u=e*c[0]+i*c[4]+m*c[8]+q*c[12];if(0===u){var v="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(b)throw new Error(v);return console.warn(v),this.identity(),this}return this.multiplyScalar(1/u),this},a.Matrix4.prototype.applyToVector3Array=function(){var b=new a.Vector3;return function(a,c,d){void 0===c&&(c=0),void 0===d&&(d=a.length);for(var e=0,f=c;d>e;e+=3,f+=3)b.x=a[f],b.y=a[f+1],b.z=a[f+2],b.applyMatrix4(this),a[f]=b.x,a[f+1]=b.y,a[f+2]=b.z;return a}},a.Matrix4.prototype.makeTranslation=function(a,b,c){return this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1),this},a.Matrix4.prototype.multiplyScalar=function(a){var b=this.elements;return b[0]*=a,b[4]*=a,b[8]*=a,b[12]*=a,b[1]*=a,b[5]*=a,b[9]*=a,b[13]*=a,b[2]*=a,b[6]*=a,b[10]*=a,b[14]*=a,b[3]*=a,b[7]*=a,b[11]*=a,b[15]*=a,this},a.Matrix4.prototype.set=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this.elements;return q[0]=a,q[4]=b,q[8]=c,q[12]=d,q[1]=e,q[5]=f,q[9]=g,q[13]=h,q[2]=i,q[6]=j,q[10]=k,q[14]=l,q[3]=m,q[7]=n,q[11]=o,q[15]=p,this},a.Matrix4.prototype.makeScale=function(a,b,c){return this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1),this},a}(cornerstoneMath),cornerstoneMath=function(a){"use strict";function b(a){return{x:a.pageX,y:a.pageY}}function c(a,b){return{x:a.x-b.x,y:a.y-b.y}}function d(a){return{x:a.x,y:a.y}}function e(a,b){return Math.sqrt(f(a,b))}function f(a,b){var d=c(a,b);return d.x*d.x+d.y*d.y}function g(a,b){return a.x<b.left||a.x>b.left+b.width||a.y<b.top||a.y>b.top+b.height?!1:!0}return void 0===a&&(a={}),a.point={subtract:c,copy:d,pageToPoint:b,distance:e,distanceSquared:f,insideRect:g},a}(cornerstoneMath),cornerstoneMath=function(a){"use strict";return void 0===a&&(a={}),a.Quaternion=function(a,b,c,d){this.x=a||0,this.y=b||0,this.z=c||0,this.w=void 0!==d?d:1},a.Quaternion.prototype.setFromAxisAngle=function(a,b){var c=b/2,d=Math.sin(c);return this.x=a.x*d,this.y=a.y*d,this.z=a.z*d,this.w=Math.cos(c),this},a.Quaternion.prototype.multiplyQuaternions=function(a,b){var c=a.x,d=a.y,e=a.z,f=a.w,g=b.x,h=b.y,i=b.z,j=b.w;return this.x=c*j+f*g+d*i-e*h,this.y=d*j+f*h+e*g-c*i,this.z=e*j+f*i+c*h-d*g,this.w=f*j-c*g-d*h-e*i,this},a.Quaternion.prototype.setFromRotationMatrix=function(a){var b,c=a.elements,d=c[0],e=c[4],f=c[8],g=c[1],h=c[5],i=c[9],j=c[2],k=c[6],l=c[10],m=d+h+l;return m>0?(b=.5/Math.sqrt(m+1),this.w=.25/b,this.x=(k-i)*b,this.y=(f-j)*b,this.z=(g-e)*b):d>h&&d>l?(b=2*Math.sqrt(1+d-h-l),this.w=(k-i)/b,this.x=.25*b,this.y=(e+g)/b,this.z=(f+j)/b):h>l?(b=2*Math.sqrt(1+h-d-l),this.w=(f-j)/b,this.x=(e+g)/b,this.y=.25*b,this.z=(i+k)/b):(b=2*Math.sqrt(1+l-d-h),this.w=(g-e)/b,this.x=(f+j)/b,this.y=(i+k)/b,this.z=.25*b),this},a}(cornerstoneMath),cornerstoneMath=function(a){"use strict";function b(a){var b={start:{x:a.left,y:a.top},end:{x:a.left+a.width,y:a.top}},c={start:{x:a.left+a.width,y:a.top},end:{x:a.left+a.width,y:a.top+a.height}},d={start:{x:a.left+a.width,y:a.top+a.height},end:{x:a.left,y:a.top+a.height}},e={start:{x:a.left,y:a.top+a.height},end:{x:a.left,y:a.top}},f=[b,c,d,e];return f}function c(c,d){var e=655535,f=b(c);return f.forEach(function(b){var c=a.lineSegment.distanceToPoint(b,d);e>c&&(e=c)}),e}return void 0===a&&(a={}),a.rect={distanceToPoint:c},a}(cornerstoneMath),cornerstoneMath=function(a){"use strict";return void 0===a&&(a={}),a.Vector3=function(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0},a.Vector3.prototype={constructor:a.Vector3,set:function(a,b,c){return this.x=a,this.y=b,this.z=c,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setZ:function(a){return this.z=a,this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+a)}},copy:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this},add:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b)):(this.x+=a.x,this.y+=a.y,this.z+=a.z,this)},addScalar:function(a){return this.x+=a,this.y+=a,this.z+=a,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this},sub:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b)):(this.x-=a.x,this.y-=a.y,this.z-=a.z,this)},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this},multiply:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b)):(this.x*=a.x,this.y*=a.y,this.z*=a.z,this)},multiplyScalar:function(a){return this.x*=a,this.y*=a,this.z*=a,this},multiplyVectors:function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this},applyAxisAngle:function(){var b;return function(c,d){return void 0===b&&(b=new a.Quaternion),this.applyQuaternion(b.setFromAxisAngle(c,d)),this}}(),applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[3]*c+e[6]*d,this.y=e[1]*b+e[4]*c+e[7]*d,this.z=e[2]*b+e[5]*c+e[8]*d,this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d+e[12],this.y=e[1]*b+e[5]*c+e[9]*d+e[13],this.z=e[2]*b+e[6]*c+e[10]*d+e[14],this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements,f=1/(e[3]*b+e[7]*c+e[11]*d+e[15]);return this.x=(e[0]*b+e[4]*c+e[8]*d+e[12])*f,this.y=(e[1]*b+e[5]*c+e[9]*d+e[13])*f,this.z=(e[2]*b+e[6]*c+e[10]*d+e[14])*f,this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z,h=a.w,i=h*b+f*d-g*c,j=h*c+g*b-e*d,k=h*d+e*c-f*b,l=-e*b-f*c-g*d;return this.x=i*h+l*-e+j*-g-k*-f,this.y=j*h+l*-f+k*-e-i*-g,this.z=k*h+l*-g+i*-f-j*-e,this},transformDirection:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d,this.y=e[1]*b+e[5]*c+e[9]*d,this.z=e[2]*b+e[6]*c+e[10]*d,this.normalize(),this},divide:function(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this},divideScalar:function(a){if(0!==a){var b=1/a;this.x*=b,this.y*=b,this.z*=b}else this.x=0,this.y=0,this.z=0;return this},min:function(a){return this.x>a.x&&(this.x=a.x),this.y>a.y&&(this.y=a.y),this.z>a.z&&(this.z=a.z),this},max:function(a){return this.x<a.x&&(this.x=a.x),this.y<a.y&&(this.y=a.y),this.z<a.z&&(this.z=a.z),this},clamp:function(a,b){return this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x),this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y),this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z),this},clampScalar:function(){var b,c;return function(d,e){return void 0===b&&(b=new a.Vector3,c=new a.Vector3),b.set(d,d,d),c.set(e,e,e),this.clamp(b,c)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();return 0!==b&&a!==b&&this.multiplyScalar(a/b),this},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this},cross:function(a,b){if(void 0!==b)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);var c=this.x,d=this.y,e=this.z;return this.x=d*a.z-e*a.y,this.y=e*a.x-c*a.z,this.z=c*a.y-d*a.x,this},crossVectors:function(a,b){var c=a.x,d=a.y,e=a.z,f=b.x,g=b.y,h=b.z;return this.x=d*h-e*g,this.y=e*f-c*h,this.z=c*g-d*f,this},projectOnVector:function(){var b,c;return function(d){return void 0===b&&(b=new a.Vector3),b.copy(d).normalize(),c=this.dot(b),this.copy(b).multiplyScalar(c)}}(),projectOnPlane:function(){var b;return function(c){return void 0===b&&(b=new a.Vector3),b.copy(this).projectOnVector(c),this.sub(b)}}(),reflect:function(){var b;return function(c){return void 0===b&&(b=new a.Vector3),this.sub(b.copy(c).multiplyScalar(2*this.dot(c)))}}(),angleTo:function(b){var c=this.dot(b)/(this.length()*b.length());return Math.acos(a.Math.clamp(c,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y,d=this.z-a.z;return b*b+c*c+d*d},setEulerFromRotationMatrix:function(){console.error("REMOVED: Vector3's setEulerFromRotationMatrix has been removed in favor of Euler.setFromRotationMatrix(), please update your code.")},setEulerFromQuaternion:function(){console.error("REMOVED: Vector3's setEulerFromQuaternion: has been removed in favor of Euler.setFromQuaternion(), please update your code.")},getPositionFromMatrix:function(a){return console.warn("DEPRECATED: Vector3's .getPositionFromMatrix() has been renamed to .setFromMatrixPosition(). Please update your code."),this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){return console.warn("DEPRECATED: Vector3's .getScaleFromMatrix() has been renamed to .setFromMatrixScale(). Please update your code."),this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,b){return console.warn("DEPRECATED: Vector3's .getColumnFromMatrix() has been renamed to .setFromMatrixColumn(). Please update your code."),this.setFromMatrixColumn(a,b)},setFromMatrixPosition:function(a){return this.x=a.elements[12],this.y=a.elements[13],this.z=a.elements[14],this},setFromMatrixScale:function(a){var b=this.set(a.elements[0],a.elements[1],a.elements[2]).length(),c=this.set(a.elements[4],a.elements[5],a.elements[6]).length(),d=this.set(a.elements[8],a.elements[9],a.elements[10]).length();return this.x=b,this.y=c,this.z=d,this},setFromMatrixColumn:function(a,b){var c=4*a,d=b.elements;return this.x=d[c],this.y=d[c+1],this.z=d[c+2],this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a){return this.x=a[0],this.y=a[1],this.z=a[2],this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new a.Vector3(this.x,this.y,this.z)}},a}(cornerstoneMath),cornerstoneTools=function(a,b,c){"use strict";function d(a){if(!("mousewheel"===a.originalEvent.type&&0===a.originalEvent.wheelDeltaY||"DOMMouseScroll"===a.originalEvent.type&&1===a.originalEvent.axis)){var c=a.currentTarget,d=b.pageToPixel(c,a.pageX,a.pageY);a=window.event||a;var e=a.wheelDelta||-a.detail||-a.originalEvent.detail,f=Math.max(-1,Math.min(1,e)),g=({element:c,viewport:b.getViewport(c),image:b.getEnabledElement(c).image,direction:f,pageX:a.pageX,pageY:a.pageY,imageX:d.x,imageY:d.y},new CustomEvent("CornerstoneToolsMouseWheel",{detail:{event:a,direction:f,viewport:b.getViewport(c),image:b.getEnabledElement(c).image,element:c},bubbles:!1,cancelable:!1}));c.dispatchEvent(g)}}function e(b){a(b).on(g,d)}function f(b){a(b).unbind(g,d)}void 0===c&&(c={});var g="mousewheel DOMMouseScroll";return c.mouseWheelInput={enable:e,disable:f},c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c,d){"use strict";function e(a){var b=new CustomEvent("CornerstoneToolsMouseDownActivate",{detail:a,bubbles:!1,cancelable:!0});a.element.dispatchEvent(b)}function f(f){function g(a){var e={page:c.point.pageToPoint(a),image:b.pageToPixel(i,a.pageX,a.pageY)},f={page:c.point.subtract(e.page,k.page),image:c.point.subtract(e.image,k.image)},g=new CustomEvent("CornerstoneToolsMouseDrag",{detail:{event:a,which:n,viewport:b.getViewport(i),image:b.getEnabledElement(i).image,element:i,startPoints:j,lastPoints:k,currentPoints:e,deltaPoints:f},bubbles:!1,cancelable:!0});return i.dispatchEvent(g),k=d.copyPoints(e),d.pauseEvent(a)}function h(d){var e={page:c.point.pageToPoint(d),image:b.pageToPixel(i,d.pageX,d.pageY)},f={page:c.point.subtract(e.page,k.page),image:c.point.subtract(e.image,k.image)},l=new CustomEvent("CornerstoneToolsMouseUp",{detail:{event:d,which:n,viewport:b.getViewport(i),image:b.getEnabledElement(i).image,element:i,startPoints:j,lastPoints:k,currentPoints:e,deltaPoints:f},bubbles:!1,cancelable:!1});i.dispatchEvent(l),a(document).off("mousemove",g),a(document).off("mouseup",h)}var i=(f.data,f.currentTarget),j={page:c.point.pageToPoint(f),image:b.pageToPixel(i,f.pageX,f.pageY)},k=d.copyPoints(j),l={event:f,which:f.which,viewport:b.getViewport(i),image:b.getEnabledElement(i).image,element:i,startPoints:j,lastPoints:k,currentPoints:j,deltaPoints:{x:0,y:0}},m=new CustomEvent("CornerstoneToolsMouseDown",{detail:l,bubbles:!1,cancelable:!0});if(i.dispatchEvent(m)===!0&&e(l)===!0)return d.pauseEvent(f);var n=f.which;return a(document).on("mousemove",g),a(document).on("mouseup",h),d.pauseEvent(f)
}function g(a){var e=(a.data,a.currentTarget),f={page:c.point.pageToPoint(a),image:b.pageToPixel(e,a.pageX,a.pageY)},g=d.copyPoints(f),h=a.which,i={page:c.point.pageToPoint(a),image:b.pageToPixel(e,a.pageX,a.pageY)},j={page:c.point.subtract(i.page,g.page),image:c.point.subtract(i.image,g.image)},k=new CustomEvent("CornerstoneToolsMouseMove",{detail:{event:a,which:h,viewport:b.getViewport(e),image:b.getEnabledElement(e).image,element:e,startPoints:f,lastPoints:g,currentPoints:i,deltaPoints:j},bubbles:!1,cancelable:!1});e.dispatchEvent(k),g=d.copyPoints(i)}function h(b){a(b).on("mousedown",f),a(b).on("mousemove",g)}function i(b){a(b).off("mousedown",f),a(b).off("mousemove",g)}return void 0===d&&(d={}),d.mouseInput={enable:h,disable:i},d}($,cornerstone,cornerstoneMath,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(b){var c={activate:function(c,d){a(c).off("CornerstoneToolsMouseDownActivate",b);var e={mouseButtonMask:d};a(c).on("CornerstoneToolsMouseDownActivate",e,b)},disable:function(c){a(c).off("CornerstoneToolsMouseDownActivate",b)},enable:function(c){a(c).off("CornerstoneToolsMouseDownActivate",b)},deactivate:function(c){a(c).off("CornerstoneToolsMouseDownActivate",b)}};return c}return void 0===c&&(c={}),c.simpleMouseButtonTool=d,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c,d){"use strict";function e(e){function f(b){var c=e.createNewMeasurement(b);d.addToolState(b.element,e.toolType,c),a(b.element).off("CornerstoneToolsMouseMove",h),d.moveHandle(b,c.handles.end,function(){d.anyHandlesOutsideImage(b,c.handles)&&d.removeToolState(b.element,e.toolType,c),a(b.element).on("CornerstoneToolsMouseMove",h)})}function g(a){var b=a.originalEvent.detail,c=a.data;return d.isMouseButtonEnabled(b.which,c.mouseButtonMask)?(f(b),!1):void 0}function h(a){var c=a.originalEvent.detail;if(0===c.which){var f=d.getToolState(c.element,e.toolType);if(void 0!==f){for(var g=!1,h=0;h<f.data.length;h++){var i=f.data[h];d.handleActivator(i.handles,c.currentPoints.image,c.viewport.scale)===!0&&(g=!0)}g===!0&&b.updateImage(c.element)}}}function i(a,b){for(var d in a.handles){var e=c.point.distanceSquared(a.handles[d],b);if(25>e)return a.handles[d]}}function j(b){function c(){d.anyHandlesOutsideImage(j,f.handles)&&d.removeToolState(j.element,e.toolType,f),a(j.element).on("CornerstoneToolsMouseMove",h)}var f,g=b.data,j=b.originalEvent.detail;if(d.isMouseButtonEnabled(j.which,g.mouseButtonMask)){var k,l=j.startPoints.image,m=d.getToolState(b.currentTarget,e.toolType);if(void 0!==m)for(k=0;k<m.data.length;k++){f=m.data[k];var n=i(f,l);if(void 0!==n)return a(j.element).off("CornerstoneToolsMouseMove",h),d.moveHandle(j,n,c),!1}if(void 0!==m&&void 0!==e.pointNearTool)for(k=0;k<m.data.length;k++)if(f=m.data[k],e.pointNearTool(f,l))return a(j.element).off("CornerstoneToolsMouseMove",h),d.moveAllHandles(b,f,m,!0),!1}}function k(c){a(c).off("CornerstoneImageRendered",e.onImageRendered),a(c).off("CornerstoneToolsMouseMove",h),a(c).off("CornerstoneToolsMouseDown",j),a(c).off("CornerstoneToolsMouseDownActivate",g),b.updateImage(c)}function l(c){a(c).off("CornerstoneImageRendered",e.onImageRendered),a(c).off("CornerstoneToolsMouseMove",h),a(c).off("CornerstoneToolsMouseDown",j),a(c).off("CornerstoneToolsMouseDownActivate",g),a(c).on("CornerstoneImageRendered",e.onImageRendered),b.updateImage(c)}function m(c,d){var f={mouseButtonMask:d};a(c).off("CornerstoneImageRendered",e.onImageRendered),a(c).off("CornerstoneToolsMouseMove",h),a(c).off("CornerstoneToolsMouseDown",j),a(c).off("CornerstoneToolsMouseDownActivate",g),a(c).on("CornerstoneImageRendered",e.onImageRendered),a(c).on("CornerstoneToolsMouseMove",f,h),a(c).on("CornerstoneToolsMouseDown",f,j),a(c).on("CornerstoneToolsMouseDownActivate",f,g),b.updateImage(c)}function n(c,d){var f={mouseButtonMask:d};a(c).off("CornerstoneImageRendered",e.onImageRendered),a(c).off("CornerstoneToolsMouseMove",h),a(c).off("CornerstoneToolsMouseDown",j),a(c).off("CornerstoneToolsMouseDownActivate",g),a(c).on("CornerstoneImageRendered",e.onImageRendered),a(c).on("CornerstoneToolsMouseMove",f,h),a(c).on("CornerstoneToolsMouseDown",f,j),b.updateImage(c)}var o={enable:l,disable:k,activate:m,deactivate:n};return o}return void 0===d&&(d={}),d.mouseButtonTool=e,d}($,cornerstone,cornerstoneMath,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(b){var c={activate:function(c){a(c).off("CornerstoneToolsMouseWheel",b);var d={};a(c).on("CornerstoneToolsMouseWheel",d,b)},disable:function(c){a(c).off("CornerstoneToolsMouseWheel",b)},enable:function(c){a(c).off("CornerstoneToolsMouseWheel",b)},deactivate:function(c){a(c).off("CornerstoneToolsMouseWheel",b)}};return c}return void 0===c&&(c={}),c.mouseWheelTool=d,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(b){var c={activate:function(c){a(c).off("CornerstoneToolsTouchDrag",b);var d={};a(c).on("CornerstoneToolsTouchDrag",d,b)},disable:function(c){a(c).off("CornerstoneToolsTouchDrag",b)},enable:function(c){a(c).off("CornerstoneToolsTouchDrag",b)},deactivate:function(c){a(c).off("CornerstoneToolsTouchDrag",b)}};return c}return void 0===c&&(c={}),c.touchDragTool=d,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(b){var c={activate:function(c){a(c).off("CornerstoneToolsTouchPinch",b);var d={};a(c).on("CornerstoneToolsTouchPinch",d,b)},disable:function(c){a(c).off("CornerstoneToolsTouchPinch",b)},enable:function(c){a(c).off("CornerstoneToolsTouchPinch",b)},deactivate:function(c){a(c).off("CornerstoneToolsTouchPinch",b)}};return c}return void 0===c&&(c={}),c.touchPinchTool=d,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c,d){"use strict";function e(a){var b={visible:!0,handles:{start:{x:a.currentPoints.image.x-20,y:a.currentPoints.image.y+10,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0},start2:{x:a.currentPoints.image.x-20,y:a.currentPoints.image.y+10,highlight:!0,active:!1},end2:{x:a.currentPoints.image.x,y:a.currentPoints.image.y+20,highlight:!0,active:!1}}};return b}function f(a,b){var d={start:a.handles.start,end:a.handles.end},e=c.lineSegment.distanceToPoint(d,b);return 5>e?!0:(d.start=a.handles.start2,d.end=a.handles.end2,e=c.lineSegment.distanceToPoint(d,b),5>e)}function g(a){var c=d.getToolState(a.currentTarget,h);if(void 0!==c){var e=a.originalEvent.detail,f=e.canvasContext.canvas.getContext("2d");b.setToPixelCoordinateSystem(e.enabledElement,f);for(var g=0;g<c.data.length;g++){f.save();var i=c.data[g];f.beginPath(),f.strokeStyle="white",f.lineWidth=1/e.viewport.scale,f.moveTo(i.handles.start.x,i.handles.start.y),f.lineTo(i.handles.end.x,i.handles.end.y),f.moveTo(i.handles.start2.x,i.handles.start2.y),f.lineTo(i.handles.end2.x,i.handles.end2.y),f.stroke(),f.beginPath(),d.drawHandles(f,e,i.handles),f.stroke(),f.fillStyle="white";var j=(Math.ceil(i.handles.start.x)-Math.ceil(i.handles.end.x))*e.image.columnPixelSpacing,k=(Math.ceil(i.handles.start.y)-Math.ceil(i.handles.end.y))*e.image.rowPixelSpacing,l=(Math.ceil(i.handles.start2.x)-Math.ceil(i.handles.end2.x))*e.image.columnPixelSpacing,m=(Math.ceil(i.handles.start2.y)-Math.ceil(i.handles.end2.y))*e.image.rowPixelSpacing,n=Math.acos(Math.abs((j*l+k*m)/(Math.sqrt(j*j+k*k)*Math.sqrt(l*l+m*m))));n*=180/Math.PI;var o=d.roundToDecimal(n,2),p="00B0",q=o.toString()+String.fromCharCode(parseInt(p,16)),r=d.setContextToDisplayFontSize(e.enabledElement,e.canvasContext,15);f.font=""+r.fontSize+"px Arial";var s=(i.handles.start2.x+i.handles.end2.x)/2/r.fontScale,t=(i.handles.start2.y+i.handles.end2.y)/2/r.fontScale;f.fillText(q,s,t),f.restore()}}}void 0===d&&(d={});var h="angle";return d.angle=d.mouseButtonTool({createNewMeasurement:e,onImageRendered:g,pointNearTool:f,toolType:h}),d}($,cornerstone,cornerstoneMath,cornerstoneTools),cornerstoneTools=function(a,b,c,d){"use strict";function e(a){var b={visible:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return b}function f(a,b){var d={left:Math.min(a.handles.start.x,a.handles.end.x),top:Math.min(a.handles.start.y,a.handles.end.y),width:Math.abs(a.handles.start.x-a.handles.end.x),height:Math.abs(a.handles.start.y-a.handles.end.y)},e=c.rect.distanceToPoint(d,b);return 5>e}function g(a,b){var c=a.width/2,d=a.height/2;if(0>=c||0>=d)return!1;var e={x:a.left+c,y:a.top+d},f={x:b.x-e.x,y:b.y-e.y},g=f.x*f.y/(c*c)+f.y*f.y/(d*d)<=1;return g}function h(a,b){for(var c=0,d=0,e=0,f=0,h=b.top;h<b.top+b.height;h++)for(var i=b.left;i<b.left+b.width;i++)g(b,{x:i,y:h})===!0&&(c+=a[f],d+=a[f]*a[f],e++),f++;if(0===e)return{count:e,mean:0,variance:0,stdDev:0};var j=c/e,k=d/e-j*j;return{count:e,mean:j,variance:k,stdDev:Math.sqrt(k)}}function i(a){var c=d.getToolState(a.currentTarget,j);if(void 0!==c){var e=a.originalEvent.detail,f=e.canvasContext.canvas.getContext("2d");b.setToPixelCoordinateSystem(e.enabledElement,f);for(var g=0;g<c.data.length;g++){f.save();var i=c.data[g],k=Math.abs(i.handles.start.x-i.handles.end.x),l=Math.abs(i.handles.start.y-i.handles.end.y),m=Math.min(i.handles.start.x,i.handles.end.x),n=Math.min(i.handles.start.y,i.handles.end.y),o=(i.handles.start.x+i.handles.end.x)/2,p=(i.handles.start.y+i.handles.end.y)/2;f.beginPath(),f.strokeStyle="white",f.lineWidth=1/e.viewport.scale,d.drawEllipse(f,m,n,k,l),f.closePath(),f.beginPath(),d.drawHandles(f,e,i.handles),f.stroke();var q=b.getStoredPixels(e.element,m,n,k,l),r={left:m,top:n,width:k,height:l},s=h(q,r),t=Math.PI*(k*e.image.columnPixelSpacing/2)*(l*e.image.rowPixelSpacing/2),u="Area: "+t.toFixed(2)+" mm^2",v=d.setContextToDisplayFontSize(e.enabledElement,e.canvasContext,15);f.font=""+v.fontSize+"px Arial";var w=f.measureText(t),x=v.lineHeight,y=o<e.image.columns/2?o+k/2:o-k/2-w.width*v.fontScale,z=p<e.image.rows/2?p+l/2:p-l/2;y/=v.fontScale,z/=v.fontScale,f.fillStyle="white",f.fillText("Mean: "+s.mean.toFixed(2),y,z-x),f.fillText("StdDev: "+s.stdDev.toFixed(2),y,z),f.fillText(u,y,z+x),f.restore()}}}void 0===d&&(d={});var j="ellipticalRoi";return d.ellipticalRoi=d.mouseButtonTool({createNewMeasurement:e,onImageRendered:i,pointNearTool:f,toolType:j}),d}($,cornerstone,cornerstoneMath,cornerstoneTools),cornerstoneTools=function(a,b,c,d){"use strict";function e(a){var b={visible:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return b}function f(a,b){var d={start:a.handles.start,end:a.handles.end},e=c.lineSegment.distanceToPoint(d,b);return 5>e}function g(a){var c=d.getToolState(a.currentTarget,h);if(void 0!==c){var e=a.originalEvent.detail,f=e.canvasContext.canvas.getContext("2d");b.setToPixelCoordinateSystem(e.enabledElement,f);for(var g=0;g<c.data.length;g++){f.save();var i=c.data[g];f.beginPath(),f.strokeStyle="white",f.lineWidth=1/e.viewport.scale,f.moveTo(i.handles.start.x,i.handles.start.y),f.lineTo(i.handles.end.x,i.handles.end.y),f.stroke(),f.beginPath(),d.drawHandles(f,e,i.handles),f.stroke(),f.fillStyle="white";var j=(i.handles.start.x-i.handles.end.x)*e.image.columnPixelSpacing,k=(i.handles.start.y-i.handles.end.y)*e.image.rowPixelSpacing,l=Math.sqrt(j*j+k*k),m=""+l.toFixed(2)+" mm",n=d.setContextToDisplayFontSize(e.enabledElement,e.canvasContext,15);f.font=""+n.fontSize+"px Arial";var o=(i.handles.start.x+i.handles.end.x)/2/n.fontScale,p=(i.handles.start.y+i.handles.end.y)/2/n.fontScale;f.fillText(m,o,p),f.restore()}}}void 0===d&&(d={});var h="length";return d.length=d.mouseButtonTool({createNewMeasurement:e,onImageRendered:g,pointNearTool:f,toolType:h}),d}($,cornerstone,cornerstoneMath,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(b){var c=b.originalEvent.detail;a(c.element).off("CornerstoneToolsMouseDrag",f),a(c.element).off("CornerstoneToolsMouseUp",d)}function e(b){var e=b.originalEvent.detail;return c.isMouseButtonEnabled(e.which,b.data.mouseButtonMask)?(a(e.element).on("CornerstoneToolsMouseDrag",f),a(e.element).on("CornerstoneToolsMouseUp",d),!1):void 0}function f(a){var c=a.originalEvent.detail;return c.viewport.translation.x+=c.deltaPoints.page.x/c.viewport.scale,c.viewport.translation.y+=c.deltaPoints.page.y/c.viewport.scale,b.setViewport(c.element,c.viewport),!1}function g(a){var c=a.originalEvent.detail;return c.viewport.translation.x+=c.deltaPoints.page.x/c.viewport.scale,c.viewport.translation.y+=c.deltaPoints.page.y/c.viewport.scale,b.setViewport(c.element,c.viewport),!1}return void 0===c&&(c={}),c.pan=c.simpleMouseButtonTool(e),c.panTouchDrag=c.touchDragTool(g),c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a){var b={visible:!0,handles:{end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return b}function e(a){var d=c.getToolState(a.currentTarget,f);if(void 0!==d){var e=a.originalEvent.detail,g=e.canvasContext.canvas.getContext("2d");b.setToPixelCoordinateSystem(e.enabledElement,g);for(var h=0;h<d.data.length;h++){g.save();var i=d.data[h];g.beginPath(),c.drawHandles(g,e,i.handles),g.stroke();var j=c.setContextToDisplayFontSize(e.enabledElement,e.canvasContext,15);g.font=""+j.fontSize+"px Arial";var k=Math.round(i.handles.end.x),l=Math.round(i.handles.end.y);m=i.handles.end.x+3,n=i.handles.end.y-3;var m=m/j.fontScale,n=n/j.fontScale;g.fillStyle="white";var o=b.getStoredPixels(e.element,k,l,1,1),p=o[0],q=p*e.image.slope+e.image.intercept;g.fillText(""+k+","+l,m,n),g.fillText("SP: "+p+" MO: "+q,m,n+j.lineHeight),g.restore()}}}void 0===c&&(c={});var f="probe";return c.probe=c.mouseButtonTool({createNewMeasurement:d,onImageRendered:e,toolType:f}),c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c,d){"use strict";function e(a){var b={visible:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return b}function f(a,b){var d={left:Math.min(a.handles.start.x,a.handles.end.x),top:Math.min(a.handles.start.y,a.handles.end.y),width:Math.abs(a.handles.start.x-a.handles.end.x),height:Math.abs(a.handles.start.y-a.handles.end.y)},e=c.rect.distanceToPoint(d,b);return 5>e}function g(a,b){for(var c=0,d=0,e=0,f=0,g=b.top;g<b.top+b.height;g++)for(var h=b.left;h<b.left+b.width;h++)c+=a[f],d+=a[f]*a[f],e++,f++;if(0===e)return{count:e,mean:0,variance:0,stdDev:0};var i=c/e,j=d/e-i*i;return{count:e,mean:i,variance:j,stdDev:Math.sqrt(j)}}function h(a){var c=d.getToolState(a.currentTarget,i);if(void 0!==c){var e=a.originalEvent.detail,f=e.canvasContext.canvas.getContext("2d");b.setToPixelCoordinateSystem(e.enabledElement,f);for(var h=0;h<c.data.length;h++){f.save();var j=c.data[h],k=Math.abs(j.handles.start.x-j.handles.end.x),l=Math.abs(j.handles.start.y-j.handles.end.y),m=Math.min(j.handles.start.x,j.handles.end.x),n=Math.min(j.handles.start.y,j.handles.end.y),o=(j.handles.start.x+j.handles.end.x)/2,p=(j.handles.start.y+j.handles.end.y)/2;f.beginPath(),f.strokeStyle="white",f.lineWidth=1/e.viewport.scale,f.rect(m,n,k,l),f.stroke(),f.beginPath(),d.drawHandles(f,e,j.handles),f.stroke();var q=b.getStoredPixels(e.element,m,n,k,l),r={left:m,top:n,width:k,height:l},s=g(q,r),t=k*e.image.columnPixelSpacing*l*e.image.rowPixelSpacing,u="Area: "+t.toFixed(2)+" mm^2",v=d.setContextToDisplayFontSize(e.enabledElement,e.canvasContext,15);f.font=""+v.fontSize+"px Arial";var w=f.measureText(t),x=v.lineHeight,y=o<e.image.columns/2?o+k/2:o-k/2-w.width*v.fontScale,z=p<e.image.rows/2?p+l/2:p-l/2;y/=v.fontScale,z/=v.fontScale,f.fillStyle="white",f.fillText("Mean: "+s.mean.toFixed(2),y,z-x),f.fillText("StdDev: "+s.stdDev.toFixed(2),y,z),f.fillText(u,y,z+x),f.restore()}}}void 0===d&&(d={});var i="rectangleRoi";return d.rectangleRoi=d.mouseButtonTool({createNewMeasurement:e,onImageRendered:h,pointNearTool:f,toolType:i}),d}($,cornerstone,cornerstoneMath,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(b){var c=b.originalEvent.detail;a(c.element).off("CornerstoneToolsMouseDrag",f),a(c.element).off("CornerstoneToolsMouseUp",d)}function e(b){var e=b.originalEvent.detail;return c.isMouseButtonEnabled(e.which,b.data.mouseButtonMask)?(a(e.element).on("CornerstoneToolsMouseDrag",f),a(e.element).on("CornerstoneToolsMouseUp",d),!1):void 0}function f(a){var c=a.originalEvent.detail,d=c.image.maxPixelValue-c.image.minPixelValue,e=d/1024;return c.viewport.voi.windowWidth+=c.deltaPoints.page.x*e,c.viewport.voi.windowCenter+=c.deltaPoints.page.y*e,b.setViewport(c.element,c.viewport),!1}function g(a){var c=a.originalEvent.detail,d=c.image.maxPixelValue-c.image.minPixelValue,e=d/1024;c.viewport.voi.windowWidth+=c.deltaPoints.page.x*e,c.viewport.voi.windowCenter+=c.deltaPoints.page.y*e,b.setViewport(c.element,c.viewport)}return void 0===c&&(c={}),c.wwwc=c.simpleMouseButtonTool(e),c.wwwcTouchDrag=c.touchDragTool(g),c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a,c,d){var e=1.7,f=Math.log(c.scale)/Math.log(e),g=f+d,h=Math.pow(e,g);c.scale=h,b.setViewport(a,c)}function e(b){var c=b.originalEvent.detail;a(c.element).off("CornerstoneToolsMouseDrag",g),a(c.element).off("CornerstoneToolsMouseUp",e)}function f(b){var d=b.originalEvent.detail;return c.isMouseButtonEnabled(d.which,b.data.mouseButtonMask)?(a(d.element).on("CornerstoneToolsMouseDrag",g),a(d.element).on("CornerstoneToolsMouseUp",e),!1):void 0}function g(a){var c=a.originalEvent.detail,e=c.deltaPoints.page.y/100;d(c.element,c.viewport,e);var f=b.pageToPixel(c.element,c.startPoints.page.x,c.startPoints.page.y);return c.viewport.translation.x-=c.startPoints.image.x-f.x,c.viewport.translation.y-=c.startPoints.image.y-f.y,b.setViewport(c.element,c.viewport),!1}function h(a){var b=a.originalEvent.detail,c=-b.direction/4;d(b.element,b.viewport,c)}function i(a){var b=a.originalEvent.detail;d(b.element,b.viewport,b.direction/4)}function j(a){var c=a.originalEvent.detail,e=c.deltaPoints.page.y/100;d(c.element,c.viewport,e);var f=b.pageToPixel(c.element,c.startPoints.page.x,c.startPoints.page.y);return c.viewport.translation.x-=c.startPoints.image.x-f.x,c.viewport.translation.y-=c.startPoints.image.y-f.y,b.setViewport(c.element,c.viewport),!1}return void 0===c&&(c={}),c.zoom=c.simpleMouseButtonTool(f),c.zoomWheel=c.mouseWheelTool(h),c.zoomTouchPinch=c.touchPinchTool(i),c.zoomTouchDrag=c.touchDragTool(j),c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c,d){"use strict";function e(e){if(e.gesture.preventDefault(),e.gesture.stopPropagation(),k!==!0){var f,g=e.currentTarget;if("transform"===e.type){var l=j-e.gesture.scale;j=e.gesture.scale,f=new CustomEvent("CornerstoneToolsTouchPinch",{detail:{event:e,viewport:b.getViewport(g),image:b.getEnabledElement(g).image,element:g,direction:0>l?1:-1},bubbles:!1,cancelable:!1})}else{if("dragstart"===e.type)return h={page:c.point.pageToPoint(e.gesture.touches[0]),image:b.pageToPixel(g,e.gesture.touches[0].pageX,e.gesture.touches[0].pageY)},void(i=d.copyPoints(h));if("drag"!==e.type)return;var m={page:c.point.pageToPoint(e.gesture.touches[0]),image:b.pageToPixel(g,e.gesture.touches[0].pageX,e.gesture.touches[0].pageY)},n={page:c.point.subtract(m.page,i.page),image:c.point.subtract(m.image,i.image)};f=new CustomEvent("CornerstoneToolsTouchDrag",{detail:{event:e,viewport:b.getViewport(g),image:b.getEnabledElement(g).image,element:g,startPoints:h,lastPoints:i,currentPoints:m,deltaPoints:n},bubbles:!1,cancelable:!1}),i=a.extend({},m)}k=!0,setTimeout(function(){g.dispatchEvent(f),k=!1},1)}}function f(b){var c={transform_always_block:!0,transform_min_scale:.01,drag_block_horizontal:!0,drag_block_vertical:!0,drag_min_distance:0};a(b).hammer(c).on("touch drag transform dragstart",e)}function g(b){a(b).hammer().off("touch drag transform dragstart",e)}void 0===d&&(d={});var h,i,j=1,k=!1;return d.touchInput={enable:f,disable:g},d}($,cornerstone,cornerstoneMath,cornerstoneTools),cornerstoneTools=function(a,b,c,d){"use strict";function e(a,b){var d=a.image,e={left:0,top:0,width:d.width,height:d.height},f=!1;for(var g in b){var h=b[g];c.point.insideRect(h,e)===!1&&(f=!0)}return f}return void 0===d&&(d={}),d.anyHandlesOutsideImage=e,d}($,cornerstone,cornerstoneMath,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a,b,c){a.strokeStyle="white";var d=e/b.viewport.scale;for(var f in c){var g=c[f];(g.active||g.highlight)&&(a.beginPath(),a.lineWidth=g.active?2/b.viewport.scale:.5/b.viewport.scale,a.arc(g.x,g.y,d,0,2*Math.PI),a.stroke())}}void 0===c&&(c={});var e=6;return c.drawHandles=d,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c,d){"use strict";function e(a,b,d){var e=h/d;for(var f in a){var g=a[f],i=c.point.distance(b,g);if(e>=i)return g}return void 0}function f(a){for(var b in a){var c=a[b];if(c.active===!0)return c}return void 0}function g(a,b,c){var d=f(a),g=e(a,b,c);return d!==g?(void 0!==g&&(g.active=!0),void 0!==d&&(d.active=!1),!0):!1}void 0===d&&(d={});var h=6;return d.handleActivator=g,d}($,cornerstone,cornerstoneMath,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(c,d,e){function f(a){var c=a.originalEvent.detail;d.x=c.currentPoints.image.x,d.y=c.currentPoints.image.y,b.updateImage(h)}function g(){d.eactive=!1,a(h).off("CornerstoneToolsMouseDrag",f),a(h).off("CornerstoneToolsMouseUp",g),b.updateImage(h),e()}var h=c.element;a(h).on("CornerstoneToolsMouseDrag",f),a(h).on("CornerstoneToolsMouseUp",g)}return void 0===c&&(c={}),c.moveHandle=d,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c,d){"use strict";function e(d,e,f,g){function h(a){var c=a.originalEvent.detail;for(var d in e.handles){var f=e.handles[d];f.x+=c.deltaPoints.image.x,f.y+=c.deltaPoints.image.y}return b.updateImage(k),!1}function i(d){e.moving=!1;var j=d.originalEvent.detail;if(a(k).off("CornerstoneToolsMouseDrag",h),a(k).off("CornerstoneToolsMouseUp",i),g===!0){var l=j.image,m=!1,n={top:0,left:0,width:l.width,height:l.height};for(var o in e.handles){var p=e.handles[o];c.point.insideRect(p,n)===!1&&(m=!0)}if(m){for(var q=-1,r=0;r<f.data.length;r++)f.data[r]===e&&(q=r);-1!==q&&f.data.splice(q,1)}}b.updateImage(k)}var j=d.originalEvent.detail,k=j.element;return a(k).on("CornerstoneToolsMouseDrag",h),a(k).on("CornerstoneToolsMouseUp",i),!0}return void 0===d&&(d={}),d.moveAllHandles=e,d}($,cornerstone,cornerstoneMath,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a,d){if(void 0===a)throw"playClip: element must not be undefined";void 0===d&&(d=30);var e=c.getToolState(a,"stack");if(void 0!==e&&void 0!==e.data&&0!==e.data.length){var g,h=e.data[0],i=c.getToolState(a,f);void 0===i||0===i.data.length?(g={intervalId:void 0,framesPerSecond:d,lastFrameTimeStamp:void 0,frameRate:0},c.addToolState(a,f,g)):(g=i.data[0],g.framesPerSecond=d),void 0===g.intervalId&&(g.intervalId=setInterval(function(){var c=h.currentImageIdIndex;if(g.framesPerSecond>0?c++:c--,c>=h.imageIds.length&&(c=0),0>c&&(c=h.imageIds.length-1),c!==h.currentImageIdIndex){var d=b.getViewport(a);b.loadAndCacheImage(h.imageIds[c]).then(function(e){h.currentImageIdIndex=c,b.displayImage(a,e,d)})}},1e3/Math.abs(g.framesPerSecond)))}}function e(a){var b,d=c.getToolState(a,f);void 0!==d&&0!==d.data.length&&(b=d.data[0],clearInterval(b.intervalId),b.intervalId=void 0)}void 0===c&&(c={});var f="playClip";return c.playClip=d,c.stopClip=e,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a){var e=c.getToolState(a,"stack");if(void 0!==e&&void 0!==e.data&&0!==e.data.length){var f=c.getToolState(a,g);if(void 0!==f){var h=f.data[0],i=e.data[0],j=h.prefetchImageIdIndex+1;if(j=Math.min(i.imageIds.length-1,j),j=Math.max(0,j),j===h.prefetchImageIdIndex)return void(h.enabled=!1);h.prefetchImageIdIndex=j;var k=i.imageIds[j],l=b.loadAndCacheImage(k);l.done(function(){setTimeout(function(){d(a)},1)})}}}function e(a){var b=c.getToolState(a,g);void 0===b&&(b={prefetchImageIdIndex:0,enabled:!0},c.addToolState(a,g,b)),d(a)}function f(a){var b=c.getToolState(a,g);void 0===b?(b={prefetchImageIdIndex:0,enabled:!1},c.addToolState(a,g,b)):b.enabled=!1}void 0===c&&(c={});var g="stackPrefetch";return c.stackPrefetch={enable:e,disable:f},c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a,d){var e=c.getToolState(a,"stack");if(void 0!==e&&void 0!==e.data&&0!==e.data.length){var f=e.data[0],g=f.currentImageIdIndex+d;if(g=Math.min(f.imageIds.length-1,g),g=Math.max(0,g),g!==f.currentImageIdIndex){var h=b.getViewport(a);b.loadAndCacheImage(f.imageIds[g]).then(function(c){f.currentImageIdIndex=g,b.displayImage(a,c,h)})}}}function e(b){var c=b.originalEvent.detail;a(c.element).off("CornerstoneToolsMouseDrag",g),a(c.element).off("CornerstoneToolsMouseUp",e)}function f(b){var d=b.originalEvent.detail;if(c.isMouseButtonEnabled(d.which,b.data.mouseButtonMask)){var f={deltaY:0};return a(d.element).on("CornerstoneToolsMouseDrag",f,g),a(d.element).on("CornerstoneToolsMouseUp",e),!1}}function g(a){var d=a.originalEvent.detail,e=a.data;e.deltaY+=d.deltaPoints.page.y;var f=c.getToolState(d.element,"stack");if(void 0!==f&&void 0!==f.data&&0!==f.data.length){var g=f.data[0];if(e.deltaY>=3||e.deltaY<=-3){var h=e.deltaY/3,i=e.deltaY%3,j=Math.round(h);e.deltaY=i;var k=g.currentImageIdIndex+j;if(k=Math.min(g.imageIds.length-1,k),k=Math.max(0,k),k!==g.currentImageIdIndex){g.currentImageIdIndex=k;var l=b.getViewport(d.element);b.loadAndCacheImage(g.imageIds[k]).then(function(a){b.displayImage(d.element,a,l)})}}return!1}}function h(a){var b=a.originalEvent.detail,c=-b.direction;d(b.element,c)}function i(a){var d=a.originalEvent.detail,e={deltaY:0};e.deltaY+=d.deltaPoints.page.y;var f=c.getToolState(d.element,"stack");if(void 0!==f&&void 0!==f.data&&0!==f.data.length){var g=f.data[0];if(e.deltaY>=3||e.deltaY<=-3){var h=e.deltaY/3,i=e.deltaY%3,j=Math.round(h);e.deltaY=i;var k=g.currentImageIdIndex+j;if(k=Math.min(g.imageIds.length-1,k),k=Math.max(0,k),k!==g.currentImageIdIndex){g.currentImageIdIndex=k;var l=b.getViewport(d.element);b.loadAndCacheImage(g.imageIds[k]).then(function(a){b.displayImage(d.element,a,l)})}}return!1}}void 0===c&&(c={});return c.stackScroll=c.simpleMouseButtonTool(f),c.stackScrollWheel=c.mouseWheelTool(h),c.stackScrollTouchDrag=c.touchDragTool(i),c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(){function a(a,c,e){var f=b.getEnabledElement(a);d.hasOwnProperty(f.image.imageId)===!1&&(d[f.image.imageId]={});var g=d[f.image.imageId];g.hasOwnProperty(c)===!1&&(g[c]={data:[]});var h=g[c];h.data.push(e)}function c(a,c){var e=b.getEnabledElement(a);if(d.hasOwnProperty(e.image.imageId)===!1)return void 0;var f=d[e.image.imageId];if(f.hasOwnProperty(c)===!1)return void 0;var g=f[c];return g}var d={},e={get:c,add:a};return e}void 0===c&&(c={});var e=d();return c.newImageIdSpecificToolStateManager=d,c.globalImageIdSpecificToolStateManager=e,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a,c){function d(d,e,g){if(!(a.indexOf(e)>=0))return c.add(d,e,g);b.getEnabledElement(d);f.hasOwnProperty(e)===!1&&(f[e]={data:[]});var h=f[e];h.data.push(g)}function e(b,d){if(a.indexOf(d)>=0){f.hasOwnProperty(d)===!1&&(f[d]={data:[]});var e=f[d];return e}return c.get(b,d)}var f={},g={get:e,add:d};return g}function e(a){var b=c.getElementToolStateManager(a);void 0===b&&(b=c.globalImageIdSpecificToolStateManager);var d=["stack","stackScroll","playClip","volume","slab"],e=c.newStackSpecificToolStateManager(d,b);f.push(e),c.setElementToolStateManager(a,e)}void 0===c&&(c={});var f=[];return c.newStackSpecificToolStateManager=d,c.addStackStateManager=e,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a){var d=b.getEnabledElement(a);return void 0===d.toolStateManager&&(d.toolStateManager=c.globalImageIdSpecificToolStateManager),d.toolStateManager}function e(a,b,c){var e=d(a);e.add(a,b,c)}function f(a,b){var c=d(a);return c.get(a,b)}function g(a,b,c){for(var e=d(a),f=e.get(a,b),g=-1,h=0;h<f.data.length;h++)f.data[h]===c&&(g=h);-1!==g&&f.data.splice(g,1)}function h(a,c){var d=b.getEnabledElement(a);d.toolStateManager=c}return void 0===c&&(c={}),c.addToolState=e,c.getToolState=f,c.removeToolState=g,c.setElementToolStateManager=h,c.getElementToolStateManager=d,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c}return void 0===c&&(c={}),c.roundToDecimal=d,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c,d){"use strict";function e(a){var b=c.point.copy(a.page),d=c.point.copy(a.image);return{page:b,image:d}}return void 0===d&&(d={}),d.copyPoints=e,d}($,cornerstone,cornerstoneMath,cornerstoneTools),cornerstoneTools=function(a){"use strict";function b(a,b,c,d,e){var f=.5522848,g=d/2*f,h=e/2*f,i=b+d,j=c+e,k=b+d/2,l=c+e/2;a.beginPath(),a.moveTo(b,l),a.bezierCurveTo(b,l-h,k-g,c,k,c),a.bezierCurveTo(k+g,c,i,l-h,i,l),a.bezierCurveTo(i,l+h,k+g,j,k,j),a.bezierCurveTo(k-g,j,b,l+h,b,l),a.closePath(),a.stroke()}return void 0===a&&(a={}),a.drawEllipse=b,a}(cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a,b){var c=1<<a-1;return 0!==(b&c)}return void 0===c&&(c={}),c.isMouseButtonEnabled=d,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a){return a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,a.returnValue=!1,!1}return void 0===c&&(c={}),c.pauseEvent=d,c}($,cornerstone,cornerstoneTools),cornerstone=function(a){"use strict";function b(b,c,d){var e=.1;a.setToPixelCoordinateSystem(b,c,e);var f=d/b.viewport.scale/e,g=d/b.viewport.scale/e;return{fontSize:f,lineHeight:g,fontScale:e}}return void 0===a&&(a={}),cornerstoneTools.setContextToDisplayFontSize=b,a}(cornerstone),cornerstoneWADOImageLoader=function(a,b,c){"use strict";function d(a){return"RGB"===a||"PALETTE COLOR"===a||"YBR_FULL"===a||"YBR_FULL_422"===a||"YBR_PARTIAL_422"===a||"YBR_PARTIAL_420"===a||"YBR_RCT"===a?!0:!1}function e(a,b,e){void 0===e&&(e=0);var f=a.string("x00280004"),g=d(f);return g===!1?c.makeGrayscaleImage(b,a,a.byteArray,f,e):c.makeColorImage(b,a,a.byteArray,f,e)}function f(b){var c=a.Deferred(),d=b;d=d.replace("dicomweb","http"),d=d.replace("dicomwebs","https");var f,h=d.indexOf("frame=");if(-1!==h){var i=d.substr(h+6);f=parseInt(i),d=d.substr(0,h-1)}if(void 0!==f&&g.hasOwnProperty(d)){var j=g[d],k=e(j,b,f);return k.then(function(a){c.resolve(a)},function(){c.reject()}),c}var l=new XMLHttpRequest;return l.open("get",d,!0),l.responseType="arraybuffer",l.onreadystatechange=function(){if(4===l.readyState)if(200===l.status){var a=l.response,h=new Uint8Array(a),i=dicomParser.parseDicom(h);void 0!==f&&(g[d]=i);var j=e(i,b,f);j.then(function(a){c.resolve(a)},function(){c.reject()})}else c.reject()},l.send(),c}void 0===c&&(c={});var g={};return b.registerImageLoader("dicomweb",f),b.registerImageLoader("dicomwebs",f),c}($,cornerstone,cornerstoneWADOImageLoader),cornerstoneWADOImageLoader=function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: rgbBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: rgbBuffer length must be divisble by 3";for(var c=a.length/3,d=0,e=0,f=0;c>f;f++)b[e++]=a[d++],b[e++]=a[d++],b[e++]=a[d++],b[e++]=255}return void 0===a&&(a={}),a.decodeRGB=b,a}(cornerstoneWADOImageLoader),cornerstoneWADOImageLoader=function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: ybrBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: ybrBuffer length must be divisble by 3";for(var c=a.length/3,d=0,e=0,f=0;c>f;f++){var g=a[d++],h=a[d++],i=a[d++];b[e++]=g+1.402*(i-128),b[e++]=g-.34414*(h-128)-.71414*(i-128),b[e++]=g+1.772*(h-128),b[e++]=255}}return void 0===a&&(a={}),a.decodeYBRFull=b,a
}(cornerstoneWADOImageLoader),cornerstoneWADOImageLoader=function(a){"use strict";function b(a){var b=a.string("x00280030");if(b&&b.length>0){var c=b.split("\\");return{row:parseFloat(c[0]),column:parseFloat(c[1])}}return{row:void 0,column:void 0}}return void 0===a&&(a={}),a.getPixelSpacing=b,a}(cornerstoneWADOImageLoader),cornerstoneWADOImageLoader=function(a){"use strict";function b(a){var b={intercept:0,slope:1},c=a.floatString("x00281052"),d=a.floatString("x00281053");return c&&(b.intercept=c),d&&(b.slope=d),b}return void 0===a&&(a={}),a.getRescaleSlopeAndIntercept=b,a}(cornerstoneWADOImageLoader),cornerstoneWADOImageLoader=function(a){"use strict";function b(a){var b={windowCenter:void 0,windowWidth:void 0},c=a.floatString("x00281050"),d=a.floatString("x00281051");return c&&(b.windowCenter=c),d&&(b.windowWidth=d),b}return void 0===a&&(a={}),a.getWindowWidthAndCenter=b,a}(cornerstoneWADOImageLoader),cornerstoneWADOImageLoader=function(a,b){"use strict";function c(c,d,f,g,h,i){e.height=h,e.width=g;var j,k=c.elements.x7fe00010,l=k.dataOffset,m=c.string("x00020010"),n=g*h*3,o=l+i*n,p=e.getContext("2d"),q=p.createImageData(g,h),r=a.Deferred();if("RGB"===f)return j=new Uint8Array(d.buffer,o),b.decodeRGB(j,q.data),r.resolve(q),r;if("YBR_FULL"===f)return j=new Uint8Array(d.buffer,o),b.decodeYBRFull(j,q.data),r.resolve(q),r;if("YBR_FULL_422"===f&&"1.2.840.10008.1.2.4.50"===m){j=dicomParser.readEncapsulatedPixelData(c,i);var s=new Blob([j],{type:"image/jpeg"}),t=new FileReader;return t.readAsBinaryString(s),t.onload=function(){var a=new Image;a.onload=function(){p.drawImage(this,0,0),q=p.getImageData(0,0,g,h),r.resolve(q)},a.onerror=function(){r.reject()},a.src="data:image/jpeg;base64,"+window.btoa(t.result)},r}throw"no codec for "+f}function d(d,g,h,i,j){var k=b.getPixelSpacing(g),l=g.uint16("x00280010"),m=g.uint16("x00280011"),n=b.getRescaleSlopeAndIntercept(g),o=4,p=l*m,q=p*o,r=b.getWindowWidthAndCenter(g),s=a.Deferred(),t=c(g,h,i,m,l,j);return t.then(function(a){function b(){return a.data}function c(){return a}function h(){if(f===d)return e;e.height=l,e.width=m;var b=e.getContext("2d");return b.putImageData(a,0,0),f=d,e}var i={imageId:d,minPixelValue:0,maxPixelValue:255,slope:n.slope,intercept:n.intercept,windowCenter:r.windowCenter,windowWidth:r.windowWidth,getPixelData:b,getImageData:c,getCanvas:h,rows:l,columns:m,height:l,width:m,color:!0,columnPixelSpacing:k.column,rowPixelSpacing:k.row,data:g,invert:!1,sizeInBytes:q,render:cornerstone.renderColorImage};void 0===i.windowCenter&&(i.windowWidth=255,i.windowCenter=128),s.resolve(i)},function(){s.reject()}),s}void 0===b&&(b={});var e=document.createElement("canvas"),f="";return b.makeColorImage=d,b}($,cornerstoneWADOImageLoader),cornerstoneWADOImageLoader=function(a,b){"use strict";function c(a){{var b=a.uint16("x00280103"),c=a.uint16("x00280100");a.string("x00280004")}return 0===b&&8===c?1:0===b&&16===c?2:1===b&&16===c?3:void 0}function d(a,b,d,e,f){var g=c(a),h=a.elements.x7fe00010,i=h.dataOffset,j=d*e,k=0;return 1===g?(k=i+f*j,new Uint8Array(b.buffer,k)):2===g?(k=i+f*j*2,new Uint16Array(b.buffer,k)):3===g?(k=i+f*j*2,new Int16Array(b.buffer,k)):void 0}function e(a){var b=c(a);if(1===b)return 1;if(2===b||3===b)return 2;throw"unknown pixel format"}function f(a){for(var b=65535,c=-32768,d=a.length,e=a,f=0;d>f;f++){var g=e[f];b=Math.min(b,g),c=Math.max(c,g)}return{min:b,max:c}}function g(c,g,h,i,j){function k(){return u}var l=b.getPixelSpacing(g),m=g.uint16("x00280010"),n=g.uint16("x00280011"),o=b.getRescaleSlopeAndIntercept(g),p=e(g),q=m*n,r=q*p,s="MONOCHROME1"===i,t=b.getWindowWidthAndCenter(g),u=d(g,h,n,m,j),v=f(u),w={imageId:c,minPixelValue:v.min,maxPixelValue:v.max,slope:o.slope,intercept:o.intercept,windowCenter:t.windowCenter,windowWidth:t.windowWidth,getPixelData:k,rows:m,columns:n,height:m,width:n,color:!1,columnPixelSpacing:l.column,rowPixelSpacing:l.row,data:g,invert:s,sizeInBytes:r,render:cornerstone.renderGrayscaleImage};if(void 0===w.windowCenter){var x=w.maxPixelValue*w.slope+w.intercept,y=w.minPixelValue*w.slope+w.intercept;w.windowWidth=x-y,w.windowCenter=(x+y)/2}var z=a.Deferred();return z.resolve(w),z}return void 0===b&&(b={}),b.makeGrayscaleImage=g,b}($,cornerstoneWADOImageLoader);!function(a,b){"use strict";function c(a,c){function d(){for(var b=g(),c=b.data,d=a.naturalHeight*a.naturalWidth,e=new Uint8Array(4*d),f=0,h=0,i=0;d>i;i++)e[h++]=c[f++],e[h++]=c[f++],e[h++]=c[f++],e[h++]=255,f++;return e}function g(){var b;f!==c?(e.height=a.naturalHeight,e.width=a.naturalWidth,b=e.getContext("2d"),b.drawImage(a,0,0)):b=e.getContext("2d");var d=b.getImageData(0,0,a.naturalWidth,a.naturalHeight);return d}function h(){if(f===c)return e;e.height=a.naturalHeight,e.width=a.naturalWidth;var b=e.getContext("2d");return b.drawImage(a,0,0),f=c,e}function i(){return a}var j=a.naturalHeight,k=a.naturalWidth,l={imageId:c,minPixelValue:0,maxPixelValue:255,slope:1,intercept:0,windowCenter:127,windowWidth:256,getPixelData:d,getImageData:g,getCanvas:h,getImage:i,rows:j,columns:k,height:j,width:k,color:!0,columnPixelSpacing:1,rowPixelSpacing:1,invert:!1,sizeInBytes:j*k*4,render:b.renderColorImage};return l}function d(b){var d=a.Deferred(),e=new Image;return e.crossOrigin="anonymous",e.onload=function(){var a=c(e,b);d.resolve(a)},e.onerror=function(){d.reject()},e.src=b,d}var e=document.createElement("canvas"),f="";return b.registerImageLoader("http",d),b.registerImageLoader("https",d),b}($,cornerstone),function(a,b){"function"==typeof define&&define.amd?define([],b):(void 0===dicomParser&&(dicomParser={}),dicomParser=b())}(this,function(){function a(a){function b(){h.seek(128);var a=h.readFixedString(4);if("DICM"!==a)throw"dicomParser.parseDicom: DICM prefix not found at location 132"}function c(){b();var a=dicomParser.readDicomElementExplicit(h),c=dicomParser.readUint32(h.byteArray,a.dataOffset),d=h.position+c,e=dicomParser.parseDicomDataSetExplicit(h,d);return e[a.tag]=a,e}function d(a){if(void 0===a.elements.x00020010)throw"dicomParser.parseDicom: missing required meta header attribute 0002,0010";var b=a.elements.x00020010,c=dicomParser.readFixedString(h.byteArray,b.dataOffset,b.length);if("1.2.840.10008.1.2"===c)return!1;if("1.2.840.10008.1.2.2"===c)throw"dicomParser.parseDicom: explicit big endian transfer syntax not supported";return!0}function e(a,b){for(var c in a.elements)a.elements.hasOwnProperty(c)&&(b.elements[c]=a.elements[c]);return b}function f(a){var b=d(a);return b?dicomParser.parseDicomDataSetExplicit(h):dicomParser.parseDicomDataSetImplicit(h)}function g(){var a=c(),b=f(a);return b.warnings=h.warnings,e(a,b)}if(void 0===a)throw"dicomParser.parseDicom: missing required parameter 'byteArray'";var h=new dicomParser.LittleEndianByteStream(a);return g()}return void 0===dicomParser?{parseDicom:a}:(dicomParser.parseDicom=a,dicomParser)});var dicomParser=function(a){"use strict";return void 0===a&&(a={}),a.readUint16=function(a,b){if(0>b)throw"dicomParser.readUint16: position cannot be less than 0";if(b+2>a.length)throw"dicomParser.readUint16: attempt to read past end of buffer";return a[b]+256*a[b+1]},a.readInt16=function(a,b){if(0>b)throw"dicomParser.readInt16: position cannot be less than 0";if(b+2>a.length)throw"dicomParser.readInt16: attempt to read past end of buffer";var c=a[b]+(a[b+1]<<8);return 32768&c&&(c=c-65535-1),c},a.readUint32=function(a,b){if(0>b)throw"dicomParser.readUint32: position cannot be less than 0";if(b+4>a.length)throw"dicomParser.readUint32: attempt to read past end of buffer";var c=a[b]+256*a[b+1]+256*a[b+2]*256+256*a[b+3]*256*256;return c},a.readInt32=function(a,b){if(0>b)throw"dicomParser.readInt32: position cannot be less than 0";if(b+4>a.length)throw"dicomParser.readInt32: attempt to read past end of buffer";var c=a[b]+(a[b+1]<<8)+(a[b+2]<<16)+(a[b+3]<<24);return c},a.readFloat=function(a,b){if(0>b)throw"dicomParser.readFloat: position cannot be less than 0";if(b+4>a.length)throw"dicomParser.readFloat: attempt to read past end of buffer";var c=new Uint8Array(4);c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3];var d=new Float32Array(c.buffer);return d[0]},a.readDouble=function(a,b){if(0>b)throw"dicomParser.readDouble: position cannot be less than 0";if(b+8>a.length)throw"dicomParser.readDouble: attempt to read past end of buffer";var c=new Uint8Array(8);c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7];var d=new Float64Array(c.buffer);return d[0]},a.readFixedString=function(a,b,c){if(0>c)throw"readFixedString - length cannot be less than 0";if(b+c>a.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var d="",e=0;c>e;e++){var f=a[b+e];if(0===f)return b+=c,d;d+=String.fromCharCode(f)}return d},a}(dicomParser),dicomParser=function(a){"use strict";return void 0===a&&(a={}),a.DataSet=function(a,b){this.byteArray=a,this.elements=b},a.DataSet.prototype.uint16=function(b,c){var d=this.elements[b];return c=void 0!==c?c:0,d&&0!==d.length?a.readUint16(this.byteArray,d.dataOffset+2*c):void 0},a.DataSet.prototype.int16=function(b,c){var d=this.elements[b];return c=void 0!==c?c:0,d&&0!==d.length?a.readInt16(this.byteArray,d.dataOffset+2*c):void 0},a.DataSet.prototype.uint32=function(b,c){var d=this.elements[b];return c=void 0!==c?c:0,d&&0!==d.length?a.readUint32(this.byteArray,d.dataOffset+4*c):void 0},a.DataSet.prototype.int32=function(b,c){var d=this.elements[b];return c=void 0!==c?c:0,d&&0!==d.length?a.readInt32(this.byteArray,d.dataOffset+4*c):void 0},a.DataSet.prototype.float=function(b,c){var d=this.elements[b];return c=void 0!==c?c:0,d&&0!==d.length?a.readFloat(this.byteArray,d.dataOffset+4*c):void 0},a.DataSet.prototype.double=function(b,c){var d=this.elements[b];return c=void 0!==c?c:0,d&&0!==d.length?a.readDouble(this.byteArray,d.dataOffset+8*c):void 0},a.DataSet.prototype.numStringValues=function(b){var c=this.elements[b];if(c&&c.length>0){var d=a.readFixedString(this.byteArray,c.dataOffset,c.length),e=d.match(/\\/g);return null===e?1:e.length+1}return void 0},a.DataSet.prototype.string=function(b,c){var d=this.elements[b];if(d&&d.length>0){var e=a.readFixedString(this.byteArray,d.dataOffset,d.length);if(c>=0){var f=e.split("\\");return f[c].trim()}return e.trim()}return void 0},a.DataSet.prototype.text=function(b,c){var d=this.elements[b];if(d&&d.length>0){var e=a.readFixedString(this.byteArray,d.dataOffset,d.length);if(c>=0){var f=e.split("\\");return f[c].replace(/ +$/,"")}return e.replace(/ +$/,"")}return void 0},a.DataSet.prototype.floatString=function(a,b){var c=this.elements[a];if(c&&c.length>0){b=void 0!==b?b:0;var d=this.string(a,b);if(void 0!==d)return parseFloat(d)}return void 0},a.DataSet.prototype.intString=function(a,b){var c=this.elements[a];if(c&&c.length>0){b=void 0!==b?b:0;var d=this.string(a,b);if(void 0!==d)return parseInt(d)}return void 0},a.DataSet.prototype.date=function(a){var b=this.string(a);if(b&&8===b.length){var c=parseInt(b.substring(0,4),10),d=parseInt(b.substring(4,6),10),e=parseInt(b.substring(6,8),10);return new Date(c,d-1,e)}return void 0},a.DataSet.prototype.time=function(a){var b=this.string(a);if(b&&b.length>=2){var c=parseInt(b.substring(0,2),10),d=b.length>=4?parseInt(b.substring(2,4),10):0,e=b.length>=6?parseInt(b.substring(4,6),10):0,f=b.length>=8?parseInt(b.substring(7,13),10):0;return{hours:c,minutes:d,seconds:e,fractionalSeconds:f}}return void 0},a.DataSet.prototype.personName=function(a,b){var c=this.string(a,b);if(c){var d=c.split("^");return{familyName:d[0],givenName:d[1],middleName:d[2],prefix:d[3],suffix:d[4]}}return void 0},a}(dicomParser),dicomParser=function(a){"use strict";return void 0===a&&(a={}),a.findItemDelimitationItemAndSetElementLength=function(a,b){if(void 0===a)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var c=8,d=a.byteArray.length-c;a.position<=d;){var e=a.readUint16();if(65534===e){var f=a.readUint16();if(57357===f){var g=a.readUint32();return 0!==g&&a.warnings("encountered non zero length following item delimeter at position"+a.position-4+" while reading element of undefined length with tag ' + element.tag"),void(b.length=a.position-b.dataOffset)}}}b.length=a.byteArray.length-b.dataOffset,a.seek(a.byteArray.length-a.position)},a}(dicomParser),dicomParser=function(a){"use strict";return void 0===a&&(a={}),a.LittleEndianByteStream=function(a,b){if(void 0===a)throw"dicomParser.LittleEndianByteStream: missing required parameter 'byteArray'";if(a instanceof Uint8Array==!1)throw"dicomParser.LittleEndianByteStream: parameter byteArray is not of type Uint8Array";if(0>b)throw"dicomParser.LittleEndianByteStream: parameter 'position' cannot be less than 0";if(b>=a.length)throw"dicomParser.LittleEndianByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArray=a,this.position=b?b:0,this.warnings=[]},a.LittleEndianByteStream.prototype.seek=function(a){if(this.position+a<0)throw"cannot seek to position < 0";this.position+=a},a.LittleEndianByteStream.prototype.readByteStream=function(b){if(this.position+b>this.byteArray.length)throw"readByteStream - buffer overread";var c=new Uint8Array(this.byteArray.buffer,this.position,b);return this.position+=b,new a.LittleEndianByteStream(c)},a.LittleEndianByteStream.prototype.readUint16=function(){var b=a.readUint16(this.byteArray,this.position);return this.position+=2,b},a.LittleEndianByteStream.prototype.readUint32=function(){var b=a.readUint32(this.byteArray,this.position);return this.position+=4,b},a.LittleEndianByteStream.prototype.readFixedString=function(b){var c=a.readFixedString(this.byteArray,this.position,b);return this.position+=b,c},a}(dicomParser),dicomParser=function(a){"use strict";return void 0===a&&(a={}),a.parseDicomDataSetExplicit=function(b,c){if(c=void 0===c?b.byteArray.length:c,void 0===b)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(c<b.position||c>b.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxPosition'";for(var d={};b.position<c;){var e=a.readDicomElementExplicit(b);d[e.tag]=e}return new a.DataSet(b.byteArray,d)},a.parseDicomDataSetImplicit=function(b,c){if(c=void 0===c?b.byteArray.length:c,void 0===b)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(c<b.position||c>b.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var d={};b.position<c;){var e=a.readDicomElementImplicit(b);d[e.tag]=e}return new a.DataSet(b.byteArray,d)},a}(dicomParser),dicomParser=function(a){"use strict";function b(a){return"OB"===a||"OW"===a||"SQ"===a||"OF"===a||"UT"===a||"UN"===a?4:2}return void 0===a&&(a={}),a.readDicomElementExplicit=function(c){if(void 0===c)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var d={tag:a.readTag(c),vr:c.readFixedString(2)},e=b(d.vr);return 2===e?(d.length=c.readUint16(),d.dataOffset=c.position):(c.seek(2),d.length=c.readUint32(),d.dataOffset=c.position),4294967295===d.length&&(d.hadUndefinedLength=!0),"SQ"===d.vr?(a.readSequenceItemsExplicit(c,d),d):4294967295===d.length?(a.findItemDelimitationItemAndSetElementLength(c,d),d):(c.seek(d.length),d)},a}(dicomParser),dicomParser=function(a){"use strict";return void 0===a&&(a={}),a.readDicomElementImplicit=function(b){if(void 0===b)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var c={tag:a.readTag(b),length:b.readUint32(),dataOffset:b.position};4294967295===c.length&&(c.hadUndefinedLength=!0);var d=a.readTag(b);return b.seek(-4),"xfffee000"===d?(a.readSequenceItemsImplicit(b,c),c.length=b.byteArray.length-c.dataOffset,c):4294967295===c.length?(a.findItemDelimitationItemAndSetElementLength(b,c),c):(b.seek(c.length),c)},a}(dicomParser),dicomParser=function(a){"use strict";function b(b,c,d,e){if(e>=d.length)throw"readFrame: parameter frame refers to frame not in frameOffsets";var f=d[e];b.position=c+f;var g=b.byteArray.length;e<d.length-1&&(g=d[e+1]);for(var h=[],i=0;b.position<g;){var j=a.readSequenceItem(b);if("xfffee0dd"===j.tag)break;h.push(j),i+=j.length,b.seek(j.length)}if(1===h.length)return new Uint8Array(b.byteArray.buffer,h[0].dataOffset,h[0].length);for(var k=new Uint8Array(i),l=0,m=0;m<h.length;m++)for(var n=h[m].dataOffset,o=0;o<h[m].length;o++)k[l++]=b.byteArray[n++];return k}return void 0===a&&(a={}),a.readEncapsulatedPixelData=function(c,d){if(void 0===c)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(void 0===d)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";var e=c.elements.x7fe00010;if(void 0===e)throw"dicomParser.readEncapsulatedPixelData: pixel data element x7fe00010 not present";var f=new a.LittleEndianByteStream(c.byteArray);f.seek(e.dataOffset);var g=a.readSequenceItem(f);if("xfffee000"!==g.tag)throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";var h=g.length/4;if(d>h-1)throw"dicomParser.readEncapsulatedPixelData: parameter frame exceeds number of frames in basic offset table";for(var i=[],j=0;h>j;j++){var k=f.readUint32();i.push(k)}var l=f.position,m=b(f,l,i,d);return m},a}(dicomParser),dicomParser=function(a){"use strict";function b(b){for(var c={};b.position<b.byteArray.length;){var d=a.readDicomElementExplicit(b);if(c[d.tag]=d,"xfffee00d"===d.tag)return new a.DataSet(b.byteArray,c)}return b.warnings.push("eof encountered before finding sequence delimitation item while reading sequence item of undefined length"),new a.DataSet(b.byteArray,c)}function c(c){var d=a.readSequenceItem(c);return 4294967295===d.length?(d.hadUndefinedLength=!0,d.dataSet=b(c),d.length=c.position-d.dataOffset):d.dataSet=a.parseDicomDataSetExplicit(c,c.position+d.length),d}function d(a,b){for(;a.position<a.byteArray.length;){var d=c(a);if(b.items.push(d),"xfffee0dd"===d.tag)return void(b.length=a.position-b.dataOffset)}a.warnings.push("eof encountered before finding sequence delimitation item in sequence element of undefined length with tag "+b.tag),b.length=a.byteArray.length-b.dataOffset}function e(a,b){for(var d=b.dataOffset+b.length;a.position<d;){var e=c(a);b.items.push(e)}}return void 0===a&&(a={}),a.readSequenceItemsExplicit=function(a,b){if(void 0===a)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(void 0===b)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";b.items=[],4294967295===b.length?d(a,b):e(a,b)},a}(dicomParser),dicomParser=function(a){"use strict";function b(b){for(var c={};b.position<b.byteArray.length;){var d=a.readDicomElementImplicit(b);if(c[d.tag]=d,"xfffee00d"===d.tag)return new a.DataSet(b.byteArray,c)}return b.warnings.push("eof encountered before finding sequence item delimeter in sequence item of undefined length"),new a.DataSet(b.byteArray,c)}function c(c){var d=a.readSequenceItem(c);return 4294967295===d.length?(d.hadUndefinedLength=!0,d.dataSet=b(c),d.length=c.position-d.dataOffset):d.dataSet=a.parseDicomDataSetImplicit(c,c.position+d.length),d}function d(a,b){for(;a.position<a.byteArray.length;){var d=c(a);if(b.items.push(d),"xfffee0dd"===d.tag)return void(b.length=a.position-b.dataOffset)}a.warnings.push("eof encountered before finding sequence delimitation item in sequence of undefined length"),b.length=a.byteArray.length-b.dataOffset}function e(a,b){for(var d=b.dataOffset+b.length;a.position<d;){var e=c(a);b.items.push(e)}}return void 0===a&&(a={}),a.readSequenceItemsImplicit=function(a,b){if(void 0===a)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(void 0===b)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";b.items=[],4294967295===b.length?d(a,b):e(a,b)},a}(dicomParser),dicomParser=function(a){"use strict";return void 0===a&&(a={}),a.readSequenceItem=function(b){if(void 0===b)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var c={tag:a.readTag(b),length:b.readUint32(),dataOffset:b.position};return c},a}(dicomParser),dicomParser=function(a){"use strict";return void 0===a&&(a={}),a.readTag=function(a){if(void 0===a)throw"dicomParser.readTag: missing required parameter 'byteStream'";var b=256*a.readUint16()*256,c=a.readUint16(),d="x"+("00000000"+(b+c).toString(16)).substr(-8);return d},a}(dicomParser);